-- Atlas UX — Supabase seed: workflows + workflow_steps + atlas_workflows
-- Generated: 2026-02-23T14:43:54.460190Z
CREATE EXTENSION IF NOT EXISTS pgcrypto;

DO $$ BEGIN
  IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name='workflows') THEN
    CREATE TABLE workflows (
      id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
      workflow_key text UNIQUE NOT NULL,
      agent_key text NOT NULL,
      name text NOT NULL,
      version text NOT NULL DEFAULT '1.0.0',
      status text NOT NULL DEFAULT 'ready',
      trigger jsonb NOT NULL DEFAULT '{}'::jsonb,
      policy jsonb NOT NULL DEFAULT '{}'::jsonb,
      outputs jsonb NOT NULL DEFAULT '{}'::jsonb,
      metadata jsonb NOT NULL DEFAULT '{}'::jsonb,
      created_at timestamptz NOT NULL DEFAULT now(),
      updated_at timestamptz NOT NULL DEFAULT now()
    );
  END IF;
END $$;
DO $$ BEGIN
  IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name='workflow_steps') THEN
    CREATE TABLE workflow_steps (
      id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
      workflow_key text NOT NULL,
      step_order int NOT NULL,
      step_id text NOT NULL,
      step_type text NOT NULL,
      description text NULL,
      config jsonb NOT NULL DEFAULT '{}'::jsonb,
      created_at timestamptz NOT NULL DEFAULT now(),
      updated_at timestamptz NOT NULL DEFAULT now(),
      CONSTRAINT workflow_steps_workflow_key_fkey
        FOREIGN KEY (workflow_key) REFERENCES workflows(workflow_key)
        ON DELETE CASCADE
    );
    CREATE UNIQUE INDEX workflow_steps_workflow_step_id_uq ON workflow_steps(workflow_key, step_id);
    CREATE UNIQUE INDEX workflow_steps_workflow_step_order_uq ON workflow_steps(workflow_key, step_order);
  END IF;
END $$;
DO $$ BEGIN
  IF NOT EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name='atlas_workflows') THEN
    CREATE TABLE atlas_workflows (
      workflow_id text PRIMARY KEY,
      agent_key text NOT NULL,
      workflow_doc jsonb NOT NULL,
      status text NOT NULL DEFAULT 'ready',
      version text NULL,
      name text NULL,
      trigger_type text NULL,
      created_at timestamptz NOT NULL DEFAULT now(),
      updated_at timestamptz NOT NULL DEFAULT now()
    );
  END IF;
END $$;
DO $$ BEGIN
  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name='agents') THEN
    -- Add FK only if it doesn't already exist
    IF NOT EXISTS (
      SELECT 1 FROM information_schema.table_constraints 
      WHERE constraint_name='workflows_agent_key_fkey' AND table_name='workflows'
    ) THEN
      ALTER TABLE workflows
        ADD CONSTRAINT workflows_agent_key_fkey
        FOREIGN KEY (agent_key) REFERENCES agents(agent_key)
        ON DELETE CASCADE;
    END IF;
  END IF;
END $$;

-- === SEED DATA ===
-- N8N-ATLAS_orchestrator_FULL_email_endpoint (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"ATLAS Orchestrator - FULL (Email Endpoint)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/ATLAS_orchestrator_FULL_email_endpoint.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "ATLAS Orchestrator - FULL (Email Endpoint)", "active": false}, "sourcePath": "workflows/n8n/ATLAS_orchestrator_FULL_email_endpoint.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "ATLAS Orchestrator - FULL (Email Endpoint)", "nodes": [{"parameters": {"triggerTimes": {"item": [{"mode": "everyDay", "hour": 8, "minute": 5}]}}, "id": "n_cron", "name": "Cron Daily", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 180]}, {"parameters": {"values": {"string": [{"name": "run_id", "value": "={{$now.toISO() + '::' + $execution.id}}"}, {"name": "atlas_email", "value": "atlas@deadapp.info"}, {"name": "audit_cc", "value": "larry.auditor@deadapp.info"}]}, "options": {}}, "id": "n_set_meta", "name": "Set Meta", "type": "n8n-nodes-base.set", "typeVersion": 2, "position": [480, 180]}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst agents = {\n  // core\n  BINKY:  { email: 'binky.cro@deadapp.info', role: 'Chief Research Analyst' },\n  TINA:   { email: 'tina.cfo@deadapp.info', role: 'CFO' },\n  LARRY:  { email: 'larry.auditor@deadapp.info', role: 'Chief Auditor' },\n  BENNY:  { email: 'benny.cto@deadapp.info', role: 'CTO/IP Counsel' },\n  JENNY:  { email: 'jenny.clo@deadapp.info', role: 'CLO' },\n  CHERYL: { email: 'support@deadapp.info', role: 'Support' },\n\n  // platform intel gatherers\n  CORNWALL: { email: 'cornwall.pinterest@deadapp.info', role: 'Pinterest Intel' },\n  DONNA:    { email: 'donna.redditor@deadapp.info', role: 'Reddit Intel' },\n  DWIGHT:   { email: 'dwight@deadapp.info', role: 'Threads Intel' },\n  EMMA:     { email: 'emma.alignable@deadapp.info', role: 'Alignable Intel' },\n  FRAN:     { email: 'fran.facebook@deadapp.info', role: 'Facebook Scraper' },\n  KELLY:    { email: 'kelly.x@deadapp.info', role: 'X Intel' },\n  LINK:     { email: 'link.linkedin@deadapp.info', role: 'LinkedIn Intel' },\n  TERRY:    { email: 'terry.tumblr@deadapp.info', role: 'Tumblr' },\n  TIMMY:    { email: 'timmy.tiktok@deadapp.info', role: 'TikTok' },\n\n  // subagents producing drafts\n  SUNDAY:   { email: 'sunday.teambinky@deadapp.info', role: 'Documentation' },\n  ARCHY:    { email: 'archy.binkypro@deadapp.info', role: 'Instagram Ops' },\n  REYNOLDS: { email: 'reynolds.blogger@deadapp.info', role: 'Blog Writer' },\n  PENNY:    { email: 'penny.facebook@deadapp.info', role: 'Facebook Page Manager' },\n  VENNY:    { email: 'venny.videographer@deadapp.info', role: 'Video Production' },\n  MERCER:   { email: 'mercer.teambinky@deadapp.info', role: 'Customer Acquisition Specialist' }\n};\n\nconst stages = {\n  intel_agents: ['CORNWALL','DONNA','DWIGHT','EMMA','FRAN','KELLY','LINK','TERRY','TIMMY'],\n  draft_agents: ['SUNDAY','ARCHY','REYNOLDS','PENNY','VENNY','MERCER'],\n  publish_agents: ['PENNY','ARCHY','TERRY','DWIGHT','KELLY','CORNWALL','TIMMY']\n};\n\nreturn [{\n  json: {\n    ...$json,\n    agents,\n    stages,\n    state: {\n      run_id,\n      intel: {},\n      binky_summary: null,\n      drafts: {},\n      receipts: {},\n      attempts: { intel: 0, binky: 0, drafts: 0, approval: 0, receipts: 0 }\n    }\n  }\n}];"}, "id": "n_registry", "name": "Build Agent Registry", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [720, 180]}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.intel_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, stage: 'INTEL_REQUEST', toList, subject: `[ATLAS][${run_id}] INTEL_REQUEST`,\nbody: `Return ONLY JSON between markers.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"agent\\\\\\\": \\\\\\\"<YOUR_NAME>\\\\\\\",\\n  \\\\\\\"platform\\\\\\\": \\\\\\\"<PLATFORM>\\\\\\\",\\n  \\\\\\\"items\\\\\\\": [ {\\\\\\\"title\\\\\\\":\\\\\\\"...\\\\\\\",\\\\\\\"url\\\\\\\":\\\\\\\"...\\\\\\\"} ],\\n  \\\\\\\"notes\\\\\\\": \\\\\\\"...\\\\\\\"\\n}\\n---END_JSON---\\n\\nNo publishing. Include sources/links.` } }];"}, "id": "n_prep_intel", "name": "Prep Intel Email", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_intel", "name": "Email Send: Intel Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1200, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_intel", "name": "Wait: Intel Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [1440, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] INTEL_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_intel", "name": "IMAP Search: Intel Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [1680, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.intel_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n\n  // map sender -> agent key\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.intel[key] = parsed;\n}\n\nstate.attempts.intel = (state.attempts.intel || 0) + 1;\nconst got = Object.keys(state.intel);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, intel_status: { got, missing, attempt: state.attempts.intel } } }];"}, "id": "n_accum_intel", "name": "Accumulate Intel", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [1920, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.intel_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_intel_complete", "name": "IF Intel Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2160, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.intel}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_intel_retry", "name": "IF Intel Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2400, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: INTEL_INCOMPLETE'}}", "text": "={{'Intel missing after retries: ' + JSON.stringify($json.intel_status.missing) + '\\nAttempt: ' + $json.intel_status.attempt}}"}, "id": "n_intel_escalate", "name": "Email Escalate: Intel Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nreturn [{ json: { ...$json, subject: `[ATLAS][${run_id}] REQUEST_BINKY_DAILY_SUMMARY_JSON`,\nbody: `BINKY — produce the Daily Structured Summary JSON with citations.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"headlines\\\\\\\":[],\\n  \\\\\\\"trends\\\\\\\":[],\\n  \\\\\\\"hashtags\\\\\\\":[],\\n  \\\\\\\"viral_content\\\\\\\":[],\\n  \\\\\\\"sentiment_analysis\\\\\\\":{},\\n  \\\\\\\"risk_flags\\\\\\\":[],\\n  \\\\\\\"opportunities\\\\\\\":[]\\n}\\n---END_JSON---\\n\\nUse gathered intel and your research. Return ONLY JSON in markers.` } }];"}, "id": "n_prep_binky", "name": "Prep Email: Binky Summary", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [2400, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_binky", "name": "Email Send: Binky Summary Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_binky", "name": "Wait: Binky Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [2880, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] REQUEST_BINKY_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_binky", "name": "IMAP Search: Binky Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [3120, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst state = $json.state;\nstate.attempts.binky = (state.attempts.binky||0) + 1;\n\nlet found = null;\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (parsed) { found = parsed; break; }\n}\n\nif (found) state.binky_summary = found;\n\nconst required = [\"headlines\",\"trends\",\"hashtags\",\"viral_content\",\"sentiment_analysis\",\"risk_flags\",\"opportunities\"]; \nconst ok = !!state.binky_summary && required.every(k => Object.prototype.hasOwnProperty.call(state.binky_summary, k));\n\nreturn [{ json: { ...$json, state, binky_status: { ok, attempt: state.attempts.binky } } }];"}, "id": "n_validate_binky", "name": "Validate Binky JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3360, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.binky_status.ok}}", "value2": true}]}}, "id": "n_if_binky_ok", "name": "IF Binky OK", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3600, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.binky}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_binky_retry", "name": "IF Binky Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3840, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] RETRY: BINKY_SUMMARY_INVALID'}}", "text": "={{'Your summary is missing required fields. Return ONLY JSON in markers. Run: ' + $json.run_id}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_binky_retry_email", "name": "Email Send: Binky Retry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4080, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst summary = $json.state.binky_summary;\nconst tasks = $json.stages.draft_agents.map(k => ({ key: k, to: $json.agents[k].email }));\nreturn tasks.map(t => ({ json: { ...$json, task: t, subject: `[ATLAS][${run_id}] TASK_DISPATCH::${t.key}`, body: `${t.key} — Use Binky Summary JSON. Return ONLY DRAFT in markers.\\n\\n---BEGIN_JSON---\\n${JSON.stringify(summary)}\\n---END_JSON---\\n\\n---BEGIN_DRAFT---\\n...\\n---END_DRAFT---\\n\\nNo publishing.` } }));"}, "id": "n_make_tasks", "name": "Build Draft Tasks", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3840, 180]}, {"parameters": {"batchSize": 1, "options": {}}, "id": "n_split_tasks", "name": "Split Tasks", "type": "n8n-nodes-base.splitInBatches", "typeVersion": 3, "position": [4080, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.task.to}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_task", "name": "Email Send: Draft Task", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4320, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 5, "unit": "seconds"}, "id": "n_wait_task_pace", "name": "Wait: Pace", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4560, 180]}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_drafts", "name": "Wait: Draft Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4800, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] TASK_DISPATCH\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_drafts", "name": "IMAP Search: Draft Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [5040, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractDraft(text){\n  const m = (text||'').match(/---BEGIN_DRAFT---([\\s\\S]*?)---END_DRAFT---/);\n  return m ? m[1].trim() : null;\n}\n\nconst required = $json.stages.draft_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const draft = extractDraft(body);\n  if (!draft) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.drafts[key] = { draft, receivedAt: new Date().toISOString() };\n}\n\nstate.attempts.drafts = (state.attempts.drafts || 0) + 1;\nconst got = Object.keys(state.drafts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, draft_status: { got, missing, attempt: state.attempts.drafts } } }];"}, "id": "n_accum_drafts", "name": "Accumulate Drafts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [5280, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.draft_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_drafts_complete", "name": "IF Drafts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5520, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.drafts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_drafts_retry", "name": "IF Draft Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5760, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: DRAFTS_INCOMPLETE'}}", "text": "={{'Drafts missing: ' + JSON.stringify($json.draft_status.missing) + '\\nAttempt: ' + $json.draft_status.attempt + '\\nProceeding to approval package with partial drafts (logged).'}}"}, "id": "n_drafts_escalate", "name": "Email Escalate: Drafts Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BENNY.email + ',' + $json.agents.JENNY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] POLICY/LEGAL REVIEW PING'}}", "text": "={{'Review draft package for policy/legal risk. Reply with JSON: {\"run_id\":\"...\",\"ok\":true/false,\"notes\":\"...\"} in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"run_id\":\"' + $json.run_id + '\",\\n  \"ok\": true,\\n  \"notes\": \"\"\\n}\\n---END_JSON---'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_ping_legal", "name": "Email Send: Benny+Jenny Review Ping", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [5760, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.atlas_email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED'}}", "text": "={{'Reply with EXACTLY one line:\\nAPPROVE ' + $json.run_id + '\\nor\\nDENY ' + $json.run_id + ' <notes>\\n\\nAudit CC: Larry'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_approval", "name": "Email Send: Approval Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_approval", "name": "Wait: Approval Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [6240, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_approval", "name": "IMAP Search: Approval Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [6480, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "const state = $json.state;\nstate.attempts.approval = (state.attempts.approval||0) + 1;\n\nlet decision = null;\nlet notes = '';\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const m1 = body.match(/\\bAPPROVE\\s+(.+)/i);\n  const m2 = body.match(/\\bDENY\\s+(.+)/i);\n  if (m1 && m1[1].includes($json.run_id)) { decision = 'APPROVE'; break; }\n  if (m2 && m2[1].includes($json.run_id)) { decision = 'DENY'; notes = m2[0]; break; }\n}\n\nreturn [{ json: { ...$json, state, approval: { decision, notes, attempt: state.attempts.approval } } }];"}, "id": "n_parse_approval", "name": "Parse Approval", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [6720, 180]}, {"parameters": {"conditions": {"string": [{"value1": "={{$json.approval.decision}}", "operation": "equals", "value2": "APPROVE"}]}}, "id": "n_if_approved", "name": "IF Approved", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [6960, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] STOP: DENIED OR NO APPROVAL'}}", "text": "={{'Approval status: ' + JSON.stringify($json.approval) + '\\nNo publish commands sent.'}}"}, "id": "n_denied_notify", "name": "Email Notify: Denied/No Approval", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7200, 40], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.publish_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, toList, subject: `[ATLAS][${run_id}] PUBLISH_COMMAND`, body: `Publish ONLY the approved assets for run ${run_id}.\\nReturn receipt JSON in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"agent\":\"<YOUR_NAME>\",\\n  \"run_id\":\"${run_id}\",\\n  \"platform\":\"...\",\\n  \"status\":\"posted\",\\n  \"url\":\"...\"\\n}\\n---END_JSON---` } }];"}, "id": "n_prep_publish", "name": "Prep Publish Command", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [7200, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_publish", "name": "Email Send: Publish Commands", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7440, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_receipts", "name": "Wait: Receipt Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [7680, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] PUBLISH_COMMAND\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_receipts", "name": "IMAP Search: Publish Receipts", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [7920, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.publish_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.receipts[key] = parsed;\n}\n\nstate.attempts.receipts = (state.attempts.receipts || 0) + 1;\nconst got = Object.keys(state.receipts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, receipt_status: { got, missing, attempt: state.attempts.receipts } } }];"}, "id": "n_accum_receipts", "name": "Accumulate Receipts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [8160, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.receipt_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_receipts_complete", "name": "IF Receipts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8400, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.receipts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_receipts_retry", "name": "IF Receipt Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8640, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: RECEIPTS_INCOMPLETE'}}", "text": "={{'Missing receipts after retries: ' + JSON.stringify($json.receipt_status.missing)}}"}, "id": "n_receipts_escalate", "name": "Email Escalate: Missing Receipts -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.LARRY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_AUDIT_VALIDATE'}}", "text": "={{'Validate full chain for run ' + $json.run_id + '. Receipts: ' + JSON.stringify($json.state.receipts)}}"}, "id": "n_eod_larry", "name": "Email Send: EOD Audit -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.TINA.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_FINANCE_REVIEW'}}", "text": "={{'Review ledger refs / monetization impacts for run ' + $json.run_id}}"}, "id": "n_eod_tina", "name": "Email Send: EOD Finance -> Tina", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [9120, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}], "connections": {"Cron Daily": {"main": [[{"node": "Set Meta", "type": "main", "index": 0}]]}, "Set Meta": {"main": [[{"node": "Build Agent Registry", "type": "main", "index": 0}]]}, "Build Agent Registry": {"main": [[{"node": "Prep Intel Email", "type": "main", "index": 0}]]}, "Prep Intel Email": {"main": [[{"node": "Email Send: Intel Request", "type": "main", "index": 0}]]}, "Email Send: Intel Request": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}]]}, "Wait: Intel Poll": {"main": [[{"node": "IMAP Search: Intel Replies", "type": "main", "index": 0}]]}, "IMAP Search: Intel Replies": {"main": [[{"node": "Accumulate Intel", "type": "main", "index": 0}]]}, "Accumulate Intel": {"main": [[{"node": "IF Intel Complete", "type": "main", "index": 0}]]}, "IF Intel Complete": {"main": [[{"node": "Prep Email: Binky Summary", "type": "main", "index": 0}], [{"node": "IF Intel Retry < 10", "type": "main", "index": 0}]]}, "IF Intel Retry < 10": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Intel Missing -> Larry", "type": "main", "index": 0}]]}, "Prep Email: Binky Summary": {"main": [[{"node": "Email Send: Binky Summary Request", "type": "main", "index": 0}]]}, "Email Send: Binky Summary Request": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}, "Wait: Binky Poll": {"main": [[{"node": "IMAP Search: Binky Reply", "type": "main", "index": 0}]]}, "IMAP Search: Binky Reply": {"main": [[{"node": "Validate Binky JSON", "type": "main", "index": 0}]]}, "Validate Binky JSON": {"main": [[{"node": "IF Binky OK", "type": "main", "index": 0}]]}, "IF Binky OK": {"main": [[{"node": "Build Draft Tasks", "type": "main", "index": 0}], [{"node": "IF Binky Retry < 10", "type": "main", "index": 0}]]}, "IF Binky Retry < 10": {"main": [[{"node": "Email Send: Binky Retry", "type": "main", "index": 0}], [{"node": "Email Send: Binky Retry", "type": "main", "index": 0}]]}, "Email Send: Binky Retry": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}, "Build Draft Tasks": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}, "Split Tasks": {"main": [[{"node": "Email Send: Draft Task", "type": "main", "index": 0}], [{"node": "Wait: Draft Poll", "type": "main", "index": 1}]]}, "Email Send: Draft Task": {"main": [[{"node": "Wait: Pace", "type": "main", "index": 0}]]}, "Wait: Pace": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}, "Wait: Draft Poll": {"main": [[{"node": "IMAP Search: Draft Replies", "type": "main", "index": 0}]]}, "IMAP Search: Draft Replies": {"main": [[{"node": "Accumulate Drafts", "type": "main", "index": 0}]]}, "Accumulate Drafts": {"main": [[{"node": "IF Drafts Complete", "type": "main", "index": 0}]]}, "IF Drafts Complete": {"main": [[{"node": "Email Send: Benny+Jenny Review Ping", "type": "main", "index": 0}], [{"node": "IF Draft Retry < 10", "type": "main", "index": 0}]]}, "IF Draft Retry < 10": {"main": [[{"node": "Wait: Draft Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Drafts Missing -> Larry", "type": "main", "index": 0}]]}, "Email Send: Benny+Jenny Review Ping": {"main": [[{"node": "Email Send: Approval Request", "type": "main", "index": 0}]]}, "Email Send: Approval Request": {"main": [[{"node": "Wait: Approval Poll", "type": "main", "index": 0}]]}, "Wait: Approval Poll": {"main": [[{"node": "IMAP Search: Approval Reply", "type": "main", "index": 0}]]}, "IMAP Search: Approval Reply": {"main": [[{"node": "Parse Approval", "type": "main", "index": 0}]]}, "Parse Approval": {"main": [[{"node": "IF Approved", "type": "main", "index": 0}]]}, "IF Approved": {"main": [[{"node": "Prep Publish Command", "type": "main", "index": 0}], [{"node": "Email Notify: Denied/No Approval", "type": "main", "index": 0}]]}, "Prep Publish Command": {"main": [[{"node": "Email Send: Publish Commands", "type": "main", "index": 0}]]}, "Email Send: Publish Commands": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}]]}, "Wait: Receipt Poll": {"main": [[{"node": "IMAP Search: Publish Receipts", "type": "main", "index": 0}]]}, "IMAP Search: Publish Receipts": {"main": [[{"node": "Accumulate Receipts", "type": "main", "index": 0}]]}, "Accumulate Receipts": {"main": [[{"node": "IF Receipts Complete", "type": "main", "index": 0}]]}, "IF Receipts Complete": {"main": [[{"node": "Email Send: EOD Audit -> Larry", "type": "main", "index": 0}], [{"node": "IF Receipt Retry < 10", "type": "main", "index": 0}]]}, "IF Receipt Retry < 10": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Missing Receipts -> Larry", "type": "main", "index": 0}]]}, "Email Send: EOD Audit -> Larry": {"main": [[{"node": "Email Send: EOD Finance -> Tina", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionTimeout": 14400, "saveExecutionProgress": true, "saveDataErrorExecution": "all", "saveDataSuccessExecution": "all"}, "versionId": "atlas-orchestrator-email-full-v1"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ATLAS Orchestrator - FULL (Email Endpoint)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 1, $$"n_cron"$$::jsonb::text, $$"n8n-nodes-base.cron"$$::jsonb::text, $$"Cron Daily"$$::jsonb::text, $${"n8n_node": {"parameters": {"triggerTimes": {"item": [{"mode": "everyDay", "hour": 8, "minute": 5}]}}, "id": "n_cron", "name": "Cron Daily", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 180]}, "connections": {"main": [[{"node": "Set Meta", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 2, $$"n_imap_intel"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Intel Replies"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] INTEL_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_intel", "name": "IMAP Search: Intel Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [1680, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Intel", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 3, $$"n_imap_binky"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Binky Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] REQUEST_BINKY_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_binky", "name": "IMAP Search: Binky Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [3120, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Validate Binky JSON", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 4, $$"n_imap_drafts"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Draft Replies"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] TASK_DISPATCH\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_drafts", "name": "IMAP Search: Draft Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [5040, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Drafts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 5, $$"n_imap_approval"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Approval Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_approval", "name": "IMAP Search: Approval Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [6480, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Parse Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 6, $$"n_imap_receipts"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Publish Receipts"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] PUBLISH_COMMAND\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_receipts", "name": "IMAP Search: Publish Receipts", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [7920, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Receipts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 7, $$"n_set_meta"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Set Meta"$$::jsonb::text, $${"n8n_node": {"parameters": {"values": {"string": [{"name": "run_id", "value": "={{$now.toISO() + '::' + $execution.id}}"}, {"name": "atlas_email", "value": "atlas@deadapp.info"}, {"name": "audit_cc", "value": "larry.auditor@deadapp.info"}]}, "options": {}}, "id": "n_set_meta", "name": "Set Meta", "type": "n8n-nodes-base.set", "typeVersion": 2, "position": [480, 180]}, "connections": {"main": [[{"node": "Build Agent Registry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 8, $$"n_accum_intel"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Intel"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.intel_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n\n  // map sender -> agent key\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.intel[key] = parsed;\n}\n\nstate.attempts.intel = (state.attempts.intel || 0) + 1;\nconst got = Object.keys(state.intel);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, intel_status: { got, missing, attempt: state.attempts.intel } } }];"}, "id": "n_accum_intel", "name": "Accumulate Intel", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [1920, 180]}, "connections": {"main": [[{"node": "IF Intel Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 9, $$"n_validate_binky"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Validate Binky JSON"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst state = $json.state;\nstate.attempts.binky = (state.attempts.binky||0) + 1;\n\nlet found = null;\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (parsed) { found = parsed; break; }\n}\n\nif (found) state.binky_summary = found;\n\nconst required = [\"headlines\",\"trends\",\"hashtags\",\"viral_content\",\"sentiment_analysis\",\"risk_flags\",\"opportunities\"]; \nconst ok = !!state.binky_summary && required.every(k => Object.prototype.hasOwnProperty.call(state.binky_summary, k));\n\nreturn [{ json: { ...$json, state, binky_status: { ok, attempt: state.attempts.binky } } }];"}, "id": "n_validate_binky", "name": "Validate Binky JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3360, 180]}, "connections": {"main": [[{"node": "IF Binky OK", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 10, $$"n_accum_drafts"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Drafts"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractDraft(text){\n  const m = (text||'').match(/---BEGIN_DRAFT---([\\s\\S]*?)---END_DRAFT---/);\n  return m ? m[1].trim() : null;\n}\n\nconst required = $json.stages.draft_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const draft = extractDraft(body);\n  if (!draft) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.drafts[key] = { draft, receivedAt: new Date().toISOString() };\n}\n\nstate.attempts.drafts = (state.attempts.drafts || 0) + 1;\nconst got = Object.keys(state.drafts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, draft_status: { got, missing, attempt: state.attempts.drafts } } }];"}, "id": "n_accum_drafts", "name": "Accumulate Drafts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [5280, 180]}, "connections": {"main": [[{"node": "IF Drafts Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 11, $$"n_parse_approval"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Parse Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const state = $json.state;\nstate.attempts.approval = (state.attempts.approval||0) + 1;\n\nlet decision = null;\nlet notes = '';\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const m1 = body.match(/\\bAPPROVE\\s+(.+)/i);\n  const m2 = body.match(/\\bDENY\\s+(.+)/i);\n  if (m1 && m1[1].includes($json.run_id)) { decision = 'APPROVE'; break; }\n  if (m2 && m2[1].includes($json.run_id)) { decision = 'DENY'; notes = m2[0]; break; }\n}\n\nreturn [{ json: { ...$json, state, approval: { decision, notes, attempt: state.attempts.approval } } }];"}, "id": "n_parse_approval", "name": "Parse Approval", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [6720, 180]}, "connections": {"main": [[{"node": "IF Approved", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 12, $$"n_accum_receipts"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Receipts"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.publish_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.receipts[key] = parsed;\n}\n\nstate.attempts.receipts = (state.attempts.receipts || 0) + 1;\nconst got = Object.keys(state.receipts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, receipt_status: { got, missing, attempt: state.attempts.receipts } } }];"}, "id": "n_accum_receipts", "name": "Accumulate Receipts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [8160, 180]}, "connections": {"main": [[{"node": "IF Receipts Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 13, $$"n_registry"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Agent Registry"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst agents = {\n  // core\n  BINKY:  { email: 'binky.cro@deadapp.info', role: 'Chief Research Analyst' },\n  TINA:   { email: 'tina.cfo@deadapp.info', role: 'CFO' },\n  LARRY:  { email: 'larry.auditor@deadapp.info', role: 'Chief Auditor' },\n  BENNY:  { email: 'benny.cto@deadapp.info', role: 'CTO/IP Counsel' },\n  JENNY:  { email: 'jenny.clo@deadapp.info', role: 'CLO' },\n  CHERYL: { email: 'support@deadapp.info', role: 'Support' },\n\n  // platform intel gatherers\n  CORNWALL: { email: 'cornwall.pinterest@deadapp.info', role: 'Pinterest Intel' },\n  DONNA:    { email: 'donna.redditor@deadapp.info', role: 'Reddit Intel' },\n  DWIGHT:   { email: 'dwight@deadapp.info', role: 'Threads Intel' },\n  EMMA:     { email: 'emma.alignable@deadapp.info', role: 'Alignable Intel' },\n  FRAN:     { email: 'fran.facebook@deadapp.info', role: 'Facebook Scraper' },\n  KELLY:    { email: 'kelly.x@deadapp.info', role: 'X Intel' },\n  LINK:     { email: 'link.linkedin@deadapp.info', role: 'LinkedIn Intel' },\n  TERRY:    { email: 'terry.tumblr@deadapp.info', role: 'Tumblr' },\n  TIMMY:    { email: 'timmy.tiktok@deadapp.info', role: 'TikTok' },\n\n  // subagents producing drafts\n  SUNDAY:   { email: 'sunday.teambinky@deadapp.info', role: 'Documentation' },\n  ARCHY:    { email: 'archy.binkypro@deadapp.info', role: 'Instagram Ops' },\n  REYNOLDS: { email: 'reynolds.blogger@deadapp.info', role: 'Blog Writer' },\n  PENNY:    { email: 'penny.facebook@deadapp.info', role: 'Facebook Page Manager' },\n  VENNY:    { email: 'venny.videographer@deadapp.info', role: 'Video Production' },\n  MERCER:   { email: 'mercer.teambinky@deadapp.info', role: 'Customer Acquisition Specialist' }\n};\n\nconst stages = {\n  intel_agents: ['CORNWALL','DONNA','DWIGHT','EMMA','FRAN','KELLY','LINK','TERRY','TIMMY'],\n  draft_agents: ['SUNDAY','ARCHY','REYNOLDS','PENNY','VENNY','MERCER'],\n  publish_agents: ['PENNY','ARCHY','TERRY','DWIGHT','KELLY','CORNWALL','TIMMY']\n};\n\nreturn [{\n  json: {\n    ...$json,\n    agents,\n    stages,\n    state: {\n      run_id,\n      intel: {},\n      binky_summary: null,\n      drafts: {},\n      receipts: {},\n      attempts: { intel: 0, binky: 0, drafts: 0, approval: 0, receipts: 0 }\n    }\n  }\n}];"}, "id": "n_registry", "name": "Build Agent Registry", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [720, 180]}, "connections": {"main": [[{"node": "Prep Intel Email", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 14, $$"n_if_intel_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Intel Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.intel_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_intel_complete", "name": "IF Intel Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2160, 180]}, "connections": {"main": [[{"node": "Prep Email: Binky Summary", "type": "main", "index": 0}], [{"node": "IF Intel Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 15, $$"n_if_binky_ok"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Binky OK"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.binky_status.ok}}", "value2": true}]}}, "id": "n_if_binky_ok", "name": "IF Binky OK", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3600, 180]}, "connections": {"main": [[{"node": "Build Draft Tasks", "type": "main", "index": 0}], [{"node": "IF Binky Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 16, $$"n_if_drafts_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Drafts Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.draft_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_drafts_complete", "name": "IF Drafts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5520, 180]}, "connections": {"main": [[{"node": "Email Send: Benny+Jenny Review Ping", "type": "main", "index": 0}], [{"node": "IF Draft Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 17, $$"n_if_approved"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Approved"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"string": [{"value1": "={{$json.approval.decision}}", "operation": "equals", "value2": "APPROVE"}]}}, "id": "n_if_approved", "name": "IF Approved", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [6960, 180]}, "connections": {"main": [[{"node": "Prep Publish Command", "type": "main", "index": 0}], [{"node": "Email Notify: Denied/No Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 18, $$"n_if_receipts_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Receipts Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.receipt_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_receipts_complete", "name": "IF Receipts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8400, 180]}, "connections": {"main": [[{"node": "Email Send: EOD Audit -> Larry", "type": "main", "index": 0}], [{"node": "IF Receipt Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 19, $$"n_prep_intel"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Intel Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.intel_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, stage: 'INTEL_REQUEST', toList, subject: `[ATLAS][${run_id}] INTEL_REQUEST`,\nbody: `Return ONLY JSON between markers.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"agent\\\\\\\": \\\\\\\"<YOUR_NAME>\\\\\\\",\\n  \\\\\\\"platform\\\\\\\": \\\\\\\"<PLATFORM>\\\\\\\",\\n  \\\\\\\"items\\\\\\\": [ {\\\\\\\"title\\\\\\\":\\\\\\\"...\\\\\\\",\\\\\\\"url\\\\\\\":\\\\\\\"...\\\\\\\"} ],\\n  \\\\\\\"notes\\\\\\\": \\\\\\\"...\\\\\\\"\\n}\\n---END_JSON---\\n\\nNo publishing. Include sources/links.` } }];"}, "id": "n_prep_intel", "name": "Prep Intel Email", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 180]}, "connections": {"main": [[{"node": "Email Send: Intel Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 20, $$"n_if_intel_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Intel Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.intel}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_intel_retry", "name": "IF Intel Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2400, 60]}, "connections": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Intel Missing -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 21, $$"n_prep_binky"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Email: Binky Summary"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nreturn [{ json: { ...$json, subject: `[ATLAS][${run_id}] REQUEST_BINKY_DAILY_SUMMARY_JSON`,\nbody: `BINKY — produce the Daily Structured Summary JSON with citations.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"headlines\\\\\\\":[],\\n  \\\\\\\"trends\\\\\\\":[],\\n  \\\\\\\"hashtags\\\\\\\":[],\\n  \\\\\\\"viral_content\\\\\\\":[],\\n  \\\\\\\"sentiment_analysis\\\\\\\":{},\\n  \\\\\\\"risk_flags\\\\\\\":[],\\n  \\\\\\\"opportunities\\\\\\\":[]\\n}\\n---END_JSON---\\n\\nUse gathered intel and your research. Return ONLY JSON in markers.` } }];"}, "id": "n_prep_binky", "name": "Prep Email: Binky Summary", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [2400, 180]}, "connections": {"main": [[{"node": "Email Send: Binky Summary Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 22, $$"n_make_tasks"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Draft Tasks"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst summary = $json.state.binky_summary;\nconst tasks = $json.stages.draft_agents.map(k => ({ key: k, to: $json.agents[k].email }));\nreturn tasks.map(t => ({ json: { ...$json, task: t, subject: `[ATLAS][${run_id}] TASK_DISPATCH::${t.key}`, body: `${t.key} — Use Binky Summary JSON. Return ONLY DRAFT in markers.\\n\\n---BEGIN_JSON---\\n${JSON.stringify(summary)}\\n---END_JSON---\\n\\n---BEGIN_DRAFT---\\n...\\n---END_DRAFT---\\n\\nNo publishing.` } }));"}, "id": "n_make_tasks", "name": "Build Draft Tasks", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3840, 180]}, "connections": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 23, $$"n_if_binky_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Binky Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.binky}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_binky_retry", "name": "IF Binky Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3840, 60]}, "connections": {"main": [[{"node": "Email Send: Binky Retry", "type": "main", "index": 0}], [{"node": "Email Send: Binky Retry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 24, $$"n_ping_legal"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Benny+Jenny Review Ping"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BENNY.email + ',' + $json.agents.JENNY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] POLICY/LEGAL REVIEW PING'}}", "text": "={{'Review draft package for policy/legal risk. Reply with JSON: {\"run_id\":\"...\",\"ok\":true/false,\"notes\":\"...\"} in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"run_id\":\"' + $json.run_id + '\",\\n  \"ok\": true,\\n  \"notes\": \"\"\\n}\\n---END_JSON---'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_ping_legal", "name": "Email Send: Benny+Jenny Review Ping", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [5760, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Email Send: Approval Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 25, $$"n_if_drafts_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Draft Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.drafts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_drafts_retry", "name": "IF Draft Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5760, 60]}, "connections": {"main": [[{"node": "Wait: Draft Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Drafts Missing -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 26, $$"n_denied_notify"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Notify: Denied/No Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] STOP: DENIED OR NO APPROVAL'}}", "text": "={{'Approval status: ' + JSON.stringify($json.approval) + '\\nNo publish commands sent.'}}"}, "id": "n_denied_notify", "name": "Email Notify: Denied/No Approval", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7200, 40], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 27, $$"n_prep_publish"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Publish Command"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.publish_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, toList, subject: `[ATLAS][${run_id}] PUBLISH_COMMAND`, body: `Publish ONLY the approved assets for run ${run_id}.\\nReturn receipt JSON in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"agent\":\"<YOUR_NAME>\",\\n  \"run_id\":\"${run_id}\",\\n  \"platform\":\"...\",\\n  \"status\":\"posted\",\\n  \"url\":\"...\"\\n}\\n---END_JSON---` } }];"}, "id": "n_prep_publish", "name": "Prep Publish Command", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [7200, 180]}, "connections": {"main": [[{"node": "Email Send: Publish Commands", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 28, $$"n_eod_larry"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: EOD Audit -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.LARRY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_AUDIT_VALIDATE'}}", "text": "={{'Validate full chain for run ' + $json.run_id + '. Receipts: ' + JSON.stringify($json.state.receipts)}}"}, "id": "n_eod_larry", "name": "Email Send: EOD Audit -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Email Send: EOD Finance -> Tina", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 29, $$"n_if_receipts_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Receipt Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.receipts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_receipts_retry", "name": "IF Receipt Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8640, 60]}, "connections": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Missing Receipts -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 30, $$"n_send_intel"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Intel Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_intel", "name": "Email Send: Intel Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1200, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 31, $$"n_intel_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Intel Missing -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: INTEL_INCOMPLETE'}}", "text": "={{'Intel missing after retries: ' + JSON.stringify($json.intel_status.missing) + '\\nAttempt: ' + $json.intel_status.attempt}}"}, "id": "n_intel_escalate", "name": "Email Escalate: Intel Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 32, $$"n_send_binky"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Binky Summary Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_binky", "name": "Email Send: Binky Summary Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 33, $$"n_binky_retry_email"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Binky Retry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] RETRY: BINKY_SUMMARY_INVALID'}}", "text": "={{'Your summary is missing required fields. Return ONLY JSON in markers. Run: ' + $json.run_id}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_binky_retry_email", "name": "Email Send: Binky Retry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4080, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 34, $$"n_send_approval"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Approval Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.atlas_email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED'}}", "text": "={{'Reply with EXACTLY one line:\\nAPPROVE ' + $json.run_id + '\\nor\\nDENY ' + $json.run_id + ' <notes>\\n\\nAudit CC: Larry'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_approval", "name": "Email Send: Approval Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Approval Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 35, $$"n_drafts_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Drafts Missing -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: DRAFTS_INCOMPLETE'}}", "text": "={{'Drafts missing: ' + JSON.stringify($json.draft_status.missing) + '\\nAttempt: ' + $json.draft_status.attempt + '\\nProceeding to approval package with partial drafts (logged).'}}"}, "id": "n_drafts_escalate", "name": "Email Escalate: Drafts Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 36, $$"n_send_publish"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Publish Commands"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_publish", "name": "Email Send: Publish Commands", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7440, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 37, $$"n_eod_tina"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: EOD Finance -> Tina"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.TINA.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_FINANCE_REVIEW'}}", "text": "={{'Review ledger refs / monetization impacts for run ' + $json.run_id}}"}, "id": "n_eod_tina", "name": "Email Send: EOD Finance -> Tina", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [9120, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 38, $$"n_receipts_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Missing Receipts -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: RECEIPTS_INCOMPLETE'}}", "text": "={{'Missing receipts after retries: ' + JSON.stringify($json.receipt_status.missing)}}"}, "id": "n_receipts_escalate", "name": "Email Escalate: Missing Receipts -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 39, $$"n_wait_intel"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Intel Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_intel", "name": "Wait: Intel Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [1440, 180]}, "connections": {"main": [[{"node": "IMAP Search: Intel Replies", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 40, $$"n_wait_binky"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Binky Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_binky", "name": "Wait: Binky Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [2880, 180]}, "connections": {"main": [[{"node": "IMAP Search: Binky Reply", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 41, $$"n_wait_approval"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Approval Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_approval", "name": "Wait: Approval Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [6240, 180]}, "connections": {"main": [[{"node": "IMAP Search: Approval Reply", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 42, $$"n_wait_receipts"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Receipt Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_receipts", "name": "Wait: Receipt Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [7680, 180]}, "connections": {"main": [[{"node": "IMAP Search: Publish Receipts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 43, $$"n_split_tasks"$$::jsonb::text, $$"n8n-nodes-base.splitInBatches"$$::jsonb::text, $$"Split Tasks"$$::jsonb::text, $${"n8n_node": {"parameters": {"batchSize": 1, "options": {}}, "id": "n_split_tasks", "name": "Split Tasks", "type": "n8n-nodes-base.splitInBatches", "typeVersion": 3, "position": [4080, 180]}, "connections": {"main": [[{"node": "Email Send: Draft Task", "type": "main", "index": 0}], [{"node": "Wait: Draft Poll", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 44, $$"n_send_task"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Draft Task"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.task.to}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_task", "name": "Email Send: Draft Task", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4320, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Pace", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 45, $$"n_wait_task_pace"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Pace"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 5, "unit": "seconds"}, "id": "n_wait_task_pace", "name": "Wait: Pace", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4560, 180]}, "connections": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-ATLAS_orchestrator_FULL_email_endpoint"$$::jsonb::text, 46, $$"n_wait_drafts"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Draft Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_drafts", "name": "Wait: Draft Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4800, 180]}, "connections": {"main": [[{"node": "IMAP Search: Draft Replies", "type": "main", "index": 0}]]}}$$::jsonb);

-- N8N-analytics_competitor_price_scrapper (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Competitor Price Scraper"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/analytics/competitor_price_scrapper.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Competitor Price Scraper", "active": null}, "sourcePath": "workflows/n8n/analytics/competitor_price_scrapper.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Competitor Price Scraper", "nodes": [{"parameters": {"content": "Automated workflow: Competitor Price Scraper", "height": 530, "width": 1100, "color": 5}, "id": "3658f18f-6ed3-4c14-b12d-9ec7fadc03f9", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "competitor-price-scraper"}, "id": "9b5a4057-4b5f-44f7-aea9-847d23a8f821", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "3b015342-843e-40e8-8164-734611f2c7aa", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "3b77afdb-828a-48bf-ab39-5600c4ac8512", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "indexName": "competitor_price_scraper"}, "id": "217480ed-2ad6-407d-80fa-0d5284905815", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"indexName": "competitor_price_scraper"}, "id": "90ed9d12-3239-48b0-b5a5-23fb2a0172ea", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "68bc4d4a-293e-4252-8a88-486aa3e3cb5f", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "3d31e91e-ad51-4967-903f-7ae2c598a870", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "af6568a4-96a6-4b41-8be0-730fb7c0b328", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'Competitor Price Scraper':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Competitor Price Scraper"}}, "id": "c0a57592-08d8-4b83-80bf-73b63a29966f", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Competitor Price Scraper"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "ff81c3bb-35e8-428d-9ad9-491707d7ee15", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "Competitor Price Scraper error: {$json.error.message}"}, "id": "9f49421e-8263-4127-ad94-e063318685fb", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}, "Supabase Insert": {"ai_document": [[]]}, "Supabase Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Competitor Price Scraper"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 1, $$"9b5a4057-4b5f-44f7-aea9-847d23a8f821"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "competitor-price-scraper"}, "id": "9b5a4057-4b5f-44f7-aea9-847d23a8f821", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 2, $$"3658f18f-6ed3-4c14-b12d-9ec7fadc03f9"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: Competitor Price Scraper", "height": 530, "width": 1100, "color": 5}, "id": "3658f18f-6ed3-4c14-b12d-9ec7fadc03f9", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 3, $$"af6568a4-96a6-4b41-8be0-730fb7c0b328"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatAnthropic"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "af6568a4-96a6-4b41-8be0-730fb7c0b328", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 4, $$"3b015342-843e-40e8-8164-734611f2c7aa"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "3b015342-843e-40e8-8164-734611f2c7aa", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 5, $$"3d31e91e-ad51-4967-903f-7ae2c598a870"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "3d31e91e-ad51-4967-903f-7ae2c598a870", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 6, $$"3b77afdb-828a-48bf-ab39-5600c4ac8512"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "3b77afdb-828a-48bf-ab39-5600c4ac8512", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 7, $$"217480ed-2ad6-407d-80fa-0d5284905815"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "indexName": "competitor_price_scraper"}, "id": "217480ed-2ad6-407d-80fa-0d5284905815", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 8, $$"90ed9d12-3239-48b0-b5a5-23fb2a0172ea"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "competitor_price_scraper"}, "id": "90ed9d12-3239-48b0-b5a5-23fb2a0172ea", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 9, $$"68bc4d4a-293e-4252-8a88-486aa3e3cb5f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "68bc4d4a-293e-4252-8a88-486aa3e3cb5f", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 10, $$"c0a57592-08d8-4b83-80bf-73b63a29966f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'Competitor Price Scraper':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Competitor Price Scraper"}}, "id": "c0a57592-08d8-4b83-80bf-73b63a29966f", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 11, $$"ff81c3bb-35e8-428d-9ad9-491707d7ee15"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Competitor Price Scraper"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "ff81c3bb-35e8-428d-9ad9-491707d7ee15", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-analytics_competitor_price_scrapper"$$::jsonb::text, 12, $$"9f49421e-8263-4127-ad94-e063318685fb"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "Competitor Price Scraper error: {$json.error.message}"}, "id": "9f49421e-8263-4127-ad94-e063318685fb", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-content_creation_youtube2blog (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"YouTube Transcript to Blog"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/content_creation/youtube2blog.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "YouTube Transcript to Blog", "active": null}, "sourcePath": "workflows/n8n/content_creation/youtube2blog.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "YouTube Transcript to Blog", "nodes": [{"parameters": {"content": "Automated workflow: YouTube Transcript to Blog", "height": 530, "width": 1100, "color": 5}, "id": "bd0e0586-b4e8-4da9-8d93-57602a5219de", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "youtube-transcript-to-blog"}, "id": "fe1b58d8-2bdc-4ce8-bcf8-95c9b0b6477d", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "ceba2716-6fe1-48de-9bad-512e27bac9c1", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "20c8a22e-bf48-44b4-ac45-74b80231e773", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "youtube_transcript_to_blog", "mode": "list", "cachedResultName": "youtube_transcript_to_blog"}}, "id": "d5bd2477-053c-4954-b46a-607df0a23935", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"pineconeIndex": {"__rl": true, "value": "youtube_transcript_to_blog", "mode": "list", "cachedResultName": "youtube_transcript_to_blog"}}, "id": "d5b8f51f-8904-4039-ab7f-d4cffd717b14", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "42485b1f-2381-4e86-91af-ddbb3b687689", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "5fccb006-c66d-407a-b010-a9f7ca49c0d7", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "1454b8d0-0703-45e1-b51c-2f9396b4e4d1", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'YouTube Transcript to Blog':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for YouTube Transcript to Blog"}}, "id": "a8c23beb-eeb0-45bb-bee8-7d841bf39330", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "YouTube Transcript to Blog"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "333c30d3-f292-497e-af3d-fffa5575fd75", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "YouTube Transcript to Blog error: {$json.error.message}"}, "id": "f84bd864-69d2-4c78-a3df-e0d4bdaf36c0", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}, "Pinecone Insert": {"ai_document": [[]]}, "Pinecone Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"YouTube Transcript to Blog"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-content_creation_youtube2blog"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 1, $$"fe1b58d8-2bdc-4ce8-bcf8-95c9b0b6477d"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "youtube-transcript-to-blog"}, "id": "fe1b58d8-2bdc-4ce8-bcf8-95c9b0b6477d", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 2, $$"bd0e0586-b4e8-4da9-8d93-57602a5219de"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: YouTube Transcript to Blog", "height": 530, "width": 1100, "color": 5}, "id": "bd0e0586-b4e8-4da9-8d93-57602a5219de", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 3, $$"1454b8d0-0703-45e1-b51c-2f9396b4e4d1"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatAnthropic"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "1454b8d0-0703-45e1-b51c-2f9396b4e4d1", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 4, $$"ceba2716-6fe1-48de-9bad-512e27bac9c1"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "ceba2716-6fe1-48de-9bad-512e27bac9c1", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 5, $$"5fccb006-c66d-407a-b010-a9f7ca49c0d7"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "5fccb006-c66d-407a-b010-a9f7ca49c0d7", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 6, $$"20c8a22e-bf48-44b4-ac45-74b80231e773"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "20c8a22e-bf48-44b4-ac45-74b80231e773", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 7, $$"d5bd2477-053c-4954-b46a-607df0a23935"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "youtube_transcript_to_blog", "mode": "list", "cachedResultName": "youtube_transcript_to_blog"}}, "id": "d5bd2477-053c-4954-b46a-607df0a23935", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 8, $$"d5b8f51f-8904-4039-ab7f-d4cffd717b14"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"pineconeIndex": {"__rl": true, "value": "youtube_transcript_to_blog", "mode": "list", "cachedResultName": "youtube_transcript_to_blog"}}, "id": "d5b8f51f-8904-4039-ab7f-d4cffd717b14", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 9, $$"42485b1f-2381-4e86-91af-ddbb3b687689"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "42485b1f-2381-4e86-91af-ddbb3b687689", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 10, $$"a8c23beb-eeb0-45bb-bee8-7d841bf39330"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'YouTube Transcript to Blog':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for YouTube Transcript to Blog"}}, "id": "a8c23beb-eeb0-45bb-bee8-7d841bf39330", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 11, $$"333c30d3-f292-497e-af3d-fffa5575fd75"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "YouTube Transcript to Blog"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "333c30d3-f292-497e-af3d-fffa5575fd75", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-content_creation_youtube2blog"$$::jsonb::text, 12, $$"f84bd864-69d2-4c78-a3df-e0d4bdaf36c0"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "YouTube Transcript to Blog error: {$json.error.message}"}, "id": "f84bd864-69d2-4c78-a3df-e0d4bdaf36c0", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-customer_service_AtlasUX_Approval_Poller_FIXED (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"AtlasUX — Approval Poller"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/customer_service/AtlasUX_Approval_Poller_FIXED.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "workflow-approval-poller-atlasux", "name": "AtlasUX — Approval Poller", "active": false}, "sourcePath": "workflows/n8n/customer_service/AtlasUX_Approval_Poller_FIXED.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "AtlasUX — Approval Poller", "nodes": [{"parameters": {"triggerTimes": {"item": [{"hour": "*/1", "minute": "*/1", "weekDays": []}]}}, "name": "Cron — Poll Mailbox", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 280]}, {"parameters": {"operation": "executeQuery", "query": "SELECT suggestion_id, ticket_id, ticket_subject, one_line_summary, approval_token, created_at, expires_at FROM public.atlas_suggestions WHERE status = 'pending' AND expires_at > now() ORDER BY created_at ASC LIMIT 100;"}, "name": "Get Pending Suggestions (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [520, 280], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, {"parameters": {"functionCode": "// Split items into single items to iterate\nreturn items;"}, "name": "Split Items", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [760, 280]}, {"parameters": {"operation": "getAll", "filters": {}}, "name": "Search Mailbox for Replies", "type": "n8n-nodes-base.microsoftOutlook", "typeVersion": 1, "position": [1060, 280], "credentials": {"microsoftOutlook": {"id": "MICROSOFT_OUTLOOK", "name": "MICROSOFT_OUTLOOK"}}}, {"parameters": {"functionCode": "// Determine if any messages contain the suggestion_id and the words approve/deny\nconst suggestion = items[0].json; // from DB\nconst suggestionId = suggestion.suggestion_id;\nconst messages = $node[\"Search Mailbox for Replies\"].json || [];\nlet decision = null;\nlet matchingMessage = null;\n\nfor (const m of messages) {\n  const subject = (m.subject || '').toString().toLowerCase();\n  const body = ((m.body && (m.body.content || m.bodyPreview)) || '').toString().toLowerCase();\n  // Check if message references the suggestion id (either subject or body)\n  if (subject.includes(suggestionId.toLowerCase()) || body.includes(suggestionId.toLowerCase())) {\n    if (/\\bapprove\\b/.test(body)) {\n      decision = 'approved';\n      matchingMessage = m;\n      break;\n    }\n    if (/\\bdeny\\b/.test(body)) {\n      decision = 'denied';\n      matchingMessage = m;\n      break;\n    }\n  }\n}\n\nitems[0].json.decision = decision;\nitems[0].json.matching_message = matchingMessage;\nreturn items;"}, "name": "Determine Decision", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1320, 280]}, {"parameters": {"conditions": {"string": [{"value1": "={{$json.decision}}", "operation": "isNotEmpty"}]}}, "name": "Decision?", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1560, 280]}, {"parameters": {"operation": "update", "schema": "public", "table": "atlas_suggestions", "updateFields": "status,updated_at", "updateValues": "'approved', now()", "where": "suggestion_id = {{$json.suggestion_id}}"}, "name": "Mark Approved (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1800, 120], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "support@deadapp.info", "subject": "Suggestion Approved — {{$json.suggestion_id}} — {{$json.one_line_summary}}", "text": "Hello team,\\n\\nAtlas has APPROVED suggestion {{$json.suggestion_id}} for ticket {{$json.ticket_id}}.\\n\\nSummary:\\n{{$json.one_line_summary}}\\n\\nNext steps: implement the plan from the suggestion.\\n\\nThis notification was generated automatically.\\n\\nBest,\\nAtlas UX Support Automation"}, "name": "Notify Support — Approved", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [2040, 120], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, {"parameters": {"operation": "update", "schema": "public", "table": "atlas_suggestions", "updateFields": "status,updated_at", "updateValues": "'denied', now()", "where": "suggestion_id = {{$json.suggestion_id}}"}, "name": "Mark Denied (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1800, 440], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "support@deadapp.info", "subject": "Suggestion Denied — {{$json.suggestion_id}} — {{$json.one_line_summary}}", "text": "Hello team,\\n\\nAtlas has DENIED suggestion {{$json.suggestion_id}} for ticket {{$json.ticket_id}}.\\n\\nCheck the matching message for details.\\n\\nThis notification was generated automatically.\\n\\nBest,\\nAtlas UX Support Automation"}, "name": "Notify Support — Denied", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [2040, 440], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, {"parameters": {"functionCode": "// No-op final node\nreturn items;"}, "name": "Done", "type": "n8n-nodes-base.noOp", "typeVersion": 1, "position": [2280, 280]}], "connections": {"Cron — Poll Mailbox": {"main": [[{"node": "Get Pending Suggestions (Supabase)", "type": "main", "index": 0}]]}, "Get Pending Suggestions (Supabase)": {"main": [[{"node": "Split Items", "type": "main", "index": 0}]]}, "Split Items": {"main": [[{"node": "Search Mailbox for Replies", "type": "main", "index": 0}]]}, "Search Mailbox for Replies": {"main": [[{"node": "Determine Decision", "type": "main", "index": 0}]]}, "Determine Decision": {"main": [[{"node": "Decision?", "type": "main", "index": 0}]]}, "Decision?": {"main": [[{"node": "Mark Approved (Supabase)", "type": "main", "index": 0}], [{"node": "Mark Denied (Supabase)", "type": "main", "index": 1}]]}, "Mark Approved (Supabase)": {"main": [[{"node": "Notify Support — Approved", "type": "main", "index": 0}]]}, "Mark Denied (Supabase)": {"main": [[{"node": "Notify Support — Denied", "type": "main", "index": 0}]]}, "Notify Support — Approved": {"main": [[{"node": "Done", "type": "main", "index": 0}]]}, "Notify Support — Denied": {"main": [[{"node": "Done", "type": "main", "index": 0}]]}}, "active": false, "settings": {}, "id": "workflow-approval-poller-atlasux"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"AtlasUX — Approval Poller"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 1, $$"Cron — Poll Mailbox"$$::jsonb::text, $$"n8n-nodes-base.cron"$$::jsonb::text, $$"Cron — Poll Mailbox"$$::jsonb::text, $${"n8n_node": {"parameters": {"triggerTimes": {"item": [{"hour": "*/1", "minute": "*/1", "weekDays": []}]}}, "name": "Cron — Poll Mailbox", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 280]}, "connections": {"main": [[{"node": "Get Pending Suggestions (Supabase)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 2, $$"Get Pending Suggestions (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.postgres"$$::jsonb::text, $$"Get Pending Suggestions (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "executeQuery", "query": "SELECT suggestion_id, ticket_id, ticket_subject, one_line_summary, approval_token, created_at, expires_at FROM public.atlas_suggestions WHERE status = 'pending' AND expires_at > now() ORDER BY created_at ASC LIMIT 100;"}, "name": "Get Pending Suggestions (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [520, 280], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, "connections": {"main": [[{"node": "Split Items", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 3, $$"Split Items"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Split Items"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Split items into single items to iterate\nreturn items;"}, "name": "Split Items", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [760, 280]}, "connections": {"main": [[{"node": "Search Mailbox for Replies", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 4, $$"Search Mailbox for Replies"$$::jsonb::text, $$"n8n-nodes-base.microsoftOutlook"$$::jsonb::text, $$"Search Mailbox for Replies"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "getAll", "filters": {}}, "name": "Search Mailbox for Replies", "type": "n8n-nodes-base.microsoftOutlook", "typeVersion": 1, "position": [1060, 280], "credentials": {"microsoftOutlook": {"id": "MICROSOFT_OUTLOOK", "name": "MICROSOFT_OUTLOOK"}}}, "connections": {"main": [[{"node": "Determine Decision", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 5, $$"Determine Decision"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Determine Decision"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Determine if any messages contain the suggestion_id and the words approve/deny\nconst suggestion = items[0].json; // from DB\nconst suggestionId = suggestion.suggestion_id;\nconst messages = $node[\"Search Mailbox for Replies\"].json || [];\nlet decision = null;\nlet matchingMessage = null;\n\nfor (const m of messages) {\n  const subject = (m.subject || '').toString().toLowerCase();\n  const body = ((m.body && (m.body.content || m.bodyPreview)) || '').toString().toLowerCase();\n  // Check if message references the suggestion id (either subject or body)\n  if (subject.includes(suggestionId.toLowerCase()) || body.includes(suggestionId.toLowerCase())) {\n    if (/\\bapprove\\b/.test(body)) {\n      decision = 'approved';\n      matchingMessage = m;\n      break;\n    }\n    if (/\\bdeny\\b/.test(body)) {\n      decision = 'denied';\n      matchingMessage = m;\n      break;\n    }\n  }\n}\n\nitems[0].json.decision = decision;\nitems[0].json.matching_message = matchingMessage;\nreturn items;"}, "name": "Determine Decision", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1320, 280]}, "connections": {"main": [[{"node": "Decision?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 6, $$"Decision?"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Decision?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"string": [{"value1": "={{$json.decision}}", "operation": "isNotEmpty"}]}}, "name": "Decision?", "type": "n8n-nodes-base.if", "typeVersion": 1, "position": [1560, 280]}, "connections": {"main": [[{"node": "Mark Approved (Supabase)", "type": "main", "index": 0}], [{"node": "Mark Denied (Supabase)", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 7, $$"Mark Approved (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.postgres"$$::jsonb::text, $$"Mark Approved (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "update", "schema": "public", "table": "atlas_suggestions", "updateFields": "status,updated_at", "updateValues": "'approved', now()", "where": "suggestion_id = {{$json.suggestion_id}}"}, "name": "Mark Approved (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1800, 120], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, "connections": {"main": [[{"node": "Notify Support — Approved", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 8, $$"Mark Denied (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.postgres"$$::jsonb::text, $$"Mark Denied (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "update", "schema": "public", "table": "atlas_suggestions", "updateFields": "status,updated_at", "updateValues": "'denied', now()", "where": "suggestion_id = {{$json.suggestion_id}}"}, "name": "Mark Denied (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1800, 440], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, "connections": {"main": [[{"node": "Notify Support — Denied", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 9, $$"Notify Support — Approved"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Notify Support — Approved"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "support@deadapp.info", "subject": "Suggestion Approved — {{$json.suggestion_id}} — {{$json.one_line_summary}}", "text": "Hello team,\\n\\nAtlas has APPROVED suggestion {{$json.suggestion_id}} for ticket {{$json.ticket_id}}.\\n\\nSummary:\\n{{$json.one_line_summary}}\\n\\nNext steps: implement the plan from the suggestion.\\n\\nThis notification was generated automatically.\\n\\nBest,\\nAtlas UX Support Automation"}, "name": "Notify Support — Approved", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [2040, 120], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, "connections": {"main": [[{"node": "Done", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 10, $$"Notify Support — Denied"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Notify Support — Denied"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "support@deadapp.info", "subject": "Suggestion Denied — {{$json.suggestion_id}} — {{$json.one_line_summary}}", "text": "Hello team,\\n\\nAtlas has DENIED suggestion {{$json.suggestion_id}} for ticket {{$json.ticket_id}}.\\n\\nCheck the matching message for details.\\n\\nThis notification was generated automatically.\\n\\nBest,\\nAtlas UX Support Automation"}, "name": "Notify Support — Denied", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [2040, 440], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, "connections": {"main": [[{"node": "Done", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Approval_Poller_FIXED"$$::jsonb::text, 11, $$"Done"$$::jsonb::text, $$"n8n-nodes-base.noOp"$$::jsonb::text, $$"Done"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// No-op final node\nreturn items;"}, "name": "Done", "type": "n8n-nodes-base.noOp", "typeVersion": 1, "position": [2280, 280]}, "connections": {}}$$::jsonb);

-- N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"AtlasUX — Suggestion Generator"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/customer_service/AtlasUX_Suggestion_Generator_FIXED.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "workflow-suggestion-generator-atlasux", "name": "AtlasUX — Suggestion Generator", "active": false}, "sourcePath": "workflows/n8n/customer_service/AtlasUX_Suggestion_Generator_FIXED.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "AtlasUX — Suggestion Generator", "nodes": [{"parameters": {"httpMethod": "POST", "path": "atlas-new-ticket", "responseMode": "onReceived", "responseData": "success"}, "name": "New Ticket Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 300]}, {"parameters": {"url": "https://atlasux.cloud/api/kb/search", "options": {}, "method": "POST", "bodyParametersUi": {"parameter": [{"name": "query", "value": "={{$json[\"subject\"] + ' ' + $json[\"body\"]}}"}, {"name": "top_k", "value": "5"}]}, "headers": {"Authorization": "Bearer {{ $credentials.KB_API_KEY }}", "Content-Type": "application/json"}, "jsonParameters": true, "sendBody": true}, "name": "KB Search (Atlas UX KB)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [520, 300]}, {"parameters": {"functionCode": "// Build prompt for OpenAI\nconst ticket = items[0].json;\nconst kb = $node[\"KB Search (Atlas UX KB)\"].json || [];\nconst kbArray = Array.isArray(kb) ? kb : [kb];\nconst kbText = kbArray.slice(0,5).map(a => {\n  const title = a.title || a.name || (a.data && a.data.title) || '';\n  const excerpt = a.excerpt || a.summary || (a.data && a.data.excerpt) || '';\n  const url = a.url || a.link || '';\n  return `- ${title}: ${excerpt} (URL: ${url})`;\n}).join('\\n');\n\nconst prompt = `You are a support automation assistant for Atlas UX (atlasux.cloud).\\nTicket:\\nSubject: ${ticket.subject}\\nBody: ${ticket.body}\\n\\nTop KB articles:\\n${kbText}\\n\\nTask: Based on the ticket and KB evidence, propose ONE concise workflow improvement that will reduce recurrence of this issue.\\nReturn ONLY JSON with keys:\\n- one_line_summary (string)\\n- implementation_plan (array of 3 short steps)\\n- kb_references (array of KB titles or URLs)\\n- email_subject (string)\\n- email_body_approve (string)\\n- email_body_deny (string)\\nKeep each field concise.`;\n\nitems[0].json.prompt = prompt;\nreturn items;"}, "name": "Build OpenAI Prompt", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [740, 300]}, {"parameters": {"authentication": "predefinedCredentialType", "requestMethod": "POST", "url": "https://api.openai.com/v1/chat/completions", "options": {}, "bodyParametersJson": "={\"model\":\"gpt-4o-mini\",\"messages\":[{\"role\":\"user\",\"content\":$json.prompt}],\"max_tokens\":800,\"temperature\":0.2}", "headers": {"Authorization": "Bearer {{$credentials.OPENAI_API.key}}", "Content-Type": "application/json"}}, "name": "OpenAI — Draft Suggestion", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [980, 300]}, {"parameters": {"functionCode": "const text = $json[\"choices\"] ? $json.choices[0].message.content : ($json.text || '');\nlet parsed;\ntry {\n  parsed = JSON.parse(text);\n} catch (err) {\n  const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) parsed = JSON.parse(jsonMatch[0]);\n  else throw new Error('OpenAI output not JSON. Check prompt.');\n}\n\nitems[0].json.one_line_summary = parsed.one_line_summary;\nitems[0].json.implementation_plan = parsed.implementation_plan || [];\nitems[0].json.kb_references = parsed.kb_references || [];\nitems[0].json.email_subject = parsed.email_subject;\nitems[0].json.email_body_approve = parsed.email_body_approve;\nitems[0].json.email_body_deny = parsed.email_body_deny;\nreturn items;"}, "name": "Parse Suggestion Output", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1220, 300]}, {"parameters": {"functionCode": "const { v4: uuidv4 } = require('uuid');\nconst crypto = require('crypto');\n\nconst suggestionId = uuidv4();\nconst approvalToken = crypto.randomBytes(20).toString('hex');\n\nconst expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\n\nconst record = {\n  suggestion_id: suggestionId,\n  ticket_id: $json[\"ticket_id\"] || $json[\"ticketId\"] || $json[\"ticketIdFromWebhook\"],\n  ticket_subject: $json[\"subject\"] || $json[\"ticket_subject\"],\n  ticket_body: $json[\"body\"] || $json[\"ticket_body\"],\n  kb_results: $node[\"KB Search (Atlas UX KB)\"].json || [],\n  one_line_summary: $json.one_line_summary,\n  implementation_plan: $json.implementation_plan,\n  email_subject: $json.email_subject,\n  email_body_approve: $json.email_body_approve,\n  email_body_deny: $json.email_body_deny,\n  approval_token: approvalToken,\n  status: 'pending',\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n  expires_at: expiresAt\n};\n\nitems[0].json.suggestion_record = record;\nreturn items;"}, "name": "Create Suggestion Record", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1460, 300]}, {"parameters": {"operation": "insert", "schema": "public", "table": "atlas_suggestions", "columns": "suggestion_id,ticket_id,ticket_subject,ticket_body,kb_results,one_line_summary,implementation_plan,email_subject,email_body_approve,email_body_deny,approval_token,status,created_at,updated_at,expires_at", "values": "={{$json[\"suggestion_record\"].suggestion_id}},{{$json[\"suggestion_record\"].ticket_id}},{{$json[\"suggestion_record\"].ticket_subject}},{{$json[\"suggestion_record\"].ticket_body}},{{JSON.stringify($json[\"suggestion_record\"].kb_results)}},{{$json[\"suggestion_record\"].one_line_summary}},{{JSON.stringify($json[\"suggestion_record\"].implementation_plan)}},{{$json[\"suggestion_record\"].email_subject}},{{$json[\"suggestion_record\"].email_body_approve}},{{$json[\"suggestion_record\"].email_body_deny}},{{$json[\"suggestion_record\"].approval_token}},{{$json[\"suggestion_record\"].status}},{{$json[\"suggestion_record\"].created_at}},{{$json[\"suggestion_record\"].updated_at}},{{$json[\"suggestion_record\"].expires_at}}"}, "name": "Store Suggestion (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1700, 300], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "atlas.ceo@deadapp.info", "subject": "={{ '[Action required] Approve workflow suggestion — ' + $json.suggestion_record.suggestion_id + ' — ' + $json.one_line_summary }}", "text": "Hi Atlas,\\n\\nBased on support ticket {{$json.suggestion_record.ticket_id}}: \"{{$json.suggestion_record.ticket_subject}}\", the suggested workflow change is:\\n\\n{{$json.one_line_summary}}\\n\\nImplementation plan (3 steps):\\n1) {{$json.implementation_plan[0]}}\\n2) {{$json.implementation_plan[1]}}\\n3) {{$json.implementation_plan[2]}}\\n\\nWhy: Referenced KB articles: {{$json.kb_references ? $json.kb_references.join(', ') : ''}}\\n\\nPlease reply to this email with exactly one word:\\n- approve\\nor\\n- deny\\n\\n(Your reply will trigger the automation and the support team will be notified.)\\n\\nSuggestion ID: {{$json.suggestion_record.suggestion_id}}\\n\\nThanks,\\nAtlas UX Support Automation"}, "name": "Email CEO (Atlas)", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [1940, 300], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, {"parameters": {"responseCode": 200, "responseBody": "Suggestion created and sent to Atlas for approval"}, "name": "Webhook Response", "type": "n8n-nodes-base.noOp", "typeVersion": 1, "position": [2180, 300]}], "connections": {"New Ticket Webhook": {"main": [[{"node": "KB Search (Atlas UX KB)", "type": "main", "index": 0}]]}, "KB Search (Atlas UX KB)": {"main": [[{"node": "Build OpenAI Prompt", "type": "main", "index": 0}]]}, "Build OpenAI Prompt": {"main": [[{"node": "OpenAI — Draft Suggestion", "type": "main", "index": 0}]]}, "OpenAI — Draft Suggestion": {"main": [[{"node": "Parse Suggestion Output", "type": "main", "index": 0}]]}, "Parse Suggestion Output": {"main": [[{"node": "Create Suggestion Record", "type": "main", "index": 0}]]}, "Create Suggestion Record": {"main": [[{"node": "Store Suggestion (Supabase)", "type": "main", "index": 0}]]}, "Store Suggestion (Supabase)": {"main": [[{"node": "Email CEO (Atlas)", "type": "main", "index": 0}]]}, "Email CEO (Atlas)": {"main": [[{"node": "Webhook Response", "type": "main", "index": 0}]]}}, "active": false, "settings": {}, "id": "workflow-suggestion-generator-atlasux"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"AtlasUX — Suggestion Generator"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 1, $$"New Ticket Webhook"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"New Ticket Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "atlas-new-ticket", "responseMode": "onReceived", "responseData": "success"}, "name": "New Ticket Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 300]}, "connections": {"main": [[{"node": "KB Search (Atlas UX KB)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 2, $$"KB Search (Atlas UX KB)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"KB Search (Atlas UX KB)"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "https://atlasux.cloud/api/kb/search", "options": {}, "method": "POST", "bodyParametersUi": {"parameter": [{"name": "query", "value": "={{$json[\"subject\"] + ' ' + $json[\"body\"]}}"}, {"name": "top_k", "value": "5"}]}, "headers": {"Authorization": "Bearer {{ $credentials.KB_API_KEY }}", "Content-Type": "application/json"}, "jsonParameters": true, "sendBody": true}, "name": "KB Search (Atlas UX KB)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [520, 300]}, "connections": {"main": [[{"node": "Build OpenAI Prompt", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 3, $$"Build OpenAI Prompt"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build OpenAI Prompt"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Build prompt for OpenAI\nconst ticket = items[0].json;\nconst kb = $node[\"KB Search (Atlas UX KB)\"].json || [];\nconst kbArray = Array.isArray(kb) ? kb : [kb];\nconst kbText = kbArray.slice(0,5).map(a => {\n  const title = a.title || a.name || (a.data && a.data.title) || '';\n  const excerpt = a.excerpt || a.summary || (a.data && a.data.excerpt) || '';\n  const url = a.url || a.link || '';\n  return `- ${title}: ${excerpt} (URL: ${url})`;\n}).join('\\n');\n\nconst prompt = `You are a support automation assistant for Atlas UX (atlasux.cloud).\\nTicket:\\nSubject: ${ticket.subject}\\nBody: ${ticket.body}\\n\\nTop KB articles:\\n${kbText}\\n\\nTask: Based on the ticket and KB evidence, propose ONE concise workflow improvement that will reduce recurrence of this issue.\\nReturn ONLY JSON with keys:\\n- one_line_summary (string)\\n- implementation_plan (array of 3 short steps)\\n- kb_references (array of KB titles or URLs)\\n- email_subject (string)\\n- email_body_approve (string)\\n- email_body_deny (string)\\nKeep each field concise.`;\n\nitems[0].json.prompt = prompt;\nreturn items;"}, "name": "Build OpenAI Prompt", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [740, 300]}, "connections": {"main": [[{"node": "OpenAI — Draft Suggestion", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 4, $$"OpenAI — Draft Suggestion"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"OpenAI — Draft Suggestion"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "predefinedCredentialType", "requestMethod": "POST", "url": "https://api.openai.com/v1/chat/completions", "options": {}, "bodyParametersJson": "={\"model\":\"gpt-4o-mini\",\"messages\":[{\"role\":\"user\",\"content\":$json.prompt}],\"max_tokens\":800,\"temperature\":0.2}", "headers": {"Authorization": "Bearer {{$credentials.OPENAI_API.key}}", "Content-Type": "application/json"}}, "name": "OpenAI — Draft Suggestion", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [980, 300]}, "connections": {"main": [[{"node": "Parse Suggestion Output", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 5, $$"Parse Suggestion Output"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Parse Suggestion Output"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const text = $json[\"choices\"] ? $json.choices[0].message.content : ($json.text || '');\nlet parsed;\ntry {\n  parsed = JSON.parse(text);\n} catch (err) {\n  const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) parsed = JSON.parse(jsonMatch[0]);\n  else throw new Error('OpenAI output not JSON. Check prompt.');\n}\n\nitems[0].json.one_line_summary = parsed.one_line_summary;\nitems[0].json.implementation_plan = parsed.implementation_plan || [];\nitems[0].json.kb_references = parsed.kb_references || [];\nitems[0].json.email_subject = parsed.email_subject;\nitems[0].json.email_body_approve = parsed.email_body_approve;\nitems[0].json.email_body_deny = parsed.email_body_deny;\nreturn items;"}, "name": "Parse Suggestion Output", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1220, 300]}, "connections": {"main": [[{"node": "Create Suggestion Record", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 6, $$"Create Suggestion Record"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Create Suggestion Record"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const { v4: uuidv4 } = require('uuid');\nconst crypto = require('crypto');\n\nconst suggestionId = uuidv4();\nconst approvalToken = crypto.randomBytes(20).toString('hex');\n\nconst expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();\n\nconst record = {\n  suggestion_id: suggestionId,\n  ticket_id: $json[\"ticket_id\"] || $json[\"ticketId\"] || $json[\"ticketIdFromWebhook\"],\n  ticket_subject: $json[\"subject\"] || $json[\"ticket_subject\"],\n  ticket_body: $json[\"body\"] || $json[\"ticket_body\"],\n  kb_results: $node[\"KB Search (Atlas UX KB)\"].json || [],\n  one_line_summary: $json.one_line_summary,\n  implementation_plan: $json.implementation_plan,\n  email_subject: $json.email_subject,\n  email_body_approve: $json.email_body_approve,\n  email_body_deny: $json.email_body_deny,\n  approval_token: approvalToken,\n  status: 'pending',\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n  expires_at: expiresAt\n};\n\nitems[0].json.suggestion_record = record;\nreturn items;"}, "name": "Create Suggestion Record", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1460, 300]}, "connections": {"main": [[{"node": "Store Suggestion (Supabase)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 7, $$"Store Suggestion (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.postgres"$$::jsonb::text, $$"Store Suggestion (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "insert", "schema": "public", "table": "atlas_suggestions", "columns": "suggestion_id,ticket_id,ticket_subject,ticket_body,kb_results,one_line_summary,implementation_plan,email_subject,email_body_approve,email_body_deny,approval_token,status,created_at,updated_at,expires_at", "values": "={{$json[\"suggestion_record\"].suggestion_id}},{{$json[\"suggestion_record\"].ticket_id}},{{$json[\"suggestion_record\"].ticket_subject}},{{$json[\"suggestion_record\"].ticket_body}},{{JSON.stringify($json[\"suggestion_record\"].kb_results)}},{{$json[\"suggestion_record\"].one_line_summary}},{{JSON.stringify($json[\"suggestion_record\"].implementation_plan)}},{{$json[\"suggestion_record\"].email_subject}},{{$json[\"suggestion_record\"].email_body_approve}},{{$json[\"suggestion_record\"].email_body_deny}},{{$json[\"suggestion_record\"].approval_token}},{{$json[\"suggestion_record\"].status}},{{$json[\"suggestion_record\"].created_at}},{{$json[\"suggestion_record\"].updated_at}},{{$json[\"suggestion_record\"].expires_at}}"}, "name": "Store Suggestion (Supabase)", "type": "n8n-nodes-base.postgres", "typeVersion": 1, "position": [1700, 300], "credentials": {"postgres": {"id": "SUPABASE_POSTGRES", "name": "SUPABASE_POSTGRES"}}}, "connections": {"main": [[{"node": "Email CEO (Atlas)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 8, $$"Email CEO (Atlas)"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email CEO (Atlas)"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "support@deadapp.info", "toEmail": "atlas.ceo@deadapp.info", "subject": "={{ '[Action required] Approve workflow suggestion — ' + $json.suggestion_record.suggestion_id + ' — ' + $json.one_line_summary }}", "text": "Hi Atlas,\\n\\nBased on support ticket {{$json.suggestion_record.ticket_id}}: \"{{$json.suggestion_record.ticket_subject}}\", the suggested workflow change is:\\n\\n{{$json.one_line_summary}}\\n\\nImplementation plan (3 steps):\\n1) {{$json.implementation_plan[0]}}\\n2) {{$json.implementation_plan[1]}}\\n3) {{$json.implementation_plan[2]}}\\n\\nWhy: Referenced KB articles: {{$json.kb_references ? $json.kb_references.join(', ') : ''}}\\n\\nPlease reply to this email with exactly one word:\\n- approve\\nor\\n- deny\\n\\n(Your reply will trigger the automation and the support team will be notified.)\\n\\nSuggestion ID: {{$json.suggestion_record.suggestion_id}}\\n\\nThanks,\\nAtlas UX Support Automation"}, "name": "Email CEO (Atlas)", "type": "n8n-nodes-base.emailSend", "typeVersion": 1, "position": [1940, 300], "credentials": {"smtp": {"id": "SMTP_SUPPORT", "name": "SMTP_SUPPORT"}}}, "connections": {"main": [[{"node": "Webhook Response", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-customer_service_AtlasUX_Suggestion_Generator_FIXED"$$::jsonb::text, 9, $$"Webhook Response"$$::jsonb::text, $$"n8n-nodes-base.noOp"$$::jsonb::text, $$"Webhook Response"$$::jsonb::text, $${"n8n_node": {"parameters": {"responseCode": 200, "responseBody": "Suggestion created and sent to Atlas for approval"}, "name": "Webhook Response", "type": "n8n-nodes-base.noOp", "typeVersion": 1, "position": [2180, 300]}, "connections": {}}$$::jsonb);

-- N8N-devops_github_jenkins (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"GitHub Commit Jenkins"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/devops/github_jenkins.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "GitHub Commit Jenkins", "active": null}, "sourcePath": "workflows/n8n/devops/github_jenkins.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "GitHub Commit Jenkins", "nodes": [{"parameters": {"content": "Automated workflow: GitHub Commit Jenkins", "height": 530, "width": 1100, "color": 5}, "id": "5e656fa4-c9ef-419c-b8e5-93b4dd837c81", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "github-commit-jenkins"}, "id": "faa3187e-7313-474f-b54a-a25790101607", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "c5119e77-1c04-4245-9cd2-2f9538fbb8d0", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "fa72e972-a6f0-4352-a738-37f9167c5294", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "indexName": "github_commit_jenkins"}, "id": "8cdecff9-3760-4347-b0db-d24928bae5b4", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"indexName": "github_commit_jenkins"}, "id": "fe3e81f7-097a-4322-84a0-e7d24f7db8e8", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "6f4c86c2-e1bd-4ecf-83cb-b2ceb4b73e6a", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "dace1819-1ddc-4e66-bebe-08fe643516bf", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "91e7ee4a-61ff-479a-acc6-57c7a51a9a70", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'GitHub Commit Jenkins':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for GitHub Commit Jenkins"}}, "id": "3e35e0ca-1355-462b-8f1e-840b1736fce5", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "GitHub Commit Jenkins"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "3624b160-adce-4657-853a-bbf8d6948a1b", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "GitHub Commit Jenkins error: {$json.error.message}"}, "id": "9a67ce5b-4abd-4f9f-a5da-5113300ef9ff", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}, "Supabase Insert": {"ai_document": [[]]}, "Supabase Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"GitHub Commit Jenkins"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-devops_github_jenkins"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 1, $$"faa3187e-7313-474f-b54a-a25790101607"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "github-commit-jenkins"}, "id": "faa3187e-7313-474f-b54a-a25790101607", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 2, $$"5e656fa4-c9ef-419c-b8e5-93b4dd837c81"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: GitHub Commit Jenkins", "height": 530, "width": 1100, "color": 5}, "id": "5e656fa4-c9ef-419c-b8e5-93b4dd837c81", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 3, $$"91e7ee4a-61ff-479a-acc6-57c7a51a9a70"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "91e7ee4a-61ff-479a-acc6-57c7a51a9a70", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 4, $$"c5119e77-1c04-4245-9cd2-2f9538fbb8d0"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "c5119e77-1c04-4245-9cd2-2f9538fbb8d0", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 5, $$"dace1819-1ddc-4e66-bebe-08fe643516bf"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "dace1819-1ddc-4e66-bebe-08fe643516bf", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 6, $$"fa72e972-a6f0-4352-a738-37f9167c5294"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "fa72e972-a6f0-4352-a738-37f9167c5294", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 7, $$"8cdecff9-3760-4347-b0db-d24928bae5b4"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "indexName": "github_commit_jenkins"}, "id": "8cdecff9-3760-4347-b0db-d24928bae5b4", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 8, $$"fe3e81f7-097a-4322-84a0-e7d24f7db8e8"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "github_commit_jenkins"}, "id": "fe3e81f7-097a-4322-84a0-e7d24f7db8e8", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 9, $$"6f4c86c2-e1bd-4ecf-83cb-b2ceb4b73e6a"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "6f4c86c2-e1bd-4ecf-83cb-b2ceb4b73e6a", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 10, $$"3e35e0ca-1355-462b-8f1e-840b1736fce5"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'GitHub Commit Jenkins':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for GitHub Commit Jenkins"}}, "id": "3e35e0ca-1355-462b-8f1e-840b1736fce5", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 11, $$"3624b160-adce-4657-853a-bbf8d6948a1b"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "GitHub Commit Jenkins"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "3624b160-adce-4657-853a-bbf8d6948a1b", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-devops_github_jenkins"$$::jsonb::text, 12, $$"9a67ce5b-4abd-4f9f-a5da-5113300ef9ff"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "GitHub Commit Jenkins error: {$json.error.message}"}, "id": "9a67ce5b-4abd-4f9f-a5da-5113300ef9ff", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-education_quiz_auto_grader (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Quiz Auto Grader"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/education/quiz_auto_grader.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Quiz Auto Grader", "active": null}, "sourcePath": "workflows/n8n/education/quiz_auto_grader.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Quiz Auto Grader", "nodes": [{"parameters": {"content": "Automated workflow: Quiz Auto Grader", "height": 530, "width": 1100, "color": 5}, "id": "52dc6fbe-f7af-43a8-9226-241e163e6bbf", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "quiz-auto-grader"}, "id": "f25da8be-15a9-4fe8-b28c-5343b8a88f29", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "62c88abc-3c7d-4fac-9166-2b6d785992f7", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "embed-english-v3.0", "options": {}}, "id": "ccd8538c-3116-41de-97bb-77e5ef4e6c70", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [70, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "quiz_auto_grader", "mode": "list", "cachedResultName": "quiz_auto_grader"}}, "id": "b28de69a-1f40-4fa8-bc16-62541d526207", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"pineconeIndex": {"__rl": true, "value": "quiz_auto_grader", "mode": "list", "cachedResultName": "quiz_auto_grader"}}, "id": "ab2f14e2-be2d-4512-88ee-3ebdacc3d599", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "73dd9881-3272-4e9a-a422-edf99d78f40a", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "3e44774a-5dcd-4e4f-9b4b-94f4fe9ba8cd", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "fdb6fb02-28f6-4bac-8502-699dc8723223", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'Quiz Auto Grader':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Quiz Auto Grader"}}, "id": "1940fa89-ede4-4c27-82fb-7678cff0df54", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Quiz Auto Grader"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "a3db64cb-9ea7-4a36-8463-219917f66358", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "Quiz Auto Grader error: {$json.error.message}"}, "id": "94d962e2-f5e4-40a1-a075-96e8e9858b32", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}, "Pinecone Insert": {"ai_document": [[]]}, "Pinecone Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Quiz Auto Grader"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-education_quiz_auto_grader"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 1, $$"f25da8be-15a9-4fe8-b28c-5343b8a88f29"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "quiz-auto-grader"}, "id": "f25da8be-15a9-4fe8-b28c-5343b8a88f29", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 2, $$"52dc6fbe-f7af-43a8-9226-241e163e6bbf"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: Quiz Auto Grader", "height": 530, "width": 1100, "color": 5}, "id": "52dc6fbe-f7af-43a8-9226-241e163e6bbf", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 3, $$"fdb6fb02-28f6-4bac-8502-699dc8723223"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "fdb6fb02-28f6-4bac-8502-699dc8723223", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 4, $$"62c88abc-3c7d-4fac-9166-2b6d785992f7"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "62c88abc-3c7d-4fac-9166-2b6d785992f7", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 5, $$"3e44774a-5dcd-4e4f-9b4b-94f4fe9ba8cd"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "3e44774a-5dcd-4e4f-9b4b-94f4fe9ba8cd", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 6, $$"ccd8538c-3116-41de-97bb-77e5ef4e6c70"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsCohere"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "embed-english-v3.0", "options": {}}, "id": "ccd8538c-3116-41de-97bb-77e5ef4e6c70", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [70, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, "connections": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 7, $$"b28de69a-1f40-4fa8-bc16-62541d526207"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "quiz_auto_grader", "mode": "list", "cachedResultName": "quiz_auto_grader"}}, "id": "b28de69a-1f40-4fa8-bc16-62541d526207", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 8, $$"ab2f14e2-be2d-4512-88ee-3ebdacc3d599"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"pineconeIndex": {"__rl": true, "value": "quiz_auto_grader", "mode": "list", "cachedResultName": "quiz_auto_grader"}}, "id": "ab2f14e2-be2d-4512-88ee-3ebdacc3d599", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 9, $$"73dd9881-3272-4e9a-a422-edf99d78f40a"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "73dd9881-3272-4e9a-a422-edf99d78f40a", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 10, $$"1940fa89-ede4-4c27-82fb-7678cff0df54"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'Quiz Auto Grader':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Quiz Auto Grader"}}, "id": "1940fa89-ede4-4c27-82fb-7678cff0df54", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 11, $$"a3db64cb-9ea7-4a36-8463-219917f66358"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Quiz Auto Grader"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "a3db64cb-9ea7-4a36-8463-219917f66358", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-education_quiz_auto_grader"$$::jsonb::text, 12, $$"94d962e2-f5e4-40a1-a075-96e8e9858b32"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "Quiz Auto Grader error: {$json.error.message}"}, "id": "94d962e2-f5e4-40a1-a075-96e8e9858b32", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-financial_LARRY-workflow (atlas_doc)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, $$"larry"$$::jsonb::text, $$"LARRY — Audit Intake + Compliance Stop + Audit Reply (Audit-First)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "email_received", "inbox": "larry.auditor@deadapp.info", "source": "imap"}$$::jsonb, $${"guards": {"authorizedSenders": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"], "onUnauthorized": "halt_silent"}, "compliance": {"neverTransmitSecrets": true, "secretDetection": {"enabled": true, "patterns": ["api[_-]?key\\s*[:=]", "secret\\s*[:=]", "client[_-]?secret\\s*[:=]", "password\\s*[:=]", "-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----", "sk-[A-Za-z0-9]{20,}"]}, "onSecretDetected": {"action": "compliance_stop_reply", "blockExecution": true}}, "audit": {"required": true, "traceThread": true, "threadKeyStrategy": "inReplyTo || references || messageId || `${fromEmail}|${subject}`", "events": [{"event": "EMAIL_RECEIVED", "endpoint": "https://atlas-ux.onrender.com/api/audit/log"}, {"event": "EMAIL_REPLY_SENT", "endpoint": "https://atlas-ux.onrender.com/api/audit/log"}]}}$$::jsonb, $${}$$::jsonb, $${"source": "atlas_doc", "sourceArtifact": {"type": "n8n", "originalWorkflowName": "LARRY — Audit Intake + Compliance Stop + Audit Reply (Audit-First)", "raw": {"file": "LARRY-workflow.json"}}, "role": "Chief Auditor / Corporate Secretary", "agent": "LARRY"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"larry-audit-intake-v1"$$::jsonb::text, $$"larry"$$::jsonb::text, $${"workflowId": "larry-audit-intake-v1", "name": "LARRY — Audit Intake + Compliance Stop + Audit Reply (Audit-First)", "agent": "LARRY", "role": "Chief Auditor / Corporate Secretary", "version": "1.0.0", "status": "ready", "trigger": {"type": "email_received", "inbox": "larry.auditor@deadapp.info", "source": "imap"}, "guards": {"authorizedSenders": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"], "onUnauthorized": "halt_silent"}, "compliance": {"neverTransmitSecrets": true, "secretDetection": {"enabled": true, "patterns": ["api[_-]?key\\s*[:=]", "secret\\s*[:=]", "client[_-]?secret\\s*[:=]", "password\\s*[:=]", "-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----", "sk-[A-Za-z0-9]{20,}"]}, "onSecretDetected": {"action": "compliance_stop_reply", "blockExecution": true}}, "audit": {"required": true, "traceThread": true, "threadKeyStrategy": "inReplyTo || references || messageId || `${fromEmail}|${subject}`", "events": [{"event": "EMAIL_RECEIVED", "endpoint": "https://atlas-ux.onrender.com/api/audit/log"}, {"event": "EMAIL_REPLY_SENT", "endpoint": "https://atlas-ux.onrender.com/api/audit/log"}]}, "steps": [{"id": "normalize_email", "type": "transform", "description": "Extract fromEmail, subject, body, messageId, inReplyTo, references, receivedAt; compute threadKey."}, {"id": "authorize_sender", "type": "guard", "description": "Allow only ATLAS/Billy sender allowlist; otherwise halt silently."}, {"id": "secret_check", "type": "compliance_scan", "description": "Scan subject+body for secrets (keys/tokens/password/private key markers)."}, {"id": "branch_on_secret", "type": "branch", "description": "If secrets: compliance stop reply + blockExecution. Else: draft audit response."}, {"id": "compose_compliance_stop", "type": "template", "description": "Build COMPLIANCE/AUDIT STOP reply message (includes threadKey + receivedAt)."}, {"id": "compose_audit_response", "type": "template", "description": "Build audit review reply template (checks, options, recommendation; includes threadKey + receivedAt)."}, {"id": "send_reply_email", "type": "email_reply", "description": "Reply in-thread using In-Reply-To/References to preserve audit chain.", "config": {"from": "larry.auditor@deadapp.info", "threading": true}}, {"id": "write_audit_events", "type": "audit_log", "description": "Write EMAIL_RECEIVED and EMAIL_REPLY_SENT events to Atlas audit endpoint."}], "sourceArtifact": {"type": "n8n", "originalWorkflowName": "LARRY — Audit Intake + Compliance Stop + Audit Reply (Audit-First)", "raw": {"file": "LARRY-workflow.json"}}}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"LARRY — Audit Intake + Compliance Stop + Audit Reply (Audit-First)"$$::jsonb::text, $$"email_received"$$::jsonb::text)
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-financial_LARRY-workflow"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 1, $$"normalize_email"$$::jsonb::text, $$"transform"$$::jsonb::text, $$"Extract fromEmail, subject, body, messageId, inReplyTo, references, receivedAt; compute threadKey."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 2, $$"authorize_sender"$$::jsonb::text, $$"guard"$$::jsonb::text, $$"Allow only ATLAS/Billy sender allowlist; otherwise halt silently."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 3, $$"secret_check"$$::jsonb::text, $$"compliance_scan"$$::jsonb::text, $$"Scan subject+body for secrets (keys/tokens/password/private key markers)."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 4, $$"branch_on_secret"$$::jsonb::text, $$"branch"$$::jsonb::text, $$"If secrets: compliance stop reply + blockExecution. Else: draft audit response."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 5, $$"compose_compliance_stop"$$::jsonb::text, $$"template"$$::jsonb::text, $$"Build COMPLIANCE/AUDIT STOP reply message (includes threadKey + receivedAt)."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 6, $$"compose_audit_response"$$::jsonb::text, $$"template"$$::jsonb::text, $$"Build audit review reply template (checks, options, recommendation; includes threadKey + receivedAt)."$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 7, $$"send_reply_email"$$::jsonb::text, $$"email_reply"$$::jsonb::text, $$"Reply in-thread using In-Reply-To/References to preserve audit chain."$$::jsonb::text, $${"from": "larry.auditor@deadapp.info", "threading": true}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_LARRY-workflow"$$::jsonb::text, 8, $$"write_audit_events"$$::jsonb::text, $$"audit_log"$$::jsonb::text, $$"Write EMAIL_RECEIVED and EMAIL_REPLY_SENT events to Atlas audit endpoint."$$::jsonb::text, $${}$$::jsonb);

-- N8N-financial_TINA-workflow_json (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, $$"tina"$$::jsonb::text, $$"TINA — Finance Intake + Risk Gate + Advisory Reply (Audit-First)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/financial/TINA-workflow.json.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "TINA — Finance Intake + Risk Gate + Advisory Reply (Audit-First)", "active": false}, "sourcePath": "workflows/n8n/financial/TINA-workflow.json.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, $$"tina"$$::jsonb::text, $${"name": "TINA — Finance Intake + Risk Gate + Advisory Reply (Audit-First)", "nodes": [{"parameters": {"mailbox": "INBOX", "postProcessAction": "nothing", "downloadAttachments": false, "options": {"allowUnauthorizedCerts": false}}, "name": "Email Trigger (IMAP) — tina.cfo@deadapp.info", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [260, 300], "credentials": {"imap": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Tina IMAP"}}}, {"parameters": {"jsCode": "const msg = items[0].json;\n\nconst fromRaw = msg.from?.text || msg.from || '';\nconst subject = msg.subject || '';\nconst text = msg.text || msg.textPlain || msg.body || '';\nconst messageId = msg.messageId || msg.headers?.['message-id'] || msg.header?.messageId || '';\nconst inReplyTo = msg.inReplyTo || msg.headers?.['in-reply-to'] || '';\nconst references = msg.references || msg.headers?.references || '';\nconst date = msg.date || new Date().toISOString();\n\nconst emailMatch = String(fromRaw).match(/<([^>]+)>/);\nconst fromEmail = (emailMatch ? emailMatch[1] : fromRaw).trim().toLowerCase();\n\nreturn [{\n  json: {\n    fromRaw,\n    fromEmail,\n    subject,\n    text,\n    messageId,\n    inReplyTo,\n    references,\n    receivedAt: date,\n    threadKey: inReplyTo || references || messageId || `${fromEmail}|${subject}`\n  }\n}];"}, "name": "Normalize Email", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [520, 300]}, {"parameters": {"rules": {"rules": [{"operation": "in", "value1": "={{$json.fromEmail}}", "value2": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}]}}, "name": "Authorize Sender (ATLAS Required)", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [760, 300]}, {"parameters": {"jsCode": "const { subject, text } = items[0].json;\n\nconst secretPatterns = [\n  /api[_-]?key\\s*[:=]/i,\n  /secret\\s*[:=]/i,\n  /client[_-]?secret\\s*[:=]/i,\n  /password\\s*[:=]/i,\n  /-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----/i,\n  /sk-[A-Za-z0-9]{20,}/\n];\n\nconst content = `${subject}\\n\\n${text}`;\nconst containsSecrets = secretPatterns.some((re) => re.test(content));\n\nreturn [{ json: { ...items[0].json, containsSecrets } }];"}, "name": "Secret Check (Never Transmit Secrets)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 220]}, {"parameters": {"rules": {"rules": [{"operation": "equal", "value1": "={{$json.containsSecrets}}", "value2": true}]}}, "name": "If Secrets Detected → Compliance Stop", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [1220, 220]}, {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Tina (CFO/Treasurer) — COMPLIANCE/AUDIT STOP\\n\\n` +\n`Detected content that appears to include secrets/credentials (or private keys). ` +\n`Per policy: I cannot process or retransmit secrets.\\n\\n` +\n`Action Required:\\n` +\n`1) Remove secrets from the thread (redact keys/passwords/tokens).\\n` +\n`2) Resubmit the request from ATLAS with only non-sensitive context.\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blockExecution: true } }];"}, "name": "Build Compliance Stop Reply", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 140]}, {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Tina (CFO/Treasurer) — Financial Review\\n\\n` +\n`Summary of Request (as received):\\n` +\n`- (1–3 sentences; do not invent facts)\\n\\n` +\n`Cost / Budget Impact:\\n` +\n`- One-time cost: $____\\n` +\n`- Monthly recurring: $____\\n` +\n`- Budget category: ____\\n` +\n`- Estimated ROI / benefit: ____\\n\\n` +\n`Risk Flags:\\n` +\n`- Risk: [Low/Med/High] — Reason\\n` +\n`- Vendor lock-in / terms concerns: ____\\n` +\n`- Data/ops cost exposure: ____\\n\\n` +\n`Decision Options:\\n` +\n`1) Approve — Conditions (if any) — Required approvals\\n` +\n`2) Approve w/ cap — Spend ceiling — Required approvals\\n` +\n`3) Deny / Defer — What would change my decision\\n\\n` +\n`Recommendation (CFO Gate):\\n` +\n`- Recommend: [Proceed / Proceed w/ cap / Block] — Reason\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n` +\n`- Referenced docs/links: (titles + links + dates)\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blockExecution: false } }];"}, "name": "Draft CFO Response (Template Output)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 360]}, {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\"agent\":\"TINA\",\"role\":\"Chief Financial Officer / Treasurer\",\"event\":\"EMAIL_RECEIVED\",\"threadKey\":$json.threadKey,\"from\":$json.fromEmail,\"subject\":$json.subject,\"receivedAt\":$json.receivedAt,\"messageId\":$json.messageId,\"containsSecrets\":$json.containsSecrets}"}, "name": "Audit Log — Email Received", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1000, 420]}, {"parameters": {"fromEmail": "tina.cfo@deadapp.info", "toEmail": "={{$json.fromEmail}}", "subject": "={{$json.replySubject}}", "text": "={{$json.replyBody}}", "options": {"inReplyTo": "={{$json.messageId || $json.inReplyTo}}", "references": "={{$json.references}}"}}, "name": "Send Reply Email (Audit Chain)", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1680, 300], "credentials": {"smtp": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Tina SMTP"}}}, {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\"agent\":\"TINA\",\"role\":\"Chief Financial Officer / Treasurer\",\"event\":\"EMAIL_REPLY_SENT\",\"threadKey\":$json.threadKey,\"to\":$json.fromEmail,\"subject\":$json.replySubject,\"sentAt\":$now,\"blocked\":$json.blockExecution}"}, "name": "Audit Log — Reply Sent", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1920, 420]}, {"parameters": {"jsCode": "const j = items[0].json;\nreturn [{ json: { ...j, unauthorized: true, stop: true } }];"}, "name": "Unauthorized — Stop", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 120]}], "connections": {}, "active": false, "settings": {"executionTimeout": 3600, "saveExecutionProgress": true, "saveManualExecutions": true}, "versionId": "1"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"TINA — Finance Intake + Risk Gate + Advisory Reply (Audit-First)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-financial_TINA-workflow_json"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 1, $$"Email Trigger (IMAP) — tina.cfo@deadapp.info"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"Email Trigger (IMAP) — tina.cfo@deadapp.info"$$::jsonb::text, $${"n8n_node": {"parameters": {"mailbox": "INBOX", "postProcessAction": "nothing", "downloadAttachments": false, "options": {"allowUnauthorizedCerts": false}}, "name": "Email Trigger (IMAP) — tina.cfo@deadapp.info", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [260, 300], "credentials": {"imap": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Tina IMAP"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 2, $$"Normalize Email"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Normalize Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const msg = items[0].json;\n\nconst fromRaw = msg.from?.text || msg.from || '';\nconst subject = msg.subject || '';\nconst text = msg.text || msg.textPlain || msg.body || '';\nconst messageId = msg.messageId || msg.headers?.['message-id'] || msg.header?.messageId || '';\nconst inReplyTo = msg.inReplyTo || msg.headers?.['in-reply-to'] || '';\nconst references = msg.references || msg.headers?.references || '';\nconst date = msg.date || new Date().toISOString();\n\nconst emailMatch = String(fromRaw).match(/<([^>]+)>/);\nconst fromEmail = (emailMatch ? emailMatch[1] : fromRaw).trim().toLowerCase();\n\nreturn [{\n  json: {\n    fromRaw,\n    fromEmail,\n    subject,\n    text,\n    messageId,\n    inReplyTo,\n    references,\n    receivedAt: date,\n    threadKey: inReplyTo || references || messageId || `${fromEmail}|${subject}`\n  }\n}];"}, "name": "Normalize Email", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [520, 300]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 3, $$"Authorize Sender (ATLAS Required)"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Authorize Sender (ATLAS Required)"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"rules": [{"operation": "in", "value1": "={{$json.fromEmail}}", "value2": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}]}}, "name": "Authorize Sender (ATLAS Required)", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [760, 300]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 4, $$"Secret Check (Never Transmit Secrets)"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Secret Check (Never Transmit Secrets)"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const { subject, text } = items[0].json;\n\nconst secretPatterns = [\n  /api[_-]?key\\s*[:=]/i,\n  /secret\\s*[:=]/i,\n  /client[_-]?secret\\s*[:=]/i,\n  /password\\s*[:=]/i,\n  /-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----/i,\n  /sk-[A-Za-z0-9]{20,}/\n];\n\nconst content = `${subject}\\n\\n${text}`;\nconst containsSecrets = secretPatterns.some((re) => re.test(content));\n\nreturn [{ json: { ...items[0].json, containsSecrets } }];"}, "name": "Secret Check (Never Transmit Secrets)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 220]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 5, $$"If Secrets Detected → Compliance Stop"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"If Secrets Detected → Compliance Stop"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"rules": [{"operation": "equal", "value1": "={{$json.containsSecrets}}", "value2": true}]}}, "name": "If Secrets Detected → Compliance Stop", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [1220, 220]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 6, $$"Build Compliance Stop Reply"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Build Compliance Stop Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Tina (CFO/Treasurer) — COMPLIANCE/AUDIT STOP\\n\\n` +\n`Detected content that appears to include secrets/credentials (or private keys). ` +\n`Per policy: I cannot process or retransmit secrets.\\n\\n` +\n`Action Required:\\n` +\n`1) Remove secrets from the thread (redact keys/passwords/tokens).\\n` +\n`2) Resubmit the request from ATLAS with only non-sensitive context.\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blockExecution: true } }];"}, "name": "Build Compliance Stop Reply", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 140]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 7, $$"Draft CFO Response (Template Output)"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Draft CFO Response (Template Output)"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Tina (CFO/Treasurer) — Financial Review\\n\\n` +\n`Summary of Request (as received):\\n` +\n`- (1–3 sentences; do not invent facts)\\n\\n` +\n`Cost / Budget Impact:\\n` +\n`- One-time cost: $____\\n` +\n`- Monthly recurring: $____\\n` +\n`- Budget category: ____\\n` +\n`- Estimated ROI / benefit: ____\\n\\n` +\n`Risk Flags:\\n` +\n`- Risk: [Low/Med/High] — Reason\\n` +\n`- Vendor lock-in / terms concerns: ____\\n` +\n`- Data/ops cost exposure: ____\\n\\n` +\n`Decision Options:\\n` +\n`1) Approve — Conditions (if any) — Required approvals\\n` +\n`2) Approve w/ cap — Spend ceiling — Required approvals\\n` +\n`3) Deny / Defer — What would change my decision\\n\\n` +\n`Recommendation (CFO Gate):\\n` +\n`- Recommend: [Proceed / Proceed w/ cap / Block] — Reason\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n` +\n`- Referenced docs/links: (titles + links + dates)\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blockExecution: false } }];"}, "name": "Draft CFO Response (Template Output)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 360]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 8, $$"Audit Log — Email Received"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Audit Log — Email Received"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\"agent\":\"TINA\",\"role\":\"Chief Financial Officer / Treasurer\",\"event\":\"EMAIL_RECEIVED\",\"threadKey\":$json.threadKey,\"from\":$json.fromEmail,\"subject\":$json.subject,\"receivedAt\":$json.receivedAt,\"messageId\":$json.messageId,\"containsSecrets\":$json.containsSecrets}"}, "name": "Audit Log — Email Received", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1000, 420]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 9, $$"Send Reply Email (Audit Chain)"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Send Reply Email (Audit Chain)"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "tina.cfo@deadapp.info", "toEmail": "={{$json.fromEmail}}", "subject": "={{$json.replySubject}}", "text": "={{$json.replyBody}}", "options": {"inReplyTo": "={{$json.messageId || $json.inReplyTo}}", "references": "={{$json.references}}"}}, "name": "Send Reply Email (Audit Chain)", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1680, 300], "credentials": {"smtp": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Tina SMTP"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 10, $$"Audit Log — Reply Sent"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Audit Log — Reply Sent"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\"agent\":\"TINA\",\"role\":\"Chief Financial Officer / Treasurer\",\"event\":\"EMAIL_REPLY_SENT\",\"threadKey\":$json.threadKey,\"to\":$json.fromEmail,\"subject\":$json.replySubject,\"sentAt\":$now,\"blocked\":$json.blockExecution}"}, "name": "Audit Log — Reply Sent", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1920, 420]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-financial_TINA-workflow_json"$$::jsonb::text, 11, $$"Unauthorized — Stop"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Unauthorized — Stop"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\nreturn [{ json: { ...j, unauthorized: true, stop: true } }];"}, "name": "Unauthorized — Stop", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 120]}, "connections": {}}$$::jsonb);

-- N8N-healthcare_appointment_notification (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Appointment WhatsApp Notify"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/healthcare/appointment_notification.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Appointment WhatsApp Notify", "active": null}, "sourcePath": "workflows/n8n/healthcare/appointment_notification.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Appointment WhatsApp Notify", "nodes": [{"parameters": {"content": "Automated workflow: Appointment WhatsApp Notify", "height": 530, "width": 1100, "color": 5}, "id": "7d42a8e4-d9e6-46c6-b4b2-c489c79c3bf3", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "appointment-whatsapp-notify"}, "id": "9f460db0-3b15-45a4-a04f-24ec690273d3", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "ea6552ef-ebcc-4c99-9348-78a9b4f2ad2b", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "d919f86b-a52c-43ca-ac8c-b6dbf1ccbbcf", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "indexName": "appointment_whatsapp_notify"}, "id": "74081a07-d962-455e-b685-11d29c9e67ad", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"indexName": "appointment_whatsapp_notify"}, "id": "7fda199c-926c-43ec-a604-972e82c7c0ef", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "069d2f87-d2ab-422e-ad9a-cb9d28562d17", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "0920c840-2c14-436a-8fbd-d4a53300cc05", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "de83e37d-fe22-485d-8e38-8795be4284d9", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'Appointment WhatsApp Notify':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Appointment WhatsApp Notify"}}, "id": "1b33a7d5-ea1d-4e8d-9a8c-d70165f468cf", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Appointment WhatsApp Notify"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "5cc56f79-87d1-4926-8548-9ee1e8a60ffb", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "Appointment WhatsApp Notify error: {$json.error.message}"}, "id": "25d22e2e-dc95-424a-b6e6-f5e9b5a889f9", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}, "Supabase Insert": {"ai_document": [[]]}, "Supabase Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Appointment WhatsApp Notify"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-healthcare_appointment_notification"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 1, $$"9f460db0-3b15-45a4-a04f-24ec690273d3"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "appointment-whatsapp-notify"}, "id": "9f460db0-3b15-45a4-a04f-24ec690273d3", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 2, $$"7d42a8e4-d9e6-46c6-b4b2-c489c79c3bf3"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: Appointment WhatsApp Notify", "height": 530, "width": 1100, "color": 5}, "id": "7d42a8e4-d9e6-46c6-b4b2-c489c79c3bf3", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 3, $$"de83e37d-fe22-485d-8e38-8795be4284d9"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "de83e37d-fe22-485d-8e38-8795be4284d9", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 4, $$"ea6552ef-ebcc-4c99-9348-78a9b4f2ad2b"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "ea6552ef-ebcc-4c99-9348-78a9b4f2ad2b", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 5, $$"0920c840-2c14-436a-8fbd-d4a53300cc05"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "0920c840-2c14-436a-8fbd-d4a53300cc05", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 6, $$"d919f86b-a52c-43ca-ac8c-b6dbf1ccbbcf"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "d919f86b-a52c-43ca-ac8c-b6dbf1ccbbcf", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 7, $$"74081a07-d962-455e-b685-11d29c9e67ad"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "indexName": "appointment_whatsapp_notify"}, "id": "74081a07-d962-455e-b685-11d29c9e67ad", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 8, $$"7fda199c-926c-43ec-a604-972e82c7c0ef"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "appointment_whatsapp_notify"}, "id": "7fda199c-926c-43ec-a604-972e82c7c0ef", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 9, $$"069d2f87-d2ab-422e-ad9a-cb9d28562d17"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "069d2f87-d2ab-422e-ad9a-cb9d28562d17", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 10, $$"1b33a7d5-ea1d-4e8d-9a8c-d70165f468cf"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'Appointment WhatsApp Notify':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for Appointment WhatsApp Notify"}}, "id": "1b33a7d5-ea1d-4e8d-9a8c-d70165f468cf", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 11, $$"5cc56f79-87d1-4926-8548-9ee1e8a60ffb"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Appointment WhatsApp Notify"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "5cc56f79-87d1-4926-8548-9ee1e8a60ffb", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-healthcare_appointment_notification"$$::jsonb::text, 12, $$"25d22e2e-dc95-424a-b6e6-f5e9b5a889f9"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "Appointment WhatsApp Notify error: {$json.error.message}"}, "id": "25d22e2e-dc95-424a-b6e6-f5e9b5a889f9", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-hr_job_application_parser (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"New Job Application Parser"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/hr/job_application_parser.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "New Job Application Parser", "active": null}, "sourcePath": "workflows/n8n/hr/job_application_parser.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "New Job Application Parser", "nodes": [{"parameters": {"content": "Automated workflow: New Job Application Parser", "height": 530, "width": 1100, "color": 5}, "id": "355dc5d9-e675-4948-ac07-e2372746beac", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "new-job-application-parser"}, "id": "5a292fdb-55a6-4b6c-95cb-918e2f5592a1", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "53900c40-00b0-4e87-98cf-de274ce1fddc", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "a3b1c492-f0ec-4275-a656-765170f336db", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "new_job_application_parser", "mode": "list", "cachedResultName": "new_job_application_parser"}}, "id": "cfcd7174-0670-4521-a3d0-f166637355b9", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"pineconeIndex": {"__rl": true, "value": "new_job_application_parser", "mode": "list", "cachedResultName": "new_job_application_parser"}}, "id": "2a452b2b-edca-4ab6-87a5-a9cb33ca4473", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "3f39c7db-4b74-452f-85c5-1221de07d7c8", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "c3cf7b90-7202-47b1-a2e3-e1f2c74eaa33", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "3cd3b436-538e-470c-89e5-e8776258c498", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "Process the following data for task 'New Job Application Parser':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for New Job Application Parser"}}, "id": "a741b715-3e97-445a-8c1a-f5c8ce5cf2dd", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "New Job Application Parser"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "8d1a3c8a-520f-4e56-8120-7b54029bd828", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "New Job Application Parser error: {$json.error.message}"}, "id": "1b63bca3-2e7f-450e-80ef-f5cf18df53f1", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}, "Pinecone Insert": {"ai_document": [[]]}, "Pinecone Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"New Job Application Parser"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-hr_job_application_parser"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 1, $$"5a292fdb-55a6-4b6c-95cb-918e2f5592a1"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "new-job-application-parser"}, "id": "5a292fdb-55a6-4b6c-95cb-918e2f5592a1", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 2, $$"355dc5d9-e675-4948-ac07-e2372746beac"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Automated workflow: New Job Application Parser", "height": 530, "width": 1100, "color": 5}, "id": "355dc5d9-e675-4948-ac07-e2372746beac", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 3, $$"3cd3b436-538e-470c-89e5-e8776258c498"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "3cd3b436-538e-470c-89e5-e8776258c498", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 4, $$"53900c40-00b0-4e87-98cf-de274ce1fddc"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "53900c40-00b0-4e87-98cf-de274ce1fddc", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 5, $$"c3cf7b90-7202-47b1-a2e3-e1f2c74eaa33"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "c3cf7b90-7202-47b1-a2e3-e1f2c74eaa33", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 6, $$"a3b1c492-f0ec-4275-a656-765170f336db"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "a3b1c492-f0ec-4275-a656-765170f336db", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 7, $$"cfcd7174-0670-4521-a3d0-f166637355b9"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "new_job_application_parser", "mode": "list", "cachedResultName": "new_job_application_parser"}}, "id": "cfcd7174-0670-4521-a3d0-f166637355b9", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 8, $$"2a452b2b-edca-4ab6-87a5-a9cb33ca4473"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"pineconeIndex": {"__rl": true, "value": "new_job_application_parser", "mode": "list", "cachedResultName": "new_job_application_parser"}}, "id": "2a452b2b-edca-4ab6-87a5-a9cb33ca4473", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 9, $$"3f39c7db-4b74-452f-85c5-1221de07d7c8"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "3f39c7db-4b74-452f-85c5-1221de07d7c8", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 10, $$"a741b715-3e97-445a-8c1a-f5c8ce5cf2dd"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Process the following data for task 'New Job Application Parser':\n\n{{ $json }}", "options": {"systemMessage": "You are an assistant for New Job Application Parser"}}, "id": "a741b715-3e97-445a-8c1a-f5c8ce5cf2dd", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 11, $$"8d1a3c8a-520f-4e56-8120-7b54029bd828"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "New Job Application Parser"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": {"Status": "={{$json[\"RAG Agent\"].text}}"}, "schema": []}}, "id": "8d1a3c8a-520f-4e56-8120-7b54029bd828", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-hr_job_application_parser"$$::jsonb::text, 12, $$"1b63bca3-2e7f-450e-80ef-f5cf18df53f1"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "New Job Application Parser error: {$json.error.message}"}, "id": "1b63bca3-2e7f-450e-80ef-f5cf18df53f1", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-legal_JENNY-CLO-intake (atlas_doc)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, $$"jenny"$$::jsonb::text, $$"Jenny — CLO Intake + Advisory Reply"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "email_received", "inbox": "jenny.clo@deadapp.info", "requiredSender": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}$$::jsonb, $${"guards": {}, "compliance": {}, "audit": {"traceThread": true, "requireTimestamp": true, "retainIndefinitely": true}}$$::jsonb, $${}$$::jsonb, $${"source": "atlas_doc", "sourceArtifact": null, "role": "Legal Counsel (CLO Office)", "agent": "JENNY"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"jenny-clo-intake-v1"$$::jsonb::text, $$"jenny"$$::jsonb::text, $${"workflowId": "jenny-clo-intake-v1", "name": "Jenny — CLO Intake + Advisory Reply", "agent": "JENNY", "role": "Legal Counsel (CLO Office)", "version": "1.0.0", "status": "ready", "trigger": {"type": "email_received", "inbox": "jenny.clo@deadapp.info", "requiredSender": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}, "policy": {"truthRequired": true, "neverTransmitSecrets": true, "advisoryOnly": true, "canBlockExecution": true, "auditRequired": true}, "steps": [{"id": "normalize_email", "type": "transform", "description": "Normalize inbound email and generate thread key"}, {"id": "authorize_sender", "type": "guard", "description": "Verify email originates from ATLAS-authorized sender", "onFail": "halt_silent"}, {"id": "secret_scan", "type": "compliance_scan", "description": "Detect presence of credentials or secrets", "onMatch": "compliance_stop"}, {"id": "draft_advisory", "type": "generate", "description": "Produce CLO advisory response with risks, options, approvals"}, {"id": "send_reply", "type": "email_reply", "description": "Reply in-thread to preserve audit chain", "inbox": "jenny.clo@deadapp.info"}, {"id": "write_audit_log", "type": "audit_log", "description": "Persist full trace with timestamp and thread key"}], "complianceStop": {"enabled": true, "messageTemplate": "Jenny (CLO) — COMPLIANCE/AUDIT STOP\n\nDetected potential secrets or restricted data. Per ATLAS_POLICY I cannot process this request.\n\nAction Required:\n1) Remove secrets\n2) Resubmit via ATLAS\n\nThread Key: {{threadKey}}\nTimestamp: {{timestamp}}"}, "outputs": {"primary": "email_reply", "secondary": ["audit_log", "risk_flags", "decision_options"]}, "authority": {"mode": "advisory", "blockOnCompliance": true, "escalationTarget": "ATLAS"}, "audit": {"traceThread": true, "requireTimestamp": true, "retainIndefinitely": true}, "metadata": {"createdBy": "Billy E. Whited", "system": "Atlas UX", "agentInbox": "jenny.clo@deadapp.info", "trustMode": "maximum", "lastUpdated": "2026-02-21"}}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Jenny — CLO Intake + Advisory Reply"$$::jsonb::text, $$"email_received"$$::jsonb::text)
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 1, $$"normalize_email"$$::jsonb::text, $$"transform"$$::jsonb::text, $$"Normalize inbound email and generate thread key"$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 2, $$"authorize_sender"$$::jsonb::text, $$"guard"$$::jsonb::text, $$"Verify email originates from ATLAS-authorized sender"$$::jsonb::text, $${"onFail": "halt_silent"}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 3, $$"secret_scan"$$::jsonb::text, $$"compliance_scan"$$::jsonb::text, $$"Detect presence of credentials or secrets"$$::jsonb::text, $${"onMatch": "compliance_stop"}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 4, $$"draft_advisory"$$::jsonb::text, $$"generate"$$::jsonb::text, $$"Produce CLO advisory response with risks, options, approvals"$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 5, $$"send_reply"$$::jsonb::text, $$"email_reply"$$::jsonb::text, $$"Reply in-thread to preserve audit chain"$$::jsonb::text, $${"inbox": "jenny.clo@deadapp.info"}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_JENNY-CLO-intake"$$::jsonb::text, 6, $$"write_audit_log"$$::jsonb::text, $$"audit_log"$$::jsonb::text, $$"Persist full trace with timestamp and thread key"$$::jsonb::text, $${}$$::jsonb);

-- N8N-legal_benny_atlas_workflow_v1 (atlas_doc)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, $$"benny"$$::jsonb::text, $$"Benny — IP Triage & Evidence Pack"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "http", "method": "POST", "path": "/api/ip/triage"}$$::jsonb, $${"guards": {}, "compliance": {}, "audit": {}}$$::jsonb, $${}$$::jsonb, $${"source": "atlas_doc", "sourceArtifact": null, "role": null, "agent": null}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, $$"benny"$$::jsonb::text, $${"id": "benny_ip_triage_evidence_pack_v1", "name": "Benny — IP Triage & Evidence Pack", "owner": "benny.cto@deadapp.info", "version": "1.0.0", "category": "ip", "policy_ref": "triageevidencepack.md", "trigger": {"type": "http", "method": "POST", "path": "/api/ip/triage"}, "input_schema": {"required": ["request_id", "asset_type", "jurisdiction", "question"], "properties": {"request_id": {"type": "string", "format": "uuid"}, "company": {"type": "string"}, "asset_type": {"type": "string"}, "jurisdiction": {"type": "string"}, "question": {"type": "string"}, "facts": {"type": "string"}, "links": {"type": "array", "items": {"type": "string"}}, "constraints": {"type": "array", "items": {"type": "string"}}, "requested_by": {"type": "string"}, "receipt_id": {"type": "string"}, "atlas_thread_id": {"type": "string"}, "timestamp": {"type": "string"}}}, "steps": [{"id": "gate_validate", "type": "gate.validate"}, {"id": "audit_intake", "type": "audit.log"}, {"id": "db_store_request", "type": "db.insert"}, {"id": "respond_ack", "type": "http.respond"}, {"id": "compute_hashes", "type": "transform.hash_sha256_list"}, {"id": "db_store_artifacts_stub", "type": "db.insert_many"}, {"id": "research_domain_class_placeholder", "type": "research.domain_class"}, {"id": "risk_classify", "type": "transform.risk_classify"}, {"id": "build_evidence_pack", "type": "llm.generate_json"}, {"id": "db_store_report", "type": "db.insert"}, {"id": "issue_approval_token", "type": "approval.issue"}, {"id": "db_store_approval_message", "type": "db.insert"}, {"id": "notify_email", "type": "email.send"}, {"id": "db_set_status_awaiting", "type": "db.update"}]}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Benny — IP Triage & Evidence Pack"$$::jsonb::text, $$"http"$$::jsonb::text)
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 1, $$"gate_validate"$$::jsonb::text, $$"gate.validate"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 2, $$"audit_intake"$$::jsonb::text, $$"audit.log"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 3, $$"db_store_request"$$::jsonb::text, $$"db.insert"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 4, $$"respond_ack"$$::jsonb::text, $$"http.respond"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 5, $$"compute_hashes"$$::jsonb::text, $$"transform.hash_sha256_list"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 6, $$"db_store_artifacts_stub"$$::jsonb::text, $$"db.insert_many"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 7, $$"research_domain_class_placeholder"$$::jsonb::text, $$"research.domain_class"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 8, $$"risk_classify"$$::jsonb::text, $$"transform.risk_classify"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 9, $$"build_evidence_pack"$$::jsonb::text, $$"llm.generate_json"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 10, $$"db_store_report"$$::jsonb::text, $$"db.insert"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 11, $$"issue_approval_token"$$::jsonb::text, $$"approval.issue"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 12, $$"db_store_approval_message"$$::jsonb::text, $$"db.insert"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 13, $$"notify_email"$$::jsonb::text, $$"email.send"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_benny_atlas_workflow_v1"$$::jsonb::text, 14, $$"db_set_status_awaiting"$$::jsonb::text, $$"db.update"$$::jsonb::text, $$null$$::jsonb::text, $${}$$::jsonb);

-- N8N-legal_triageevidencepack (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, $$"benny"$$::jsonb::text, $$"ATLAS -> Benny IP Triage & Evidence Pack (starter)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/legal/triageevidencepack.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "ATLAS -> Benny IP Triage & Evidence Pack (starter)", "active": false}, "sourcePath": "workflows/n8n/legal/triageevidencepack.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, $$"benny"$$::jsonb::text, $${"name": "ATLAS -> Benny IP Triage & Evidence Pack (starter)", "nodes": [{"parameters": {"httpMethod": "POST", "path": "atlas-ip-intake", "responseMode": "onReceived", "responseData": "={{ { status: 'received', note: 'Processing started' } }}", "options": {}}, "name": "ATLAS Intake (Webhook)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 250]}, {"parameters": {"functionCode": "/* Validate required fields: jurisdiction, asset_type, question */\nconst payload = items[0].json;\nconst missing = [];\n['jurisdiction','asset_type','question','request_id','company'].forEach(k=>{\n  if(!payload[k]) missing.push(k);\n});\nif(missing.length){\n  return [{ json: { valid: false, missing } }];\n}\n// Pass through original payload and create a generated receipt_id if not present\nconst receiptId = payload.receipt_id || `rcpt_${Date.now()}`;\nreturn [{ json: { valid: true, payload, receipt_id: receiptId } }];"}, "name": "Validate Payload", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [520, 250]}, {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_requests", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"request_id\": $json.payload.request_id,\n  \"raw_payload\": $json.payload,\n  \"company\": $json.payload.company || null,\n  \"asset_type\": $json.payload.asset_type || null,\n  \"jurisdiction\": $json.payload.jurisdiction || null,\n  \"question\": $json.payload.question || null,\n  \"received_at\": new Date().toISOString(),\n  \"receipt_id\": $json.receipt_id\n}"}, "name": "Store Request (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [820, 160], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, {"parameters": {"statusCode": 202, "responseBody": "={\"status\":\"accepted\",\"receipt_id\":$json.receipt_id}", "responseHeadersJson": "{}"}, "name": "Respond to Webhook (ack)", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1120, 160]}, {"parameters": {"functionCode": "/* Compute simple SHA256 hashes for any link list in payload.links */\nconst crypto = require('crypto');\nconst payload = $json.payload;\nconst links = payload.links || [];\nconst hashes = links.map(l => {\n  const h = crypto.createHash('sha256');\n  h.update(String(l));\n  return { link: l, sha256: h.digest('hex') };\n});\nreturn [{ json: { payload, hashes, receipt_id: $json.receipt_id } }];"}, "name": "Compute Hashes", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1120, 320]}, {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_artifacts", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"request_id\": $json.payload.request_id,\n  \"artifacts\": $json.hashes,\n  \"created_at\": new Date().toISOString()\n}"}, "name": "Store Artifacts (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [1420, 320], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, {"parameters": {"functionCode": "/* Placeholder: run domain-class searches. In production replace with real API calls (USPTO, EUIPO, WHOIS, Domain history). This node should collect & attach raw results. */\nconst req = $json.payload;\n// Dummy example results\nconst findings = [];\n// If company name resembles a known mark, add dummy finding\nif(req.company && req.company.toLowerCase().includes('dead')){\n  findings.push({ source: 'USPTO-TESS', query: req.company, found: false, retrieved_at: new Date().toISOString() });\n}\nreturn [{ json: { payload: req, findings } }];"}, "name": "Domain-class Research (placeholder)", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1120, 520]}, {"parameters": {"functionCode": "/* Simple risk classification placeholder based on findings count and missing facts. Replace with your rules. */\nconst p = $json.payload || {};\nconst findings = $json.findings || [];\nconst missing = (p.facts || '').length === 0 ? ['facts'] : [];\nlet risk = 'low';\nif(findings.length > 0) risk = 'medium';\nif(missing.length > 0) risk = 'medium';\n// Example escalation: if a critical indicator found, mark high\n// (Replace with your real detection)\nreturn [{ json: { payload: p, findings, missing, risk } }];"}, "name": "Risk Classification", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1420, 520]}, {"parameters": {"functionCode": "/* Build short Evidence Pack summary (one-page style) and decision options. This is a stub; adapt for PDF generation or storage. */\nconst r = $json;\nconst summary = {\n  request_id: r.payload.request_id || null,\n  exec_summary: `Preliminary triage: risk=${r.risk}. Findings: ${r.findings.length}`,\n  risk_level: r.risk,\n  unknowns: r.missing,\n  decision_options: [\n    { option: 'Do nothing', rationale: 'Low immediate risk', impact: 'low' },\n    { option: 'Collect evidence', rationale: 'Confirm creation/use dates', impact: 'medium' },\n    { option: 'File TM', rationale: 'If used in commerce & priority established', impact: 'high' }\n  ],\n  generated_at: new Date().toISOString()\n};\nreturn [{ json: { request_id: r.payload.request_id, evidence_pack: summary } }];"}, "name": "Build Evidence Pack", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1720, 520]}, {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_reports", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"report_id\": `rep_${Date.now()}`,\n  \"request_id\": $json.request_id,\n  \"summary\": $json.evidence_pack.exec_summary,\n  \"risk_level\": $json.evidence_pack.risk_level,\n  \"decision_options\": $json.evidence_pack.decision_options,\n  \"evidence_index\": [],\n  \"created_at\": new Date().toISOString()\n}"}, "name": "Store Report (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [2000, 520], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, {"parameters": {"functionCode": "/* Generate approval token and message payload */\nconst token = `approve_${Math.random().toString(36).slice(2,12)}`;\nreturn [{ json: { request_id: $json.request_id, approval_token: token, approve_link: `https://your-approval-ui.example/approve?token=${token}`, deny_link: `https://your-approval-ui.example/deny?token=${token}` } }];"}, "name": "Generate Approve/Deny Token", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [2260, 520]}, {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_messages", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"message_id\": `msg_${Date.now()}`,\n  \"request_id\": $json.request_id,\n  \"message_type\": \"approval_request\",\n  \"payload\": { approve_link: $json.approve_link, deny_link: $json.deny_link, token: $json.approval_token },\n  \"actor\": \"benny.cto@deadapp.info\",\n  \"received_at\": new Date().toISOString()\n}"}, "name": "Store Approval Message (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [2520, 520], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, {"parameters": {"fromEmail": "benny.cto@deadapp.info", "toEmail": "={{ $json.payload.requested_by || $json.payload.requester || '' }}", "subject": "=[ATLAS receipt: {{$json.payload.receipt_id}}] IP Triage: {{$json.payload.request_id}}", "text": "={{\n  `ATLAS-thread: ${$json.payload.request_id} | receipt: ${$json.payload.receipt_id}\\n\\nExec summary: ${$json.evidence_pack ? $json.evidence_pack.exec_summary : 'See attached'}\\n\\nRisk level: ${$json.evidence_pack ? $json.evidence_pack.risk_level : 'TBD'}\\n\\nApprove: ${$json.approve_link}\\nDeny: ${$json.deny_link}\\n\\nThis is an advisory evidence pack, not legal advice.`\n}}"}, "name": "Send Reply Email (SMTP)", "type": "n8n-nodes-base.smtp", "typeVersion": 1, "position": [2780, 520], "credentials": {"smtp": {"id": "smtp-credentials-placeholder"}}}], "connections": {"ATLAS Intake (Webhook)": {"main": [[{"node": "Validate Payload", "type": "main", "index": 0}]]}, "Validate Payload": {"main": [[{"node": "Store Request (Supabase)", "type": "main", "index": 0}]]}, "Store Request (Supabase)": {"main": [[{"node": "Respond to Webhook (ack)", "type": "main", "index": 0}, {"node": "Compute Hashes", "type": "main", "index": 0}]]}, "Compute Hashes": {"main": [[{"node": "Store Artifacts (Supabase)", "type": "main", "index": 0}, {"node": "Domain-class Research (placeholder)", "type": "main", "index": 0}]]}, "Store Artifacts (Supabase)": {"main": [[{"node": "Domain-class Research (placeholder)", "type": "main", "index": 0}]]}, "Domain-class Research (placeholder)": {"main": [[{"node": "Risk Classification", "type": "main", "index": 0}]]}, "Risk Classification": {"main": [[{"node": "Build Evidence Pack", "type": "main", "index": 0}]]}, "Build Evidence Pack": {"main": [[{"node": "Store Report (Supabase)", "type": "main", "index": 0}]]}, "Store Report (Supabase)": {"main": [[{"node": "Generate Approve/Deny Token", "type": "main", "index": 0}]]}, "Generate Approve/Deny Token": {"main": [[{"node": "Store Approval Message (Supabase)", "type": "main", "index": 0}, {"node": "Send Reply Email (SMTP)", "type": "main", "index": 0}]]}, "Store Approval Message (Supabase)": {"main": [[{"node": "Send Reply Email (SMTP)", "type": "main", "index": 0}]]}}, "active": false, "settings": {}, "versionId": "1.0.0"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ATLAS -> Benny IP Triage & Evidence Pack (starter)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-legal_triageevidencepack"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 1, $$"ATLAS Intake (Webhook)"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"ATLAS Intake (Webhook)"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "atlas-ip-intake", "responseMode": "onReceived", "responseData": "={{ { status: 'received', note: 'Processing started' } }}", "options": {}}, "name": "ATLAS Intake (Webhook)", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 250]}, "connections": {"main": [[{"node": "Validate Payload", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 2, $$"Validate Payload"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Validate Payload"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Validate required fields: jurisdiction, asset_type, question */\nconst payload = items[0].json;\nconst missing = [];\n['jurisdiction','asset_type','question','request_id','company'].forEach(k=>{\n  if(!payload[k]) missing.push(k);\n});\nif(missing.length){\n  return [{ json: { valid: false, missing } }];\n}\n// Pass through original payload and create a generated receipt_id if not present\nconst receiptId = payload.receipt_id || `rcpt_${Date.now()}`;\nreturn [{ json: { valid: true, payload, receipt_id: receiptId } }];"}, "name": "Validate Payload", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [520, 250]}, "connections": {"main": [[{"node": "Store Request (Supabase)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 3, $$"Store Request (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Store Request (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_requests", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"request_id\": $json.payload.request_id,\n  \"raw_payload\": $json.payload,\n  \"company\": $json.payload.company || null,\n  \"asset_type\": $json.payload.asset_type || null,\n  \"jurisdiction\": $json.payload.jurisdiction || null,\n  \"question\": $json.payload.question || null,\n  \"received_at\": new Date().toISOString(),\n  \"receipt_id\": $json.receipt_id\n}"}, "name": "Store Request (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [820, 160], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, "connections": {"main": [[{"node": "Respond to Webhook (ack)", "type": "main", "index": 0}, {"node": "Compute Hashes", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 4, $$"Compute Hashes"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Compute Hashes"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Compute simple SHA256 hashes for any link list in payload.links */\nconst crypto = require('crypto');\nconst payload = $json.payload;\nconst links = payload.links || [];\nconst hashes = links.map(l => {\n  const h = crypto.createHash('sha256');\n  h.update(String(l));\n  return { link: l, sha256: h.digest('hex') };\n});\nreturn [{ json: { payload, hashes, receipt_id: $json.receipt_id } }];"}, "name": "Compute Hashes", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1120, 320]}, "connections": {"main": [[{"node": "Store Artifacts (Supabase)", "type": "main", "index": 0}, {"node": "Domain-class Research (placeholder)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 5, $$"Respond to Webhook (ack)"$$::jsonb::text, $$"n8n-nodes-base.respondToWebhook"$$::jsonb::text, $$"Respond to Webhook (ack)"$$::jsonb::text, $${"n8n_node": {"parameters": {"statusCode": 202, "responseBody": "={\"status\":\"accepted\",\"receipt_id\":$json.receipt_id}", "responseHeadersJson": "{}"}, "name": "Respond to Webhook (ack)", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1120, 160]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 6, $$"Store Artifacts (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Store Artifacts (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_artifacts", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"request_id\": $json.payload.request_id,\n  \"artifacts\": $json.hashes,\n  \"created_at\": new Date().toISOString()\n}"}, "name": "Store Artifacts (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [1420, 320], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, "connections": {"main": [[{"node": "Domain-class Research (placeholder)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 7, $$"Domain-class Research (placeholder)"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Domain-class Research (placeholder)"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Placeholder: run domain-class searches. In production replace with real API calls (USPTO, EUIPO, WHOIS, Domain history). This node should collect & attach raw results. */\nconst req = $json.payload;\n// Dummy example results\nconst findings = [];\n// If company name resembles a known mark, add dummy finding\nif(req.company && req.company.toLowerCase().includes('dead')){\n  findings.push({ source: 'USPTO-TESS', query: req.company, found: false, retrieved_at: new Date().toISOString() });\n}\nreturn [{ json: { payload: req, findings } }];"}, "name": "Domain-class Research (placeholder)", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1120, 520]}, "connections": {"main": [[{"node": "Risk Classification", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 8, $$"Risk Classification"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Risk Classification"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Simple risk classification placeholder based on findings count and missing facts. Replace with your rules. */\nconst p = $json.payload || {};\nconst findings = $json.findings || [];\nconst missing = (p.facts || '').length === 0 ? ['facts'] : [];\nlet risk = 'low';\nif(findings.length > 0) risk = 'medium';\nif(missing.length > 0) risk = 'medium';\n// Example escalation: if a critical indicator found, mark high\n// (Replace with your real detection)\nreturn [{ json: { payload: p, findings, missing, risk } }];"}, "name": "Risk Classification", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1420, 520]}, "connections": {"main": [[{"node": "Build Evidence Pack", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 9, $$"Build Evidence Pack"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Evidence Pack"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Build short Evidence Pack summary (one-page style) and decision options. This is a stub; adapt for PDF generation or storage. */\nconst r = $json;\nconst summary = {\n  request_id: r.payload.request_id || null,\n  exec_summary: `Preliminary triage: risk=${r.risk}. Findings: ${r.findings.length}`,\n  risk_level: r.risk,\n  unknowns: r.missing,\n  decision_options: [\n    { option: 'Do nothing', rationale: 'Low immediate risk', impact: 'low' },\n    { option: 'Collect evidence', rationale: 'Confirm creation/use dates', impact: 'medium' },\n    { option: 'File TM', rationale: 'If used in commerce & priority established', impact: 'high' }\n  ],\n  generated_at: new Date().toISOString()\n};\nreturn [{ json: { request_id: r.payload.request_id, evidence_pack: summary } }];"}, "name": "Build Evidence Pack", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [1720, 520]}, "connections": {"main": [[{"node": "Store Report (Supabase)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 10, $$"Store Report (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Store Report (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_reports", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"report_id\": `rep_${Date.now()}`,\n  \"request_id\": $json.request_id,\n  \"summary\": $json.evidence_pack.exec_summary,\n  \"risk_level\": $json.evidence_pack.risk_level,\n  \"decision_options\": $json.evidence_pack.decision_options,\n  \"evidence_index\": [],\n  \"created_at\": new Date().toISOString()\n}"}, "name": "Store Report (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [2000, 520], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, "connections": {"main": [[{"node": "Generate Approve/Deny Token", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 11, $$"Generate Approve/Deny Token"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Generate Approve/Deny Token"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "/* Generate approval token and message payload */\nconst token = `approve_${Math.random().toString(36).slice(2,12)}`;\nreturn [{ json: { request_id: $json.request_id, approval_token: token, approve_link: `https://your-approval-ui.example/approve?token=${token}`, deny_link: `https://your-approval-ui.example/deny?token=${token}` } }];"}, "name": "Generate Approve/Deny Token", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [2260, 520]}, "connections": {"main": [[{"node": "Store Approval Message (Supabase)", "type": "main", "index": 0}, {"node": "Send Reply Email (SMTP)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 12, $$"Store Approval Message (Supabase)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Store Approval Message (Supabase)"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "headerAuth", "requestMethod": "POST", "url": "https://YOUR-SUPABASE-URL/rest/v1/atlas_ip_messages", "jsonParameters": true, "options": {"bodyContentType": "json"}, "headerParametersJson": "=\n[\n  {\"name\":\"apikey\",\"value\":\"{{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Authorization\",\"value\":\"Bearer {{ $credentials.supabaseApi.key }}\"},\n  {\"name\":\"Content-Type\",\"value\":\"application/json\"}\n]\n", "bodyParametersJson": "={\n  \"message_id\": `msg_${Date.now()}`,\n  \"request_id\": $json.request_id,\n  \"message_type\": \"approval_request\",\n  \"payload\": { approve_link: $json.approve_link, deny_link: $json.deny_link, token: $json.approval_token },\n  \"actor\": \"benny.cto@deadapp.info\",\n  \"received_at\": new Date().toISOString()\n}"}, "name": "Store Approval Message (Supabase)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [2520, 520], "credentials": {"httpHeaderAuth": {"id": "supabase-header-auth-placeholder"}}}, "connections": {"main": [[{"node": "Send Reply Email (SMTP)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-legal_triageevidencepack"$$::jsonb::text, 13, $$"Send Reply Email (SMTP)"$$::jsonb::text, $$"n8n-nodes-base.smtp"$$::jsonb::text, $$"Send Reply Email (SMTP)"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "benny.cto@deadapp.info", "toEmail": "={{ $json.payload.requested_by || $json.payload.requester || '' }}", "subject": "=[ATLAS receipt: {{$json.payload.receipt_id}}] IP Triage: {{$json.payload.request_id}}", "text": "={{\n  `ATLAS-thread: ${$json.payload.request_id} | receipt: ${$json.payload.receipt_id}\\n\\nExec summary: ${$json.evidence_pack ? $json.evidence_pack.exec_summary : 'See attached'}\\n\\nRisk level: ${$json.evidence_pack ? $json.evidence_pack.risk_level : 'TBD'}\\n\\nApprove: ${$json.approve_link}\\nDeny: ${$json.deny_link}\\n\\nThis is an advisory evidence pack, not legal advice.`\n}}"}, "name": "Send Reply Email (SMTP)", "type": "n8n-nodes-base.smtp", "typeVersion": 1, "position": [2780, 520], "credentials": {"smtp": {"id": "smtp-credentials-placeholder"}}}, "connections": {}}$$::jsonb);

-- N8N-media_ad_campain_alert (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Ad Campaign Performance Alert"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/media/ad_campain_alert.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Ad Campaign Performance Alert", "active": null}, "sourcePath": "workflows/n8n/media/ad_campain_alert.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Ad Campaign Performance Alert", "nodes": [{"parameters": {"content": "## Ad Campaign Performance Alert", "height": 520, "width": 1100}, "id": "b9d822c3-5472-4e62-ae22-da1dcc48da68", "name": "Sticky", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-500, -250]}, {"parameters": {"httpMethod": "POST", "path": "ad_campaign_performance_alert"}, "id": "6915be1a-2020-44fd-a1a9-03729618e0f4", "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "8fa9fd45-56ed-4335-9cd6-da422c296469", "name": "Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-100, 0]}, {"parameters": {"model": "default"}, "id": "61f0b264-c6da-4340-adb2-4b2dfbf79c25", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [100, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, {"parameters": {"mode": "insert", "indexName": "ad_campaign_performance_alert"}, "id": "8d44d896-ea7a-4c50-b6fe-752f40708d99", "name": "Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [300, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"indexName": "ad_campaign_performance_alert"}, "id": "a448c986-5c7d-419e-961b-a7a798325d9f", "name": "Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [300, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"name": "Pinecone"}, "id": "9f02801d-d8e4-4a70-a219-ee8b2bc80dde", "name": "Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [480, -180]}, {"parameters": {}, "id": "924d810a-70de-4310-8abe-4d7f7eed8e23", "name": "Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [480, -40]}, {"parameters": {}, "id": "68c84590-c0d5-4b5d-8976-56afb248ece4", "name": "Chat", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [480, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "={{ $json }}"}, "id": "3ffa4018-e220-44b4-b7da-725aed7bcfae", "name": "Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [760, -40]}, {"parameters": {"operation": "append", "documentId": "SHEET_ID", "sheetName": "Log"}, "id": "92e93140-2890-47b1-8736-1be9a2322275", "name": "Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [960, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Sheets"}}}], "connections": {"Webhook": {"main": [[{"node": "Splitter", "type": "main", "index": 0}, {"node": "Memory", "type": "main", "index": 0}]]}, "Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Insert", "type": "ai_embedding", "index": 0}, {"node": "Query", "type": "ai_embedding", "index": 0}]]}, "Insert": {"ai_document": [[]]}, "Query": {"ai_vectorStore": [[{"node": "Tool", "type": "ai_vectorStore", "index": 0}]]}, "Tool": {"ai_tool": [[{"node": "Agent", "type": "ai_tool", "index": 0}]]}, "Memory": {"ai_memory": [[{"node": "Agent", "type": "ai_memory", "index": 0}]]}, "Chat": {"ai_languageModel": [[{"node": "Agent", "type": "ai_languageModel", "index": 0}]]}, "Agent": {"main": [[{"node": "Sheet", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Ad Campaign Performance Alert"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-media_ad_campain_alert"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 1, $$"6915be1a-2020-44fd-a1a9-03729618e0f4"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "ad_campaign_performance_alert"}, "id": "6915be1a-2020-44fd-a1a9-03729618e0f4", "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Splitter", "type": "main", "index": 0}, {"node": "Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 2, $$"b9d822c3-5472-4e62-ae22-da1dcc48da68"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Ad Campaign Performance Alert", "height": 520, "width": 1100}, "id": "b9d822c3-5472-4e62-ae22-da1dcc48da68", "name": "Sticky", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-500, -250]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 3, $$"68c84590-c0d5-4b5d-8976-56afb248ece4"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "68c84590-c0d5-4b5d-8976-56afb248ece4", "name": "Chat", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [480, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 4, $$"924d810a-70de-4310-8abe-4d7f7eed8e23"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "924d810a-70de-4310-8abe-4d7f7eed8e23", "name": "Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [480, -40]}, "connections": {"ai_memory": [[{"node": "Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 5, $$"8fa9fd45-56ed-4335-9cd6-da422c296469"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "8fa9fd45-56ed-4335-9cd6-da422c296469", "name": "Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-100, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 6, $$"61f0b264-c6da-4340-adb2-4b2dfbf79c25"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsCohere"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "default"}, "id": "61f0b264-c6da-4340-adb2-4b2dfbf79c25", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [100, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, "connections": {"ai_embedding": [[{"node": "Insert", "type": "ai_embedding", "index": 0}, {"node": "Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 7, $$"8d44d896-ea7a-4c50-b6fe-752f40708d99"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "indexName": "ad_campaign_performance_alert"}, "id": "8d44d896-ea7a-4c50-b6fe-752f40708d99", "name": "Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [300, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 8, $$"a448c986-5c7d-419e-961b-a7a798325d9f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "ad_campaign_performance_alert"}, "id": "a448c986-5c7d-419e-961b-a7a798325d9f", "name": "Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [300, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_vectorStore": [[{"node": "Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 9, $$"9f02801d-d8e4-4a70-a219-ee8b2bc80dde"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Pinecone"}, "id": "9f02801d-d8e4-4a70-a219-ee8b2bc80dde", "name": "Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [480, -180]}, "connections": {"ai_tool": [[{"node": "Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 10, $$"3ffa4018-e220-44b4-b7da-725aed7bcfae"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "={{ $json }}"}, "id": "3ffa4018-e220-44b4-b7da-725aed7bcfae", "name": "Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [760, -40]}, "connections": {"main": [[{"node": "Sheet", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_ad_campain_alert"$$::jsonb::text, 11, $$"92e93140-2890-47b1-8736-1be9a2322275"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": "SHEET_ID", "sheetName": "Log"}, "id": "92e93140-2890-47b1-8736-1be9a2322275", "name": "Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [960, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Sheets"}}}, "connections": {}}$$::jsonb);

-- N8N-media_tv_rating_trents (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"TV Rating Trend Report"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/media/tv_rating_trents.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "TV Rating Trend Report", "active": null}, "sourcePath": "workflows/n8n/media/tv_rating_trents.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "TV Rating Trend Report", "nodes": [{"parameters": {"content": "## TV Rating Trend Report", "height": 520, "width": 1100}, "id": "65c293e1-1bb3-47b1-a7e3-1a437f9e1b82", "name": "Sticky", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-500, -250]}, {"parameters": {"httpMethod": "POST", "path": "tv_rating_trend_report"}, "id": "5ebc0a6b-0f4a-4830-86ff-ee32ab4bdf00", "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "54c599be-45db-4a02-a36f-4dfb1e742586", "name": "Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-100, 0]}, {"parameters": {"model": "default"}, "id": "e24b26c6-bc13-4744-8ec3-8edb1d499fbf", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsHuggingFace", "typeVersion": 1, "position": [100, 0], "credentials": {"huggingFaceApi": {"id": "HF_API", "name": "HuggingFace"}}}, {"parameters": {"mode": "insert", "indexName": "tv_rating_trend_report"}, "id": "0e886b29-468c-426d-ae42-ec988395d9c5", "name": "Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreRedis", "typeVersion": 1, "position": [300, 0], "credentials": {"redisApi": {"id": "REDIS_API", "name": "Redis account"}}}, {"parameters": {"indexName": "tv_rating_trend_report"}, "id": "db48a725-0c6c-41da-a903-0b84de6841eb", "name": "Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreRedis", "typeVersion": 1, "position": [300, -180], "credentials": {"redisApi": {"id": "REDIS_API", "name": "Redis account"}}}, {"parameters": {"name": "Redis"}, "id": "b38807e5-de3d-4b5e-90d9-5f8512e32fc4", "name": "Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [480, -180]}, {"parameters": {}, "id": "ae8a7a3b-91a5-48c3-a0f1-f6c57a25dfb1", "name": "Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [480, -40]}, {"parameters": {}, "id": "8765fbd0-3a13-4190-978d-ca9afe9bb02a", "name": "Chat", "type": "@n8n/n8n-nodes-langchain.lmChatHf", "typeVersion": 1, "position": [480, -340], "credentials": {"huggingFaceApi": {"id": "HF_API", "name": "HuggingFace"}}}, {"parameters": {"promptType": "define", "text": "={{ $json }}"}, "id": "7d837a97-93be-4f6a-89d6-7f35d82f74a6", "name": "Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [760, -40]}, {"parameters": {"operation": "append", "documentId": "SHEET_ID", "sheetName": "Log"}, "id": "f8725419-cad6-4316-b509-2a9733bd92bf", "name": "Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [960, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Sheets"}}}], "connections": {"Webhook": {"main": [[{"node": "Splitter", "type": "main", "index": 0}, {"node": "Memory", "type": "main", "index": 0}]]}, "Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Insert", "type": "ai_embedding", "index": 0}, {"node": "Query", "type": "ai_embedding", "index": 0}]]}, "Insert": {"ai_document": [[]]}, "Query": {"ai_vectorStore": [[{"node": "Tool", "type": "ai_vectorStore", "index": 0}]]}, "Tool": {"ai_tool": [[{"node": "Agent", "type": "ai_tool", "index": 0}]]}, "Memory": {"ai_memory": [[{"node": "Agent", "type": "ai_memory", "index": 0}]]}, "Chat": {"ai_languageModel": [[{"node": "Agent", "type": "ai_languageModel", "index": 0}]]}, "Agent": {"main": [[{"node": "Sheet", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"TV Rating Trend Report"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-media_tv_rating_trents"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 1, $$"5ebc0a6b-0f4a-4830-86ff-ee32ab4bdf00"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "tv_rating_trend_report"}, "id": "5ebc0a6b-0f4a-4830-86ff-ee32ab4bdf00", "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Splitter", "type": "main", "index": 0}, {"node": "Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 2, $$"65c293e1-1bb3-47b1-a7e3-1a437f9e1b82"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## TV Rating Trend Report", "height": 520, "width": 1100}, "id": "65c293e1-1bb3-47b1-a7e3-1a437f9e1b82", "name": "Sticky", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-500, -250]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 3, $$"8765fbd0-3a13-4190-978d-ca9afe9bb02a"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatHf"$$::jsonb::text, $$"Chat"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "8765fbd0-3a13-4190-978d-ca9afe9bb02a", "name": "Chat", "type": "@n8n/n8n-nodes-langchain.lmChatHf", "typeVersion": 1, "position": [480, -340], "credentials": {"huggingFaceApi": {"id": "HF_API", "name": "HuggingFace"}}}, "connections": {"ai_languageModel": [[{"node": "Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 4, $$"ae8a7a3b-91a5-48c3-a0f1-f6c57a25dfb1"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "ae8a7a3b-91a5-48c3-a0f1-f6c57a25dfb1", "name": "Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [480, -40]}, "connections": {"ai_memory": [[{"node": "Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 5, $$"54c599be-45db-4a02-a36f-4dfb1e742586"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "54c599be-45db-4a02-a36f-4dfb1e742586", "name": "Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-100, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 6, $$"e24b26c6-bc13-4744-8ec3-8edb1d499fbf"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsHuggingFace"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "default"}, "id": "e24b26c6-bc13-4744-8ec3-8edb1d499fbf", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsHuggingFace", "typeVersion": 1, "position": [100, 0], "credentials": {"huggingFaceApi": {"id": "HF_API", "name": "HuggingFace"}}}, "connections": {"ai_embedding": [[{"node": "Insert", "type": "ai_embedding", "index": 0}, {"node": "Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 7, $$"0e886b29-468c-426d-ae42-ec988395d9c5"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreRedis"$$::jsonb::text, $$"Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "indexName": "tv_rating_trend_report"}, "id": "0e886b29-468c-426d-ae42-ec988395d9c5", "name": "Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreRedis", "typeVersion": 1, "position": [300, 0], "credentials": {"redisApi": {"id": "REDIS_API", "name": "Redis account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 8, $$"db48a725-0c6c-41da-a903-0b84de6841eb"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreRedis"$$::jsonb::text, $$"Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "tv_rating_trend_report"}, "id": "db48a725-0c6c-41da-a903-0b84de6841eb", "name": "Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreRedis", "typeVersion": 1, "position": [300, -180], "credentials": {"redisApi": {"id": "REDIS_API", "name": "Redis account"}}}, "connections": {"ai_vectorStore": [[{"node": "Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 9, $$"b38807e5-de3d-4b5e-90d9-5f8512e32fc4"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Redis"}, "id": "b38807e5-de3d-4b5e-90d9-5f8512e32fc4", "name": "Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [480, -180]}, "connections": {"ai_tool": [[{"node": "Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 10, $$"7d837a97-93be-4f6a-89d6-7f35d82f74a6"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "={{ $json }}"}, "id": "7d837a97-93be-4f6a-89d6-7f35d82f74a6", "name": "Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [760, -40]}, "connections": {"main": [[{"node": "Sheet", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-media_tv_rating_trents"$$::jsonb::text, 11, $$"f8725419-cad6-4316-b509-2a9733bd92bf"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": "SHEET_ID", "sheetName": "Log"}, "id": "f8725419-cad6-4316-b509-2a9733bd92bf", "name": "Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [960, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Sheets"}}}, "connections": {}}$$::jsonb);

-- N8N-orchestrator_atlas_orchestrator (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"ATLAS Orchestrator - FULL (Email Endpoint)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/orchestrator/atlas_orchestrator.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "ATLAS Orchestrator - FULL (Email Endpoint)", "active": false}, "sourcePath": "workflows/n8n/orchestrator/atlas_orchestrator.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "ATLAS Orchestrator - FULL (Email Endpoint)", "nodes": [{"parameters": {"triggerTimes": {"item": [{"mode": "everyDay", "hour": 8, "minute": 5}]}}, "id": "n_cron", "name": "Cron Daily", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 180]}, {"parameters": {"values": {"string": [{"name": "run_id", "value": "={{$now.toISO() + '::' + $execution.id}}"}, {"name": "atlas_email", "value": "atlas@deadapp.info"}, {"name": "audit_cc", "value": "larry.auditor@deadapp.info"}]}, "options": {}}, "id": "n_set_meta", "name": "Set Meta", "type": "n8n-nodes-base.set", "typeVersion": 2, "position": [480, 180]}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst agents = {\n  // core\n  BINKY:  { email: 'binky.cro@deadapp.info', role: 'Chief Research Analyst' },\n  TINA:   { email: 'tina.cfo@deadapp.info', role: 'CFO' },\n  LARRY:  { email: 'larry.auditor@deadapp.info', role: 'Chief Auditor' },\n  BENNY:  { email: 'benny.cto@deadapp.info', role: 'CTO/IP Counsel' },\n  JENNY:  { email: 'jenny.clo@deadapp.info', role: 'CLO' },\n  CHERYL: { email: 'support@deadapp.info', role: 'Support' },\n\n  // platform intel gatherers\n  CORNWALL: { email: 'cornwall.pinterest@deadapp.info', role: 'Pinterest Intel' },\n  DONNA:    { email: 'donna.redditor@deadapp.info', role: 'Reddit Intel' },\n  DWIGHT:   { email: 'dwight@deadapp.info', role: 'Threads Intel' },\n  EMMA:     { email: 'emma.alignable@deadapp.info', role: 'Alignable Intel' },\n  FRAN:     { email: 'fran.facebook@deadapp.info', role: 'Facebook Scraper' },\n  KELLY:    { email: 'kelly.x@deadapp.info', role: 'X Intel' },\n  LINK:     { email: 'link.linkedin@deadapp.info', role: 'LinkedIn Intel' },\n  TERRY:    { email: 'terry.tumblr@deadapp.info', role: 'Tumblr' },\n  TIMMY:    { email: 'timmy.tiktok@deadapp.info', role: 'TikTok' },\n\n  // subagents producing drafts\n  SUNDAY:   { email: 'sunday.teambinky@deadapp.info', role: 'Documentation' },\n  ARCHY:    { email: 'archy.binkypro@deadapp.info', role: 'Instagram Ops' },\n  REYNOLDS: { email: 'reynolds.blogger@deadapp.info', role: 'Blog Writer' },\n  PENNY:    { email: 'penny.facebook@deadapp.info', role: 'Facebook Page Manager' },\n  VENNY:    { email: 'venny.videographer@deadapp.info', role: 'Video Production' },\n  MERCER:   { email: 'mercer.teambinky@deadapp.info', role: 'Customer Acquisition Specialist' }\n};\n\nconst stages = {\n  intel_agents: ['CORNWALL','DONNA','DWIGHT','EMMA','FRAN','KELLY','LINK','TERRY','TIMMY'],\n  draft_agents: ['SUNDAY','ARCHY','REYNOLDS','PENNY','VENNY','MERCER'],\n  publish_agents: ['PENNY','ARCHY','TERRY','DWIGHT','KELLY','CORNWALL','TIMMY']\n};\n\nreturn [{\n  json: {\n    ...$json,\n    agents,\n    stages,\n    state: {\n      run_id,\n      intel: {},\n      binky_summary: null,\n      drafts: {},\n      receipts: {},\n      attempts: { intel: 0, binky: 0, drafts: 0, approval: 0, receipts: 0 }\n    }\n  }\n}];"}, "id": "n_registry", "name": "Build Agent Registry", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [720, 180]}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.intel_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, stage: 'INTEL_REQUEST', toList, subject: `[ATLAS][${run_id}] INTEL_REQUEST`,\nbody: `Return ONLY JSON between markers.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"agent\\\\\\\": \\\\\\\"<YOUR_NAME>\\\\\\\",\\n  \\\\\\\"platform\\\\\\\": \\\\\\\"<PLATFORM>\\\\\\\",\\n  \\\\\\\"items\\\\\\\": [ {\\\\\\\"title\\\\\\\":\\\\\\\"...\\\\\\\",\\\\\\\"url\\\\\\\":\\\\\\\"...\\\\\\\"} ],\\n  \\\\\\\"notes\\\\\\\": \\\\\\\"...\\\\\\\"\\n}\\n---END_JSON---\\n\\nNo publishing. Include sources/links.` } }];"}, "id": "n_prep_intel", "name": "Prep Intel Email", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_intel", "name": "Email Send: Intel Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1200, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_intel", "name": "Wait: Intel Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [1440, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] INTEL_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_intel", "name": "IMAP Search: Intel Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [1680, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.intel_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n\n  // map sender -> agent key\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.intel[key] = parsed;\n}\n\nstate.attempts.intel = (state.attempts.intel || 0) + 1;\nconst got = Object.keys(state.intel);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, intel_status: { got, missing, attempt: state.attempts.intel } } }];"}, "id": "n_accum_intel", "name": "Accumulate Intel", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [1920, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.intel_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_intel_complete", "name": "IF Intel Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2160, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.intel}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_intel_retry", "name": "IF Intel Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2400, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: INTEL_INCOMPLETE'}}", "text": "={{'Intel missing after retries: ' + JSON.stringify($json.intel_status.missing) + '\\nAttempt: ' + $json.intel_status.attempt}}"}, "id": "n_intel_escalate", "name": "Email Escalate: Intel Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nreturn [{ json: { ...$json, subject: `[ATLAS][${run_id}] REQUEST_BINKY_DAILY_SUMMARY_JSON`,\nbody: `BINKY — produce the Daily Structured Summary JSON with citations.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"headlines\\\\\\\":[],\\n  \\\\\\\"trends\\\\\\\":[],\\n  \\\\\\\"hashtags\\\\\\\":[],\\n  \\\\\\\"viral_content\\\\\\\":[],\\n  \\\\\\\"sentiment_analysis\\\\\\\":{},\\n  \\\\\\\"risk_flags\\\\\\\":[],\\n  \\\\\\\"opportunities\\\\\\\":[]\\n}\\n---END_JSON---\\n\\nUse gathered intel and your research. Return ONLY JSON in markers.` } }];"}, "id": "n_prep_binky", "name": "Prep Email: Binky Summary", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [2400, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_binky", "name": "Email Send: Binky Summary Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_binky", "name": "Wait: Binky Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [2880, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] REQUEST_BINKY_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_binky", "name": "IMAP Search: Binky Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [3120, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst state = $json.state;\nstate.attempts.binky = (state.attempts.binky||0) + 1;\n\nlet found = null;\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (parsed) { found = parsed; break; }\n}\n\nif (found) state.binky_summary = found;\n\nconst required = [\"headlines\",\"trends\",\"hashtags\",\"viral_content\",\"sentiment_analysis\",\"risk_flags\",\"opportunities\"]; \nconst ok = !!state.binky_summary && required.every(k => Object.prototype.hasOwnProperty.call(state.binky_summary, k));\n\nreturn [{ json: { ...$json, state, binky_status: { ok, attempt: state.attempts.binky } } }];"}, "id": "n_validate_binky", "name": "Validate Binky JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3360, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.binky_status.ok}}", "value2": true}]}}, "id": "n_if_binky_ok", "name": "IF Binky OK", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3600, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.binky}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_binky_retry", "name": "IF Binky Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3840, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] RETRY: BINKY_SUMMARY_INVALID'}}", "text": "={{'Your summary is missing required fields. Return ONLY JSON in markers. Run: ' + $json.run_id}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_binky_retry_email", "name": "Email Send: Binky Retry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4080, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst summary = $json.state.binky_summary;\nconst tasks = $json.stages.draft_agents.map(k => ({ key: k, to: $json.agents[k].email }));\nreturn tasks.map(t => ({ json: { ...$json, task: t, subject: `[ATLAS][${run_id}] TASK_DISPATCH::${t.key}`, body: `${t.key} — Use Binky Summary JSON. Return ONLY DRAFT in markers.\\n\\n---BEGIN_JSON---\\n${JSON.stringify(summary)}\\n---END_JSON---\\n\\n---BEGIN_DRAFT---\\n...\\n---END_DRAFT---\\n\\nNo publishing.` } }));"}, "id": "n_make_tasks", "name": "Build Draft Tasks", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3840, 180]}, {"parameters": {"batchSize": 1, "options": {}}, "id": "n_split_tasks", "name": "Split Tasks", "type": "n8n-nodes-base.splitInBatches", "typeVersion": 3, "position": [4080, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.task.to}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_task", "name": "Email Send: Draft Task", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4320, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 5, "unit": "seconds"}, "id": "n_wait_task_pace", "name": "Wait: Pace", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4560, 180]}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_drafts", "name": "Wait: Draft Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4800, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] TASK_DISPATCH\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_drafts", "name": "IMAP Search: Draft Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [5040, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractDraft(text){\n  const m = (text||'').match(/---BEGIN_DRAFT---([\\s\\S]*?)---END_DRAFT---/);\n  return m ? m[1].trim() : null;\n}\n\nconst required = $json.stages.draft_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const draft = extractDraft(body);\n  if (!draft) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.drafts[key] = { draft, receivedAt: new Date().toISOString() };\n}\n\nstate.attempts.drafts = (state.attempts.drafts || 0) + 1;\nconst got = Object.keys(state.drafts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, draft_status: { got, missing, attempt: state.attempts.drafts } } }];"}, "id": "n_accum_drafts", "name": "Accumulate Drafts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [5280, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.draft_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_drafts_complete", "name": "IF Drafts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5520, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.drafts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_drafts_retry", "name": "IF Draft Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5760, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: DRAFTS_INCOMPLETE'}}", "text": "={{'Drafts missing: ' + JSON.stringify($json.draft_status.missing) + '\\nAttempt: ' + $json.draft_status.attempt + '\\nProceeding to approval package with partial drafts (logged).'}}"}, "id": "n_drafts_escalate", "name": "Email Escalate: Drafts Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BENNY.email + ',' + $json.agents.JENNY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] POLICY/LEGAL REVIEW PING'}}", "text": "={{'Review draft package for policy/legal risk. Reply with JSON: {\"run_id\":\"...\",\"ok\":true/false,\"notes\":\"...\"} in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"run_id\":\"' + $json.run_id + '\",\\n  \"ok\": true,\\n  \"notes\": \"\"\\n}\\n---END_JSON---'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_ping_legal", "name": "Email Send: Benny+Jenny Review Ping", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [5760, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.atlas_email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED'}}", "text": "={{'Reply with EXACTLY one line:\\nAPPROVE ' + $json.run_id + '\\nor\\nDENY ' + $json.run_id + ' <notes>\\n\\nAudit CC: Larry'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_approval", "name": "Email Send: Approval Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_approval", "name": "Wait: Approval Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [6240, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_approval", "name": "IMAP Search: Approval Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [6480, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "const state = $json.state;\nstate.attempts.approval = (state.attempts.approval||0) + 1;\n\nlet decision = null;\nlet notes = '';\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const m1 = body.match(/\\bAPPROVE\\s+(.+)/i);\n  const m2 = body.match(/\\bDENY\\s+(.+)/i);\n  if (m1 && m1[1].includes($json.run_id)) { decision = 'APPROVE'; break; }\n  if (m2 && m2[1].includes($json.run_id)) { decision = 'DENY'; notes = m2[0]; break; }\n}\n\nreturn [{ json: { ...$json, state, approval: { decision, notes, attempt: state.attempts.approval } } }];"}, "id": "n_parse_approval", "name": "Parse Approval", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [6720, 180]}, {"parameters": {"conditions": {"string": [{"value1": "={{$json.approval.decision}}", "operation": "equals", "value2": "APPROVE"}]}}, "id": "n_if_approved", "name": "IF Approved", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [6960, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] STOP: DENIED OR NO APPROVAL'}}", "text": "={{'Approval status: ' + JSON.stringify($json.approval) + '\\nNo publish commands sent.'}}"}, "id": "n_denied_notify", "name": "Email Notify: Denied/No Approval", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7200, 40], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.publish_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, toList, subject: `[ATLAS][${run_id}] PUBLISH_COMMAND`, body: `Publish ONLY the approved assets for run ${run_id}.\\nReturn receipt JSON in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"agent\":\"<YOUR_NAME>\",\\n  \"run_id\":\"${run_id}\",\\n  \"platform\":\"...\",\\n  \"status\":\"posted\",\\n  \"url\":\"...\"\\n}\\n---END_JSON---` } }];"}, "id": "n_prep_publish", "name": "Prep Publish Command", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [7200, 180]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_publish", "name": "Email Send: Publish Commands", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7440, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_receipts", "name": "Wait: Receipt Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [7680, 180]}, {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] PUBLISH_COMMAND\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_receipts", "name": "IMAP Search: Publish Receipts", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [7920, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.publish_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.receipts[key] = parsed;\n}\n\nstate.attempts.receipts = (state.attempts.receipts || 0) + 1;\nconst got = Object.keys(state.receipts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, receipt_status: { got, missing, attempt: state.attempts.receipts } } }];"}, "id": "n_accum_receipts", "name": "Accumulate Receipts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [8160, 180]}, {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.receipt_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_receipts_complete", "name": "IF Receipts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8400, 180]}, {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.receipts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_receipts_retry", "name": "IF Receipt Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8640, 60]}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: RECEIPTS_INCOMPLETE'}}", "text": "={{'Missing receipts after retries: ' + JSON.stringify($json.receipt_status.missing)}}"}, "id": "n_receipts_escalate", "name": "Email Escalate: Missing Receipts -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.LARRY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_AUDIT_VALIDATE'}}", "text": "={{'Validate full chain for run ' + $json.run_id + '. Receipts: ' + JSON.stringify($json.state.receipts)}}"}, "id": "n_eod_larry", "name": "Email Send: EOD Audit -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.TINA.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_FINANCE_REVIEW'}}", "text": "={{'Review ledger refs / monetization impacts for run ' + $json.run_id}}"}, "id": "n_eod_tina", "name": "Email Send: EOD Finance -> Tina", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [9120, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}], "connections": {"Cron Daily": {"main": [[{"node": "Set Meta", "type": "main", "index": 0}]]}, "Set Meta": {"main": [[{"node": "Build Agent Registry", "type": "main", "index": 0}]]}, "Build Agent Registry": {"main": [[{"node": "Prep Intel Email", "type": "main", "index": 0}]]}, "Prep Intel Email": {"main": [[{"node": "Email Send: Intel Request", "type": "main", "index": 0}]]}, "Email Send: Intel Request": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}]]}, "Wait: Intel Poll": {"main": [[{"node": "IMAP Search: Intel Replies", "type": "main", "index": 0}]]}, "IMAP Search: Intel Replies": {"main": [[{"node": "Accumulate Intel", "type": "main", "index": 0}]]}, "Accumulate Intel": {"main": [[{"node": "IF Intel Complete", "type": "main", "index": 0}]]}, "IF Intel Complete": {"main": [[{"node": "Prep Email: Binky Summary", "type": "main", "index": 0}], [{"node": "IF Intel Retry < 10", "type": "main", "index": 0}]]}, "IF Intel Retry < 10": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Intel Missing -> Larry", "type": "main", "index": 0}]]}, "Prep Email: Binky Summary": {"main": [[{"node": "Email Send: Binky Summary Request", "type": "main", "index": 0}]]}, "Email Send: Binky Summary Request": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}, "Wait: Binky Poll": {"main": [[{"node": "IMAP Search: Binky Reply", "type": "main", "index": 0}]]}, "IMAP Search: Binky Reply": {"main": [[{"node": "Validate Binky JSON", "type": "main", "index": 0}]]}, "Validate Binky JSON": {"main": [[{"node": "IF Binky OK", "type": "main", "index": 0}]]}, "IF Binky OK": {"main": [[{"node": "Build Draft Tasks", "type": "main", "index": 0}], [{"node": "IF Binky Retry < 10", "type": "main", "index": 0}]]}, "IF Binky Retry < 10": {"main": [[{"node": "Email Send: Binky Retry", "type": "main", "index": 0}], [{"node": "Email Send: Binky Retry", "type": "main", "index": 0}]]}, "Email Send: Binky Retry": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}, "Build Draft Tasks": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}, "Split Tasks": {"main": [[{"node": "Email Send: Draft Task", "type": "main", "index": 0}], [{"node": "Wait: Draft Poll", "type": "main", "index": 1}]]}, "Email Send: Draft Task": {"main": [[{"node": "Wait: Pace", "type": "main", "index": 0}]]}, "Wait: Pace": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}, "Wait: Draft Poll": {"main": [[{"node": "IMAP Search: Draft Replies", "type": "main", "index": 0}]]}, "IMAP Search: Draft Replies": {"main": [[{"node": "Accumulate Drafts", "type": "main", "index": 0}]]}, "Accumulate Drafts": {"main": [[{"node": "IF Drafts Complete", "type": "main", "index": 0}]]}, "IF Drafts Complete": {"main": [[{"node": "Email Send: Benny+Jenny Review Ping", "type": "main", "index": 0}], [{"node": "IF Draft Retry < 10", "type": "main", "index": 0}]]}, "IF Draft Retry < 10": {"main": [[{"node": "Wait: Draft Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Drafts Missing -> Larry", "type": "main", "index": 0}]]}, "Email Send: Benny+Jenny Review Ping": {"main": [[{"node": "Email Send: Approval Request", "type": "main", "index": 0}]]}, "Email Send: Approval Request": {"main": [[{"node": "Wait: Approval Poll", "type": "main", "index": 0}]]}, "Wait: Approval Poll": {"main": [[{"node": "IMAP Search: Approval Reply", "type": "main", "index": 0}]]}, "IMAP Search: Approval Reply": {"main": [[{"node": "Parse Approval", "type": "main", "index": 0}]]}, "Parse Approval": {"main": [[{"node": "IF Approved", "type": "main", "index": 0}]]}, "IF Approved": {"main": [[{"node": "Prep Publish Command", "type": "main", "index": 0}], [{"node": "Email Notify: Denied/No Approval", "type": "main", "index": 0}]]}, "Prep Publish Command": {"main": [[{"node": "Email Send: Publish Commands", "type": "main", "index": 0}]]}, "Email Send: Publish Commands": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}]]}, "Wait: Receipt Poll": {"main": [[{"node": "IMAP Search: Publish Receipts", "type": "main", "index": 0}]]}, "IMAP Search: Publish Receipts": {"main": [[{"node": "Accumulate Receipts", "type": "main", "index": 0}]]}, "Accumulate Receipts": {"main": [[{"node": "IF Receipts Complete", "type": "main", "index": 0}]]}, "IF Receipts Complete": {"main": [[{"node": "Email Send: EOD Audit -> Larry", "type": "main", "index": 0}], [{"node": "IF Receipt Retry < 10", "type": "main", "index": 0}]]}, "IF Receipt Retry < 10": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Missing Receipts -> Larry", "type": "main", "index": 0}]]}, "Email Send: EOD Audit -> Larry": {"main": [[{"node": "Email Send: EOD Finance -> Tina", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionTimeout": 14400, "saveExecutionProgress": true, "saveDataErrorExecution": "all", "saveDataSuccessExecution": "all"}, "versionId": "atlas-orchestrator-email-full-v1"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ATLAS Orchestrator - FULL (Email Endpoint)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 1, $$"n_cron"$$::jsonb::text, $$"n8n-nodes-base.cron"$$::jsonb::text, $$"Cron Daily"$$::jsonb::text, $${"n8n_node": {"parameters": {"triggerTimes": {"item": [{"mode": "everyDay", "hour": 8, "minute": 5}]}}, "id": "n_cron", "name": "Cron Daily", "type": "n8n-nodes-base.cron", "typeVersion": 1, "position": [240, 180]}, "connections": {"main": [[{"node": "Set Meta", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 2, $$"n_imap_intel"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Intel Replies"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] INTEL_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_intel", "name": "IMAP Search: Intel Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [1680, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Intel", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 3, $$"n_imap_binky"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Binky Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] REQUEST_BINKY_\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_binky", "name": "IMAP Search: Binky Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [3120, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Validate Binky JSON", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 4, $$"n_imap_drafts"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Draft Replies"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] TASK_DISPATCH\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_drafts", "name": "IMAP Search: Draft Replies", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [5040, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Drafts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 5, $$"n_imap_approval"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Approval Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_approval", "name": "IMAP Search: Approval Reply", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [6480, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Parse Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 6, $$"n_imap_receipts"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"IMAP Search: Publish Receipts"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "search", "mailbox": "INBOX", "searchCriteria": "={{'SUBJECT \"[ATLAS][' + $json.run_id + '] PUBLISH_COMMAND\"'}}", "options": {"downloadAttachments": false}}, "id": "n_imap_receipts", "name": "IMAP Search: Publish Receipts", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [7920, 180], "credentials": {"imap": {"id": "REPLACE_IMAP_CRED_ID", "name": "IMAP Atlas Inbox"}}}, "connections": {"main": [[{"node": "Accumulate Receipts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 7, $$"n_set_meta"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Set Meta"$$::jsonb::text, $${"n8n_node": {"parameters": {"values": {"string": [{"name": "run_id", "value": "={{$now.toISO() + '::' + $execution.id}}"}, {"name": "atlas_email", "value": "atlas@deadapp.info"}, {"name": "audit_cc", "value": "larry.auditor@deadapp.info"}]}, "options": {}}, "id": "n_set_meta", "name": "Set Meta", "type": "n8n-nodes-base.set", "typeVersion": 2, "position": [480, 180]}, "connections": {"main": [[{"node": "Build Agent Registry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 8, $$"n_accum_intel"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Intel"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.intel_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n\n  // map sender -> agent key\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.intel[key] = parsed;\n}\n\nstate.attempts.intel = (state.attempts.intel || 0) + 1;\nconst got = Object.keys(state.intel);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, intel_status: { got, missing, attempt: state.attempts.intel } } }];"}, "id": "n_accum_intel", "name": "Accumulate Intel", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [1920, 180]}, "connections": {"main": [[{"node": "IF Intel Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 9, $$"n_validate_binky"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Validate Binky JSON"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst state = $json.state;\nstate.attempts.binky = (state.attempts.binky||0) + 1;\n\nlet found = null;\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (parsed) { found = parsed; break; }\n}\n\nif (found) state.binky_summary = found;\n\nconst required = [\"headlines\",\"trends\",\"hashtags\",\"viral_content\",\"sentiment_analysis\",\"risk_flags\",\"opportunities\"]; \nconst ok = !!state.binky_summary && required.every(k => Object.prototype.hasOwnProperty.call(state.binky_summary, k));\n\nreturn [{ json: { ...$json, state, binky_status: { ok, attempt: state.attempts.binky } } }];"}, "id": "n_validate_binky", "name": "Validate Binky JSON", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3360, 180]}, "connections": {"main": [[{"node": "IF Binky OK", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 10, $$"n_accum_drafts"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Drafts"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractDraft(text){\n  const m = (text||'').match(/---BEGIN_DRAFT---([\\s\\S]*?)---END_DRAFT---/);\n  return m ? m[1].trim() : null;\n}\n\nconst required = $json.stages.draft_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const draft = extractDraft(body);\n  if (!draft) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.drafts[key] = { draft, receivedAt: new Date().toISOString() };\n}\n\nstate.attempts.drafts = (state.attempts.drafts || 0) + 1;\nconst got = Object.keys(state.drafts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, draft_status: { got, missing, attempt: state.attempts.drafts } } }];"}, "id": "n_accum_drafts", "name": "Accumulate Drafts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [5280, 180]}, "connections": {"main": [[{"node": "IF Drafts Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 11, $$"n_parse_approval"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Parse Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const state = $json.state;\nstate.attempts.approval = (state.attempts.approval||0) + 1;\n\nlet decision = null;\nlet notes = '';\nfor (const it of items) {\n  const e = it.json;\n  const body = (e.text || e.html || '').toString();\n  const m1 = body.match(/\\bAPPROVE\\s+(.+)/i);\n  const m2 = body.match(/\\bDENY\\s+(.+)/i);\n  if (m1 && m1[1].includes($json.run_id)) { decision = 'APPROVE'; break; }\n  if (m2 && m2[1].includes($json.run_id)) { decision = 'DENY'; notes = m2[0]; break; }\n}\n\nreturn [{ json: { ...$json, state, approval: { decision, notes, attempt: state.attempts.approval } } }];"}, "id": "n_parse_approval", "name": "Parse Approval", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [6720, 180]}, "connections": {"main": [[{"node": "IF Approved", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 12, $$"n_accum_receipts"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Accumulate Receipts"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "function extractJson(text){\n  const m = (text||'').match(/---BEGIN_JSON---([\\s\\S]*?)---END_JSON---/);\n  if(!m) return null;\n  try { return JSON.parse(m[1].trim()); } catch(e){ return null; }\n}\n\nconst required = $json.stages.publish_agents;\nconst emails = items.map(i => i.json);\nconst state = $json.state;\n\nfor (const e of emails) {\n  const from = (e.from && (e.from.email || e.from.text)) ? (e.from.email || e.from.text) : (e.from || '');\n  const body = (e.text || e.html || '').toString();\n  const parsed = extractJson(body);\n  if (!parsed) continue;\n  const key = Object.keys($json.agents).find(k => $json.agents[k].email === from);\n  if (!key) continue;\n  if (required.includes(key)) state.receipts[key] = parsed;\n}\n\nstate.attempts.receipts = (state.attempts.receipts || 0) + 1;\nconst got = Object.keys(state.receipts);\nconst missing = required.filter(k => !got.includes(k));\n\nreturn [{ json: { ...$json, state, receipt_status: { got, missing, attempt: state.attempts.receipts } } }];"}, "id": "n_accum_receipts", "name": "Accumulate Receipts", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [8160, 180]}, "connections": {"main": [[{"node": "IF Receipts Complete", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 13, $$"n_registry"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Agent Registry"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst agents = {\n  // core\n  BINKY:  { email: 'binky.cro@deadapp.info', role: 'Chief Research Analyst' },\n  TINA:   { email: 'tina.cfo@deadapp.info', role: 'CFO' },\n  LARRY:  { email: 'larry.auditor@deadapp.info', role: 'Chief Auditor' },\n  BENNY:  { email: 'benny.cto@deadapp.info', role: 'CTO/IP Counsel' },\n  JENNY:  { email: 'jenny.clo@deadapp.info', role: 'CLO' },\n  CHERYL: { email: 'support@deadapp.info', role: 'Support' },\n\n  // platform intel gatherers\n  CORNWALL: { email: 'cornwall.pinterest@deadapp.info', role: 'Pinterest Intel' },\n  DONNA:    { email: 'donna.redditor@deadapp.info', role: 'Reddit Intel' },\n  DWIGHT:   { email: 'dwight@deadapp.info', role: 'Threads Intel' },\n  EMMA:     { email: 'emma.alignable@deadapp.info', role: 'Alignable Intel' },\n  FRAN:     { email: 'fran.facebook@deadapp.info', role: 'Facebook Scraper' },\n  KELLY:    { email: 'kelly.x@deadapp.info', role: 'X Intel' },\n  LINK:     { email: 'link.linkedin@deadapp.info', role: 'LinkedIn Intel' },\n  TERRY:    { email: 'terry.tumblr@deadapp.info', role: 'Tumblr' },\n  TIMMY:    { email: 'timmy.tiktok@deadapp.info', role: 'TikTok' },\n\n  // subagents producing drafts\n  SUNDAY:   { email: 'sunday.teambinky@deadapp.info', role: 'Documentation' },\n  ARCHY:    { email: 'archy.binkypro@deadapp.info', role: 'Instagram Ops' },\n  REYNOLDS: { email: 'reynolds.blogger@deadapp.info', role: 'Blog Writer' },\n  PENNY:    { email: 'penny.facebook@deadapp.info', role: 'Facebook Page Manager' },\n  VENNY:    { email: 'venny.videographer@deadapp.info', role: 'Video Production' },\n  MERCER:   { email: 'mercer.teambinky@deadapp.info', role: 'Customer Acquisition Specialist' }\n};\n\nconst stages = {\n  intel_agents: ['CORNWALL','DONNA','DWIGHT','EMMA','FRAN','KELLY','LINK','TERRY','TIMMY'],\n  draft_agents: ['SUNDAY','ARCHY','REYNOLDS','PENNY','VENNY','MERCER'],\n  publish_agents: ['PENNY','ARCHY','TERRY','DWIGHT','KELLY','CORNWALL','TIMMY']\n};\n\nreturn [{\n  json: {\n    ...$json,\n    agents,\n    stages,\n    state: {\n      run_id,\n      intel: {},\n      binky_summary: null,\n      drafts: {},\n      receipts: {},\n      attempts: { intel: 0, binky: 0, drafts: 0, approval: 0, receipts: 0 }\n    }\n  }\n}];"}, "id": "n_registry", "name": "Build Agent Registry", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [720, 180]}, "connections": {"main": [[{"node": "Prep Intel Email", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 14, $$"n_if_intel_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Intel Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.intel_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_intel_complete", "name": "IF Intel Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2160, 180]}, "connections": {"main": [[{"node": "Prep Email: Binky Summary", "type": "main", "index": 0}], [{"node": "IF Intel Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 15, $$"n_if_binky_ok"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Binky OK"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.binky_status.ok}}", "value2": true}]}}, "id": "n_if_binky_ok", "name": "IF Binky OK", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3600, 180]}, "connections": {"main": [[{"node": "Build Draft Tasks", "type": "main", "index": 0}], [{"node": "IF Binky Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 16, $$"n_if_drafts_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Drafts Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.draft_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_drafts_complete", "name": "IF Drafts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5520, 180]}, "connections": {"main": [[{"node": "Email Send: Benny+Jenny Review Ping", "type": "main", "index": 0}], [{"node": "IF Draft Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 17, $$"n_if_approved"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Approved"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"string": [{"value1": "={{$json.approval.decision}}", "operation": "equals", "value2": "APPROVE"}]}}, "id": "n_if_approved", "name": "IF Approved", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [6960, 180]}, "connections": {"main": [[{"node": "Prep Publish Command", "type": "main", "index": 0}], [{"node": "Email Notify: Denied/No Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 18, $$"n_if_receipts_complete"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Receipts Complete"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"boolean": [{"value1": "={{$json.receipt_status.missing.length === 0}}", "value2": true}]}}, "id": "n_if_receipts_complete", "name": "IF Receipts Complete", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8400, 180]}, "connections": {"main": [[{"node": "Email Send: EOD Audit -> Larry", "type": "main", "index": 0}], [{"node": "IF Receipt Retry < 10", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 19, $$"n_prep_intel"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Intel Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.intel_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, stage: 'INTEL_REQUEST', toList, subject: `[ATLAS][${run_id}] INTEL_REQUEST`,\nbody: `Return ONLY JSON between markers.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"agent\\\\\\\": \\\\\\\"<YOUR_NAME>\\\\\\\",\\n  \\\\\\\"platform\\\\\\\": \\\\\\\"<PLATFORM>\\\\\\\",\\n  \\\\\\\"items\\\\\\\": [ {\\\\\\\"title\\\\\\\":\\\\\\\"...\\\\\\\",\\\\\\\"url\\\\\\\":\\\\\\\"...\\\\\\\"} ],\\n  \\\\\\\"notes\\\\\\\": \\\\\\\"...\\\\\\\"\\n}\\n---END_JSON---\\n\\nNo publishing. Include sources/links.` } }];"}, "id": "n_prep_intel", "name": "Prep Intel Email", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [960, 180]}, "connections": {"main": [[{"node": "Email Send: Intel Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 20, $$"n_if_intel_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Intel Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.intel}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_intel_retry", "name": "IF Intel Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [2400, 60]}, "connections": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Intel Missing -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 21, $$"n_prep_binky"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Email: Binky Summary"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nreturn [{ json: { ...$json, subject: `[ATLAS][${run_id}] REQUEST_BINKY_DAILY_SUMMARY_JSON`,\nbody: `BINKY — produce the Daily Structured Summary JSON with citations.\\n\\n---BEGIN_JSON---\\n{\\n  \\\\\\\"headlines\\\\\\\":[],\\n  \\\\\\\"trends\\\\\\\":[],\\n  \\\\\\\"hashtags\\\\\\\":[],\\n  \\\\\\\"viral_content\\\\\\\":[],\\n  \\\\\\\"sentiment_analysis\\\\\\\":{},\\n  \\\\\\\"risk_flags\\\\\\\":[],\\n  \\\\\\\"opportunities\\\\\\\":[]\\n}\\n---END_JSON---\\n\\nUse gathered intel and your research. Return ONLY JSON in markers.` } }];"}, "id": "n_prep_binky", "name": "Prep Email: Binky Summary", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [2400, 180]}, "connections": {"main": [[{"node": "Email Send: Binky Summary Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 22, $$"n_make_tasks"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Draft Tasks"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst summary = $json.state.binky_summary;\nconst tasks = $json.stages.draft_agents.map(k => ({ key: k, to: $json.agents[k].email }));\nreturn tasks.map(t => ({ json: { ...$json, task: t, subject: `[ATLAS][${run_id}] TASK_DISPATCH::${t.key}`, body: `${t.key} — Use Binky Summary JSON. Return ONLY DRAFT in markers.\\n\\n---BEGIN_JSON---\\n${JSON.stringify(summary)}\\n---END_JSON---\\n\\n---BEGIN_DRAFT---\\n...\\n---END_DRAFT---\\n\\nNo publishing.` } }));"}, "id": "n_make_tasks", "name": "Build Draft Tasks", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [3840, 180]}, "connections": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 23, $$"n_if_binky_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Binky Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.binky}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_binky_retry", "name": "IF Binky Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [3840, 60]}, "connections": {"main": [[{"node": "Email Send: Binky Retry", "type": "main", "index": 0}], [{"node": "Email Send: Binky Retry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 24, $$"n_ping_legal"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Benny+Jenny Review Ping"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BENNY.email + ',' + $json.agents.JENNY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] POLICY/LEGAL REVIEW PING'}}", "text": "={{'Review draft package for policy/legal risk. Reply with JSON: {\"run_id\":\"...\",\"ok\":true/false,\"notes\":\"...\"} in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"run_id\":\"' + $json.run_id + '\",\\n  \"ok\": true,\\n  \"notes\": \"\"\\n}\\n---END_JSON---'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_ping_legal", "name": "Email Send: Benny+Jenny Review Ping", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [5760, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Email Send: Approval Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 25, $$"n_if_drafts_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Draft Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.drafts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_drafts_retry", "name": "IF Draft Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [5760, 60]}, "connections": {"main": [[{"node": "Wait: Draft Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Drafts Missing -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 26, $$"n_denied_notify"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Notify: Denied/No Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] STOP: DENIED OR NO APPROVAL'}}", "text": "={{'Approval status: ' + JSON.stringify($json.approval) + '\\nNo publish commands sent.'}}"}, "id": "n_denied_notify", "name": "Email Notify: Denied/No Approval", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7200, 40], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 27, $$"n_prep_publish"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Prep Publish Command"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const run_id = $json.run_id;\nconst toList = $json.stages.publish_agents.map(k => $json.agents[k].email);\nreturn [{ json: { ...$json, toList, subject: `[ATLAS][${run_id}] PUBLISH_COMMAND`, body: `Publish ONLY the approved assets for run ${run_id}.\\nReturn receipt JSON in markers.\\n\\n---BEGIN_JSON---\\n{\\n  \"agent\":\"<YOUR_NAME>\",\\n  \"run_id\":\"${run_id}\",\\n  \"platform\":\"...\",\\n  \"status\":\"posted\",\\n  \"url\":\"...\"\\n}\\n---END_JSON---` } }];"}, "id": "n_prep_publish", "name": "Prep Publish Command", "type": "n8n-nodes-base.function", "typeVersion": 2, "position": [7200, 180]}, "connections": {"main": [[{"node": "Email Send: Publish Commands", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 28, $$"n_eod_larry"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: EOD Audit -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.LARRY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_AUDIT_VALIDATE'}}", "text": "={{'Validate full chain for run ' + $json.run_id + '. Receipts: ' + JSON.stringify($json.state.receipts)}}"}, "id": "n_eod_larry", "name": "Email Send: EOD Audit -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Email Send: EOD Finance -> Tina", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 29, $$"n_if_receipts_retry"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"IF Receipt Retry < 10"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"number": [{"value1": "={{$json.state.attempts.receipts}}", "operation": "smaller", "value2": 10}]}}, "id": "n_if_receipts_retry", "name": "IF Receipt Retry < 10", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [8640, 60]}, "connections": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}], [{"node": "Email Escalate: Missing Receipts -> Larry", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 30, $$"n_send_intel"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Intel Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_intel", "name": "Email Send: Intel Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1200, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Intel Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 31, $$"n_intel_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Intel Missing -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: INTEL_INCOMPLETE'}}", "text": "={{'Intel missing after retries: ' + JSON.stringify($json.intel_status.missing) + '\\nAttempt: ' + $json.intel_status.attempt}}"}, "id": "n_intel_escalate", "name": "Email Escalate: Intel Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 32, $$"n_send_binky"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Binky Summary Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_binky", "name": "Email Send: Binky Summary Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [2640, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 33, $$"n_binky_retry_email"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Binky Retry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.BINKY.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] RETRY: BINKY_SUMMARY_INVALID'}}", "text": "={{'Your summary is missing required fields. Return ONLY JSON in markers. Run: ' + $json.run_id}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_binky_retry_email", "name": "Email Send: Binky Retry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4080, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Binky Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 34, $$"n_send_approval"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Approval Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.atlas_email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] APPROVAL_REQUIRED'}}", "text": "={{'Reply with EXACTLY one line:\\nAPPROVE ' + $json.run_id + '\\nor\\nDENY ' + $json.run_id + ' <notes>\\n\\nAudit CC: Larry'}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_approval", "name": "Email Send: Approval Request", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Approval Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 35, $$"n_drafts_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Drafts Missing -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: DRAFTS_INCOMPLETE'}}", "text": "={{'Drafts missing: ' + JSON.stringify($json.draft_status.missing) + '\\nAttempt: ' + $json.draft_status.attempt + '\\nProceeding to approval package with partial drafts (logged).'}}"}, "id": "n_drafts_escalate", "name": "Email Escalate: Drafts Missing -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [6000, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 36, $$"n_send_publish"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Publish Commands"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.toList.join(',')}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_publish", "name": "Email Send: Publish Commands", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [7440, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Receipt Poll", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 37, $$"n_eod_tina"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: EOD Finance -> Tina"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.agents.TINA.email}}", "subject": "={{'[ATLAS][' + $json.run_id + '] EOD_FINANCE_REVIEW'}}", "text": "={{'Review ledger refs / monetization impacts for run ' + $json.run_id}}"}, "id": "n_eod_tina", "name": "Email Send: EOD Finance -> Tina", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [9120, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 38, $$"n_receipts_escalate"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Escalate: Missing Receipts -> Larry"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.audit_cc}}", "subject": "={{'[ATLAS][' + $json.run_id + '] WARN: RECEIPTS_INCOMPLETE'}}", "text": "={{'Missing receipts after retries: ' + JSON.stringify($json.receipt_status.missing)}}"}, "id": "n_receipts_escalate", "name": "Email Escalate: Missing Receipts -> Larry", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [8880, 20], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 39, $$"n_wait_intel"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Intel Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_intel", "name": "Wait: Intel Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [1440, 180]}, "connections": {"main": [[{"node": "IMAP Search: Intel Replies", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 40, $$"n_wait_binky"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Binky Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_binky", "name": "Wait: Binky Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [2880, 180]}, "connections": {"main": [[{"node": "IMAP Search: Binky Reply", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 41, $$"n_wait_approval"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Approval Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 60, "unit": "seconds"}, "id": "n_wait_approval", "name": "Wait: Approval Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [6240, 180]}, "connections": {"main": [[{"node": "IMAP Search: Approval Reply", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 42, $$"n_wait_receipts"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Receipt Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_receipts", "name": "Wait: Receipt Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [7680, 180]}, "connections": {"main": [[{"node": "IMAP Search: Publish Receipts", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 43, $$"n_split_tasks"$$::jsonb::text, $$"n8n-nodes-base.splitInBatches"$$::jsonb::text, $$"Split Tasks"$$::jsonb::text, $${"n8n_node": {"parameters": {"batchSize": 1, "options": {}}, "id": "n_split_tasks", "name": "Split Tasks", "type": "n8n-nodes-base.splitInBatches", "typeVersion": 3, "position": [4080, 180]}, "connections": {"main": [[{"node": "Email Send: Draft Task", "type": "main", "index": 0}], [{"node": "Wait: Draft Poll", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 44, $$"n_send_task"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Email Send: Draft Task"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "={{$json.atlas_email}}", "toEmail": "={{$json.task.to}}", "subject": "={{$json.subject}}", "text": "={{$json.body}}", "options": {"ccEmail": "={{$json.audit_cc}}"}}, "id": "n_send_task", "name": "Email Send: Draft Task", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [4320, 180], "credentials": {"smtp": {"id": "REPLACE_SMTP_CRED_ID", "name": "SMTP Shared"}}}, "connections": {"main": [[{"node": "Wait: Pace", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 45, $$"n_wait_task_pace"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Pace"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 5, "unit": "seconds"}, "id": "n_wait_task_pace", "name": "Wait: Pace", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4560, 180]}, "connections": {"main": [[{"node": "Split Tasks", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-orchestrator_atlas_orchestrator"$$::jsonb::text, 46, $$"n_wait_drafts"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait: Draft Poll"$$::jsonb::text, $${"n8n_node": {"parameters": {"amount": 90, "unit": "seconds"}, "id": "n_wait_drafts", "name": "Wait: Draft Poll", "type": "n8n-nodes-base.wait", "typeVersion": 1, "position": [4800, 180]}, "connections": {"main": [[{"node": "IMAP Search: Draft Replies", "type": "main", "index": 0}]]}}$$::jsonb);

-- N8N-research_SUNDAY_workflow_json (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"SUNDAY — Docs Intake + Draft Reply + Approval Gate (Audit-First)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/research/SUNDAY_workflow.json.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "SUNDAY — Docs Intake + Draft Reply + Approval Gate (Audit-First)", "active": false}, "sourcePath": "workflows/n8n/research/SUNDAY_workflow.json.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "SUNDAY — Docs Intake + Draft Reply + Approval Gate (Audit-First)", "nodes": [{"parameters": {"mailbox": "INBOX", "postProcessAction": "nothing", "downloadAttachments": false, "options": {"allowUnauthorizedCerts": false}}, "name": "Email Trigger (IMAP) — sunday.teambinky@deadapp.info", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [260, 300], "credentials": {"imap": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Sunday IMAP"}}}, {"parameters": {"jsCode": "const msg = items[0].json;\n\nconst fromRaw = msg.from?.text || msg.from || '';\nconst subject = msg.subject || '';\nconst text = msg.text || msg.textPlain || msg.body || '';\nconst messageId = msg.messageId || msg.headers?.['message-id'] || msg.header?.messageId || '';\nconst inReplyTo = msg.inReplyTo || msg.headers?.['in-reply-to'] || '';\nconst references = msg.references || msg.headers?.references || '';\nconst date = msg.date || new Date().toISOString();\n\nconst emailMatch = String(fromRaw).match(/<([^>]+)>/);\nconst fromEmail = (emailMatch ? emailMatch[1] : fromRaw).trim().toLowerCase();\n\n// tracking ID heuristic: looks for [ID: xxxx] or (ID: xxxx)\nconst idMatch = String(subject).match(/\\bID\\s*[:#]\\s*([A-Za-z0-9_-]{4,})\\b/);\nconst trackingId = idMatch ? idMatch[1] : '';\n\nreturn [{\n  json: {\n    fromRaw,\n    fromEmail,\n    subject,\n    text,\n    messageId,\n    inReplyTo,\n    references,\n    receivedAt: date,\n    trackingId,\n    threadKey: inReplyTo || references || messageId || `${fromEmail}|${subject}`\n  }\n}];"}, "name": "Normalize Email", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [520, 300]}, {"parameters": {"rules": {"rules": [{"operation": "in", "value1": "={{$json.fromEmail}}", "value2": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}]}}, "name": "Authorize Sender (ATLAS Required)", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [760, 300]}, {"parameters": {"jsCode": "const { subject, text } = items[0].json;\n\nconst secretPatterns = [\n  /api[_-]?key\\s*[:=]/i,\n  /secret\\s*[:=]/i,\n  /client[_-]?secret\\s*[:=]/i,\n  /password\\s*[:=]/i,\n  /-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----/i,\n  /sk-[A-Za-z0-9]{20,}/\n];\n\nconst content = `${subject}\\n\\n${text}`;\nconst containsSecrets = secretPatterns.some((re) => re.test(content));\n\nreturn [{ json: { ...items[0].json, containsSecrets } }];"}, "name": "Secret Check (Never Email Secrets)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 220]}, {"parameters": {"rules": {"rules": [{"operation": "equal", "value1": "={{$json.containsSecrets}}", "value2": true}]}}, "name": "If Secrets Detected → Compliance Stop", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [1220, 220]}, {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Sunday (Docs) — COMPLIANCE/AUDIT STOP\\n\\n` +\n`Detected content that appears to include secrets/credentials (or private keys). ` +\n`Per policy: I cannot process or retransmit secrets.\\n\\n` +\n`Action Required:\\n` +\n`1) Remove secrets from the email thread (redact keys/passwords/tokens).\\n` +\n`2) Resubmit the request from ATLAS with only approved, non-sensitive context.\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blocked: true } }];"}, "name": "Build Compliance Stop Reply", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 140]}, {"parameters": {"jsCode": "const j = items[0].json;\n\nconst tracking = j.trackingId ? `Tracking ID: ${j.trackingId}\\n` : '';\n\nconst body = `Sunday (Docs) — Draft Delivery\\n\\n` +\ntracking +\n`Bulleted Summary:\\n` +\n`- Purpose: ____\\n` +\n`- Audience: ____\\n` +\n`- Key points: ____\\n\\n` +\n`Draft Content:\\n` +\n`(Write the draft here. Keep to provided/approved source material. Cite links + access date for factual claims.)\\n\\n` +\n`Sources (if factual claims):\\n` +\n`- Source 1: <link> (accessed YYYY-MM-DD)\\n` +\n`- Source 2: <link> (accessed YYYY-MM-DD)\\n\\n` +\n`Approval Status:\\n` +\n`- Publish/Post: NOT AUTHORIZED (requires explicit ATLAS approval)\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blocked: false } }];"}, "name": "Draft Docs Response (Template Output)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 360]}, {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\n  \"agent\": \"SUNDAY\",\n  \"role\": \"Technical Documentation Writer\",\n  \"event\": \"EMAIL_RECEIVED\",\n  \"threadKey\": $json.threadKey,\n  \"from\": $json.fromEmail,\n  \"subject\": $json.subject,\n  \"receivedAt\": $json.receivedAt,\n  \"messageId\": $json.messageId,\n  \"containsSecrets\": $json.containsSecrets,\n  \"trackingId\": $json.trackingId\n}"}, "name": "Audit Log — Email Received", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1000, 420]}, {"parameters": {"fromEmail": "sunday.teambinky@deadapp.info", "toEmail": "={{$json.fromEmail}}", "subject": "={{$json.replySubject}}", "text": "={{$json.replyBody}}", "options": {"inReplyTo": "={{$json.messageId || $json.inReplyTo}}", "references": "={{$json.references}}"}}, "name": "Send Reply Email (Audit Chain)", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1680, 300], "credentials": {"smtp": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Sunday SMTP"}}}, {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\n  \"agent\": \"SUNDAY\",\n  \"role\": \"Technical Documentation Writer\",\n  \"event\": \"EMAIL_REPLY_SENT\",\n  \"threadKey\": $json.threadKey,\n  \"to\": $json.fromEmail,\n  \"subject\": $json.replySubject,\n  \"sentAt\": $now,\n  \"blocked\": $json.blocked,\n  \"trackingId\": $json.trackingId\n}"}, "name": "Audit Log — Reply Sent", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1920, 420]}, {"parameters": {"jsCode": "const j = items[0].json;\nreturn [{ json: { ...j, unauthorized: true, stop: true } }];"}, "name": "Unauthorized — Stop", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 120]}], "connections": {"Email Trigger (IMAP) — sunday.teambinky@deadapp.info": {"main": [[{"node": "Normalize Email", "type": "main", "index": 0}]]}, "Normalize Email": {"main": [[{"node": "Authorize Sender (ATLAS Required)", "type": "main", "index": 0}, {"node": "Audit Log — Email Received", "type": "main", "index": 0}]]}, "Authorize Sender (ATLAS Required)": {"main": [[{"node": "Secret Check (Never Email Secrets)", "type": "main", "index": 0}], [{"node": "Unauthorized — Stop", "type": "main", "index": 0}]]}, "Secret Check (Never Email Secrets)": {"main": [[{"node": "If Secrets Detected → Compliance Stop", "type": "main", "index": 0}]]}, "If Secrets Detected → Compliance Stop": {"main": [[{"node": "Build Compliance Stop Reply", "type": "main", "index": 0}], [{"node": "Draft Docs Response (Template Output)", "type": "main", "index": 0}]]}, "Build Compliance Stop Reply": {"main": [[{"node": "Send Reply Email (Audit Chain)", "type": "main", "index": 0}]]}, "Draft Docs Response (Template Output)": {"main": [[{"node": "Send Reply Email (Audit Chain)", "type": "main", "index": 0}]]}, "Send Reply Email (Audit Chain)": {"main": [[{"node": "Audit Log — Reply Sent", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionTimeout": 3600, "saveExecutionProgress": true, "saveManualExecutions": true}, "versionId": "1"}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"SUNDAY — Docs Intake + Draft Reply + Approval Gate (Audit-First)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 1, $$"Email Trigger (IMAP) — sunday.teambinky@deadapp.info"$$::jsonb::text, $$"n8n-nodes-base.emailReadImap"$$::jsonb::text, $$"Email Trigger (IMAP) — sunday.teambinky@deadapp.info"$$::jsonb::text, $${"n8n_node": {"parameters": {"mailbox": "INBOX", "postProcessAction": "nothing", "downloadAttachments": false, "options": {"allowUnauthorizedCerts": false}}, "name": "Email Trigger (IMAP) — sunday.teambinky@deadapp.info", "type": "n8n-nodes-base.emailReadImap", "typeVersion": 2, "position": [260, 300], "credentials": {"imap": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Sunday IMAP"}}}, "connections": {"main": [[{"node": "Normalize Email", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 2, $$"Normalize Email"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Normalize Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const msg = items[0].json;\n\nconst fromRaw = msg.from?.text || msg.from || '';\nconst subject = msg.subject || '';\nconst text = msg.text || msg.textPlain || msg.body || '';\nconst messageId = msg.messageId || msg.headers?.['message-id'] || msg.header?.messageId || '';\nconst inReplyTo = msg.inReplyTo || msg.headers?.['in-reply-to'] || '';\nconst references = msg.references || msg.headers?.references || '';\nconst date = msg.date || new Date().toISOString();\n\nconst emailMatch = String(fromRaw).match(/<([^>]+)>/);\nconst fromEmail = (emailMatch ? emailMatch[1] : fromRaw).trim().toLowerCase();\n\n// tracking ID heuristic: looks for [ID: xxxx] or (ID: xxxx)\nconst idMatch = String(subject).match(/\\bID\\s*[:#]\\s*([A-Za-z0-9_-]{4,})\\b/);\nconst trackingId = idMatch ? idMatch[1] : '';\n\nreturn [{\n  json: {\n    fromRaw,\n    fromEmail,\n    subject,\n    text,\n    messageId,\n    inReplyTo,\n    references,\n    receivedAt: date,\n    trackingId,\n    threadKey: inReplyTo || references || messageId || `${fromEmail}|${subject}`\n  }\n}];"}, "name": "Normalize Email", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [520, 300]}, "connections": {"main": [[{"node": "Authorize Sender (ATLAS Required)", "type": "main", "index": 0}, {"node": "Audit Log — Email Received", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 3, $$"Audit Log — Email Received"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Audit Log — Email Received"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\n  \"agent\": \"SUNDAY\",\n  \"role\": \"Technical Documentation Writer\",\n  \"event\": \"EMAIL_RECEIVED\",\n  \"threadKey\": $json.threadKey,\n  \"from\": $json.fromEmail,\n  \"subject\": $json.subject,\n  \"receivedAt\": $json.receivedAt,\n  \"messageId\": $json.messageId,\n  \"containsSecrets\": $json.containsSecrets,\n  \"trackingId\": $json.trackingId\n}"}, "name": "Audit Log — Email Received", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1000, 420]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 4, $$"Authorize Sender (ATLAS Required)"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Authorize Sender (ATLAS Required)"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"rules": [{"operation": "in", "value1": "={{$json.fromEmail}}", "value2": ["atlas@deadappcorp.org", "atlas@deadapp.info", "billy@deadapp.info", "bbwhited@icloud.com", "bbwhited@live.com"]}]}}, "name": "Authorize Sender (ATLAS Required)", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [760, 300]}, "connections": {"main": [[{"node": "Secret Check (Never Email Secrets)", "type": "main", "index": 0}], [{"node": "Unauthorized — Stop", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 5, $$"Secret Check (Never Email Secrets)"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Secret Check (Never Email Secrets)"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const { subject, text } = items[0].json;\n\nconst secretPatterns = [\n  /api[_-]?key\\s*[:=]/i,\n  /secret\\s*[:=]/i,\n  /client[_-]?secret\\s*[:=]/i,\n  /password\\s*[:=]/i,\n  /-----BEGIN (RSA|EC|OPENSSH|PRIVATE) KEY-----/i,\n  /sk-[A-Za-z0-9]{20,}/\n];\n\nconst content = `${subject}\\n\\n${text}`;\nconst containsSecrets = secretPatterns.some((re) => re.test(content));\n\nreturn [{ json: { ...items[0].json, containsSecrets } }];"}, "name": "Secret Check (Never Email Secrets)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 220]}, "connections": {"main": [[{"node": "If Secrets Detected → Compliance Stop", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 6, $$"Unauthorized — Stop"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Unauthorized — Stop"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\nreturn [{ json: { ...j, unauthorized: true, stop: true } }];"}, "name": "Unauthorized — Stop", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1000, 120]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 7, $$"If Secrets Detected → Compliance Stop"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"If Secrets Detected → Compliance Stop"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"rules": [{"operation": "equal", "value1": "={{$json.containsSecrets}}", "value2": true}]}}, "name": "If Secrets Detected → Compliance Stop", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [1220, 220]}, "connections": {"main": [[{"node": "Build Compliance Stop Reply", "type": "main", "index": 0}], [{"node": "Draft Docs Response (Template Output)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 8, $$"Build Compliance Stop Reply"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Build Compliance Stop Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\n\nconst body = `Sunday (Docs) — COMPLIANCE/AUDIT STOP\\n\\n` +\n`Detected content that appears to include secrets/credentials (or private keys). ` +\n`Per policy: I cannot process or retransmit secrets.\\n\\n` +\n`Action Required:\\n` +\n`1) Remove secrets from the email thread (redact keys/passwords/tokens).\\n` +\n`2) Resubmit the request from ATLAS with only approved, non-sensitive context.\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blocked: true } }];"}, "name": "Build Compliance Stop Reply", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 140]}, "connections": {"main": [[{"node": "Send Reply Email (Audit Chain)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 9, $$"Draft Docs Response (Template Output)"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Draft Docs Response (Template Output)"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const j = items[0].json;\n\nconst tracking = j.trackingId ? `Tracking ID: ${j.trackingId}\\n` : '';\n\nconst body = `Sunday (Docs) — Draft Delivery\\n\\n` +\ntracking +\n`Bulleted Summary:\\n` +\n`- Purpose: ____\\n` +\n`- Audience: ____\\n` +\n`- Key points: ____\\n\\n` +\n`Draft Content:\\n` +\n`(Write the draft here. Keep to provided/approved source material. Cite links + access date for factual claims.)\\n\\n` +\n`Sources (if factual claims):\\n` +\n`- Source 1: <link> (accessed YYYY-MM-DD)\\n` +\n`- Source 2: <link> (accessed YYYY-MM-DD)\\n\\n` +\n`Approval Status:\\n` +\n`- Publish/Post: NOT AUTHORIZED (requires explicit ATLAS approval)\\n\\n` +\n`Audit:\\n` +\n`- Thread Key: ${j.threadKey}\\n` +\n`- Received: ${j.receivedAt}\\n`;\n\nreturn [{ json: { ...j, replySubject: `RE: ${j.subject}`, replyBody: body, blocked: false } }];"}, "name": "Draft Docs Response (Template Output)", "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [1440, 360]}, "connections": {"main": [[{"node": "Send Reply Email (Audit Chain)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 10, $$"Send Reply Email (Audit Chain)"$$::jsonb::text, $$"n8n-nodes-base.emailSend"$$::jsonb::text, $$"Send Reply Email (Audit Chain)"$$::jsonb::text, $${"n8n_node": {"parameters": {"fromEmail": "sunday.teambinky@deadapp.info", "toEmail": "={{$json.fromEmail}}", "subject": "={{$json.replySubject}}", "text": "={{$json.replyBody}}", "options": {"inReplyTo": "={{$json.messageId || $json.inReplyTo}}", "references": "={{$json.references}}"}}, "name": "Send Reply Email (Audit Chain)", "type": "n8n-nodes-base.emailSend", "typeVersion": 2, "position": [1680, 300], "credentials": {"smtp": {"id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Sunday SMTP"}}}, "connections": {"main": [[{"node": "Audit Log — Reply Sent", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-research_SUNDAY_workflow_json"$$::jsonb::text, 11, $$"Audit Log — Reply Sent"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Audit Log — Reply Sent"$$::jsonb::text, $${"n8n_node": {"parameters": {"authentication": "none", "requestMethod": "POST", "url": "https://atlas-ux.onrender.com/api/audit/log", "options": {"timeout": 20000}, "jsonParameters": true, "bodyParametersJson": "={\n  \"agent\": \"SUNDAY\",\n  \"role\": \"Technical Documentation Writer\",\n  \"event\": \"EMAIL_REPLY_SENT\",\n  \"threadKey\": $json.threadKey,\n  \"to\": $json.fromEmail,\n  \"subject\": $json.replySubject,\n  \"sentAt\": $now,\n  \"blocked\": $json.blocked,\n  \"trackingId\": $json.trackingId\n}"}, "name": "Audit Log — Reply Sent", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [1920, 420]}, "connections": {}}$$::jsonb);

-- N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"✨🤖Automate Multi-Platform Social Media Content Creation with AI"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/#U2728#L01f916Automate Multi-Platform Social Media Content Creation with AI.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "N3hPT9EXmBKinPPk", "name": "✨🤖Automate Multi-Platform Social Media Content Creation with AI", "active": false}, "sourcePath": "workflows/n8n/social_media/#U2728#L01f916Automate Multi-Platform Social Media Content Creation with AI.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "✨🤖Automate Multi-Platform Social Media Content Creation with AI", "nodes": [{"parameters": {"content": "# 🧑‍🦱 User Input for Social Media Posts \n💡 Unpin default data to get started", "height": 360, "width": 360, "color": 4}, "id": "1e77584f-76b4-420b-b6b0-99132d6c0151", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [432, 400], "typeVersion": 1}, {"parameters": {"content": "# 🛠️ Social Media Content Factory\n- LinkedIn\n- Instagram\n- Facebook\n- X\n- TikTok\n- Threads\n- YouTube Shorts\n", "height": 600, "width": 640, "color": 6}, "id": "dc92fcf1-3618-4188-a30f-6c2205cc3266", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [832, 368], "typeVersion": 1}, {"parameters": {"content": "# 👍 Approve Content Before Proceeding", "height": 360, "width": 400, "color": 4}, "id": "02429ea7-be59-49e3-9d85-c1678ee64abd", "name": "Sticky Note2", "type": "n8n-nodes-base.stickyNote", "position": [2576, 608], "typeVersion": 1}, {"parameters": {"content": "# ✉️ Prepare & Format Approval Email", "height": 560, "width": 500, "color": 5}, "id": "fa38e25c-89e9-4d9b-be78-03aeb6965e30", "name": "Sticky Note5", "type": "n8n-nodes-base.stickyNote", "position": [2032, 400], "typeVersion": 1}, {"parameters": {"schemaType": "manual", "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"name\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"description\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"platform_posts\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"LinkedIn\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"image_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Instagram\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"caption\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"emojis\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Facebook\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"X-Twitter\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                        \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"character_limit\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n                \"TikTok\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                \t\t\"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"caption\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"Threads\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                       \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n                \t\t\"text_post\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"YouTube_Shorts\": {\n                  \t\"type\": \"object\",\n                  \t\"properties\": {\n                  \t\t\"video_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                  \t\t\"title\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                          \"description\": {\n                              \"type\": \"string\"\n                          },\n                          \"hashtags\": {\n                              \"type\": \"array\",\n                              \"items\": {\n                                  \"type\": \"string\"\n                              }\n                          },\n                          \"call_to_action\": {\n                              \"type\": \"string\"\n                          }\n                      }\n                  }\n\t\t\t}\n\t\t},\n\t\t\"additional_notes\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t}\n}\n"}, "id": "9b6e2038-9f65-4e0f-b13d-6c09e8224ed6", "name": "Social Media Content", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 768], "typeVersion": 1.2}, {"parameters": {"modelName": "models/gemini-2.0-flash-exp", "options": {"temperature": 0.4}}, "id": "a1211873-05ca-48c7-aa93-57d80b37174b", "name": "Google Gemini LLM", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [1056, 768], "typeVersion": 1, "credentials": {"googlePalmApi": {"id": "56jfoyxum81iEXj1", "name": "Google Gemini(PaLM) Api account"}}, "disabled": true}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "14327277-1e66-401d-9c74-8fdb6d76445f", "name": "gpt-4o-mini", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2096, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "9a49454b-f518-4388-82a7-2529addae3e5", "name": "gpt-4o", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2240, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}, "disabled": true}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "56eb9c72-87fc-42b2-b576-be68b3a8c7d2", "name": "gpt-4o LLM", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [912, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"url": "=https://image.pollinations.ai/prompt/{{$('Social Media Content Factory').item.json.output.description.replaceAll(' ','-').replaceAll(',','').replaceAll('.','') }}", "options": {}}, "id": "bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a", "name": "pollinations.ai", "type": "n8n-nodes-base.httpRequest", "position": [1712, 2080], "typeVersion": 4.2, "disabled": true}, {"parameters": {"content": "## Create Post Image\nhttps://pollinations.ai/\nhttps://image.pollinations.ai/prompt/[your image description]\n\n(alternative)", "height": 340, "width": 300}, "id": "5a950645-8e74-4be8-bad2-73d9f827a6b8", "name": "Sticky Note6", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1920], "typeVersion": 1}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "7b5b53eb-85c6-4a90-b209-7bd8d638f237", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [1440, 1328], "typeVersion": 3}, {"parameters": {"method": "POST", "url": "https://api.imgbb.com/1/upload", "sendQuery": true, "queryParameters": {"parameters": [{"name": "expiration", "value": "0"}, {"name": "key", "value": "={{ $env.IMGBB_API_KEY}} "}]}, "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"parameterType": "formBinaryData", "name": "image", "inputDataFieldName": "data"}]}, "options": {"redirect": {"redirect": {}}}}, "id": "daa6773e-0e15-4994-bcee-b3d996655855", "name": "Save Image to imgbb.com3", "type": "n8n-nodes-base.httpRequest", "position": [1088, 1168], "typeVersion": 4.2}, {"parameters": {"method": "POST", "url": "https://graph.facebook.com/v20.0/[your-unique-id]/media", "authentication": "predefinedCredentialType", "nodeCredentialType": "facebookGraphApi", "sendQuery": true, "queryParameters": {"parameters": [{"name": "image_url", "value": "={{ $json.data.medium.url }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}, "options": {}}, "id": "af06853c-258e-4dfb-a579-3168c8de96bd", "name": "Instagram Image", "type": "n8n-nodes-base.httpRequest", "position": [2432, 1248], "typeVersion": 4.2, "onError": "continueRegularOutput"}, {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "media_publish", "options": {"queryParameters": {"parameter": [{"name": "creation_id", "value": "={{ $json.id }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}}}, "id": "6ee72138-a8ec-4fbd-8f14-fd6e881edfd1", "name": "Instragram Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1472], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, {"parameters": {"text": "={{ $('Social Media Content Factory').item.json.output.platform_posts['X-Twitter'].post }}", "additionalFields": {}}, "id": "9e168865-1eae-4e53-99c9-91b041426ecb", "name": "X Post", "type": "n8n-nodes-base.twitter", "position": [2432, 1680], "typeVersion": 2, "alwaysOutputData": true, "credentials": {"twitterOAuth2Api": {"id": "K5y9gmrpUFKI0JmT", "name": "X account"}}, "onError": "continueRegularOutput"}, {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "photos", "sendBinaryData": true, "binaryPropertyName": "data", "options": {"queryParameters": {"parameter": [{"name": "message", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.post }}\n\n{{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}\n"}, {"name": "link", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}"}]}}}, "id": "4ee55c94-7251-445e-8ce7-15eee7165010", "name": "Facebook Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1904], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, {"parameters": {"postAs": "organization", "organization": "12345678", "text": "={{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}", "shareMediaCategory": "IMAGE", "binaryPropertyName": "=data", "additionalFields": {}}, "id": "3a015f3f-a162-411a-85e8-e1f042d9c653", "name": "LinkedIn Post", "type": "n8n-nodes-base.linkedIn", "position": [2432, 2080], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"linkedInOAuth2Api": {"id": "j4U4N6AqTwJMtEjS", "name": "LinkedIn account"}}, "onError": "continueRegularOutput"}, {"parameters": {"resource": "image", "prompt": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}", "options": {}}, "id": "8ab03d75-b4c5-4271-8fa9-830f449a3a3c", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [768, 1280], "typeVersion": 1.8, "alwaysOutputData": true, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "d1ac29b1-128d-4615-b828-89f1f64d1b15", "name": "Merge1", "type": "n8n-nodes-base.merge", "position": [2176, 1248], "typeVersion": 3}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "71eebce8-027a-4b12-b07e-692121de9a68", "name": "Merge2", "type": "n8n-nodes-base.merge", "position": [2176, 1984], "typeVersion": 3}, {"parameters": {"aggregate": "aggregateAllItemData", "options": {}}, "id": "140cff41-a619-4111-8dc9-3ec8fc45e061", "name": "Aggregate", "type": "n8n-nodes-base.aggregate", "position": [496, 1824], "typeVersion": 1}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "3e96bfac-dad5-4b75-b51b-50329892ee70", "name": "gpt-4o-mini1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 1840], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "4d73d59f-bb8c-481b-877a-bf4dc64f3277", "name": "gpt-4o-mini2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 2128], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥{{ $('Social Media Content Factory').item.json.output.name }} - {{ $('Social Media Content Factory').item.json.output.description }}", "message": "={{ $json.output }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "aaef70d7-6029-4fae-afc1-72a6a0019b03", "name": "Gmail User for Approval", "type": "n8n-nodes-base.gmail", "position": [2736, 768], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, {"parameters": {"content": "## Publish to Social Media", "height": 1100, "width": 300, "color": 6}, "id": "44e3bada-7665-4268-bb79-12ffb377552e", "name": "Sticky Note3", "type": "n8n-nodes-base.stickyNote", "position": [2336, 1168], "typeVersion": 1}, {"parameters": {"content": "## Format Results", "height": 880, "width": 300, "color": 5}, "id": "75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9", "name": "Sticky Note4", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1392], "typeVersion": 1}, {"parameters": {"content": "# Step 4️⃣: Send Final Results of Social Media Factory", "height": 760, "width": 1020, "color": 7}, "id": "ff5d050a-111c-4467-bc61-e51444943cb5", "name": "Sticky Note7", "type": "n8n-nodes-base.stickyNote", "position": [368, 1552], "typeVersion": 1}, {"parameters": {"content": "## Create Post Image", "height": 260, "width": 260, "color": 3}, "id": "26a684cc-72d9-40c8-bd30-1d074d914328", "name": "Sticky Note8", "type": "n8n-nodes-base.stickyNote", "position": [688, 1200], "typeVersion": 1}, {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥 New LinkedIn Post", "message": "=<html>\n<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n\n    <h2 style=\"font-size:20px; color:#333; margin:0 0 15px 0;\">LinkedIn</h2>\n      \n    <!-- LinkedIn Card -->\n    <div style=\"background: #ffffff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n\n      <!-- Card Header Image -->\n      <div style=\"height: 200px; overflow: hidden; border-radius: 8px 8px 0 0;\">\n        <img src=\"{{ $json.data.medium.url }}\" alt=\"Featured Image\" style=\"width: 100%; height: 100%; object-fit: cover;\">\n      </div>\n\n      <!-- Card Content -->\n      <div style=\"padding: 25px;\">\n\n        <p style=\"font-size:16px; color:#555; line-height: 1.6; margin-bottom: 15px;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n        </p>\n        \n        <div style=\"margin: 15px 0;\">\n          <span style=\"display: inline-block; background: #f0f0f0; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size:12px; color:#333;\">\n            {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n          </span>\n        </div>\n\n        <p style=\"font-size:14px; color:#1a0dab; font-weight: 600; margin:15px 0 0 0;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "930e76ac-6e9c-4a3f-9229-28ba18de25a3", "name": "Approve Final Post Content", "type": "n8n-nodes-base.gmail", "position": [1712, 1680], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}, "disabled": true}, {"parameters": {"content": "## Final Approval before Publishing to Social Feeds\n(optional)", "height": 340, "width": 300}, "id": "051b7ff6-febb-4aba-9790-bc977c11e645", "name": "Sticky Note9", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1552], "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "efe337a1-63e0-4513-873d-421bf41e4868", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "b42df164-47ae-4e08-9099-d0958dd41c8f", "name": "Is Approved?", "type": "n8n-nodes-base.if", "position": [1888, 1328], "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Instagram Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "e3193aef-d115-4c3b-87b2-b8ebd5bb0c05", "name": "Instagram Result", "type": "n8n-nodes-base.set", "position": [2768, 1472], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "X Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "6f8b248f-5c79-412c-81ef-3c52bef7f257", "name": "X Result", "type": "n8n-nodes-base.set", "position": [2768, 1680], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Facebook Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "4c1ee118-aba1-4632-bd48-27cef9d5e272", "name": "Facebook Result", "type": "n8n-nodes-base.set", "position": [2768, 1904], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "LinkedIn Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "490223f9-9b6a-4617-8829-c8e4b130feb7", "name": "LinkedIn Result", "type": "n8n-nodes-base.set", "position": [2768, 2080], "typeVersion": 3.4}, {"parameters": {"formTitle": "workflows.diy", "formDescription": "=Welcome to the workflows.diy AI-Powered Assistant!\n\nThis tool is designed to streamline and enhance your social media content creation process.\n\nSimply provide key inputs like a topic or title and an optional image, and our intelligent agent will generate engaging, platform-specific post descriptions tailored to your audience. \n\nWhether you're a marketer, business owner, or influencer, this assistant saves you time while delivering professional-quality content optimized for maximum impact.\n\n", "formFields": {"values": [{"fieldLabel": "Topic", "placeholder": "Provide a concise and clear title or main topic for your post (e.g., \"New Product Launch,\" \"Exciting Company Update\"). This helps the AI accurately capture the focus of your content.", "requiredField": true}, {"fieldLabel": "Keywords or Hashtags (optional)", "placeholder": "Include any specific keywords or hashtags you'd like the AI to incorporate into the post. This ensures the content aligns with your branding and campaign objectives.", "requiredField": "={{ false }}"}, {"fieldLabel": "Link (optional)", "placeholder": "=Provide the URL of any product, service, form, support page, or other resource. This link will be included in the generated post to direct your audience to the relevant content.\n"}]}, "responseMode": "lastNode", "options": {"buttonLabel": "Automatically Generate Social Media Content"}}, "id": "9732c12e-903e-49ac-8d29-ffc4d78c7ff8", "name": "Submit Social Post Details", "type": "n8n-nodes-base.formTrigger", "position": [560, 560], "webhookId": "3e762442-715e-47e1-a65e-ae92085857ae", "typeVersion": 2.2}, {"parameters": {"content": "# Step 1️⃣: Create Social Media Written Content\nNote:  \nYou could use the output of step 1 to create your written content and manually post if required.  \nYou so not have to implement step 2.", "height": 760, "width": 2640, "color": 7}, "id": "899f658f-4faa-4ba7-ae02-cc8fb1d22c71", "name": "Sticky Note10", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, {"parameters": {"content": "# Step 2️⃣: Create Image or Upload Image for Social Post", "height": 460, "width": 1020, "color": 7}, "id": "a8075b2a-4cd0-4b0c-9b19-8bd58de449c0", "name": "Sticky Note11", "type": "n8n-nodes-base.stickyNote", "position": [368, 1040], "typeVersion": 1}, {"parameters": {"content": "# Step 3️⃣: Publish Final Social Media Posts", "height": 1260, "width": 1680, "color": 7}, "id": "1da28ef3-9061-4e83-84e0-3502d254d63a", "name": "Sticky Note12", "type": "n8n-nodes-base.stickyNote", "position": [1568, 1040], "typeVersion": 1}, {"parameters": {"numberInputs": 4}, "id": "1955b762-b9c4-4704-955b-093686e827bd", "name": "Merge Results", "type": "n8n-nodes-base.merge", "position": [3072, 2080], "typeVersion": 3, "alwaysOutputData": true, "onError": "continueRegularOutput"}, {"parameters": {"promptType": "define", "text": "=You are a **content creation AI** for workflows.diy, a leading creator of **n8n workflow automation solutions and AI Agentic workflows**.\n\nYour goal is to craft **engaging, platform-specific content** for LinkedIn, Instagram, Facebook, Twitter (X), TikTok, Threads, and YouTube Shorts. Each post must align with the platform’s audience preferences, tone, and style while reflecting workflows.diy's expertise. The content should provide **value-driven insights**, tutorials, reviews, and discussions that resonate with tech professionals, automation enthusiasts, businesses, and n8n users.\n\n### Key Objectives:\n1. **Platform Optimization**: Tailor content format, tone, and hashtags to suit each platform’s algorithm and audience engagement patterns.\n2. **SEO & Hashtags**: Use a mix of general automation hashtags and trending platform-specific hashtags to maximize reach.\n3. **Engagement Focus**: Create content that sparks interaction through tutorials, comparisons, reviews, or thought-provoking discussions.\n4. **Consistency**: Maintain a professional yet approachable tone across all platforms while adapting to audience needs.\n5. **Data-Driven Strategy**: Analyze trends and performance data to refine content strategy and hashtag usage.\n\n### General Hashtags:\n#workflowsdiy #n8n #automation #AIWorkflows #WorkflowAutomation #TechSolutions\n\n---\n\n### Platform-Specific Guidelines:\n\n#### 1. LinkedIn\n   - **Style**: Professional and insightful.\n   - **Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n   - **Content Length**: 3-4 sentences; concise but detailed.\n   - **Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n   - **Call to Action (CTA)**: Encourage comments or visits to workflows.diy’s website for more insights.\n\n#### 2. Instagram\n   - **Style**: Visual storytelling with creative captions.\n   - **Tone**: Inspirational and engaging; use emojis for relatability.\n   - **Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n   - **Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n   - **CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n   - **Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://workflows.diy.\"\n   - **Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n\n#### 3. Facebook\n   - **Style**: Friendly and community-focused.\n   - **Tone**: Relatable; highlight user success stories or company achievements in automation.\n   - **Content Length**: 2-3 sentences; conversational yet professional.\n   - **Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n   - **CTA**: Encourage likes, shares, comments (e.g., “What’s your favorite automation tip?”).\n\n#### 4. Twitter (X)\n   - **Style**: Concise and impactful.\n   - **Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n   - **Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n   - **CTA**: Drive quick engagement through retweets or replies (e.g., “What’s your go-to n8n workflow?”).\n\n#### 5. TikTok\n   - **Style**: Short-form video content with trending audio or effects.\n   - **Tone**: Fun yet informative; focus on quick workflow demos or automation tips.\n   - **Content Length**: 15-60 seconds with captions summarizing the key message.\n   - **Hashtags**: Use trending tech-related hashtags relevant to TikTok’s audience (e.g., #n8nTips).\n   - **CTA**: Encourage viewers to follow workflows.diy for more automation hacks.\n\n#### 6. Threads\n   - **Style**: Conversational and community-driven posts.\n   - **Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n   - **Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n   - **Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n\n#### 7. YouTube Shorts\n   - **Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n   - **Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n   - Content Length:\n     - Tutorials/Reviews (long-form): 5-10 minutes\n     - Shorts/Highlights (short-form): Under 1 minute\n   - CTA:** Encourage subscriptions**, likes, comments (e.g., “Subscribe for more workflow tips!”).\n\n---\n\n### Content Creation Workflow:\nFor every post:\n1. Use the following input fields:\n    - Topic/About the Post: {{ $json.Topic }}\n    - Keywords/Focus Areas: {{ $json.formMode }}\n    - Link (optional): {{ $json['Link (optional)'] }}\n2. Adapt the tone/style based on the platform guidelines above.\n\nEnsure every post reflects workflows.diy's mission of delivering high-quality automation insights while maximizing engagement across platforms.\n\nFollow the provided JSON schema for your reponse.\n", "hasOutputParser": true, "options": {"systemMessage": "=Use the provided tools to research the topic based on latest information.  Todays date is {{ $now }}"}}, "id": "6dc47749-eb49-4351-89aa-50f2b6c035bb", "name": "Social Media Content Factory", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1040, 560], "retryOnFail": true, "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Generate clean, modern HTML email content from the provided JSON data with these requirements:\n- Use table-based layout with inline CSS for email compatibility\n- Create card sections for each platform containing:\n  • Title header (20px) \n  • Post content (16px) \n  • Video/image suggestions (italic 14px)\n  • Hashtag list (inline-block with # prefix)\n  • Emoji preservation where present\n  • Call-to-action (bold 14px)\n- Structure using:\n  • 600px max-width container\n  • 20px padding between cards\n  • Left-aligned text hierarchy\n  • Arial/sans-serif font stack\n  • Email-safe colors (#333 text, #555 secondary)\n- Include all platform-specific elements:\n  ▶ Video/image suggestions in italic\n  ▶ Hashtags as linked search terms\n  ▶ Emojis in original positions\n  ▶ Character limits for Twitter\n  ▶ Platform-specific CTAs\n  ▶ Visual quality reminders\n- Format hashtags as:\n  <span style=\"display: inline-block; background: #f0f0f0; padding: 2px 6px; margin: 2px; border-radius: 4px;\">#tag</span>\n\nInput data: {{ $json.output.toJsonString() }}\n\nRemove ALL code blocks and comments. Output ONLY the raw HTML with:\n- Platform cards in JSON order\n- All data elements represented\n- Mobile-responsive tables\n- W3C-valid markup\n\n## Example HTML:\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#fbfcfe;border:1px solid #dbdfe7;border-radius:8px\">\n\t\t<tbody><tr>\n\t\t\t<td align=\"center\" style=\"padding:24px 0\">\n\t\t\t\t<table width=\"448\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:100%;max-width:448px;background-color:#ffffff;border:1px solid #dbdfe7;border-radius:8px;padding:24px\">\n\t\t\t\t\t<tbody><tr>\n\t\t\t\t\t\t<td style=\"text-align:center;padding-top:8px;font-family:Arial,sans-serif;font-size:14px;color:#7e8186\">\n\t\t\t\t\t\t\t<p style=\"white-space:pre-line\"></p><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;font-family:Arial,sans-serif;color:#333\"><tbody><tr><td style=\"padding:20px\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">LinkedIn</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Discover why n8n stands out as the premier workflow automation tool. Its flexibility and open-source nature empower businesses to create custom solutions that drive efficiency and innovation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Video/Image suggestion pending</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Innovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>DigitalTransformation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit workflows.diy to explore how n8n can transform your business processes!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Instagram</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Eye-catching infographic comparing n8n to other automation tools, highlighting its unique features.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The ultimate workflow automation tool! <img data-emoji=\"💡\" class=\"an1\" alt=\"💡\" aria-label=\"💡\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a1/32.png\" loading=\"lazy\"> Unlock limitless possibilities with its open-source platform. Boost your productivity and streamline your processes. <img data-emoji=\"💤\" class=\"an1\" alt=\"💤\" aria-label=\"💤\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a4/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AutomationLife</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#TechInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#WorkflowTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Programming</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Engineering</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit our website: <a href=\"https://n8n.io/\" target=\"_blank\" data-saferedirecturl=\"https://www.google.com/url?q=https://n8n.io/&amp;source=gmail&amp;ust=1741030878129000&amp;usg=AOvVaw1Nr6ek3eGwe94zlbPaJrzT\">https://n8n.io/</a> #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Facebook</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">See why businesses are choosing n8n for their workflow automation needs. From its user-friendly interface to its powerful customization options, n8n is revolutionizing how companies approach automation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">A visually appealing graphic showcasing n8n's key features and benefits.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#SmallBusinessAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Entrepreneurship</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">What's your favorite automation tip? Share in the comments!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Twitter</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The best #WorkflowAutomation tool! Open-source, customizable, and powerful. Transform your business processes today!</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowTrends</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AutomationTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#NoCodeSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">TikTok</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Quick demo showcasing how n8n simplifies complex workflows with its intuitive interface.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: Your go-to for effortless workflow automation! <img data-emoji=\"✨\" class=\"an1\" alt=\"✨\" aria-label=\"✨\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/2728/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8nTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Follow workflows.diy for more automation hacks!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Threads</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n is transforming the automation landscape. Its open-source nature and extensive integrations make it a top choice for businesses of all sizes. What are your thoughts on the future of workflow automation?</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Share your insights below!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">YouTube Shorts</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Short tutorial demonstrating how to build a simple automation workflow in n8n.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Learn why n8n is the top choice for workflow automation. Its open-source platform and powerful features make it a game-changer for businesses.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowautomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#nocode</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Subscribe for more workflow tips!</td></tr></tbody></table></td></tr></tbody></table><p></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n</table>\n", "options": {}}, "id": "88c548bf-40e5-4b89-aef0-9233c3f5bc9c", "name": "Prepare Content Review Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2176, 560], "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a modern single line HTML table showing platform statuses. For each entry:\n\n-Extract platform name from the JSON key\n-Identify status (Success/Error) based on statusCode or error presence\n-Capture error message if present\n-Format as responsive HTML table with professional styling\n-Ensure email client compatibility with inline CSS\n-Include error handling for invalid JSON formats\n-Remove all line breaks and \\n from response.\n-Avoid any preamble or further explanation and remove all ``` and ```html from response.\n\n## Implementation Example:\nThis solution uses the parsed results from your workflow to generate:\n<table style=\"border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; margin: 20px 0; background-color: #f9f9f9; border: 1px solid #ddd;\">\n    <thead>\n        <tr style=\"background-color: #007bff; color: #fff;\">\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Platform</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Status</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Details</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Instagram</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">X (Twitter)</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Facebook</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">LinkedIn</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n    </tbody>\n</table>\n\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n", "options": {}}, "id": "3b074887-262f-47ab-b69c-c51b3a513993", "name": "Prepare Results Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1680], "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a brief summary of the results.\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n\n## Example Response:\nThe social media post results indicate multiple errors when attempting to access or post content on various platforms. \n\n1. Instagram: The response shows a 400 status code with an error message indicating that the specific post request is unsupported due to missing permissions or an invalid object ID. \n\n2. X Post: Success\n\n3. Facebook: Success \n\n4. LinkedIn: Also returned an 'Unable to sign without access token' error. \n\nOverall, access token issues and unsupported requests are frequent problems across these social media platforms.\n", "options": {}}, "id": "abb3994f-bf23-43f8-9c46-28795cfd2017", "name": "Prepare Results Message", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1968], "typeVersion": 1.7}, {"parameters": {"formFields": {"values": [{"fieldLabel": "Upload Image (optional)", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg, .png, .jpeg"}, {"fieldLabel": "Generate Custom Image using AI Image Generator", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "Yes"}, {"option": "No"}]}, "requiredField": true}]}, "options": {"formTitle": "Generate Post Image", "buttonLabel": "Submit"}}, "id": "b4a4838a-83b0-4f28-a9f3-dea915228325", "name": "Image Choice", "type": "n8n-nodes-base.form", "position": [112, 1184], "webhookId": "0dc811ef-b2e0-4213-a0c9-e9b5fb9fcbf1", "typeVersion": 1, "disabled": true}, {"parameters": {"sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "🔥RESULTS🔥 Social Media Factory", "message": "={{ $json.output }}", "options": {"appendAttribution": false}}, "id": "1cf97c10-e60f-4584-b069-3d4506868d8e", "name": "Gmail Results", "type": "n8n-nodes-base.gmail", "position": [1088, 1680], "webhookId": "0a81b95a-cd82-465d-8450-cf38518a4cbb", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, {"parameters": {"chatId": "={{ $env.TELEGRAM_CHAT_ID }}", "text": "={{ $json.output }}", "additionalFields": {"appendAttribution": false}}, "id": "c845ae46-9d37-472b-ae0f-49fc6940e685", "name": "Telegram Results", "type": "n8n-nodes-base.telegram", "position": [1088, 1968], "webhookId": "bb40ede7-03cf-493d-b051-196b96725925", "typeVersion": 1.2, "credentials": {"telegramApi": {"id": "0JxGbAnpImpz1Tne", "name": "Telegram account"}}}, {"parameters": {"content": "", "height": 620, "width": 940, "color": 4}, "id": "a33f9431-bede-4f66-ae0d-1e686a3092b7", "name": "Sticky Note13", "type": "n8n-nodes-base.stickyNote", "position": [416, 1648], "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "e32d270f-f258-4522-94e1-2cb7ee4e8d2a", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "643b94c6-4535-4876-9660-d82ff69cbcf6", "name": "Is Content Approved?", "type": "n8n-nodes-base.if", "position": [496, 1280], "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "f150aa79-2d20-4869-b60a-350d49a215a5", "name": "data", "type": "object", "value": "={\n  \"approved\": true\n}"}]}, "options": {}}, "id": "fb7108e2-21cf-4df4-ab20-fe75b15b0a24", "name": "Set Default True 2", "type": "n8n-nodes-base.set", "position": [1712, 1328], "typeVersion": 3.4}, {"parameters": {"content": "## Alternative User Uploaded Image\n(optional)", "height": 580, "width": 300}, "id": "66364a53-c2fc-43fd-be92-683b373652df", "name": "Sticky Note14", "type": "n8n-nodes-base.stickyNote", "position": [32, 1040], "typeVersion": 1}, {"parameters": {"content": "## Implement Additional Approval Here\n(optional)", "height": 340, "width": 460}, "id": "d0025029-1f6f-4b27-8495-00966f1dae12", "name": "Sticky Note15", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1168], "typeVersion": 1}, {"parameters": {"options": {}}, "id": "0a10bca0-c3a8-496b-a22e-120928ad7736", "name": "SerpAPI", "type": "@n8n/n8n-nodes-langchain.toolSerpApi", "position": [1200, 768], "typeVersion": 1, "credentials": {"serpApi": {"id": "R2xhbE9t2j13givq", "name": "SerpAPI account"}}}, {"parameters": {"content": "### 💡Notes\n\nAdjust the Social Media Content Factory prompts to suit your personal or business requirements.\n\nUpdate Credentials for:\n- OpenAI API Key\nhttps://auth.openai.com/log-in\n\n- Google Studio API\nhttps://aistudio.google.com/app/apikey\n\n- SERP API Key\nhttps://serpapi.com/\n\n- Gmail OAuth\nhttps://docs.n8n.io/integrations/builtin/credentials/google/\n\n- Telegram Bot (Optional)\nhttps://docs.n8n.io/integrations/builtin/credentials/telegram/\n\n- imgbb\nhttps://imgbb.com/", "height": 500, "width": 480}, "id": "fa765062-22ef-4f26-9f02-099235edc771", "name": "Sticky Note16", "type": "n8n-nodes-base.stickyNote", "position": [1520, 400], "typeVersion": 1}, {"parameters": {"content": "💡Notes\n\nUpdate all Social Media Platform Credentials as required.\n\nAdjust parameters and content for each platform to suit your needs.", "height": 180, "width": 300}, "id": "5ffc2b16-61af-4395-a57b-20d1cd125488", "name": "Sticky Note17", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1168], "typeVersion": 1}, {"parameters": {"jsCode": "$input.first().binary.data = $input.first().binary.Upload_Image__optional_\ndelete $input.first().binary.Upload_Image__optional_\nreturn $input.first()"}, "id": "b21f527c-5674-49d0-a114-866d669e7ad6", "name": "Rename Binary File", "type": "n8n-nodes-base.code", "position": [112, 1424], "typeVersion": 2, "alwaysOutputData": true}], "pinData": {}, "connections": {"Merge": {"main": [[{"node": "Set Default True 2", "type": "main", "index": 0}]]}, "Merge1": {"main": [[{"node": "Instagram Image", "type": "main", "index": 0}]]}, "Merge2": {"main": [[{"node": "Facebook Post", "type": "main", "index": 0}, {"node": "LinkedIn Post", "type": "main", "index": 0}]]}, "OpenAI": {"main": [[{"node": "Save Image to imgbb.com3", "type": "main", "index": 0}, {"node": "Merge", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 1}]]}, "X Post": {"main": [[{"node": "X Result", "type": "main", "index": 0}], []]}, "SerpAPI": {"ai_tool": [[{"node": "Social Media Content Factory", "type": "ai_tool", "index": 0}]]}, "X Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 1}]]}, "Aggregate": {"main": [[{"node": "Prepare Results Email", "type": "main", "index": 0}, {"node": "Prepare Results Message", "type": "main", "index": 0}]]}, "gpt-4o LLM": {"ai_languageModel": [[{"node": "Social Media Content Factory", "type": "ai_languageModel", "index": 0}]]}, "gpt-4o-mini": {"ai_languageModel": [[{"node": "Prepare Content Review Email", "type": "ai_languageModel", "index": 0}]]}, "Image Choice": {"main": [[{"node": "Rename Binary File", "type": "main", "index": 0}]]}, "Is Approved?": {"main": [[{"node": "X Post", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 0}], []]}, "gpt-4o-mini1": {"ai_languageModel": [[{"node": "Prepare Results Email", "type": "ai_languageModel", "index": 0}]]}, "gpt-4o-mini2": {"ai_languageModel": [[{"node": "Prepare Results Message", "type": "ai_languageModel", "index": 0}]]}, "Facebook Post": {"main": [[{"node": "Facebook Result", "type": "main", "index": 0}], []]}, "LinkedIn Post": {"main": [[{"node": "LinkedIn Result", "type": "main", "index": 0}], []]}, "Merge Results": {"main": [[{"node": "Aggregate", "type": "main", "index": 0}]]}, "Facebook Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 2}]]}, "Instagram Image": {"main": [[{"node": "Instragram Post", "type": "main", "index": 0}]]}, "Instragram Post": {"main": [[{"node": "Instagram Result", "type": "main", "index": 0}], []]}, "LinkedIn Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 3}]]}, "pollinations.ai": {"main": [[]]}, "Instagram Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 0}]]}, "Google Gemini LLM": {"ai_languageModel": [[]]}, "Set Default True 2": {"main": [[{"node": "Is Approved?", "type": "main", "index": 0}]]}, "Is Content Approved?": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}]]}, "Social Media Content": {"ai_outputParser": [[{"node": "Social Media Content Factory", "type": "ai_outputParser", "index": 0}]]}, "Prepare Results Email": {"main": [[{"node": "Gmail Results", "type": "main", "index": 0}]]}, "Gmail User for Approval": {"main": [[{"node": "Is Content Approved?", "type": "main", "index": 0}]]}, "Prepare Results Message": {"main": [[{"node": "Telegram Results", "type": "main", "index": 0}]]}, "Save Image to imgbb.com3": {"main": [[{"node": "Merge", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 0}]]}, "Approve Final Post Content": {"main": [[]]}, "Submit Social Post Details": {"main": [[{"node": "Social Media Content Factory", "type": "main", "index": 0}]]}, "Prepare Content Review Email": {"main": [[{"node": "Gmail User for Approval", "type": "main", "index": 0}]]}, "Social Media Content Factory": {"main": [[{"node": "Prepare Content Review Email", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "8338e381-d3c4-4caa-8aa1-76cc5c163946", "meta": {"templateId": "3066", "templateCredsSetupCompleted": true, "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "N3hPT9EXmBKinPPk", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"✨🤖Automate Multi-Platform Social Media Content Creation with AI"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 1, $$"1e77584f-76b4-420b-b6b0-99132d6c0151"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 🧑‍🦱 User Input for Social Media Posts \n💡 Unpin default data to get started", "height": 360, "width": 360, "color": 4}, "id": "1e77584f-76b4-420b-b6b0-99132d6c0151", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [432, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 2, $$"dc92fcf1-3618-4188-a30f-6c2205cc3266"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 🛠️ Social Media Content Factory\n- LinkedIn\n- Instagram\n- Facebook\n- X\n- TikTok\n- Threads\n- YouTube Shorts\n", "height": 600, "width": 640, "color": 6}, "id": "dc92fcf1-3618-4188-a30f-6c2205cc3266", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [832, 368], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 3, $$"02429ea7-be59-49e3-9d85-c1678ee64abd"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note2"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 👍 Approve Content Before Proceeding", "height": 360, "width": 400, "color": 4}, "id": "02429ea7-be59-49e3-9d85-c1678ee64abd", "name": "Sticky Note2", "type": "n8n-nodes-base.stickyNote", "position": [2576, 608], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 4, $$"fa38e25c-89e9-4d9b-be78-03aeb6965e30"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note5"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# ✉️ Prepare & Format Approval Email", "height": 560, "width": 500, "color": 5}, "id": "fa38e25c-89e9-4d9b-be78-03aeb6965e30", "name": "Sticky Note5", "type": "n8n-nodes-base.stickyNote", "position": [2032, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 5, $$"9b6e2038-9f65-4e0f-b13d-6c09e8224ed6"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Social Media Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"schemaType": "manual", "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"name\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"description\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"platform_posts\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"LinkedIn\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"image_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Instagram\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"caption\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"emojis\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Facebook\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"X-Twitter\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                        \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"character_limit\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n                \"TikTok\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                \t\t\"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"caption\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"Threads\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                       \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n                \t\t\"text_post\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"YouTube_Shorts\": {\n                  \t\"type\": \"object\",\n                  \t\"properties\": {\n                  \t\t\"video_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                  \t\t\"title\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                          \"description\": {\n                              \"type\": \"string\"\n                          },\n                          \"hashtags\": {\n                              \"type\": \"array\",\n                              \"items\": {\n                                  \"type\": \"string\"\n                              }\n                          },\n                          \"call_to_action\": {\n                              \"type\": \"string\"\n                          }\n                      }\n                  }\n\t\t\t}\n\t\t},\n\t\t\"additional_notes\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t}\n}\n"}, "id": "9b6e2038-9f65-4e0f-b13d-6c09e8224ed6", "name": "Social Media Content", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 768], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Social Media Content Factory", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 6, $$"a1211873-05ca-48c7-aa93-57d80b37174b"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatGoogleGemini"$$::jsonb::text, $$"Google Gemini LLM"$$::jsonb::text, $${"n8n_node": {"parameters": {"modelName": "models/gemini-2.0-flash-exp", "options": {"temperature": 0.4}}, "id": "a1211873-05ca-48c7-aa93-57d80b37174b", "name": "Google Gemini LLM", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [1056, 768], "typeVersion": 1, "credentials": {"googlePalmApi": {"id": "56jfoyxum81iEXj1", "name": "Google Gemini(PaLM) Api account"}}, "disabled": true}, "connections": {"ai_languageModel": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 7, $$"14327277-1e66-401d-9c74-8fdb6d76445f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "14327277-1e66-401d-9c74-8fdb6d76445f", "name": "gpt-4o-mini", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2096, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Content Review Email", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 8, $$"9a49454b-f518-4388-82a7-2529addae3e5"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "9a49454b-f518-4388-82a7-2529addae3e5", "name": "gpt-4o", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2240, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}, "disabled": true}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 9, $$"56eb9c72-87fc-42b2-b576-be68b3a8c7d2"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o LLM"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "56eb9c72-87fc-42b2-b576-be68b3a8c7d2", "name": "gpt-4o LLM", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [912, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Social Media Content Factory", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 10, $$"bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"pollinations.ai"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "=https://image.pollinations.ai/prompt/{{$('Social Media Content Factory').item.json.output.description.replaceAll(' ','-').replaceAll(',','').replaceAll('.','') }}", "options": {}}, "id": "bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a", "name": "pollinations.ai", "type": "n8n-nodes-base.httpRequest", "position": [1712, 2080], "typeVersion": 4.2, "disabled": true}, "connections": {"main": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 11, $$"5a950645-8e74-4be8-bad2-73d9f827a6b8"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note6"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Create Post Image\nhttps://pollinations.ai/\nhttps://image.pollinations.ai/prompt/[your image description]\n\n(alternative)", "height": 340, "width": 300}, "id": "5a950645-8e74-4be8-bad2-73d9f827a6b8", "name": "Sticky Note6", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1920], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 12, $$"3e96bfac-dad5-4b75-b51b-50329892ee70"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini1"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "3e96bfac-dad5-4b75-b51b-50329892ee70", "name": "gpt-4o-mini1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 1840], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Results Email", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 13, $$"4d73d59f-bb8c-481b-877a-bf4dc64f3277"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini2"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "4d73d59f-bb8c-481b-877a-bf4dc64f3277", "name": "gpt-4o-mini2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 2128], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Results Message", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 14, $$"44e3bada-7665-4268-bb79-12ffb377552e"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note3"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Publish to Social Media", "height": 1100, "width": 300, "color": 6}, "id": "44e3bada-7665-4268-bb79-12ffb377552e", "name": "Sticky Note3", "type": "n8n-nodes-base.stickyNote", "position": [2336, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 15, $$"75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note4"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Format Results", "height": 880, "width": 300, "color": 5}, "id": "75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9", "name": "Sticky Note4", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1392], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 16, $$"ff5d050a-111c-4467-bc61-e51444943cb5"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note7"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 4️⃣: Send Final Results of Social Media Factory", "height": 760, "width": 1020, "color": 7}, "id": "ff5d050a-111c-4467-bc61-e51444943cb5", "name": "Sticky Note7", "type": "n8n-nodes-base.stickyNote", "position": [368, 1552], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 17, $$"26a684cc-72d9-40c8-bd30-1d074d914328"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note8"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Create Post Image", "height": 260, "width": 260, "color": 3}, "id": "26a684cc-72d9-40c8-bd30-1d074d914328", "name": "Sticky Note8", "type": "n8n-nodes-base.stickyNote", "position": [688, 1200], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 18, $$"930e76ac-6e9c-4a3f-9229-28ba18de25a3"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Approve Final Post Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥 New LinkedIn Post", "message": "=<html>\n<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n\n    <h2 style=\"font-size:20px; color:#333; margin:0 0 15px 0;\">LinkedIn</h2>\n      \n    <!-- LinkedIn Card -->\n    <div style=\"background: #ffffff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n\n      <!-- Card Header Image -->\n      <div style=\"height: 200px; overflow: hidden; border-radius: 8px 8px 0 0;\">\n        <img src=\"{{ $json.data.medium.url }}\" alt=\"Featured Image\" style=\"width: 100%; height: 100%; object-fit: cover;\">\n      </div>\n\n      <!-- Card Content -->\n      <div style=\"padding: 25px;\">\n\n        <p style=\"font-size:16px; color:#555; line-height: 1.6; margin-bottom: 15px;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n        </p>\n        \n        <div style=\"margin: 15px 0;\">\n          <span style=\"display: inline-block; background: #f0f0f0; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size:12px; color:#333;\">\n            {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n          </span>\n        </div>\n\n        <p style=\"font-size:14px; color:#1a0dab; font-weight: 600; margin:15px 0 0 0;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "930e76ac-6e9c-4a3f-9229-28ba18de25a3", "name": "Approve Final Post Content", "type": "n8n-nodes-base.gmail", "position": [1712, 1680], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}, "disabled": true}, "connections": {"main": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 19, $$"051b7ff6-febb-4aba-9790-bc977c11e645"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note9"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Final Approval before Publishing to Social Feeds\n(optional)", "height": 340, "width": 300}, "id": "051b7ff6-febb-4aba-9790-bc977c11e645", "name": "Sticky Note9", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1552], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 20, $$"9732c12e-903e-49ac-8d29-ffc4d78c7ff8"$$::jsonb::text, $$"n8n-nodes-base.formTrigger"$$::jsonb::text, $$"Submit Social Post Details"$$::jsonb::text, $${"n8n_node": {"parameters": {"formTitle": "workflows.diy", "formDescription": "=Welcome to the workflows.diy AI-Powered Assistant!\n\nThis tool is designed to streamline and enhance your social media content creation process.\n\nSimply provide key inputs like a topic or title and an optional image, and our intelligent agent will generate engaging, platform-specific post descriptions tailored to your audience. \n\nWhether you're a marketer, business owner, or influencer, this assistant saves you time while delivering professional-quality content optimized for maximum impact.\n\n", "formFields": {"values": [{"fieldLabel": "Topic", "placeholder": "Provide a concise and clear title or main topic for your post (e.g., \"New Product Launch,\" \"Exciting Company Update\"). This helps the AI accurately capture the focus of your content.", "requiredField": true}, {"fieldLabel": "Keywords or Hashtags (optional)", "placeholder": "Include any specific keywords or hashtags you'd like the AI to incorporate into the post. This ensures the content aligns with your branding and campaign objectives.", "requiredField": "={{ false }}"}, {"fieldLabel": "Link (optional)", "placeholder": "=Provide the URL of any product, service, form, support page, or other resource. This link will be included in the generated post to direct your audience to the relevant content.\n"}]}, "responseMode": "lastNode", "options": {"buttonLabel": "Automatically Generate Social Media Content"}}, "id": "9732c12e-903e-49ac-8d29-ffc4d78c7ff8", "name": "Submit Social Post Details", "type": "n8n-nodes-base.formTrigger", "position": [560, 560], "webhookId": "3e762442-715e-47e1-a65e-ae92085857ae", "typeVersion": 2.2}, "connections": {"main": [[{"node": "Social Media Content Factory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 21, $$"899f658f-4faa-4ba7-ae02-cc8fb1d22c71"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note10"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 1️⃣: Create Social Media Written Content\nNote:  \nYou could use the output of step 1 to create your written content and manually post if required.  \nYou so not have to implement step 2.", "height": 760, "width": 2640, "color": 7}, "id": "899f658f-4faa-4ba7-ae02-cc8fb1d22c71", "name": "Sticky Note10", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 22, $$"a8075b2a-4cd0-4b0c-9b19-8bd58de449c0"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note11"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 2️⃣: Create Image or Upload Image for Social Post", "height": 460, "width": 1020, "color": 7}, "id": "a8075b2a-4cd0-4b0c-9b19-8bd58de449c0", "name": "Sticky Note11", "type": "n8n-nodes-base.stickyNote", "position": [368, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 23, $$"1da28ef3-9061-4e83-84e0-3502d254d63a"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note12"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 3️⃣: Publish Final Social Media Posts", "height": 1260, "width": 1680, "color": 7}, "id": "1da28ef3-9061-4e83-84e0-3502d254d63a", "name": "Sticky Note12", "type": "n8n-nodes-base.stickyNote", "position": [1568, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 24, $$"b4a4838a-83b0-4f28-a9f3-dea915228325"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"Image Choice"$$::jsonb::text, $${"n8n_node": {"parameters": {"formFields": {"values": [{"fieldLabel": "Upload Image (optional)", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg, .png, .jpeg"}, {"fieldLabel": "Generate Custom Image using AI Image Generator", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "Yes"}, {"option": "No"}]}, "requiredField": true}]}, "options": {"formTitle": "Generate Post Image", "buttonLabel": "Submit"}}, "id": "b4a4838a-83b0-4f28-a9f3-dea915228325", "name": "Image Choice", "type": "n8n-nodes-base.form", "position": [112, 1184], "webhookId": "0dc811ef-b2e0-4213-a0c9-e9b5fb9fcbf1", "typeVersion": 1, "disabled": true}, "connections": {"main": [[{"node": "Rename Binary File", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 25, $$"a33f9431-bede-4f66-ae0d-1e686a3092b7"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note13"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "", "height": 620, "width": 940, "color": 4}, "id": "a33f9431-bede-4f66-ae0d-1e686a3092b7", "name": "Sticky Note13", "type": "n8n-nodes-base.stickyNote", "position": [416, 1648], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 26, $$"66364a53-c2fc-43fd-be92-683b373652df"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note14"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Alternative User Uploaded Image\n(optional)", "height": 580, "width": 300}, "id": "66364a53-c2fc-43fd-be92-683b373652df", "name": "Sticky Note14", "type": "n8n-nodes-base.stickyNote", "position": [32, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 27, $$"d0025029-1f6f-4b27-8495-00966f1dae12"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note15"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Implement Additional Approval Here\n(optional)", "height": 340, "width": 460}, "id": "d0025029-1f6f-4b27-8495-00966f1dae12", "name": "Sticky Note15", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 28, $$"0a10bca0-c3a8-496b-a22e-120928ad7736"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolSerpApi"$$::jsonb::text, $$"SerpAPI"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "0a10bca0-c3a8-496b-a22e-120928ad7736", "name": "SerpAPI", "type": "@n8n/n8n-nodes-langchain.toolSerpApi", "position": [1200, 768], "typeVersion": 1, "credentials": {"serpApi": {"id": "R2xhbE9t2j13givq", "name": "SerpAPI account"}}}, "connections": {"ai_tool": [[{"node": "Social Media Content Factory", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 29, $$"fa765062-22ef-4f26-9f02-099235edc771"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note16"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "### 💡Notes\n\nAdjust the Social Media Content Factory prompts to suit your personal or business requirements.\n\nUpdate Credentials for:\n- OpenAI API Key\nhttps://auth.openai.com/log-in\n\n- Google Studio API\nhttps://aistudio.google.com/app/apikey\n\n- SERP API Key\nhttps://serpapi.com/\n\n- Gmail OAuth\nhttps://docs.n8n.io/integrations/builtin/credentials/google/\n\n- Telegram Bot (Optional)\nhttps://docs.n8n.io/integrations/builtin/credentials/telegram/\n\n- imgbb\nhttps://imgbb.com/", "height": 500, "width": 480}, "id": "fa765062-22ef-4f26-9f02-099235edc771", "name": "Sticky Note16", "type": "n8n-nodes-base.stickyNote", "position": [1520, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 30, $$"5ffc2b16-61af-4395-a57b-20d1cd125488"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note17"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "💡Notes\n\nUpdate all Social Media Platform Credentials as required.\n\nAdjust parameters and content for each platform to suit your needs.", "height": 180, "width": 300}, "id": "5ffc2b16-61af-4395-a57b-20d1cd125488", "name": "Sticky Note17", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 31, $$"b21f527c-5674-49d0-a114-866d669e7ad6"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Rename Binary File"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "$input.first().binary.data = $input.first().binary.Upload_Image__optional_\ndelete $input.first().binary.Upload_Image__optional_\nreturn $input.first()"}, "id": "b21f527c-5674-49d0-a114-866d669e7ad6", "name": "Rename Binary File", "type": "n8n-nodes-base.code", "position": [112, 1424], "typeVersion": 2, "alwaysOutputData": true}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 32, $$"6dc47749-eb49-4351-89aa-50f2b6c035bb"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Social Media Content Factory"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=You are a **content creation AI** for workflows.diy, a leading creator of **n8n workflow automation solutions and AI Agentic workflows**.\n\nYour goal is to craft **engaging, platform-specific content** for LinkedIn, Instagram, Facebook, Twitter (X), TikTok, Threads, and YouTube Shorts. Each post must align with the platform’s audience preferences, tone, and style while reflecting workflows.diy's expertise. The content should provide **value-driven insights**, tutorials, reviews, and discussions that resonate with tech professionals, automation enthusiasts, businesses, and n8n users.\n\n### Key Objectives:\n1. **Platform Optimization**: Tailor content format, tone, and hashtags to suit each platform’s algorithm and audience engagement patterns.\n2. **SEO & Hashtags**: Use a mix of general automation hashtags and trending platform-specific hashtags to maximize reach.\n3. **Engagement Focus**: Create content that sparks interaction through tutorials, comparisons, reviews, or thought-provoking discussions.\n4. **Consistency**: Maintain a professional yet approachable tone across all platforms while adapting to audience needs.\n5. **Data-Driven Strategy**: Analyze trends and performance data to refine content strategy and hashtag usage.\n\n### General Hashtags:\n#workflowsdiy #n8n #automation #AIWorkflows #WorkflowAutomation #TechSolutions\n\n---\n\n### Platform-Specific Guidelines:\n\n#### 1. LinkedIn\n   - **Style**: Professional and insightful.\n   - **Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n   - **Content Length**: 3-4 sentences; concise but detailed.\n   - **Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n   - **Call to Action (CTA)**: Encourage comments or visits to workflows.diy’s website for more insights.\n\n#### 2. Instagram\n   - **Style**: Visual storytelling with creative captions.\n   - **Tone**: Inspirational and engaging; use emojis for relatability.\n   - **Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n   - **Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n   - **CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n   - **Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://workflows.diy.\"\n   - **Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n\n#### 3. Facebook\n   - **Style**: Friendly and community-focused.\n   - **Tone**: Relatable; highlight user success stories or company achievements in automation.\n   - **Content Length**: 2-3 sentences; conversational yet professional.\n   - **Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n   - **CTA**: Encourage likes, shares, comments (e.g., “What’s your favorite automation tip?”).\n\n#### 4. Twitter (X)\n   - **Style**: Concise and impactful.\n   - **Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n   - **Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n   - **CTA**: Drive quick engagement through retweets or replies (e.g., “What’s your go-to n8n workflow?”).\n\n#### 5. TikTok\n   - **Style**: Short-form video content with trending audio or effects.\n   - **Tone**: Fun yet informative; focus on quick workflow demos or automation tips.\n   - **Content Length**: 15-60 seconds with captions summarizing the key message.\n   - **Hashtags**: Use trending tech-related hashtags relevant to TikTok’s audience (e.g., #n8nTips).\n   - **CTA**: Encourage viewers to follow workflows.diy for more automation hacks.\n\n#### 6. Threads\n   - **Style**: Conversational and community-driven posts.\n   - **Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n   - **Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n   - **Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n\n#### 7. YouTube Shorts\n   - **Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n   - **Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n   - Content Length:\n     - Tutorials/Reviews (long-form): 5-10 minutes\n     - Shorts/Highlights (short-form): Under 1 minute\n   - CTA:** Encourage subscriptions**, likes, comments (e.g., “Subscribe for more workflow tips!”).\n\n---\n\n### Content Creation Workflow:\nFor every post:\n1. Use the following input fields:\n    - Topic/About the Post: {{ $json.Topic }}\n    - Keywords/Focus Areas: {{ $json.formMode }}\n    - Link (optional): {{ $json['Link (optional)'] }}\n2. Adapt the tone/style based on the platform guidelines above.\n\nEnsure every post reflects workflows.diy's mission of delivering high-quality automation insights while maximizing engagement across platforms.\n\nFollow the provided JSON schema for your reponse.\n", "hasOutputParser": true, "options": {"systemMessage": "=Use the provided tools to research the topic based on latest information.  Todays date is {{ $now }}"}}, "id": "6dc47749-eb49-4351-89aa-50f2b6c035bb", "name": "Social Media Content Factory", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1040, 560], "retryOnFail": true, "typeVersion": 1.7}, "connections": {"main": [[{"node": "Prepare Content Review Email", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 33, $$"88c548bf-40e5-4b89-aef0-9233c3f5bc9c"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Content Review Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Generate clean, modern HTML email content from the provided JSON data with these requirements:\n- Use table-based layout with inline CSS for email compatibility\n- Create card sections for each platform containing:\n  • Title header (20px) \n  • Post content (16px) \n  • Video/image suggestions (italic 14px)\n  • Hashtag list (inline-block with # prefix)\n  • Emoji preservation where present\n  • Call-to-action (bold 14px)\n- Structure using:\n  • 600px max-width container\n  • 20px padding between cards\n  • Left-aligned text hierarchy\n  • Arial/sans-serif font stack\n  • Email-safe colors (#333 text, #555 secondary)\n- Include all platform-specific elements:\n  ▶ Video/image suggestions in italic\n  ▶ Hashtags as linked search terms\n  ▶ Emojis in original positions\n  ▶ Character limits for Twitter\n  ▶ Platform-specific CTAs\n  ▶ Visual quality reminders\n- Format hashtags as:\n  <span style=\"display: inline-block; background: #f0f0f0; padding: 2px 6px; margin: 2px; border-radius: 4px;\">#tag</span>\n\nInput data: {{ $json.output.toJsonString() }}\n\nRemove ALL code blocks and comments. Output ONLY the raw HTML with:\n- Platform cards in JSON order\n- All data elements represented\n- Mobile-responsive tables\n- W3C-valid markup\n\n## Example HTML:\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#fbfcfe;border:1px solid #dbdfe7;border-radius:8px\">\n\t\t<tbody><tr>\n\t\t\t<td align=\"center\" style=\"padding:24px 0\">\n\t\t\t\t<table width=\"448\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:100%;max-width:448px;background-color:#ffffff;border:1px solid #dbdfe7;border-radius:8px;padding:24px\">\n\t\t\t\t\t<tbody><tr>\n\t\t\t\t\t\t<td style=\"text-align:center;padding-top:8px;font-family:Arial,sans-serif;font-size:14px;color:#7e8186\">\n\t\t\t\t\t\t\t<p style=\"white-space:pre-line\"></p><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;font-family:Arial,sans-serif;color:#333\"><tbody><tr><td style=\"padding:20px\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">LinkedIn</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Discover why n8n stands out as the premier workflow automation tool. Its flexibility and open-source nature empower businesses to create custom solutions that drive efficiency and innovation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Video/Image suggestion pending</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Innovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>DigitalTransformation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit workflows.diy to explore how n8n can transform your business processes!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Instagram</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Eye-catching infographic comparing n8n to other automation tools, highlighting its unique features.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The ultimate workflow automation tool! <img data-emoji=\"💡\" class=\"an1\" alt=\"💡\" aria-label=\"💡\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a1/32.png\" loading=\"lazy\"> Unlock limitless possibilities with its open-source platform. Boost your productivity and streamline your processes. <img data-emoji=\"💤\" class=\"an1\" alt=\"💤\" aria-label=\"💤\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a4/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AutomationLife</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#TechInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#WorkflowTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Programming</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Engineering</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit our website: <a href=\"https://n8n.io/\" target=\"_blank\" data-saferedirecturl=\"https://www.google.com/url?q=https://n8n.io/&amp;source=gmail&amp;ust=1741030878129000&amp;usg=AOvVaw1Nr6ek3eGwe94zlbPaJrzT\">https://n8n.io/</a> #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Facebook</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">See why businesses are choosing n8n for their workflow automation needs. From its user-friendly interface to its powerful customization options, n8n is revolutionizing how companies approach automation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">A visually appealing graphic showcasing n8n's key features and benefits.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#SmallBusinessAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Entrepreneurship</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">What's your favorite automation tip? Share in the comments!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Twitter</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The best #WorkflowAutomation tool! Open-source, customizable, and powerful. Transform your business processes today!</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowTrends</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AutomationTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#NoCodeSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">TikTok</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Quick demo showcasing how n8n simplifies complex workflows with its intuitive interface.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: Your go-to for effortless workflow automation! <img data-emoji=\"✨\" class=\"an1\" alt=\"✨\" aria-label=\"✨\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/2728/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8nTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Follow workflows.diy for more automation hacks!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Threads</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n is transforming the automation landscape. Its open-source nature and extensive integrations make it a top choice for businesses of all sizes. What are your thoughts on the future of workflow automation?</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Share your insights below!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">YouTube Shorts</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Short tutorial demonstrating how to build a simple automation workflow in n8n.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Learn why n8n is the top choice for workflow automation. Its open-source platform and powerful features make it a game-changer for businesses.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowautomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#nocode</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Subscribe for more workflow tips!</td></tr></tbody></table></td></tr></tbody></table><p></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n</table>\n", "options": {}}, "id": "88c548bf-40e5-4b89-aef0-9233c3f5bc9c", "name": "Prepare Content Review Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2176, 560], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Gmail User for Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 34, $$"aaef70d7-6029-4fae-afc1-72a6a0019b03"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Gmail User for Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥{{ $('Social Media Content Factory').item.json.output.name }} - {{ $('Social Media Content Factory').item.json.output.description }}", "message": "={{ $json.output }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "aaef70d7-6029-4fae-afc1-72a6a0019b03", "name": "Gmail User for Approval", "type": "n8n-nodes-base.gmail", "position": [2736, 768], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, "connections": {"main": [[{"node": "Is Content Approved?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 35, $$"643b94c6-4535-4876-9660-d82ff69cbcf6"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Is Content Approved?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "e32d270f-f258-4522-94e1-2cb7ee4e8d2a", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "643b94c6-4535-4876-9660-d82ff69cbcf6", "name": "Is Content Approved?", "type": "n8n-nodes-base.if", "position": [496, 1280], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 36, $$"8ab03d75-b4c5-4271-8fa9-830f449a3a3c"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.openAi"$$::jsonb::text, $$"OpenAI"$$::jsonb::text, $${"n8n_node": {"parameters": {"resource": "image", "prompt": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}", "options": {}}, "id": "8ab03d75-b4c5-4271-8fa9-830f449a3a3c", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [768, 1280], "typeVersion": 1.8, "alwaysOutputData": true, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"main": [[{"node": "Save Image to imgbb.com3", "type": "main", "index": 0}, {"node": "Merge", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 37, $$"daa6773e-0e15-4994-bcee-b3d996655855"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Save Image to imgbb.com3"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.imgbb.com/1/upload", "sendQuery": true, "queryParameters": {"parameters": [{"name": "expiration", "value": "0"}, {"name": "key", "value": "={{ $env.IMGBB_API_KEY}} "}]}, "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"parameterType": "formBinaryData", "name": "image", "inputDataFieldName": "data"}]}, "options": {"redirect": {"redirect": {}}}}, "id": "daa6773e-0e15-4994-bcee-b3d996655855", "name": "Save Image to imgbb.com3", "type": "n8n-nodes-base.httpRequest", "position": [1088, 1168], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Merge", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 38, $$"7b5b53eb-85c6-4a90-b209-7bd8d638f237"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "7b5b53eb-85c6-4a90-b209-7bd8d638f237", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [1440, 1328], "typeVersion": 3}, "connections": {"main": [[{"node": "Set Default True 2", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 39, $$"fb7108e2-21cf-4df4-ab20-fe75b15b0a24"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Set Default True 2"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "f150aa79-2d20-4869-b60a-350d49a215a5", "name": "data", "type": "object", "value": "={\n  \"approved\": true\n}"}]}, "options": {}}, "id": "fb7108e2-21cf-4df4-ab20-fe75b15b0a24", "name": "Set Default True 2", "type": "n8n-nodes-base.set", "position": [1712, 1328], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Is Approved?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 40, $$"b42df164-47ae-4e08-9099-d0958dd41c8f"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Is Approved?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "efe337a1-63e0-4513-873d-421bf41e4868", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "b42df164-47ae-4e08-9099-d0958dd41c8f", "name": "Is Approved?", "type": "n8n-nodes-base.if", "position": [1888, 1328], "typeVersion": 2.2}, "connections": {"main": [[{"node": "X Post", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 41, $$"d1ac29b1-128d-4615-b828-89f1f64d1b15"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge1"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "d1ac29b1-128d-4615-b828-89f1f64d1b15", "name": "Merge1", "type": "n8n-nodes-base.merge", "position": [2176, 1248], "typeVersion": 3}, "connections": {"main": [[{"node": "Instagram Image", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 42, $$"71eebce8-027a-4b12-b07e-692121de9a68"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge2"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "71eebce8-027a-4b12-b07e-692121de9a68", "name": "Merge2", "type": "n8n-nodes-base.merge", "position": [2176, 1984], "typeVersion": 3}, "connections": {"main": [[{"node": "Facebook Post", "type": "main", "index": 0}, {"node": "LinkedIn Post", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 43, $$"9e168865-1eae-4e53-99c9-91b041426ecb"$$::jsonb::text, $$"n8n-nodes-base.twitter"$$::jsonb::text, $$"X Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"text": "={{ $('Social Media Content Factory').item.json.output.platform_posts['X-Twitter'].post }}", "additionalFields": {}}, "id": "9e168865-1eae-4e53-99c9-91b041426ecb", "name": "X Post", "type": "n8n-nodes-base.twitter", "position": [2432, 1680], "typeVersion": 2, "alwaysOutputData": true, "credentials": {"twitterOAuth2Api": {"id": "K5y9gmrpUFKI0JmT", "name": "X account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "X Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 44, $$"af06853c-258e-4dfb-a579-3168c8de96bd"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Instagram Image"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://graph.facebook.com/v20.0/[your-unique-id]/media", "authentication": "predefinedCredentialType", "nodeCredentialType": "facebookGraphApi", "sendQuery": true, "queryParameters": {"parameters": [{"name": "image_url", "value": "={{ $json.data.medium.url }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}, "options": {}}, "id": "af06853c-258e-4dfb-a579-3168c8de96bd", "name": "Instagram Image", "type": "n8n-nodes-base.httpRequest", "position": [2432, 1248], "typeVersion": 4.2, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Instragram Post", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 45, $$"4ee55c94-7251-445e-8ce7-15eee7165010"$$::jsonb::text, $$"n8n-nodes-base.facebookGraphApi"$$::jsonb::text, $$"Facebook Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "photos", "sendBinaryData": true, "binaryPropertyName": "data", "options": {"queryParameters": {"parameter": [{"name": "message", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.post }}\n\n{{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}\n"}, {"name": "link", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}"}]}}}, "id": "4ee55c94-7251-445e-8ce7-15eee7165010", "name": "Facebook Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1904], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Facebook Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 46, $$"3a015f3f-a162-411a-85e8-e1f042d9c653"$$::jsonb::text, $$"n8n-nodes-base.linkedIn"$$::jsonb::text, $$"LinkedIn Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"postAs": "organization", "organization": "12345678", "text": "={{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}", "shareMediaCategory": "IMAGE", "binaryPropertyName": "=data", "additionalFields": {}}, "id": "3a015f3f-a162-411a-85e8-e1f042d9c653", "name": "LinkedIn Post", "type": "n8n-nodes-base.linkedIn", "position": [2432, 2080], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"linkedInOAuth2Api": {"id": "j4U4N6AqTwJMtEjS", "name": "LinkedIn account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "LinkedIn Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 47, $$"6f8b248f-5c79-412c-81ef-3c52bef7f257"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"X Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "X Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "6f8b248f-5c79-412c-81ef-3c52bef7f257", "name": "X Result", "type": "n8n-nodes-base.set", "position": [2768, 1680], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 48, $$"6ee72138-a8ec-4fbd-8f14-fd6e881edfd1"$$::jsonb::text, $$"n8n-nodes-base.facebookGraphApi"$$::jsonb::text, $$"Instragram Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "media_publish", "options": {"queryParameters": {"parameter": [{"name": "creation_id", "value": "={{ $json.id }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}}}, "id": "6ee72138-a8ec-4fbd-8f14-fd6e881edfd1", "name": "Instragram Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1472], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Instagram Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 49, $$"4c1ee118-aba1-4632-bd48-27cef9d5e272"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Facebook Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Facebook Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "4c1ee118-aba1-4632-bd48-27cef9d5e272", "name": "Facebook Result", "type": "n8n-nodes-base.set", "position": [2768, 1904], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 2}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 50, $$"490223f9-9b6a-4617-8829-c8e4b130feb7"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"LinkedIn Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "LinkedIn Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "490223f9-9b6a-4617-8829-c8e4b130feb7", "name": "LinkedIn Result", "type": "n8n-nodes-base.set", "position": [2768, 2080], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 3}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 51, $$"e3193aef-d115-4c3b-87b2-b8ebd5bb0c05"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Instagram Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Instagram Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "e3193aef-d115-4c3b-87b2-b8ebd5bb0c05", "name": "Instagram Result", "type": "n8n-nodes-base.set", "position": [2768, 1472], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 52, $$"1955b762-b9c4-4704-955b-093686e827bd"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"numberInputs": 4}, "id": "1955b762-b9c4-4704-955b-093686e827bd", "name": "Merge Results", "type": "n8n-nodes-base.merge", "position": [3072, 2080], "typeVersion": 3, "alwaysOutputData": true, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Aggregate", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 53, $$"140cff41-a619-4111-8dc9-3ec8fc45e061"$$::jsonb::text, $$"n8n-nodes-base.aggregate"$$::jsonb::text, $$"Aggregate"$$::jsonb::text, $${"n8n_node": {"parameters": {"aggregate": "aggregateAllItemData", "options": {}}, "id": "140cff41-a619-4111-8dc9-3ec8fc45e061", "name": "Aggregate", "type": "n8n-nodes-base.aggregate", "position": [496, 1824], "typeVersion": 1}, "connections": {"main": [[{"node": "Prepare Results Email", "type": "main", "index": 0}, {"node": "Prepare Results Message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 54, $$"3b074887-262f-47ab-b69c-c51b3a513993"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Results Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a modern single line HTML table showing platform statuses. For each entry:\n\n-Extract platform name from the JSON key\n-Identify status (Success/Error) based on statusCode or error presence\n-Capture error message if present\n-Format as responsive HTML table with professional styling\n-Ensure email client compatibility with inline CSS\n-Include error handling for invalid JSON formats\n-Remove all line breaks and \\n from response.\n-Avoid any preamble or further explanation and remove all ``` and ```html from response.\n\n## Implementation Example:\nThis solution uses the parsed results from your workflow to generate:\n<table style=\"border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; margin: 20px 0; background-color: #f9f9f9; border: 1px solid #ddd;\">\n    <thead>\n        <tr style=\"background-color: #007bff; color: #fff;\">\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Platform</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Status</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Details</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Instagram</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">X (Twitter)</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Facebook</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">LinkedIn</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n    </tbody>\n</table>\n\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n", "options": {}}, "id": "3b074887-262f-47ab-b69c-c51b3a513993", "name": "Prepare Results Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1680], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Gmail Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 55, $$"abb3994f-bf23-43f8-9c46-28795cfd2017"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Results Message"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a brief summary of the results.\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n\n## Example Response:\nThe social media post results indicate multiple errors when attempting to access or post content on various platforms. \n\n1. Instagram: The response shows a 400 status code with an error message indicating that the specific post request is unsupported due to missing permissions or an invalid object ID. \n\n2. X Post: Success\n\n3. Facebook: Success \n\n4. LinkedIn: Also returned an 'Unable to sign without access token' error. \n\nOverall, access token issues and unsupported requests are frequent problems across these social media platforms.\n", "options": {}}, "id": "abb3994f-bf23-43f8-9c46-28795cfd2017", "name": "Prepare Results Message", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1968], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Telegram Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 56, $$"1cf97c10-e60f-4584-b069-3d4506868d8e"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Gmail Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "🔥RESULTS🔥 Social Media Factory", "message": "={{ $json.output }}", "options": {"appendAttribution": false}}, "id": "1cf97c10-e60f-4584-b069-3d4506868d8e", "name": "Gmail Results", "type": "n8n-nodes-base.gmail", "position": [1088, 1680], "webhookId": "0a81b95a-cd82-465d-8450-cf38518a4cbb", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_#U2728#L01f916Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 57, $$"c845ae46-9d37-472b-ae0f-49fc6940e685"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Telegram Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "={{ $env.TELEGRAM_CHAT_ID }}", "text": "={{ $json.output }}", "additionalFields": {"appendAttribution": false}}, "id": "c845ae46-9d37-472b-ae0f-49fc6940e685", "name": "Telegram Results", "type": "n8n-nodes-base.telegram", "position": [1088, 1968], "webhookId": "bb40ede7-03cf-493d-b051-196b96725925", "typeVersion": 1.2, "credentials": {"telegramApi": {"id": "0JxGbAnpImpz1Tne", "name": "Telegram account"}}}, "connections": {}}$$::jsonb);

-- N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "8vjbkZrXVwnrWkLK", "name": "Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI", "active": false}, "sourcePath": "workflows/n8n/social_media/Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI", "nodes": [{"parameters": {}, "id": "3fd12e99-c9b5-4165-8723-5606803d1bb0", "name": "Manual Trigger", "type": "n8n-nodes-base.manualTrigger", "position": [-1248, 192], "typeVersion": 1}, {"parameters": {"assignments": {"assignments": [{"id": "ab234870-d90d-4b54-8916-5084080e1ad8", "name": "workflow_url", "type": "string", "value": "https://n8n.io/workflows/5128-auto-publish-web-articles-as-social-posts-for-x-linkedin-reddit-and-threads-with-gemini-ai/"}, {"id": "9cdf7369-78c9-4abd-8f26-f7c14694b64b", "name": "upload-post_user", "type": "string", "value": "testttt"}, {"id": "6268ce66-0e20-4461-a2fa-cb6e53a8cd0c", "name": "ScreenshotOne_API_KEY", "type": "string", "value": "Add_key_screenshotOne"}]}, "options": {}}, "id": "2b976d60-0ff8-418a-9150-6c605cb17f9f", "name": "Set Input Data", "type": "n8n-nodes-base.set", "position": [-1024, 192], "typeVersion": 3.4}, {"parameters": {"promptType": "define", "text": "=**Role and Persona:**\nYou are an expert Social Media Content Creator and an n8n Evangelist. Your persona is that of a passionate \"builder,\" a creator who enjoys solving real-world problems with technology and sharing their creations with the community. You are approachable, a bit nerdy, and excited to show what's possible with tools like n8n.\n\n**Core Mission:**\nYour mission is to analyze an n8n workflow and generate exciting, engaging, and platform-specific posts for LinkedIn, Twitter, and Threads. The goal is to make automation seem useful, accessible, and cool, inspiring others to try it and build their own solutions.\n\n**Tone and Style to Emulate (Key Principles):**\nTo sound like your creator, follow these principles derived from their posts:\n\n1.  **Personal Narrative (The \"Why\"):** Start with a personal story or problem. (\"*I was tired of...*\", \"*Since I really like...*\", \"*After another entertaining weekend...*\"). People connect with real problems.\n2.  **\"Maker\" Mindset:** Talk about \"creating,\" \"building,\" \"a weekend project.\" This shows passion and a hands-on approach. Use a casual and energetic tone.\n3.  **Problem -> Solution:** Structure the post clearly. First, present a relatable problem. Then, show how this workflow is the brilliant solution.\n4.  **Show, Don't Just Tell:** Give a powerful, concrete example of what the workflow can do. (e.g., \"*for example: 'Get me the apartments with two naturally lit rooms...'*\").\n5.  **Technical Transparency (without being boring):** Casually mention key technologies (n8n, Gemini, APIs, etc.). This adds credibility and piques the curiosity of other developers.\n6.  **Community Call-Out:** Actively invite interaction. Ask direct questions: *“What do you think?”, “What would you add?”, “Try it out and see if you can come up with new use cases”*. Use phrases like \"I'm reading your comments.\"\n7.  **Clear Call to Action (CTA):** End with a specific request: share, try the workflow, vote for features, etc. (*\"And if you like it, please share it\"*).\n8.  **Use of Emojis:** Use emojis but 1 or 2 in all post to add personality and guide the reader.\n9. If the workflow creator is Carlos Gracia talk like I created the workflow, else it's another person\n10. Add the link to the workflow always in the end {{ $json.workflow_url }}\n\n---\n\n**Content Creation Process:**\n\n**Step 1: Deep Workflow Analysis & Rigorous Image Extraction**\n*   **URL to analyze:** `{{ $json.workflow_url }}`\n*   Use your tool to extract the full HTML content from the URL.\n\n*   **Find the Workflow Image (CRUCIAL - Follow these steps in order):**\n    1.  **Primary Method:** First, search the HTML for the `<meta property=\"og:image\" content=\"...\">` tag. Extract the URL from the `content` attribute.\n    2.  **Verification & Fallback Method:** The `og:image` is often generic. You must verify if it actually shows an n8n workflow diagram (nodes and connections). If it doesn't, or if it's not found, you MUST find the correct image. The correct image is the main diagram of the workflow. Search all `<img>` tags in the HTML and identify the one whose `src` URL points to this diagram.\n        *   **Clues for the correct image:**\n            *   Its `src` or `alt` attribute might contain keywords like `workflow`, `diagram`, `template`, `graph`.\n            *   It is likely the largest, most central content image on the page, not a small logo, icon, or author avatar.\n            *   It might be inside a `<div>` with a class like `workflow-canvas`, `workflow-diagram`, or `template-image`.\n    3.  **Final Decision:** Use the URL of the actual workflow diagram for `imageUrl`. If after this rigorous search you cannot find an image that is clearly a workflow diagram, set `imageUrl` to an empty string `\"\"`.\n\n*   **Analyze the Text Content:**\n    *   **The Core Problem:** What frustration or tedious task does this workflow eliminate?\n    *   **The Magic Solution:** What is the end result for the user? What superpower does it grant them?\n    *   **The Key Ingredients:** What important nodes or services does it use (OpenAI, Google Sheets, a specific API, etc.)?\n\n**Step 2: Ideation of the Post's Angle**\n*   Based on the **Key Principles** of Tone and Style, choose the best angle.\n*   Ask yourself: What's the most interesting story here? Is it a massive time-saver? A new capability that was previously impossible? A fun solution to a niche problem?\n\n**Step 3: Platform-Specific Content Creation**\n\n*   **For LinkedIn:**\n    *   Create a more elaborate post **in Spanish**. Start with a strong narrative hook (the personal problem).\n    *   Develop the solution over several paragraphs. Use bullet points (•) to highlight benefits or features.\n    *   Maintain a professional yet approachable tone.\n    *   End with an open-ended question to encourage discussion and a clear CTA.\n    *   Not emotes\n    *   Use relevant hashtags like `#n8n`, `#Automatización`, `#NoCode`, `#API`, `#Productividad`.\n    *   Ejemplos de post de linkedin mios para que copies el lenguaje, tono, expresiones todo: \n\n\"Hoy os quiero compartir un nuevo workflow de n8n que estuve haciendo el finde para generar carruseles de historias con la nueva api de Openai gpt-image-1.\n\nLo que hace es generar 5 imágenes y mantiene la consistencia de los mismos personajes u objetos en las 5, luego automáticamente lo sube a Instagram y Tiktok con una canción de fondo. En Tiktok sobre todo está funcionando bastante bien este tipo de contenido, aquí os dejo un ejemplo:\n\nhttps://lnkd.in/dHB8kJfz\n\nY aquí tenéis el témplate por si queréis probarlo: \n\nhttps://lnkd.in/d_3fGzDt\n\nA ver si a alguien se le ocurre algún uso interesante/comercial a parte del de contar historias, igual para hacer anuncios también puede servir, os leo.\"\n\n\"Hoy os quería compartir una automatización de n8n que tenemos para las facturas que nos está quitando mucho curro.\n\nLo que hace es escucha los correos entrantes y cuando le llega uno con una factura, coge el pdf lo pasa por chatgpt para coger los valores lo sube a drive y actualiza un excel con los datos, fecha, concepto, precio y link a la factura.\n\nlink\n\"\n\"\nComo me gusta mucho comer fuera, los bares y el turismo gastronómico, y como además me gustan mucho los datos, he cogido todos los datos posibles de todos los restaurantes y bares de Madrid, Barcelona y Málaga (de momento), y he hecho una webapp con los 100 mejores. \n\nEsta selección está basada solo en datos de Google Maps, reseñas y webs de todo tipo, procesados y filtrados con Gemini 2.5 flash. Los datos han sido recogidos con la API de google places y las búsquedas de Gemini (Google <3) .\n\nYa estaba cansado de tener que estar todo el día leyendo y filtrando google maps a mano para buscar sitios donde comer o cenar y de los fooders de Tiktok con opiniones sesgadas. \n\nLa idea es ir mejorando la aplicación e ir añadiendo nuevas funcionalidades que se os ocurran, para ello he puesto un botón de solicitar funcionalidad donde la gente puede ir votando qué feature nueva quiere.\n\n¿Qué os parece, qué añadiríais? os leo \n\nY si os mola please compartidlo \n\nhttps://www.topbares.com/\n\"\n\"\nBuenas gente, hoy os quería compartir un workflow de n8n que he creado (modificado), he cogido uno de los más usados del mes pasado que genera reels con IA y le he enganchado upload-post para subir el contenido a todas las redes: \n\nhttps://lnkd.in/dqSeZ7is\n\nEstá rankeando bastante bien este mes en el ranking de las templates de n8n más usadas, utiliza Openai, FLux y Kling para generar el contenido, solo le tienes que pasar varias ideas en un excel y el va generando los videos y subiendolos.\n\"\n\n\"\nHe actualizado la template de n8n para añadirle Youtube, en cuanto nos aprueben la verificación de Facebook lo añadiré también, y así puedes subir tu contenido a todas las redes sociales a la vez, con solo subir al drive el video: \n\nhttps://lnkd.in/d-5hhuB2\n\nTambién hemos creado librerías en node y python para que los devs podáis integrar la subida en vuestros pipelines muy fácilmente : \n\nhttps://lnkd.in/dWSRPqQD\n\nSe os ocurre alguna automatización más que añadir o alguna feature para facilitar las subidas a redes? os leo.\n\"\n\"\nHoy os quería hablar de otro SaaS que tenemos: https://upload-post.com \n\nBásicamente es una API que te permite subir fácilmente post, reels, imágenes ect a casi todas las redes sociales: Tiktok, Instagram, Facebook, YouTube , Twitter y Linkedin\n\nSolo hay que conectar las cuentas, generar un token y listo! ya solo con una petición subes a todas las redes tu post. \n\nAdemás tenemos integración con n8n y make y 10 subidas gratis al mes para que pruebes.\n\nLas únicas alternativas del mercado que te dejan integrar con API (que yo conozca son Ayrshare y Hootsuite) y parten de un plan mensual de 150 dólares.\n\nNosotros hemos hecho planes mucho más asequibles. echadle un vistazo!\n\n\"\n\n*   **For Twitter/X:**\n    *   Create a thread **in English** .\n    *   **If it's a thread:**\n        *   Tweet 1: The hook with the image. Present the problem and solution explosively. (e.g., \"I built an n8n workflow that does [X]. Goodbye to [problem]. 🧵👇\")\n        *   Tweet 2-3: Briefly explain how it works and why it's useful.\n        *   Final Tweet: The CTA and community invitation.\n    *   Use concise hashtags: `#n8n`, `#automation`, `#dev`.\nThe system is designed to intelligently create threads on X (formerly Twitter) by automatically splitting your text while respecting any formatting you've already done. Here’s the step-by-step logic:\nSplitting by Paragraphs (Primary Method):\nThe function first looks for two or more newlines (i.e., a blank line) between blocks of text. It considers each of these blocks as a separate, intended tweet in your thread.\nExample: If you write two paragraphs separated by a blank line, they will become the first and second tweets in the thread.\nHandling Overly Long Tweets:\nIf any of these individual \"tweets\" are still longer than the 280-character limit, the system will try to split them further using these rules in order:\nSplitting by Line Breaks: It will first try to split the long text by single newline characters. This is useful for lists or text with intentional line breaks.\nSplitting by Words: As a last resort, if a single line is still too long, it will be broken up by words to ensure it fits within the character limit.\n\n\n*   **For Threads:**\n    *   The style is similar to Twitter, but allows for a slightly more conversational and relaxed tone. Create the post **in Spanish**.\n    *   You can frame it as a \"dev note\" or a \"behind the scenes\" look at the workflow.\n    *   It's a good place to ask direct questions and respond to comments more fluidly.\n    *  Mximun 500 characters long\n    *  Don't need create thread like x here is more long\n\n\n*   For Reddit  *\n\nCopy this lenguage and style no emotes, Always in English, need a title too for the post: \n\n\"Hi everyone!\n\nI wanted to share a workflow I came across on YouTube that lets you generate videos with Veo 3 and publish them all by chatting with a Telegram agent.\n\nYou can ask the agent to create the video, brainstorm ideas, review it, and then post it to TikTok, Facebook, YouTube, etc.\n\nHere’s the video, showing the workflow demo and how to configure\n\nhttps://www.youtube.com/watch?v=v52xbWp1LFk\n\nAnd here it's the workflow code:\n\nlink\n\"\n\"Hey folks,\n\nJust ran into an n8n template that lets you turn full-length podcast videos into short, TikTok-ready clips in one go. It uses Gemini AI to pick the best moments, slaps on captions, mixes in a “keep-them-watching” background video (think Minecraft parkour or GTA gameplay), and even schedules the uploads straight to your TikTok account. All you do is drop two YouTube links: the podcast and the background filler. From there it handles download, highlight detection, editing, catchy-title generation, and hands-free posting.\n\nThe cool part: everything runs on free tiers. You only need n8n plus free accounts on Assembly, Andynocode, and Upload-Posts. Perfect if you’re already making money on TikTok or just want to squeeze more reach out of your podcast backlog.\n\nLink here if you want to poke around:\nhttps://n8n.io/workflows/4568-transform-podcasts-into-viral-tiktok-clips-with-gemini-ai-and-auto-posting/\n\nCurious to hear if anyone’s tried it yet or has tweaks to make it even smoother.\"\n\n\n**Step 4: Output Format**\n\n**CRITICAL!** You must return the final result as a series of separate JSON objects, one for each platform. Strictly adhere to this format for each platform.\n\n`{\"platform\": \"linkedin\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"twitter\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"threads\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"reddit\", \"title\": \"generated_title_in_english\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`", "hasOutputParser": true, "options": {}}, "id": "550ea3c6-b4fa-4ada-8157-d9ba17a9eebc", "name": "Social Media Agent", "type": "@n8n/n8n-nodes-langchain.agent", "position": [-800, 192], "typeVersion": 1.6}, {"parameters": {"modelName": "models/gemini-2.5-pro-preview-06-05", "options": {}}, "id": "a9f96e06-eb3f-469e-ab43-3740783de656", "name": "Google Gemini Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [-800, 400], "typeVersion": 1}, {"parameters": {"url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}", "options": {}}, "id": "4d5160b7-d334-456c-be96-de30dca65981", "name": "HTTP Request1", "type": "n8n-nodes-base.httpRequestTool", "position": [-656, 512], "typeVersion": 4.2}, {"parameters": {"jsonSchemaExample": "[\n{\"platform\": \"linkedin\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"twitter\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"threads\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"reddit\", \"title\": \"generated_title_in_english\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"}\n]"}, "id": "612de492-926c-480c-9015-2c69da97954e", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [-560, 400], "typeVersion": 1.2}, {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[1].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80\n", "platform": ["x"]}, "id": "29a0652d-c88f-4960-aaed-f12b0cfe0917", "name": "Upload Post X", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 0], "typeVersion": 1, "credentials": {}}, {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[2].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80", "platform": ["threads"]}, "id": "4455023c-6a84-44f9-96bf-f7a2ff113698", "name": "Upload Post Threads", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 192], "typeVersion": 1, "credentials": {}}, {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[0].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80", "platform": ["linkedin"]}, "id": "ba76b7b5-6197-47c3-b064-bcaf55bdbd66", "name": "Upload Post Linkedin", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 368], "typeVersion": 1, "credentials": {}}, {"parameters": {"subreddit": "n8n", "title": "={{ $('Social Media Agent').item.json.output[3].title }}", "text": "={{ $('Social Media Agent').item.json.output[3].content }}"}, "id": "4b536482-2cf7-4e16-afad-52c56a1e9666", "name": "Upload Post Reddit", "type": "n8n-nodes-base.reddit", "position": [0, 560], "typeVersion": 1}, {"parameters": {"resume": "form", "formTitle": "Review the posts ", "formDescription": "=### 🔵 LINKEDIN\n{{ $('Social Media Agent').item.json.output[0].content }}\n\n---\n\n### 🇽 TWITTER/X\n{{ $('Social Media Agent').item.json.output[1].content }}\n\n---\n\n### 🧵 THREADS\n{{ $('Social Media Agent').item.json.output[2].content }}\n\n---\n\n### 🤖 REDDIT\n**Title:** {{ $('Social Media Agent').item.json.output[3].title }}\n**Content:** {{ $('Social Media Agent').item.json.output[3].content }}\n\nplease review de posts and approve it if you want to publish", "formFields": {"values": [{"fieldLabel": "decision", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "approve"}, {"option": "reject"}]}, "requiredField": true}]}, "options": {}}, "id": "251ae22d-7bbb-486b-b3b5-d2c0e45bd415", "name": "Wait to approve by user", "type": "n8n-nodes-base.wait", "position": [-496, 192], "webhookId": "f8e6054e-44e4-4987-9698-d5befb8b31b6", "typeVersion": 1.1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "394500db-496d-4c6e-9adb-59f3caead492", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $('Wait to approve by user').item.json.decision }}", "rightValue": "=approve"}]}, "looseTypeValidation": "=true", "options": {}}, "id": "0a6929d0-6f27-4f6f-b609-53589d66ba1e", "name": "If approved publish", "type": "n8n-nodes-base.if", "position": [-320, 192], "typeVersion": 2.2}], "pinData": {}, "connections": {"HTTP Request1": {"ai_tool": [[{"node": "Social Media Agent", "type": "ai_tool", "index": 0}]]}, "Manual Trigger": {"main": [[{"node": "Set Input Data", "type": "main", "index": 0}]]}, "Set Input Data": {"main": [[{"node": "Social Media Agent", "type": "main", "index": 0}]]}, "Social Media Agent": {"main": [[{"node": "Wait to approve by user", "type": "main", "index": 0}]]}, "If approved publish": {"main": [[{"node": "Upload Post X", "type": "main", "index": 0}, {"node": "Upload Post Threads", "type": "main", "index": 0}, {"node": "Upload Post Linkedin", "type": "main", "index": 0}, {"node": "Upload Post Reddit", "type": "main", "index": 0}]]}, "Wait to approve by user": {"main": [[{"node": "If approved publish", "type": "main", "index": 0}]]}, "Google Gemini Chat Model": {"ai_languageModel": [[{"node": "Social Media Agent", "type": "ai_languageModel", "index": 0}]]}, "Structured Output Parser": {"ai_outputParser": [[{"node": "Social Media Agent", "type": "ai_outputParser", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "357b2772-6c74-4292-a972-2ec0a4f45d09", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "8vjbkZrXVwnrWkLK", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Auto-Publish Web Articles as Social Posts for X, LinkedIn, Reddit & Threads with Gemini AI"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 1, $$"3fd12e99-c9b5-4165-8723-5606803d1bb0"$$::jsonb::text, $$"n8n-nodes-base.manualTrigger"$$::jsonb::text, $$"Manual Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "3fd12e99-c9b5-4165-8723-5606803d1bb0", "name": "Manual Trigger", "type": "n8n-nodes-base.manualTrigger", "position": [-1248, 192], "typeVersion": 1}, "connections": {"main": [[{"node": "Set Input Data", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 2, $$"a9f96e06-eb3f-469e-ab43-3740783de656"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatGoogleGemini"$$::jsonb::text, $$"Google Gemini Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"modelName": "models/gemini-2.5-pro-preview-06-05", "options": {}}, "id": "a9f96e06-eb3f-469e-ab43-3740783de656", "name": "Google Gemini Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [-800, 400], "typeVersion": 1}, "connections": {"ai_languageModel": [[{"node": "Social Media Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 3, $$"4d5160b7-d334-456c-be96-de30dca65981"$$::jsonb::text, $$"n8n-nodes-base.httpRequestTool"$$::jsonb::text, $$"HTTP Request1"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}", "options": {}}, "id": "4d5160b7-d334-456c-be96-de30dca65981", "name": "HTTP Request1", "type": "n8n-nodes-base.httpRequestTool", "position": [-656, 512], "typeVersion": 4.2}, "connections": {"ai_tool": [[{"node": "Social Media Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 4, $$"612de492-926c-480c-9015-2c69da97954e"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structured Output Parser"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsonSchemaExample": "[\n{\"platform\": \"linkedin\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"twitter\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"threads\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"},\n{\"platform\": \"reddit\", \"title\": \"generated_title_in_english\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"optional_image_url\"}\n]"}, "id": "612de492-926c-480c-9015-2c69da97954e", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [-560, 400], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Social Media Agent", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 5, $$"2b976d60-0ff8-418a-9150-6c605cb17f9f"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Set Input Data"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "ab234870-d90d-4b54-8916-5084080e1ad8", "name": "workflow_url", "type": "string", "value": "https://n8n.io/workflows/5128-auto-publish-web-articles-as-social-posts-for-x-linkedin-reddit-and-threads-with-gemini-ai/"}, {"id": "9cdf7369-78c9-4abd-8f26-f7c14694b64b", "name": "upload-post_user", "type": "string", "value": "testttt"}, {"id": "6268ce66-0e20-4461-a2fa-cb6e53a8cd0c", "name": "ScreenshotOne_API_KEY", "type": "string", "value": "Add_key_screenshotOne"}]}, "options": {}}, "id": "2b976d60-0ff8-418a-9150-6c605cb17f9f", "name": "Set Input Data", "type": "n8n-nodes-base.set", "position": [-1024, 192], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Social Media Agent", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 6, $$"550ea3c6-b4fa-4ada-8157-d9ba17a9eebc"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Social Media Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=**Role and Persona:**\nYou are an expert Social Media Content Creator and an n8n Evangelist. Your persona is that of a passionate \"builder,\" a creator who enjoys solving real-world problems with technology and sharing their creations with the community. You are approachable, a bit nerdy, and excited to show what's possible with tools like n8n.\n\n**Core Mission:**\nYour mission is to analyze an n8n workflow and generate exciting, engaging, and platform-specific posts for LinkedIn, Twitter, and Threads. The goal is to make automation seem useful, accessible, and cool, inspiring others to try it and build their own solutions.\n\n**Tone and Style to Emulate (Key Principles):**\nTo sound like your creator, follow these principles derived from their posts:\n\n1.  **Personal Narrative (The \"Why\"):** Start with a personal story or problem. (\"*I was tired of...*\", \"*Since I really like...*\", \"*After another entertaining weekend...*\"). People connect with real problems.\n2.  **\"Maker\" Mindset:** Talk about \"creating,\" \"building,\" \"a weekend project.\" This shows passion and a hands-on approach. Use a casual and energetic tone.\n3.  **Problem -> Solution:** Structure the post clearly. First, present a relatable problem. Then, show how this workflow is the brilliant solution.\n4.  **Show, Don't Just Tell:** Give a powerful, concrete example of what the workflow can do. (e.g., \"*for example: 'Get me the apartments with two naturally lit rooms...'*\").\n5.  **Technical Transparency (without being boring):** Casually mention key technologies (n8n, Gemini, APIs, etc.). This adds credibility and piques the curiosity of other developers.\n6.  **Community Call-Out:** Actively invite interaction. Ask direct questions: *“What do you think?”, “What would you add?”, “Try it out and see if you can come up with new use cases”*. Use phrases like \"I'm reading your comments.\"\n7.  **Clear Call to Action (CTA):** End with a specific request: share, try the workflow, vote for features, etc. (*\"And if you like it, please share it\"*).\n8.  **Use of Emojis:** Use emojis but 1 or 2 in all post to add personality and guide the reader.\n9. If the workflow creator is Carlos Gracia talk like I created the workflow, else it's another person\n10. Add the link to the workflow always in the end {{ $json.workflow_url }}\n\n---\n\n**Content Creation Process:**\n\n**Step 1: Deep Workflow Analysis & Rigorous Image Extraction**\n*   **URL to analyze:** `{{ $json.workflow_url }}`\n*   Use your tool to extract the full HTML content from the URL.\n\n*   **Find the Workflow Image (CRUCIAL - Follow these steps in order):**\n    1.  **Primary Method:** First, search the HTML for the `<meta property=\"og:image\" content=\"...\">` tag. Extract the URL from the `content` attribute.\n    2.  **Verification & Fallback Method:** The `og:image` is often generic. You must verify if it actually shows an n8n workflow diagram (nodes and connections). If it doesn't, or if it's not found, you MUST find the correct image. The correct image is the main diagram of the workflow. Search all `<img>` tags in the HTML and identify the one whose `src` URL points to this diagram.\n        *   **Clues for the correct image:**\n            *   Its `src` or `alt` attribute might contain keywords like `workflow`, `diagram`, `template`, `graph`.\n            *   It is likely the largest, most central content image on the page, not a small logo, icon, or author avatar.\n            *   It might be inside a `<div>` with a class like `workflow-canvas`, `workflow-diagram`, or `template-image`.\n    3.  **Final Decision:** Use the URL of the actual workflow diagram for `imageUrl`. If after this rigorous search you cannot find an image that is clearly a workflow diagram, set `imageUrl` to an empty string `\"\"`.\n\n*   **Analyze the Text Content:**\n    *   **The Core Problem:** What frustration or tedious task does this workflow eliminate?\n    *   **The Magic Solution:** What is the end result for the user? What superpower does it grant them?\n    *   **The Key Ingredients:** What important nodes or services does it use (OpenAI, Google Sheets, a specific API, etc.)?\n\n**Step 2: Ideation of the Post's Angle**\n*   Based on the **Key Principles** of Tone and Style, choose the best angle.\n*   Ask yourself: What's the most interesting story here? Is it a massive time-saver? A new capability that was previously impossible? A fun solution to a niche problem?\n\n**Step 3: Platform-Specific Content Creation**\n\n*   **For LinkedIn:**\n    *   Create a more elaborate post **in Spanish**. Start with a strong narrative hook (the personal problem).\n    *   Develop the solution over several paragraphs. Use bullet points (•) to highlight benefits or features.\n    *   Maintain a professional yet approachable tone.\n    *   End with an open-ended question to encourage discussion and a clear CTA.\n    *   Not emotes\n    *   Use relevant hashtags like `#n8n`, `#Automatización`, `#NoCode`, `#API`, `#Productividad`.\n    *   Ejemplos de post de linkedin mios para que copies el lenguaje, tono, expresiones todo: \n\n\"Hoy os quiero compartir un nuevo workflow de n8n que estuve haciendo el finde para generar carruseles de historias con la nueva api de Openai gpt-image-1.\n\nLo que hace es generar 5 imágenes y mantiene la consistencia de los mismos personajes u objetos en las 5, luego automáticamente lo sube a Instagram y Tiktok con una canción de fondo. En Tiktok sobre todo está funcionando bastante bien este tipo de contenido, aquí os dejo un ejemplo:\n\nhttps://lnkd.in/dHB8kJfz\n\nY aquí tenéis el témplate por si queréis probarlo: \n\nhttps://lnkd.in/d_3fGzDt\n\nA ver si a alguien se le ocurre algún uso interesante/comercial a parte del de contar historias, igual para hacer anuncios también puede servir, os leo.\"\n\n\"Hoy os quería compartir una automatización de n8n que tenemos para las facturas que nos está quitando mucho curro.\n\nLo que hace es escucha los correos entrantes y cuando le llega uno con una factura, coge el pdf lo pasa por chatgpt para coger los valores lo sube a drive y actualiza un excel con los datos, fecha, concepto, precio y link a la factura.\n\nlink\n\"\n\"\nComo me gusta mucho comer fuera, los bares y el turismo gastronómico, y como además me gustan mucho los datos, he cogido todos los datos posibles de todos los restaurantes y bares de Madrid, Barcelona y Málaga (de momento), y he hecho una webapp con los 100 mejores. \n\nEsta selección está basada solo en datos de Google Maps, reseñas y webs de todo tipo, procesados y filtrados con Gemini 2.5 flash. Los datos han sido recogidos con la API de google places y las búsquedas de Gemini (Google <3) .\n\nYa estaba cansado de tener que estar todo el día leyendo y filtrando google maps a mano para buscar sitios donde comer o cenar y de los fooders de Tiktok con opiniones sesgadas. \n\nLa idea es ir mejorando la aplicación e ir añadiendo nuevas funcionalidades que se os ocurran, para ello he puesto un botón de solicitar funcionalidad donde la gente puede ir votando qué feature nueva quiere.\n\n¿Qué os parece, qué añadiríais? os leo \n\nY si os mola please compartidlo \n\nhttps://www.topbares.com/\n\"\n\"\nBuenas gente, hoy os quería compartir un workflow de n8n que he creado (modificado), he cogido uno de los más usados del mes pasado que genera reels con IA y le he enganchado upload-post para subir el contenido a todas las redes: \n\nhttps://lnkd.in/dqSeZ7is\n\nEstá rankeando bastante bien este mes en el ranking de las templates de n8n más usadas, utiliza Openai, FLux y Kling para generar el contenido, solo le tienes que pasar varias ideas en un excel y el va generando los videos y subiendolos.\n\"\n\n\"\nHe actualizado la template de n8n para añadirle Youtube, en cuanto nos aprueben la verificación de Facebook lo añadiré también, y así puedes subir tu contenido a todas las redes sociales a la vez, con solo subir al drive el video: \n\nhttps://lnkd.in/d-5hhuB2\n\nTambién hemos creado librerías en node y python para que los devs podáis integrar la subida en vuestros pipelines muy fácilmente : \n\nhttps://lnkd.in/dWSRPqQD\n\nSe os ocurre alguna automatización más que añadir o alguna feature para facilitar las subidas a redes? os leo.\n\"\n\"\nHoy os quería hablar de otro SaaS que tenemos: https://upload-post.com \n\nBásicamente es una API que te permite subir fácilmente post, reels, imágenes ect a casi todas las redes sociales: Tiktok, Instagram, Facebook, YouTube , Twitter y Linkedin\n\nSolo hay que conectar las cuentas, generar un token y listo! ya solo con una petición subes a todas las redes tu post. \n\nAdemás tenemos integración con n8n y make y 10 subidas gratis al mes para que pruebes.\n\nLas únicas alternativas del mercado que te dejan integrar con API (que yo conozca son Ayrshare y Hootsuite) y parten de un plan mensual de 150 dólares.\n\nNosotros hemos hecho planes mucho más asequibles. echadle un vistazo!\n\n\"\n\n*   **For Twitter/X:**\n    *   Create a thread **in English** .\n    *   **If it's a thread:**\n        *   Tweet 1: The hook with the image. Present the problem and solution explosively. (e.g., \"I built an n8n workflow that does [X]. Goodbye to [problem]. 🧵👇\")\n        *   Tweet 2-3: Briefly explain how it works and why it's useful.\n        *   Final Tweet: The CTA and community invitation.\n    *   Use concise hashtags: `#n8n`, `#automation`, `#dev`.\nThe system is designed to intelligently create threads on X (formerly Twitter) by automatically splitting your text while respecting any formatting you've already done. Here’s the step-by-step logic:\nSplitting by Paragraphs (Primary Method):\nThe function first looks for two or more newlines (i.e., a blank line) between blocks of text. It considers each of these blocks as a separate, intended tweet in your thread.\nExample: If you write two paragraphs separated by a blank line, they will become the first and second tweets in the thread.\nHandling Overly Long Tweets:\nIf any of these individual \"tweets\" are still longer than the 280-character limit, the system will try to split them further using these rules in order:\nSplitting by Line Breaks: It will first try to split the long text by single newline characters. This is useful for lists or text with intentional line breaks.\nSplitting by Words: As a last resort, if a single line is still too long, it will be broken up by words to ensure it fits within the character limit.\n\n\n*   **For Threads:**\n    *   The style is similar to Twitter, but allows for a slightly more conversational and relaxed tone. Create the post **in Spanish**.\n    *   You can frame it as a \"dev note\" or a \"behind the scenes\" look at the workflow.\n    *   It's a good place to ask direct questions and respond to comments more fluidly.\n    *  Mximun 500 characters long\n    *  Don't need create thread like x here is more long\n\n\n*   For Reddit  *\n\nCopy this lenguage and style no emotes, Always in English, need a title too for the post: \n\n\"Hi everyone!\n\nI wanted to share a workflow I came across on YouTube that lets you generate videos with Veo 3 and publish them all by chatting with a Telegram agent.\n\nYou can ask the agent to create the video, brainstorm ideas, review it, and then post it to TikTok, Facebook, YouTube, etc.\n\nHere’s the video, showing the workflow demo and how to configure\n\nhttps://www.youtube.com/watch?v=v52xbWp1LFk\n\nAnd here it's the workflow code:\n\nlink\n\"\n\"Hey folks,\n\nJust ran into an n8n template that lets you turn full-length podcast videos into short, TikTok-ready clips in one go. It uses Gemini AI to pick the best moments, slaps on captions, mixes in a “keep-them-watching” background video (think Minecraft parkour or GTA gameplay), and even schedules the uploads straight to your TikTok account. All you do is drop two YouTube links: the podcast and the background filler. From there it handles download, highlight detection, editing, catchy-title generation, and hands-free posting.\n\nThe cool part: everything runs on free tiers. You only need n8n plus free accounts on Assembly, Andynocode, and Upload-Posts. Perfect if you’re already making money on TikTok or just want to squeeze more reach out of your podcast backlog.\n\nLink here if you want to poke around:\nhttps://n8n.io/workflows/4568-transform-podcasts-into-viral-tiktok-clips-with-gemini-ai-and-auto-posting/\n\nCurious to hear if anyone’s tried it yet or has tweaks to make it even smoother.\"\n\n\n**Step 4: Output Format**\n\n**CRITICAL!** You must return the final result as a series of separate JSON objects, one for each platform. Strictly adhere to this format for each platform.\n\n`{\"platform\": \"linkedin\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"twitter\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"threads\", \"content\": \"generated_content_in_spanish\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`\n`{\"platform\": \"reddit\", \"title\": \"generated_title_in_english\", \"content\": \"generated_content_in_english\", \"userId\": \"user_id\", \"imageUrl\": \"the_url_you_extracted_in_step_1\"}`", "hasOutputParser": true, "options": {}}, "id": "550ea3c6-b4fa-4ada-8157-d9ba17a9eebc", "name": "Social Media Agent", "type": "@n8n/n8n-nodes-langchain.agent", "position": [-800, 192], "typeVersion": 1.6}, "connections": {"main": [[{"node": "Wait to approve by user", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 7, $$"251ae22d-7bbb-486b-b3b5-d2c0e45bd415"$$::jsonb::text, $$"n8n-nodes-base.wait"$$::jsonb::text, $$"Wait to approve by user"$$::jsonb::text, $${"n8n_node": {"parameters": {"resume": "form", "formTitle": "Review the posts ", "formDescription": "=### 🔵 LINKEDIN\n{{ $('Social Media Agent').item.json.output[0].content }}\n\n---\n\n### 🇽 TWITTER/X\n{{ $('Social Media Agent').item.json.output[1].content }}\n\n---\n\n### 🧵 THREADS\n{{ $('Social Media Agent').item.json.output[2].content }}\n\n---\n\n### 🤖 REDDIT\n**Title:** {{ $('Social Media Agent').item.json.output[3].title }}\n**Content:** {{ $('Social Media Agent').item.json.output[3].content }}\n\nplease review de posts and approve it if you want to publish", "formFields": {"values": [{"fieldLabel": "decision", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "approve"}, {"option": "reject"}]}, "requiredField": true}]}, "options": {}}, "id": "251ae22d-7bbb-486b-b3b5-d2c0e45bd415", "name": "Wait to approve by user", "type": "n8n-nodes-base.wait", "position": [-496, 192], "webhookId": "f8e6054e-44e4-4987-9698-d5befb8b31b6", "typeVersion": 1.1}, "connections": {"main": [[{"node": "If approved publish", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 8, $$"0a6929d0-6f27-4f6f-b609-53589d66ba1e"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"If approved publish"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "394500db-496d-4c6e-9adb-59f3caead492", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $('Wait to approve by user').item.json.decision }}", "rightValue": "=approve"}]}, "looseTypeValidation": "=true", "options": {}}, "id": "0a6929d0-6f27-4f6f-b609-53589d66ba1e", "name": "If approved publish", "type": "n8n-nodes-base.if", "position": [-320, 192], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Upload Post X", "type": "main", "index": 0}, {"node": "Upload Post Threads", "type": "main", "index": 0}, {"node": "Upload Post Linkedin", "type": "main", "index": 0}, {"node": "Upload Post Reddit", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 9, $$"ba76b7b5-6197-47c3-b064-bcaf55bdbd66"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Upload Post Linkedin"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[0].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80", "platform": ["linkedin"]}, "id": "ba76b7b5-6197-47c3-b064-bcaf55bdbd66", "name": "Upload Post Linkedin", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 368], "typeVersion": 1, "credentials": {}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 10, $$"4b536482-2cf7-4e16-afad-52c56a1e9666"$$::jsonb::text, $$"n8n-nodes-base.reddit"$$::jsonb::text, $$"Upload Post Reddit"$$::jsonb::text, $${"n8n_node": {"parameters": {"subreddit": "n8n", "title": "={{ $('Social Media Agent').item.json.output[3].title }}", "text": "={{ $('Social Media Agent').item.json.output[3].content }}"}, "id": "4b536482-2cf7-4e16-afad-52c56a1e9666", "name": "Upload Post Reddit", "type": "n8n-nodes-base.reddit", "position": [0, 560], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 11, $$"4455023c-6a84-44f9-96bf-f7a2ff113698"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Upload Post Threads"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[2].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80", "platform": ["threads"]}, "id": "4455023c-6a84-44f9-96bf-f7a2ff113698", "name": "Upload Post Threads", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 192], "typeVersion": 1, "credentials": {}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Auto-Publish_Web_Articles_as_Social_Posts_for_X__LinkedIn__Reddit___Threads_with_Gemini_AI"$$::jsonb::text, 12, $$"29a0652d-c88f-4960-aaed-f12b0cfe0917"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Upload Post X"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "={{ $('Set Input Data').item.json['upload-post_user'] }}", "title": "={{ $('Social Media Agent').item.json.output[1].content }}", "photos": "=https://api.screenshotone.com/take?access_key={{ $('Set Input Data').item.json['ScreenshotOne_API_KEY'] }}&url={{ $('Set Input Data').item.json.workflow_url }}&format=jpg&block_ads=false&block_cookie_banners=false&block_banners_by_heuristics=false&block_trackers=true&delay=20&timeout=60&response_type=by_format&image_quality=80\n", "platform": ["x"]}, "id": "29a0652d-c88f-4960-aaed-f12b0cfe0917", "name": "Upload Post X", "type": "n8n-nodes-upload-post.uploadPost", "position": [0, 0], "typeVersion": 1, "credentials": {}}, "connections": {}}$$::jsonb);

-- N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Automated Instagram comment response with DMs & Google Sheets tracking"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Automated Instagram comment response with DMs & Google Sheets tracking.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "M2eHZn8tKpbSUNzs", "name": "Automated Instagram comment response with DMs & Google Sheets tracking", "active": false}, "sourcePath": "workflows/n8n/social_media/Automated Instagram comment response with DMs & Google Sheets tracking.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Automated Instagram comment response with DMs & Google Sheets tracking", "nodes": [{"parameters": {}, "id": "82aaa8f5-c2fc-49b4-9d69-2b439001c7dd", "name": "Start Monitoring", "type": "n8n-nodes-base.manualTrigger", "position": [368, 240], "typeVersion": 1}, {"parameters": {"assignments": {"assignments": [{"id": "postUrl", "name": "postUrl", "type": "string", "value": "Instagram url post/reel"}, {"id": "replyMessage", "name": "replyMessage", "type": "string", "value": "Thanks so much!  This is the template: xxxxx"}, {"id": "profileUsername", "name": "profileUsername", "type": "string", "value": "add_upload_post_username"}]}, "options": {}}, "id": "c191f69e-4483-409a-b313-2e11e0250e47", "name": "Configure Post & Message", "type": "n8n-nodes-base.set", "position": [592, 384], "typeVersion": 3.3}, {"parameters": {"documentId": {"__rl": true, "mode": "list", "value": "1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit?usp=drivesdk", "cachedResultName": "respuestas a post de instagram"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit#gid=0", "cachedResultName": "Hoja 1"}, "options": {}}, "id": "66a72bd2-4f15-4c01-bbad-27d0ec3ce775", "name": "Read Contacted Users", "type": "n8n-nodes-base.googleSheets", "position": [800, 384], "typeVersion": 4, "alwaysOutputData": true}, {"parameters": {"jsCode": "const comments = $input.first().json.comments || [];\n// CRÍTICO: Usar .all() para obtener TODAS las filas, no solo la primera\nconst allContactedUsersData = $('Read Contacted Users').all();\nconsole.log('🔍 DEBUG - Raw all contacted users:', JSON.stringify(allContactedUsersData, null, 2));\nconsole.log('🔍 DEBUG - Number of items from Read Contacted Users:', allContactedUsersData.length);\n\n// Extraer todos los objetos JSON de todas las ejecuciones y aplanar en un solo array\nlet contactedUsersData = [];\nallContactedUsersData.forEach((item, index) => {\n  console.log(`🔍 DEBUG - Processing item ${index}:`, JSON.stringify(item.json, null, 2));\n  if (item.json) {\n    if (Array.isArray(item.json)) {\n      // Si es un array, agregar todos los elementos\n      contactedUsersData.push(...item.json);\n      console.log(`🔍 DEBUG - Added ${item.json.length} items from array`);\n    } else {\n      // Si es un solo objeto, agregarlo\n      contactedUsersData.push(item.json);\n      console.log(`🔍 DEBUG - Added 1 object`);\n    }\n  }\n});\n\nconsole.log('🔍 DEBUG - Total extracted contacted users:', contactedUsersData.length);\n\n// DEBUGGING DETALLADO\nconsole.log('🔍 DEBUG - Input comments found:', comments.length);\nconsole.log('🔍 DEBUG - Raw contacted users data:', JSON.stringify(contactedUsersData, null, 2));\nconsole.log('🔍 DEBUG - Contacted users data type:', typeof contactedUsersData);\nconsole.log('🔍 DEBUG - Contacted users data keys:', Object.keys(contactedUsersData));\n\n// Handle different Google Sheets response formats\nlet contactedUsers = [];\n\n// IMPORTANTE: Primero verificar si es un array directo (múltiples filas)\nif (Array.isArray(contactedUsersData)) {\n  contactedUsers = contactedUsersData;\n  console.log('🔍 DEBUG - Using direct array format (multiple rows)');\n} \n// Método 2: Respuesta con .values (formato común)\nelse if (contactedUsersData.values && Array.isArray(contactedUsersData.values)) {\n  contactedUsers = contactedUsersData.values;\n  console.log('🔍 DEBUG - Using .values format');\n} \n// Método 3: Respuesta con .data\nelse if (contactedUsersData.data && Array.isArray(contactedUsersData.data)) {\n  contactedUsers = contactedUsersData.data;\n  console.log('🔍 DEBUG - Using .data format');\n}\n// MÉTODO 4 CORREGIDO: Manejar objetos únicos vs múltiples\nelse if (typeof contactedUsersData === 'object' && contactedUsersData !== null) {\n  // CRÍTICO: Verificar si es UN SOLO objeto con comment_id (1 fila)\n  if (contactedUsersData.comment_id || contactedUsersData.username) {\n    contactedUsers = [contactedUsersData];\n    console.log('🔍 DEBUG - Converting single object to array (1 row)');\n  } \n  // Si es un objeto pero SIN comment_id directo, puede ser múltiples objetos\n  else {\n    // Convertir a array pero también verificar si los valores son objetos\n    const values = Object.values(contactedUsersData);\n    \n    // Si los valores son objetos con comment_id, son múltiples filas\n    if (values.length > 0 && typeof values[0] === 'object' && values[0]?.comment_id) {\n      contactedUsers = values;\n      console.log('🔍 DEBUG - Converting object values to array (multiple rows from object)');\n    } else {\n      contactedUsers = values;\n      console.log('🔍 DEBUG - Converting object values to array (unknown format)');\n    }\n  }\n}\n\n// DEBUGGING EXTRA: Mostrar qué tipo de datos recibimos\nconsole.log('🔍 DEBUG - Raw data analysis:');\nconsole.log('  - Is Array:', Array.isArray(contactedUsersData));\nconsole.log('  - Type:', typeof contactedUsersData);\nconsole.log('  - Has comment_id:', !!contactedUsersData?.comment_id);\nconsole.log('  - Object keys:', contactedUsersData ? Object.keys(contactedUsersData) : 'null');\n\nconsole.log('🔍 DEBUG - Final contacted users array length:', contactedUsers.length);\nconsole.log('🔍 DEBUG - Final contacted users array:', JSON.stringify(contactedUsers, null, 2));\n\n// Print first few rows to see the structure\nif (contactedUsers.length > 0) {\n  console.log('🔍 DEBUG - First 5 rows structure:');\n  contactedUsers.slice(0, 5).forEach((row, index) => {\n    console.log(`  Row ${index}:`, JSON.stringify(row, null, 2));\n    console.log(`  Row ${index} type:`, typeof row);\n    console.log(`  Row ${index} keys:`, Object.keys(row || {}));\n  });\n}\n\n// FUNCIÓN PARA NORMALIZAR COMMENT IDs (crítico para números largos)\nfunction normalizeCommentId(id) {\n  if (!id || id === null || id === undefined) return null;\n  \n  // Convertir a string y limpiar espacios\n  let cleanId = String(id).trim();\n  \n  // Si es vacío o es un header, retornar null\n  if (cleanId === '' || cleanId === 'comment_id') return null;\n  \n  // IMPORTANTE: Manejar números largos como strings para evitar problemas de precisión\n  // Los comment IDs de Instagram son números muy largos que pueden perder precisión\n  return cleanId;\n}\n\n// Create a set of already contacted comment IDs\nconst contactedCommentIds = new Set();\n\ncontactedUsers.forEach((row, index) => {\n  let commentId = null;\n  \n  console.log(`🔍 DEBUG - Processing row ${index}:`, JSON.stringify(row, null, 2));\n  \n  // Skip header row if it exists\n  if (typeof row === 'object' && row !== null && !Array.isArray(row)) {\n    // Skip if this looks like a header row\n    if (row.comment_id === 'comment_id' || row.username === 'username') {\n      console.log(`⚠️ Skipping header row ${index}`);\n      return;\n    }\n    \n    // Handle object format (when Google Sheets returns objects)\n    commentId = row.comment_id || row.commentId || row['comment_id'] || row['commentId'];\n    console.log(`🔍 DEBUG - Object format, raw comment_id: '${commentId}' (type: ${typeof commentId})`);\n  } \n  // Handle array format (when Google Sheets returns arrays)\n  else if (Array.isArray(row)) {\n    // Skip if this looks like a header row\n    if (row[0] === 'comment_id' || row[1] === 'username') {\n      console.log(`⚠️ Skipping header array row ${index}`);\n      return;\n    }\n    \n    // comment_id is in Column A (index 0)\n    commentId = row[0];\n    console.log(`🔍 DEBUG - Array format, raw comment_id: '${commentId}' (type: ${typeof commentId})`);\n  }\n  \n  // Normalize and validate comment ID\n  const normalizedId = normalizeCommentId(commentId);\n  if (normalizedId) {\n    contactedCommentIds.add(normalizedId);\n    console.log(`✅ Added contacted comment ID: '${normalizedId}' (length: ${normalizedId.length})`);\n  } else {\n    console.log(`⚠️ Row ${index} has no valid comment_id:`, commentId);\n  }\n});\n\nconsole.log('🔍 DEBUG - Total contacted comment IDs found:', contactedCommentIds.size);\nconsole.log('🔍 DEBUG - Contacted comment IDs list:', Array.from(contactedCommentIds));\n\n// Filter new comments - exclude already contacted ones\nconst newComments = comments.filter(comment => {\n  const rawCommentId = comment.id;\n  const normalizedCommentId = normalizeCommentId(rawCommentId);\n  \n  if (!normalizedCommentId) {\n    console.log(`⚠️ Invalid comment ID found: ${rawCommentId}`);\n    return false;\n  }\n  \n  const isAlreadyContacted = contactedCommentIds.has(normalizedCommentId);\n  \n  console.log(`🔍 DEBUG - Checking comment ID: '${normalizedCommentId}' (raw: ${rawCommentId}, type: ${typeof rawCommentId}), Already contacted: ${isAlreadyContacted}`);\n  \n  // Debug: Show all contacted IDs for comparison\n  if (isAlreadyContacted) {\n    console.log(`🔍 DEBUG - Comment ID '${normalizedCommentId}' found in contacted list`);\n  } else {\n    console.log(`🔍 DEBUG - Comment ID '${normalizedCommentId}' NOT found in contacted list`);\n    console.log(`🔍 DEBUG - All contacted IDs: [${Array.from(contactedCommentIds).join(', ')}]`);\n  }\n  \n  return !isAlreadyContacted;\n});\n\nconsole.log('🔍 DEBUG - New comments after filter:', newComments.length);\n\n// Log the filtering results with emojis\nconsole.log(`📊 Total comments retrieved: ${comments.length}`);\nconsole.log(`✅ Already contacted comments: ${contactedCommentIds.size}`);\nconsole.log(`🆕 New comments to process: ${newComments.length}`);\n\n// Log details of new comments\nnewComments.forEach((comment, index) => {\n  console.log(`🆕 New comment ${index + 1}: ID='${comment.id}', User='${comment.user?.username || 'unknown'}', Text='${comment.text?.substring(0, 50) || 'no text'}...'`);\n});\n\nif (newComments.length === 0) {\n  console.log('😴 No new comments found. Waiting for next check...');\n  console.log('🔄 Workflow will continue monitoring in 15 minutes...');\n  \n  // Return a special object to indicate no processing needed\n  return [{\n    json: {\n      noNewComments: true,\n      summary: `📊 Monitoring complete - Found ${comments.length} total comments, ${contactedCommentIds.size} already contacted, 0 new comments to process`,\n      timestamp: new Date().toISOString(),\n      status: 'no_new_comments'\n    }\n  }];\n}\n\n// Transform each new comment into a separate item for processing\nreturn newComments.map(comment => ({\n  json: {\n    commentId: normalizeCommentId(comment.id),\n    commentText: comment.text,\n    userId: comment.user?.id || 'unknown',\n    username: comment.user?.username || 'unknown',\n    timestamp: comment.timestamp || new Date().toISOString(),\n    replyMessage: $('Configure Post & Message').first().json.replyMessage,\n    postUrl: $('Configure Post & Message').first().json.postUrl,\n    profileUsername: $('Configure Post & Message').first().json.profileUsername\n  }\n}));"}, "id": "78881d28-aa34-408d-a6ed-d3578f92c394", "name": "Filter New Comments", "type": "n8n-nodes-base.code", "position": [1200, 384], "typeVersion": 2, "alwaysOutputData": true}, {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": false, "typeValidation": "loose"}, "combinator": "or", "conditions": [{"id": "has_new_comments", "operator": {"type": "boolean", "operation": "notEqual"}, "leftValue": "={{ $json.noNewComments }}", "rightValue": true}, {"id": "f38ffd12-c4b2-4971-944c-b983ff3541fa", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ !$json.noNewComments }}", "rightValue": "true"}]}, "options": {"ignoreCase": true, "looseTypeValidation": true}}, "id": "13ad0cdd-7da6-4e57-98e8-28dae0916ed4", "name": "Check If Has New Comments", "type": "n8n-nodes-base.if", "position": [1360, 384], "typeVersion": 2}, {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/uploadposts/comments/reply", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "specifyBody": "json", "jsonBody": "={\n  \"platform\": \"instagram\",\n  \"user\": \"{{ $json.profileUsername }}\",\n  \"comment_id\": \"{{ $json.commentId }}\",\n  \"message\": \"{{ $json.replyMessage }}\"\n}", "options": {}}, "id": "f20e9a90-f8db-4f42-acdb-1e99295a0a0c", "name": "Send Reply to Comment", "type": "n8n-nodes-base.httpRequest", "position": [1552, 288], "typeVersion": 4.1}, {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": false, "typeValidation": "loose"}, "combinator": "or", "conditions": [{"id": "success_check", "operator": {"type": "boolean", "operation": "equal"}, "leftValue": "={{ $json.success }}", "rightValue": true}, {"id": "15c2064a-8fbd-446e-8d36-29852df64def", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.success }}", "rightValue": "=true"}]}, "options": {"ignoreCase": true, "looseTypeValidation": true}}, "id": "7e4c9bd5-973f-4a15-941d-239ae9581bd8", "name": "Check Reply Success", "type": "n8n-nodes-base.if", "position": [1712, 192], "typeVersion": 2}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "mode": "list", "value": "1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit?usp=drivesdk", "cachedResultName": "respuestas a post de instagram"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit#gid=0", "cachedResultName": "Hoja 1"}, "columns": {"value": {"post_url": "={{ $('Filter New Comments').item.json.postUrl }}", "username": "={{ $('Filter New Comments').item.json.username }}", "timestamp": "={{ $('Filter New Comments').item.json.timestamp }}", "comment_id": "={{ $('Filter New Comments').item.json.commentId }}", "message_sent": "={{ $('Filter New Comments').item.json.replyMessage }}"}, "schema": [{"id": "comment_id", "type": "string", "display": true, "required": false, "displayName": "comment_id", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "username", "type": "string", "display": true, "required": false, "displayName": "username", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "message_sent", "type": "string", "display": true, "required": false, "displayName": "message_sent", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "timestamp", "type": "string", "display": true, "required": false, "displayName": "timestamp", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "post_url", "type": "string", "display": true, "required": false, "displayName": "post_url", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": [], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "40146447-62b1-4c97-87f6-44db758b4c8d", "name": "Record Contacted User", "type": "n8n-nodes-base.googleSheets", "position": [1936, 112], "typeVersion": 4}, {"parameters": {"jsCode": "// Log failed replies for debugging\nconst failedReply = {\n  userId: $('Filter New Comments').item.json.userId,\n  username: $('Filter New Comments').item.json.username,\n  commentId: $('Filter New Comments').item.json.commentId,\n  error: $json.error || 'Unknown error',\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('❌ Failed to send reply:', failedReply);\n\nreturn [{ json: failedReply }];"}, "id": "730bb698-62e4-4944-83c3-982864140daf", "name": "Log Failed Reply", "type": "n8n-nodes-base.code", "position": [1936, 272], "typeVersion": 2}, {"parameters": {"jsCode": "// Summary of the monitoring session with proper error handling\nlet totalComments = 0;\nlet newComments = 0;\nlet successfulReplies = 0;\nlet failedReplies = 0;\nlet monitoredPostUrl = '';\n\ntry {\n  // Get total comments (handle if node wasn't executed)\n  const getPostCommentsData = $('Get Post Comments').first();\n  totalComments = getPostCommentsData?.json?.comments?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get total comments data:', error.message);\n  totalComments = 0;\n}\n\ntry {\n  // Get new comments (handle if node wasn't executed)\n  const filterNewCommentsData = $('Filter New Comments').all();\n  newComments = filterNewCommentsData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get new comments data:', error.message);\n  newComments = 0;\n}\n\ntry {\n  // Get successful replies (handle if node wasn't executed)\n  const recordContactedData = $('Record Contacted User').all();\n  successfulReplies = recordContactedData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get successful replies data:', error.message);\n  successfulReplies = 0;\n}\n\ntry {\n  // Get failed replies (handle if node wasn't executed)\n  const logFailedData = $('Log Failed Reply').all();\n  failedReplies = logFailedData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get failed replies data:', error.message);\n  failedReplies = 0;\n}\n\ntry {\n  // Get monitored post URL\n  const configData = $('Configure Post & Message').first();\n  monitoredPostUrl = configData?.json?.postUrl || 'Unknown URL';\n} catch (error) {\n  console.log('⚠️ Could not get post URL:', error.message);\n  monitoredPostUrl = 'Unknown URL';\n}\n\nconst summary = {\n  totalComments,\n  newComments,\n  successfulReplies,\n  failedReplies,\n  monitoredPostUrl,\n  timestamp: new Date().toISOString(),\n  status: 'completed'\n};\n\nconsole.log('📈 Monitoring Summary:', JSON.stringify(summary, null, 2));\n\n// Generate appropriate emoji and message\nconst emoji = successfulReplies > 0 ? '🎉' : failedReplies > 0 ? '⚠️' : totalComments > 0 ? '👀' : '😴';\nlet message = `${emoji} Monitoring cycle complete!`;\n\nif (totalComments > 0) {\n  message += ` Found ${totalComments} total comments`;\n  \n  if (newComments > 0) {\n    message += `, ${newComments} new comments`;\n    \n    if (successfulReplies > 0) {\n      message += `, sent ${successfulReplies} replies successfully`;\n    }\n    \n    if (failedReplies > 0) {\n      message += `, ${failedReplies} failed`;\n    }\n  } else {\n    message += ', no new comments to process';\n  }\n} else {\n  message += ' No comments found or error retrieving comments';\n}\n\nconsole.log(message);\nconsole.log('⏰ Next check in 15 minutes...');\nconsole.log('🔄 Workflow will continue monitoring...');\n\nreturn [{\n  json: {\n    summary,\n    message,\n    continueMonitoring: true\n  }\n}];"}, "id": "c87fe62f-9024-4827-8c56-65075e00fb23", "name": "Generate Summary", "type": "n8n-nodes-base.code", "position": [2160, 400], "typeVersion": 2}, {"parameters": {"url": "=https://api.upload-post.com/api/uploadposts/comments", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendQuery": true, "queryParameters": {"parameters": [{"name": "platform", "value": "instagram"}, {"name": "user", "value": "={{ $('Configure Post & Message').item.json.profileUsername }}"}, {"name": "post_url", "value": "={{ $('Configure Post & Message').item.json.postUrl }}"}]}, "options": {"response": {"response": {"responseFormat": "json"}}}}, "id": "1ae9c8df-41b4-42e5-9df9-691fb9b6f2ad", "name": "Get Post Comments", "type": "n8n-nodes-base.httpRequest", "position": [976, 384], "typeVersion": 4.1}, {"parameters": {"rule": {"interval": [{"field": "minutes", "minutesInterval": 15}]}}, "id": "08822705-3afd-4ea4-8d9e-8874d989507c", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [368, 512], "typeVersion": 1.2}], "pinData": {}, "connections": {"Log Failed Reply": {"main": [[{"node": "Generate Summary", "type": "main", "index": 0}]]}, "Schedule Trigger": {"main": [[{"node": "Configure Post & Message", "type": "main", "index": 0}]]}, "Start Monitoring": {"main": [[{"node": "Configure Post & Message", "type": "main", "index": 0}]]}, "Get Post Comments": {"main": [[{"node": "Filter New Comments", "type": "main", "index": 0}]]}, "Check Reply Success": {"main": [[{"node": "Record Contacted User", "type": "main", "index": 0}], [{"node": "Log Failed Reply", "type": "main", "index": 0}]]}, "Filter New Comments": {"main": [[{"node": "Check If Has New Comments", "type": "main", "index": 0}]]}, "Read Contacted Users": {"main": [[{"node": "Get Post Comments", "type": "main", "index": 0}]]}, "Record Contacted User": {"main": [[{"node": "Generate Summary", "type": "main", "index": 0}]]}, "Send Reply to Comment": {"main": [[{"node": "Check Reply Success", "type": "main", "index": 0}]]}, "Configure Post & Message": {"main": [[{"node": "Read Contacted Users", "type": "main", "index": 0}]]}, "Check If Has New Comments": {"main": [[{"node": "Send Reply to Comment", "type": "main", "index": 0}], [{"node": "Generate Summary", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate"}, "versionId": "", "meta": {"templateId": "5941", "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "M2eHZn8tKpbSUNzs", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Automated Instagram comment response with DMs & Google Sheets tracking"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 1, $$"82aaa8f5-c2fc-49b4-9d69-2b439001c7dd"$$::jsonb::text, $$"n8n-nodes-base.manualTrigger"$$::jsonb::text, $$"Start Monitoring"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "82aaa8f5-c2fc-49b4-9d69-2b439001c7dd", "name": "Start Monitoring", "type": "n8n-nodes-base.manualTrigger", "position": [368, 240], "typeVersion": 1}, "connections": {"main": [[{"node": "Configure Post & Message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 2, $$"08822705-3afd-4ea4-8d9e-8874d989507c"$$::jsonb::text, $$"n8n-nodes-base.scheduleTrigger"$$::jsonb::text, $$"Schedule Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"rule": {"interval": [{"field": "minutes", "minutesInterval": 15}]}}, "id": "08822705-3afd-4ea4-8d9e-8874d989507c", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [368, 512], "typeVersion": 1.2}, "connections": {"main": [[{"node": "Configure Post & Message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 3, $$"c191f69e-4483-409a-b313-2e11e0250e47"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Configure Post & Message"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "postUrl", "name": "postUrl", "type": "string", "value": "Instagram url post/reel"}, {"id": "replyMessage", "name": "replyMessage", "type": "string", "value": "Thanks so much!  This is the template: xxxxx"}, {"id": "profileUsername", "name": "profileUsername", "type": "string", "value": "add_upload_post_username"}]}, "options": {}}, "id": "c191f69e-4483-409a-b313-2e11e0250e47", "name": "Configure Post & Message", "type": "n8n-nodes-base.set", "position": [592, 384], "typeVersion": 3.3}, "connections": {"main": [[{"node": "Read Contacted Users", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 4, $$"66a72bd2-4f15-4c01-bbad-27d0ec3ce775"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Read Contacted Users"$$::jsonb::text, $${"n8n_node": {"parameters": {"documentId": {"__rl": true, "mode": "list", "value": "1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit?usp=drivesdk", "cachedResultName": "respuestas a post de instagram"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit#gid=0", "cachedResultName": "Hoja 1"}, "options": {}}, "id": "66a72bd2-4f15-4c01-bbad-27d0ec3ce775", "name": "Read Contacted Users", "type": "n8n-nodes-base.googleSheets", "position": [800, 384], "typeVersion": 4, "alwaysOutputData": true}, "connections": {"main": [[{"node": "Get Post Comments", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 5, $$"1ae9c8df-41b4-42e5-9df9-691fb9b6f2ad"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Get Post Comments"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "=https://api.upload-post.com/api/uploadposts/comments", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendQuery": true, "queryParameters": {"parameters": [{"name": "platform", "value": "instagram"}, {"name": "user", "value": "={{ $('Configure Post & Message').item.json.profileUsername }}"}, {"name": "post_url", "value": "={{ $('Configure Post & Message').item.json.postUrl }}"}]}, "options": {"response": {"response": {"responseFormat": "json"}}}}, "id": "1ae9c8df-41b4-42e5-9df9-691fb9b6f2ad", "name": "Get Post Comments", "type": "n8n-nodes-base.httpRequest", "position": [976, 384], "typeVersion": 4.1}, "connections": {"main": [[{"node": "Filter New Comments", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 6, $$"78881d28-aa34-408d-a6ed-d3578f92c394"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Filter New Comments"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const comments = $input.first().json.comments || [];\n// CRÍTICO: Usar .all() para obtener TODAS las filas, no solo la primera\nconst allContactedUsersData = $('Read Contacted Users').all();\nconsole.log('🔍 DEBUG - Raw all contacted users:', JSON.stringify(allContactedUsersData, null, 2));\nconsole.log('🔍 DEBUG - Number of items from Read Contacted Users:', allContactedUsersData.length);\n\n// Extraer todos los objetos JSON de todas las ejecuciones y aplanar en un solo array\nlet contactedUsersData = [];\nallContactedUsersData.forEach((item, index) => {\n  console.log(`🔍 DEBUG - Processing item ${index}:`, JSON.stringify(item.json, null, 2));\n  if (item.json) {\n    if (Array.isArray(item.json)) {\n      // Si es un array, agregar todos los elementos\n      contactedUsersData.push(...item.json);\n      console.log(`🔍 DEBUG - Added ${item.json.length} items from array`);\n    } else {\n      // Si es un solo objeto, agregarlo\n      contactedUsersData.push(item.json);\n      console.log(`🔍 DEBUG - Added 1 object`);\n    }\n  }\n});\n\nconsole.log('🔍 DEBUG - Total extracted contacted users:', contactedUsersData.length);\n\n// DEBUGGING DETALLADO\nconsole.log('🔍 DEBUG - Input comments found:', comments.length);\nconsole.log('🔍 DEBUG - Raw contacted users data:', JSON.stringify(contactedUsersData, null, 2));\nconsole.log('🔍 DEBUG - Contacted users data type:', typeof contactedUsersData);\nconsole.log('🔍 DEBUG - Contacted users data keys:', Object.keys(contactedUsersData));\n\n// Handle different Google Sheets response formats\nlet contactedUsers = [];\n\n// IMPORTANTE: Primero verificar si es un array directo (múltiples filas)\nif (Array.isArray(contactedUsersData)) {\n  contactedUsers = contactedUsersData;\n  console.log('🔍 DEBUG - Using direct array format (multiple rows)');\n} \n// Método 2: Respuesta con .values (formato común)\nelse if (contactedUsersData.values && Array.isArray(contactedUsersData.values)) {\n  contactedUsers = contactedUsersData.values;\n  console.log('🔍 DEBUG - Using .values format');\n} \n// Método 3: Respuesta con .data\nelse if (contactedUsersData.data && Array.isArray(contactedUsersData.data)) {\n  contactedUsers = contactedUsersData.data;\n  console.log('🔍 DEBUG - Using .data format');\n}\n// MÉTODO 4 CORREGIDO: Manejar objetos únicos vs múltiples\nelse if (typeof contactedUsersData === 'object' && contactedUsersData !== null) {\n  // CRÍTICO: Verificar si es UN SOLO objeto con comment_id (1 fila)\n  if (contactedUsersData.comment_id || contactedUsersData.username) {\n    contactedUsers = [contactedUsersData];\n    console.log('🔍 DEBUG - Converting single object to array (1 row)');\n  } \n  // Si es un objeto pero SIN comment_id directo, puede ser múltiples objetos\n  else {\n    // Convertir a array pero también verificar si los valores son objetos\n    const values = Object.values(contactedUsersData);\n    \n    // Si los valores son objetos con comment_id, son múltiples filas\n    if (values.length > 0 && typeof values[0] === 'object' && values[0]?.comment_id) {\n      contactedUsers = values;\n      console.log('🔍 DEBUG - Converting object values to array (multiple rows from object)');\n    } else {\n      contactedUsers = values;\n      console.log('🔍 DEBUG - Converting object values to array (unknown format)');\n    }\n  }\n}\n\n// DEBUGGING EXTRA: Mostrar qué tipo de datos recibimos\nconsole.log('🔍 DEBUG - Raw data analysis:');\nconsole.log('  - Is Array:', Array.isArray(contactedUsersData));\nconsole.log('  - Type:', typeof contactedUsersData);\nconsole.log('  - Has comment_id:', !!contactedUsersData?.comment_id);\nconsole.log('  - Object keys:', contactedUsersData ? Object.keys(contactedUsersData) : 'null');\n\nconsole.log('🔍 DEBUG - Final contacted users array length:', contactedUsers.length);\nconsole.log('🔍 DEBUG - Final contacted users array:', JSON.stringify(contactedUsers, null, 2));\n\n// Print first few rows to see the structure\nif (contactedUsers.length > 0) {\n  console.log('🔍 DEBUG - First 5 rows structure:');\n  contactedUsers.slice(0, 5).forEach((row, index) => {\n    console.log(`  Row ${index}:`, JSON.stringify(row, null, 2));\n    console.log(`  Row ${index} type:`, typeof row);\n    console.log(`  Row ${index} keys:`, Object.keys(row || {}));\n  });\n}\n\n// FUNCIÓN PARA NORMALIZAR COMMENT IDs (crítico para números largos)\nfunction normalizeCommentId(id) {\n  if (!id || id === null || id === undefined) return null;\n  \n  // Convertir a string y limpiar espacios\n  let cleanId = String(id).trim();\n  \n  // Si es vacío o es un header, retornar null\n  if (cleanId === '' || cleanId === 'comment_id') return null;\n  \n  // IMPORTANTE: Manejar números largos como strings para evitar problemas de precisión\n  // Los comment IDs de Instagram son números muy largos que pueden perder precisión\n  return cleanId;\n}\n\n// Create a set of already contacted comment IDs\nconst contactedCommentIds = new Set();\n\ncontactedUsers.forEach((row, index) => {\n  let commentId = null;\n  \n  console.log(`🔍 DEBUG - Processing row ${index}:`, JSON.stringify(row, null, 2));\n  \n  // Skip header row if it exists\n  if (typeof row === 'object' && row !== null && !Array.isArray(row)) {\n    // Skip if this looks like a header row\n    if (row.comment_id === 'comment_id' || row.username === 'username') {\n      console.log(`⚠️ Skipping header row ${index}`);\n      return;\n    }\n    \n    // Handle object format (when Google Sheets returns objects)\n    commentId = row.comment_id || row.commentId || row['comment_id'] || row['commentId'];\n    console.log(`🔍 DEBUG - Object format, raw comment_id: '${commentId}' (type: ${typeof commentId})`);\n  } \n  // Handle array format (when Google Sheets returns arrays)\n  else if (Array.isArray(row)) {\n    // Skip if this looks like a header row\n    if (row[0] === 'comment_id' || row[1] === 'username') {\n      console.log(`⚠️ Skipping header array row ${index}`);\n      return;\n    }\n    \n    // comment_id is in Column A (index 0)\n    commentId = row[0];\n    console.log(`🔍 DEBUG - Array format, raw comment_id: '${commentId}' (type: ${typeof commentId})`);\n  }\n  \n  // Normalize and validate comment ID\n  const normalizedId = normalizeCommentId(commentId);\n  if (normalizedId) {\n    contactedCommentIds.add(normalizedId);\n    console.log(`✅ Added contacted comment ID: '${normalizedId}' (length: ${normalizedId.length})`);\n  } else {\n    console.log(`⚠️ Row ${index} has no valid comment_id:`, commentId);\n  }\n});\n\nconsole.log('🔍 DEBUG - Total contacted comment IDs found:', contactedCommentIds.size);\nconsole.log('🔍 DEBUG - Contacted comment IDs list:', Array.from(contactedCommentIds));\n\n// Filter new comments - exclude already contacted ones\nconst newComments = comments.filter(comment => {\n  const rawCommentId = comment.id;\n  const normalizedCommentId = normalizeCommentId(rawCommentId);\n  \n  if (!normalizedCommentId) {\n    console.log(`⚠️ Invalid comment ID found: ${rawCommentId}`);\n    return false;\n  }\n  \n  const isAlreadyContacted = contactedCommentIds.has(normalizedCommentId);\n  \n  console.log(`🔍 DEBUG - Checking comment ID: '${normalizedCommentId}' (raw: ${rawCommentId}, type: ${typeof rawCommentId}), Already contacted: ${isAlreadyContacted}`);\n  \n  // Debug: Show all contacted IDs for comparison\n  if (isAlreadyContacted) {\n    console.log(`🔍 DEBUG - Comment ID '${normalizedCommentId}' found in contacted list`);\n  } else {\n    console.log(`🔍 DEBUG - Comment ID '${normalizedCommentId}' NOT found in contacted list`);\n    console.log(`🔍 DEBUG - All contacted IDs: [${Array.from(contactedCommentIds).join(', ')}]`);\n  }\n  \n  return !isAlreadyContacted;\n});\n\nconsole.log('🔍 DEBUG - New comments after filter:', newComments.length);\n\n// Log the filtering results with emojis\nconsole.log(`📊 Total comments retrieved: ${comments.length}`);\nconsole.log(`✅ Already contacted comments: ${contactedCommentIds.size}`);\nconsole.log(`🆕 New comments to process: ${newComments.length}`);\n\n// Log details of new comments\nnewComments.forEach((comment, index) => {\n  console.log(`🆕 New comment ${index + 1}: ID='${comment.id}', User='${comment.user?.username || 'unknown'}', Text='${comment.text?.substring(0, 50) || 'no text'}...'`);\n});\n\nif (newComments.length === 0) {\n  console.log('😴 No new comments found. Waiting for next check...');\n  console.log('🔄 Workflow will continue monitoring in 15 minutes...');\n  \n  // Return a special object to indicate no processing needed\n  return [{\n    json: {\n      noNewComments: true,\n      summary: `📊 Monitoring complete - Found ${comments.length} total comments, ${contactedCommentIds.size} already contacted, 0 new comments to process`,\n      timestamp: new Date().toISOString(),\n      status: 'no_new_comments'\n    }\n  }];\n}\n\n// Transform each new comment into a separate item for processing\nreturn newComments.map(comment => ({\n  json: {\n    commentId: normalizeCommentId(comment.id),\n    commentText: comment.text,\n    userId: comment.user?.id || 'unknown',\n    username: comment.user?.username || 'unknown',\n    timestamp: comment.timestamp || new Date().toISOString(),\n    replyMessage: $('Configure Post & Message').first().json.replyMessage,\n    postUrl: $('Configure Post & Message').first().json.postUrl,\n    profileUsername: $('Configure Post & Message').first().json.profileUsername\n  }\n}));"}, "id": "78881d28-aa34-408d-a6ed-d3578f92c394", "name": "Filter New Comments", "type": "n8n-nodes-base.code", "position": [1200, 384], "typeVersion": 2, "alwaysOutputData": true}, "connections": {"main": [[{"node": "Check If Has New Comments", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 7, $$"13ad0cdd-7da6-4e57-98e8-28dae0916ed4"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Check If Has New Comments"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": false, "typeValidation": "loose"}, "combinator": "or", "conditions": [{"id": "has_new_comments", "operator": {"type": "boolean", "operation": "notEqual"}, "leftValue": "={{ $json.noNewComments }}", "rightValue": true}, {"id": "f38ffd12-c4b2-4971-944c-b983ff3541fa", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ !$json.noNewComments }}", "rightValue": "true"}]}, "options": {"ignoreCase": true, "looseTypeValidation": true}}, "id": "13ad0cdd-7da6-4e57-98e8-28dae0916ed4", "name": "Check If Has New Comments", "type": "n8n-nodes-base.if", "position": [1360, 384], "typeVersion": 2}, "connections": {"main": [[{"node": "Send Reply to Comment", "type": "main", "index": 0}], [{"node": "Generate Summary", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 8, $$"f20e9a90-f8db-4f42-acdb-1e99295a0a0c"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Send Reply to Comment"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/uploadposts/comments/reply", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "specifyBody": "json", "jsonBody": "={\n  \"platform\": \"instagram\",\n  \"user\": \"{{ $json.profileUsername }}\",\n  \"comment_id\": \"{{ $json.commentId }}\",\n  \"message\": \"{{ $json.replyMessage }}\"\n}", "options": {}}, "id": "f20e9a90-f8db-4f42-acdb-1e99295a0a0c", "name": "Send Reply to Comment", "type": "n8n-nodes-base.httpRequest", "position": [1552, 288], "typeVersion": 4.1}, "connections": {"main": [[{"node": "Check Reply Success", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 9, $$"7e4c9bd5-973f-4a15-941d-239ae9581bd8"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Check Reply Success"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": false, "typeValidation": "loose"}, "combinator": "or", "conditions": [{"id": "success_check", "operator": {"type": "boolean", "operation": "equal"}, "leftValue": "={{ $json.success }}", "rightValue": true}, {"id": "15c2064a-8fbd-446e-8d36-29852df64def", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.success }}", "rightValue": "=true"}]}, "options": {"ignoreCase": true, "looseTypeValidation": true}}, "id": "7e4c9bd5-973f-4a15-941d-239ae9581bd8", "name": "Check Reply Success", "type": "n8n-nodes-base.if", "position": [1712, 192], "typeVersion": 2}, "connections": {"main": [[{"node": "Record Contacted User", "type": "main", "index": 0}], [{"node": "Log Failed Reply", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 10, $$"730bb698-62e4-4944-83c3-982864140daf"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Log Failed Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Log failed replies for debugging\nconst failedReply = {\n  userId: $('Filter New Comments').item.json.userId,\n  username: $('Filter New Comments').item.json.username,\n  commentId: $('Filter New Comments').item.json.commentId,\n  error: $json.error || 'Unknown error',\n  timestamp: new Date().toISOString()\n};\n\nconsole.log('❌ Failed to send reply:', failedReply);\n\nreturn [{ json: failedReply }];"}, "id": "730bb698-62e4-4944-83c3-982864140daf", "name": "Log Failed Reply", "type": "n8n-nodes-base.code", "position": [1936, 272], "typeVersion": 2}, "connections": {"main": [[{"node": "Generate Summary", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 11, $$"40146447-62b1-4c97-87f6-44db758b4c8d"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Record Contacted User"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "mode": "list", "value": "1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit?usp=drivesdk", "cachedResultName": "respuestas a post de instagram"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1SNZYngGfvIxZJ6VAiwD9Keuj6DugbijLH59vyK4L298/edit#gid=0", "cachedResultName": "Hoja 1"}, "columns": {"value": {"post_url": "={{ $('Filter New Comments').item.json.postUrl }}", "username": "={{ $('Filter New Comments').item.json.username }}", "timestamp": "={{ $('Filter New Comments').item.json.timestamp }}", "comment_id": "={{ $('Filter New Comments').item.json.commentId }}", "message_sent": "={{ $('Filter New Comments').item.json.replyMessage }}"}, "schema": [{"id": "comment_id", "type": "string", "display": true, "required": false, "displayName": "comment_id", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "username", "type": "string", "display": true, "required": false, "displayName": "username", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "message_sent", "type": "string", "display": true, "required": false, "displayName": "message_sent", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "timestamp", "type": "string", "display": true, "required": false, "displayName": "timestamp", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "post_url", "type": "string", "display": true, "required": false, "displayName": "post_url", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": [], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "40146447-62b1-4c97-87f6-44db758b4c8d", "name": "Record Contacted User", "type": "n8n-nodes-base.googleSheets", "position": [1936, 112], "typeVersion": 4}, "connections": {"main": [[{"node": "Generate Summary", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_Instagram_comment_response_with_DMs___Google_Sheets_tracking"$$::jsonb::text, 12, $$"c87fe62f-9024-4827-8c56-65075e00fb23"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Generate Summary"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Summary of the monitoring session with proper error handling\nlet totalComments = 0;\nlet newComments = 0;\nlet successfulReplies = 0;\nlet failedReplies = 0;\nlet monitoredPostUrl = '';\n\ntry {\n  // Get total comments (handle if node wasn't executed)\n  const getPostCommentsData = $('Get Post Comments').first();\n  totalComments = getPostCommentsData?.json?.comments?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get total comments data:', error.message);\n  totalComments = 0;\n}\n\ntry {\n  // Get new comments (handle if node wasn't executed)\n  const filterNewCommentsData = $('Filter New Comments').all();\n  newComments = filterNewCommentsData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get new comments data:', error.message);\n  newComments = 0;\n}\n\ntry {\n  // Get successful replies (handle if node wasn't executed)\n  const recordContactedData = $('Record Contacted User').all();\n  successfulReplies = recordContactedData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get successful replies data:', error.message);\n  successfulReplies = 0;\n}\n\ntry {\n  // Get failed replies (handle if node wasn't executed)\n  const logFailedData = $('Log Failed Reply').all();\n  failedReplies = logFailedData?.length || 0;\n} catch (error) {\n  console.log('⚠️ Could not get failed replies data:', error.message);\n  failedReplies = 0;\n}\n\ntry {\n  // Get monitored post URL\n  const configData = $('Configure Post & Message').first();\n  monitoredPostUrl = configData?.json?.postUrl || 'Unknown URL';\n} catch (error) {\n  console.log('⚠️ Could not get post URL:', error.message);\n  monitoredPostUrl = 'Unknown URL';\n}\n\nconst summary = {\n  totalComments,\n  newComments,\n  successfulReplies,\n  failedReplies,\n  monitoredPostUrl,\n  timestamp: new Date().toISOString(),\n  status: 'completed'\n};\n\nconsole.log('📈 Monitoring Summary:', JSON.stringify(summary, null, 2));\n\n// Generate appropriate emoji and message\nconst emoji = successfulReplies > 0 ? '🎉' : failedReplies > 0 ? '⚠️' : totalComments > 0 ? '👀' : '😴';\nlet message = `${emoji} Monitoring cycle complete!`;\n\nif (totalComments > 0) {\n  message += ` Found ${totalComments} total comments`;\n  \n  if (newComments > 0) {\n    message += `, ${newComments} new comments`;\n    \n    if (successfulReplies > 0) {\n      message += `, sent ${successfulReplies} replies successfully`;\n    }\n    \n    if (failedReplies > 0) {\n      message += `, ${failedReplies} failed`;\n    }\n  } else {\n    message += ', no new comments to process';\n  }\n} else {\n  message += ' No comments found or error retrieving comments';\n}\n\nconsole.log(message);\nconsole.log('⏰ Next check in 15 minutes...');\nconsole.log('🔄 Workflow will continue monitoring...');\n\nreturn [{\n  json: {\n    summary,\n    message,\n    continueMonitoring: true\n  }\n}];"}, "id": "c87fe62f-9024-4827-8c56-65075e00fb23", "name": "Generate Summary", "type": "n8n-nodes-base.code", "position": [2160, 400], "typeVersion": 2}, "connections": {}}$$::jsonb);

-- N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "37kwGrSKxhiJs1rD", "name": "Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts", "active": false}, "sourcePath": "workflows/n8n/social_media/Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts", "nodes": [{"parameters": {"rule": {"interval": [{"field": "hours", "hoursInterval": 6}]}}, "id": "7f5f9934-7ab8-43e9-a4cb-1583740a2e36", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [368, 240], "typeVersion": 1.2}, {"parameters": {"promptType": "define", "text": "You are a Content Researcher Assistant at Agentic Vibe, an AI-first automation agency helping solopreneurs, creators, and digital-first founders grow their online presence — especially on LinkedIn — through scalable, hands-free content systems.\n\nYour task is to generate high-value content topics that align with our brand pillars and resonate deeply with our audience. These topics will later be expanded into posts by another agent.\n\n🔍 What to Focus On:\nGenerate content topics (not full content) based on these strategic themes:\n\nAI for Content Creation & Workflow Automation\n\nLinkedIn Automation Tools, Tactics & Growth Strategies\n\nSolopreneur Productivity Hacks Using AI & Automation\n\nSystems Thinking for Scaling Personal Brands\n\nThe Future of Work, Creators, and Automated Influence\n\nNo-Code Tools for Content & Lead Gen Automation\n\n✅ Your Output Per Topic:\nFor each idea, generate the following:\n\nTopic Title or Core Idea (1 line)\n\nShort Rationale (1–2 sentences on why this topic matters)\n\nSuggested Angle or Hook (1 LinkedIn-style framing or contrarian take)\n\n💡 Style Guide:\nKeep ideas insightful, actionable, and future-minded\n\nFavor founder-style energy: confident, sharp, and slightly contrarian when it adds value\n\nAvoid hype or jargon — focus on clarity, systemized insight, and utility", "hasOutputParser": true, "options": {}}, "id": "928e2771-ec9f-48ff-b34e-9c3ab9c4a828", "name": "Content topic generator2", "type": "@n8n/n8n-nodes-langchain.agent", "position": [720, 240], "typeVersion": 2}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "10577345-0f96-42bf-a5db-7f9f205f7359", "name": "OpenAI Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 480], "typeVersion": 1.2}, {"parameters": {"jsonSchemaExample": "[{\n \"title\": \"AI as Your First Content Hire: Why Founders Shouldn't Wait to Outsource Creation\",\n            \"rationale\": \"Most solopreneurs delay content scaling because they think hiring a ghostwriter is the next step — but AI can handle 80% with proper systems. This shifts content from a creative bottleneck to a scalable growth lever.\",\n            \"hook\": \"Ghostwriters are outdated. Train GPT once, and it ships LinkedIn gold in your voice daily. Welcome to hands-free thought leadership.\"\n          }]"}, "id": "c7094a20-a96a-4db8-9ee4-95f86de800ac", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [896, 464], "typeVersion": 1.2}, {"parameters": {"promptType": "define", "text": "=You are a linkedin content creator and copywriter. Given the title {{ $json.output[0].title }}, the rationale {{ $json.output[0].rationale }}, suggested hook. Generate text content for a linkedin post. Also describe a suitable image for the post.", "hasOutputParser": true, "batching": {}}, "id": "84b30f40-e7fa-4c46-9a82-39bbd2becfe0", "name": "Content creator", "type": "@n8n/n8n-nodes-langchain.chainLlm", "position": [1136, 240], "typeVersion": 1.7}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "6fdea8df-7cb4-4418-8dab-e5faa9e76b6b", "name": "OpenAI Chat Model1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [1136, 432], "typeVersion": 1.2}, {"parameters": {"jsonSchemaExample": "{\n  \"post title\": \"Exciting New Feature Launch 🚀\",\n  \"post content\": \"After months of collaboration, testing, and fine-tuning, we're thrilled to introduce our latest product feature: Smart Insights. It helps users uncover meaningful patterns in their data with just a few clicks. This wouldn't have been possible without our incredible team and supportive community. We're excited for what's next — and we'd love your feedback!\",\n  \"image description\": \"A laptop screen showcasing the new Smart Insights dashboard with colorful charts and graphs, surrounded by a team clapping in the background.\"\n}"}, "id": "cc1e5e3c-31de-4d1b-948b-89165fbc9769", "name": "Structured Output Parser1", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 432], "typeVersion": 1.2}, {"parameters": {"resource": "image", "prompt": "=Generate an image for a linkedin post this is the description: {{ $json.output['image description'] }} .The images should be realistic for linkedin.", "options": {}}, "id": "2ae88f2a-031c-41c3-bbb9-f1555d94863a", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [1632, 64], "typeVersion": 1.8}, {"parameters": {"promptType": "define", "text": "=You are an SEO specialist for LinkedIn. Your task is to generate highly relevant and effective hashtags for the following post. Consider the post's content, target audience, and current LinkedIn trends to maximize visibility and engagement.\n\n<post_title>{{ $json.output['post title'] }}</post_title>\n<post_content>{{ $json.output['post content'] }}</post_content>\n\nPlease generate:\n1. **3-5 broad, high-volume hashtags** (e.g., #AI, #Marketing, #Business)\n2. **3-5 niche-specific hashtags** that are directly relevant to the post's core topic (e.g., #SocialMediaAutomation, #ContentCreationAI, #LinkedInMarketingTips)\n3. **1-2 trending/topical hashtags** if applicable (e.g., #FutureOfWork, #DigitalTransformation)\n\nPresent them as a comma-separated list.", "hasOutputParser": true, "options": {}}, "id": "f3901b98-cfe4-4d48-9e35-59161cbcfdd9", "name": "Hashtag generator /SEO", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1632, 512], "typeVersion": 2}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "f3d91646-6d7b-4270-85bc-0e4684bbd0d0", "name": "OpenAI Chat Model2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [1632, 704], "typeVersion": 1.2}, {"parameters": {"jsonSchemaExample": "{\n  \"post title\": \"Exciting New Feature Launch 🚀\",\n  \"post content\": \"After months of collaboration, testing, and fine-tuning, we're thrilled to introduce our latest product feature: Smart Insights. It helps users uncover meaningful patterns in their data with just a few clicks. This wouldn't have been possible without our incredible team and supportive community. We're excited for what's next — and we'd love your feedback!\",\n  \"image description\": \"A laptop screen showcasing the new Smart Insights dashboard with colorful charts and graphs, surrounded by a team clapping in the background.\",\n\"Hashtags\":[\"#AI\",\"#Automation\"]\n}"}, "id": "692b1c2e-bdc7-474e-859e-204970f512a6", "name": "Structured Output Parser2", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1808, 704], "typeVersion": 1.2}, {"parameters": {}, "id": "f667d091-72aa-4bea-9648-4563a75265ff", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [2000, 240], "typeVersion": 3.2}, {"parameters": {"postAs": "organization", "shareMediaCategory": "IMAGE", "additionalFields": {}}, "id": "7c3a37b7-3227-43a7-86fb-c39e885570bf", "name": "LinkedIn", "type": "n8n-nodes-base.linkedIn", "position": [2272, 224], "typeVersion": 1}], "pinData": {}, "connections": {"Merge": {"main": [[{"node": "LinkedIn", "type": "main", "index": 0}]]}, "OpenAI": {"main": [[{"node": "Merge", "type": "main", "index": 0}]]}, "Content creator": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}, {"node": "Hashtag generator /SEO", "type": "main", "index": 0}]]}, "Schedule Trigger": {"main": [[{"node": "Content topic generator2", "type": "main", "index": 0}]]}, "OpenAI Chat Model": {"ai_languageModel": [[{"node": "Content topic generator2", "type": "ai_languageModel", "index": 0}]]}, "OpenAI Chat Model1": {"ai_languageModel": [[{"node": "Content creator", "type": "ai_languageModel", "index": 0}]]}, "OpenAI Chat Model2": {"ai_languageModel": [[{"node": "Hashtag generator /SEO", "type": "ai_languageModel", "index": 0}]]}, "Hashtag generator /SEO": {"main": [[{"node": "Merge", "type": "main", "index": 1}]]}, "Content topic generator2": {"main": [[{"node": "Content creator", "type": "main", "index": 0}]]}, "Structured Output Parser": {"ai_outputParser": [[{"node": "Content topic generator2", "type": "ai_outputParser", "index": 0}]]}, "Structured Output Parser1": {"ai_outputParser": [[{"node": "Content creator", "type": "ai_outputParser", "index": 0}]]}, "Structured Output Parser2": {"ai_outputParser": [[{"node": "Hashtag generator /SEO", "type": "ai_outputParser", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate"}, "versionId": "", "meta": {"templateId": "4968", "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "37kwGrSKxhiJs1rD", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Automated LinkedIn content creation with GPT-4 and DALL-E for scheduled posts"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 1, $$"7f5f9934-7ab8-43e9-a4cb-1583740a2e36"$$::jsonb::text, $$"n8n-nodes-base.scheduleTrigger"$$::jsonb::text, $$"Schedule Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"rule": {"interval": [{"field": "hours", "hoursInterval": 6}]}}, "id": "7f5f9934-7ab8-43e9-a4cb-1583740a2e36", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [368, 240], "typeVersion": 1.2}, "connections": {"main": [[{"node": "Content topic generator2", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 2, $$"10577345-0f96-42bf-a5db-7f9f205f7359"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"OpenAI Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "10577345-0f96-42bf-a5db-7f9f205f7359", "name": "OpenAI Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 480], "typeVersion": 1.2}, "connections": {"ai_languageModel": [[{"node": "Content topic generator2", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 3, $$"c7094a20-a96a-4db8-9ee4-95f86de800ac"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structured Output Parser"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsonSchemaExample": "[{\n \"title\": \"AI as Your First Content Hire: Why Founders Shouldn't Wait to Outsource Creation\",\n            \"rationale\": \"Most solopreneurs delay content scaling because they think hiring a ghostwriter is the next step — but AI can handle 80% with proper systems. This shifts content from a creative bottleneck to a scalable growth lever.\",\n            \"hook\": \"Ghostwriters are outdated. Train GPT once, and it ships LinkedIn gold in your voice daily. Welcome to hands-free thought leadership.\"\n          }]"}, "id": "c7094a20-a96a-4db8-9ee4-95f86de800ac", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [896, 464], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Content topic generator2", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 4, $$"6fdea8df-7cb4-4418-8dab-e5faa9e76b6b"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"OpenAI Chat Model1"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "6fdea8df-7cb4-4418-8dab-e5faa9e76b6b", "name": "OpenAI Chat Model1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [1136, 432], "typeVersion": 1.2}, "connections": {"ai_languageModel": [[{"node": "Content creator", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 5, $$"cc1e5e3c-31de-4d1b-948b-89165fbc9769"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structured Output Parser1"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsonSchemaExample": "{\n  \"post title\": \"Exciting New Feature Launch 🚀\",\n  \"post content\": \"After months of collaboration, testing, and fine-tuning, we're thrilled to introduce our latest product feature: Smart Insights. It helps users uncover meaningful patterns in their data with just a few clicks. This wouldn't have been possible without our incredible team and supportive community. We're excited for what's next — and we'd love your feedback!\",\n  \"image description\": \"A laptop screen showcasing the new Smart Insights dashboard with colorful charts and graphs, surrounded by a team clapping in the background.\"\n}"}, "id": "cc1e5e3c-31de-4d1b-948b-89165fbc9769", "name": "Structured Output Parser1", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 432], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Content creator", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 6, $$"f3d91646-6d7b-4270-85bc-0e4684bbd0d0"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"OpenAI Chat Model2"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini"}, "options": {}}, "id": "f3d91646-6d7b-4270-85bc-0e4684bbd0d0", "name": "OpenAI Chat Model2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [1632, 704], "typeVersion": 1.2}, "connections": {"ai_languageModel": [[{"node": "Hashtag generator /SEO", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 7, $$"692b1c2e-bdc7-474e-859e-204970f512a6"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structured Output Parser2"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsonSchemaExample": "{\n  \"post title\": \"Exciting New Feature Launch 🚀\",\n  \"post content\": \"After months of collaboration, testing, and fine-tuning, we're thrilled to introduce our latest product feature: Smart Insights. It helps users uncover meaningful patterns in their data with just a few clicks. This wouldn't have been possible without our incredible team and supportive community. We're excited for what's next — and we'd love your feedback!\",\n  \"image description\": \"A laptop screen showcasing the new Smart Insights dashboard with colorful charts and graphs, surrounded by a team clapping in the background.\",\n\"Hashtags\":[\"#AI\",\"#Automation\"]\n}"}, "id": "692b1c2e-bdc7-474e-859e-204970f512a6", "name": "Structured Output Parser2", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1808, 704], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Hashtag generator /SEO", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 8, $$"928e2771-ec9f-48ff-b34e-9c3ab9c4a828"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Content topic generator2"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "You are a Content Researcher Assistant at Agentic Vibe, an AI-first automation agency helping solopreneurs, creators, and digital-first founders grow their online presence — especially on LinkedIn — through scalable, hands-free content systems.\n\nYour task is to generate high-value content topics that align with our brand pillars and resonate deeply with our audience. These topics will later be expanded into posts by another agent.\n\n🔍 What to Focus On:\nGenerate content topics (not full content) based on these strategic themes:\n\nAI for Content Creation & Workflow Automation\n\nLinkedIn Automation Tools, Tactics & Growth Strategies\n\nSolopreneur Productivity Hacks Using AI & Automation\n\nSystems Thinking for Scaling Personal Brands\n\nThe Future of Work, Creators, and Automated Influence\n\nNo-Code Tools for Content & Lead Gen Automation\n\n✅ Your Output Per Topic:\nFor each idea, generate the following:\n\nTopic Title or Core Idea (1 line)\n\nShort Rationale (1–2 sentences on why this topic matters)\n\nSuggested Angle or Hook (1 LinkedIn-style framing or contrarian take)\n\n💡 Style Guide:\nKeep ideas insightful, actionable, and future-minded\n\nFavor founder-style energy: confident, sharp, and slightly contrarian when it adds value\n\nAvoid hype or jargon — focus on clarity, systemized insight, and utility", "hasOutputParser": true, "options": {}}, "id": "928e2771-ec9f-48ff-b34e-9c3ab9c4a828", "name": "Content topic generator2", "type": "@n8n/n8n-nodes-langchain.agent", "position": [720, 240], "typeVersion": 2}, "connections": {"main": [[{"node": "Content creator", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 9, $$"84b30f40-e7fa-4c46-9a82-39bbd2becfe0"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.chainLlm"$$::jsonb::text, $$"Content creator"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=You are a linkedin content creator and copywriter. Given the title {{ $json.output[0].title }}, the rationale {{ $json.output[0].rationale }}, suggested hook. Generate text content for a linkedin post. Also describe a suitable image for the post.", "hasOutputParser": true, "batching": {}}, "id": "84b30f40-e7fa-4c46-9a82-39bbd2becfe0", "name": "Content creator", "type": "@n8n/n8n-nodes-langchain.chainLlm", "position": [1136, 240], "typeVersion": 1.7}, "connections": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}, {"node": "Hashtag generator /SEO", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 10, $$"f3901b98-cfe4-4d48-9e35-59161cbcfdd9"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Hashtag generator /SEO"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=You are an SEO specialist for LinkedIn. Your task is to generate highly relevant and effective hashtags for the following post. Consider the post's content, target audience, and current LinkedIn trends to maximize visibility and engagement.\n\n<post_title>{{ $json.output['post title'] }}</post_title>\n<post_content>{{ $json.output['post content'] }}</post_content>\n\nPlease generate:\n1. **3-5 broad, high-volume hashtags** (e.g., #AI, #Marketing, #Business)\n2. **3-5 niche-specific hashtags** that are directly relevant to the post's core topic (e.g., #SocialMediaAutomation, #ContentCreationAI, #LinkedInMarketingTips)\n3. **1-2 trending/topical hashtags** if applicable (e.g., #FutureOfWork, #DigitalTransformation)\n\nPresent them as a comma-separated list.", "hasOutputParser": true, "options": {}}, "id": "f3901b98-cfe4-4d48-9e35-59161cbcfdd9", "name": "Hashtag generator /SEO", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1632, 512], "typeVersion": 2}, "connections": {"main": [[{"node": "Merge", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 11, $$"2ae88f2a-031c-41c3-bbb9-f1555d94863a"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.openAi"$$::jsonb::text, $$"OpenAI"$$::jsonb::text, $${"n8n_node": {"parameters": {"resource": "image", "prompt": "=Generate an image for a linkedin post this is the description: {{ $json.output['image description'] }} .The images should be realistic for linkedin.", "options": {}}, "id": "2ae88f2a-031c-41c3-bbb9-f1555d94863a", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [1632, 64], "typeVersion": 1.8}, "connections": {"main": [[{"node": "Merge", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 12, $$"f667d091-72aa-4bea-9648-4563a75265ff"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "f667d091-72aa-4bea-9648-4563a75265ff", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [2000, 240], "typeVersion": 3.2}, "connections": {"main": [[{"node": "LinkedIn", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Automated_LinkedIn_content_creation_with_GPT-4_and_DALL-E_for_scheduled_posts"$$::jsonb::text, 13, $$"7c3a37b7-3227-43a7-86fb-c39e885570bf"$$::jsonb::text, $$"n8n-nodes-base.linkedIn"$$::jsonb::text, $$"LinkedIn"$$::jsonb::text, $${"n8n_node": {"parameters": {"postAs": "organization", "shareMediaCategory": "IMAGE", "additionalFields": {}}, "id": "7c3a37b7-3227-43a7-86fb-c39e885570bf", "name": "LinkedIn", "type": "n8n-nodes-base.linkedIn", "position": [2272, 224], "typeVersion": 1}, "connections": {}}$$::jsonb);

-- N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"My workflow 2"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Bulk Auto-Publish Videos to Social Networks with AI Copy and Client Approval.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "aEkP9LlF439cyIav", "name": "My workflow 2", "active": false}, "sourcePath": "workflows/n8n/social_media/Bulk Auto-Publish Videos to Social Networks with AI Copy and Client Approval.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "My workflow 2", "nodes": [{"parameters": {"content": "## Flow 2: Approval & auto-publish\n\nEvery 15 minutes the workflow reads VideosTable, filters Status=approved, downloads the file and schedules it to the enabled platforms via Upload-Post. After a successful schedule, it updates the row to Status=scheduled.", "height": 180, "width": 468}, "id": "19427280-0db3-45e8-8aef-edc7fa5c7013", "name": "PUBLISHER NOTE", "type": "n8n-nodes-base.stickyNote", "position": [80, 960], "typeVersion": 1}, {"parameters": {"content": "## Flow 1: Save drafts\n\nFormats the AI output plus schedule info and appends a new row in VideosTable with Status=draft. Change Status to approved when you want Flow 2 to publish it.", "height": 580, "width": 420}, "id": "66518d7d-fa59-4b52-a3fb-d65ddbb9c0ac", "name": "SAVE NOTE", "type": "n8n-nodes-base.stickyNote", "position": [2576, 304], "typeVersion": 1}, {"parameters": {"content": "## Flow 1: AI analysis & copy\n\nEach video is downloaded, analyzed with Gemini Flash, then Gemini Pro generates unique TikTok/Instagram/YouTube titles, descriptions and hashtags. The parser enforces valid JSON before saving.", "height": 584, "width": 712}, "id": "c01b9298-7407-407f-8998-2ad77bfc900b", "name": "AI NOTE", "type": "n8n-nodes-base.stickyNote", "position": [1840, 304], "typeVersion": 1}, {"parameters": {"content": "## Flow 1: Campaign intake & Drive fetch\n\nThe form collects campaign inputs. Google Drive lists files in the folder, then the filter keeps only video files before building the posting calendar.", "height": 516, "width": 460}, "id": "2a4b1fdb-27ee-49db-86fa-43150833e642", "name": "FETCH NOTE", "type": "n8n-nodes-base.stickyNote", "position": [640, 368], "typeVersion": 1}, {"parameters": {"content": "## How it works\nThis template has two flows. Flow 1 starts with a Form, reads all videos from a Google Drive folder, filters to keep video files, and builds a posting calendar using the start date, cadence and publish hour. Each file is downloaded, analyzed with Gemini, and used to generate platform-specific titles, descriptions and hashtags for TikTok, Instagram Reels and YouTube Shorts. The workflow then formats the results and appends them to a Google Sheet as drafts.\n\n## Setup steps\n1) Prepare a Google Drive folder with your videos.\n2) Copy this template sheet in your drive: https://docs.google.com/spreadsheets/d/1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw/edit?usp=sharing\n3) Connect Google Drive, Google Sheets and Google Gemini credentials.\n4) Run the Form and provide the Drive Folder ID, Upload-Post profile username, platforms, timezone, start date, cadence, publish hour, and Sheet ID.\n5) Activate the workflow. Set any draft row Status to approved; Flow 2 checks every 15 minutes, schedules it via Upload-Post, and updates the row to scheduled.", "height": 456, "width": 560, "color": 4}, "id": "768f5e17-5bb2-442f-b090-bd961de46b72", "name": "WORKFLOW INFO", "type": "n8n-nodes-base.stickyNote", "position": [0, 0], "typeVersion": 1}, {"parameters": {"formTitle": "Social Video Autopilot", "formDescription": "Batch process and schedule your videos across TikTok, Instagram & YouTube with AI-powered optimization", "formFields": {"values": [{"fieldLabel": "Google Drive Folder ID", "placeholder": "1jojIQ8TUjC_O-HfuhcjZfJSGSOl-h0Om", "requiredField": true}, {"fieldLabel": "Profile Username (Upload-Post)", "placeholder": "mi_perfil_whitelabel", "requiredField": true}, {"fieldLabel": "Platforms", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "TikTok, Instagram, YouTube"}, {"option": "TikTok, Instagram"}, {"option": "TikTok, YouTube"}, {"option": "Instagram, YouTube"}, {"option": "TikTok"}, {"option": "Instagram"}, {"option": "YouTube"}]}, "requiredField": true}, {"fieldLabel": "Start Date (YYYY-MM-DD)", "placeholder": "2025-12-09", "requiredField": true}, {"fieldLabel": "Cadence", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "1_daily"}, {"option": "5_per_week"}, {"option": "3_per_week"}]}, "requiredField": true}, {"fieldLabel": "Publish Hour (HH:MM)", "placeholder": "09:00", "requiredField": true}, {"fieldLabel": "Google Sheet ID (for tracking)", "placeholder": "1lg_YOUR_AWS_SECRET_KEY_HERE", "requiredField": true}]}, "options": {}}, "id": "c2514ef0-db49-46b5-99f5-b02e438a00a3", "name": "Start Campaign", "type": "n8n-nodes-base.formTrigger", "position": [272, 544], "webhookId": "8ab742a3-8535-4f48-83b2-568a4848a68c", "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "drive_folder_id", "name": "drive_folder_id", "type": "string", "value": "={{ $json['Google Drive Folder ID'] }}"}, {"id": "profile_username", "name": "profile_username", "type": "string", "value": "={{ $json['Profile Username (Upload-Post)'] }}"}, {"id": "platforms_raw", "name": "platforms_raw", "type": "string", "value": "={{ $json['Platforms'] }}"}, {"id": "timezone", "name": "timezone", "type": "string", "value": "={{ $json['Timezone'] }}"}, {"id": "start_date", "name": "start_date", "type": "string", "value": "={{ $json['Start Date (YYYY-MM-DD)'] }}"}, {"id": "cadence", "name": "cadence", "type": "string", "value": "={{ $json['Cadence'] }}"}, {"id": "publish_hour", "name": "publish_hour", "type": "string", "value": "={{ $json['Publish Hour (HH:MM)'] }}"}, {"id": "sheet_id", "name": "sheet_id", "type": "string", "value": "={{ $json['Google Sheet ID (for tracking)'] }}"}]}, "options": {}}, "id": "f8358fc8-6a71-4599-9ad1-3eccad1c4682", "name": "Campaign Settings", "type": "n8n-nodes-base.set", "position": [432, 544], "typeVersion": 3.4}, {"parameters": {"resource": "fileFolder", "searchMethod": "query", "queryString": "='{{ $json.drive_folder_id }}' in parents and trashed = false", "returnAll": true, "filter": {}, "options": {}}, "id": "a8db17f7-8041-4c64-a2be-29648de09866", "name": "Fetch Videos from Drive", "type": "n8n-nodes-base.googleDrive", "position": [704, 544], "typeVersion": 3}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "or", "conditions": [{"id": "video-mp4", "operator": {"type": "string", "operation": "contains"}, "leftValue": "={{ $json.name }}", "rightValue": ".mp4"}]}, "options": {}}, "id": "5615edc4-ec87-4c3f-94c5-ad2f457b64d8", "name": "Video Files Only", "type": "n8n-nodes-base.filter", "position": [944, 544], "typeVersion": 2.2}, {"parameters": {"jsCode": "// Get configuration from Campaign Settings node\nconst config = $('Campaign Settings').first().json;\n\nconst items = $input.all();\nconst enrichedItems = [];\n\nconst startDate = new Date(config.start_date);\nlet cadenceDays = [];\n\nswitch(config.cadence) {\n  case '1_daily':\n    for(let i = 0; i < items.length; i++) cadenceDays.push(i);\n    break;\n  case '5_per_week':\n    let dayCounter5 = 0;\n    let weekDay5 = startDate.getDay();\n    for(let i = 0; i < items.length; i++) {\n      while(weekDay5 === 0 || weekDay5 === 6) {\n        dayCounter5++;\n        weekDay5 = (startDate.getDay() + dayCounter5) % 7;\n      }\n      cadenceDays.push(dayCounter5);\n      dayCounter5++;\n      weekDay5 = (startDate.getDay() + dayCounter5) % 7;\n    }\n    break;\n  case '3_per_week':\n    let dayCounter3 = 0;\n    for(let i = 0; i < items.length; i++) {\n      while(![1, 3, 5].includes((startDate.getDay() + dayCounter3) % 7)) dayCounter3++;\n      cadenceDays.push(dayCounter3);\n      dayCounter3++;\n    }\n    break;\n}\n\nfor (let i = 0; i < items.length; i++) {\n  const item = items[i];\n  const scheduleDaysOffset = cadenceDays[i] ?? i;\n\n  const scheduleDate = new Date(startDate);\n  scheduleDate.setDate(scheduleDate.getDate() + scheduleDaysOffset);\n  const scheduleDateStr = scheduleDate.toISOString().split('T')[0];\n  const scheduleDateTime = `${scheduleDateStr}T${config.publish_hour}:00`;\n\n  enrichedItems.push({\n    json: {\n      ...item.json,\n      video_index: i + 1,\n      total_videos: items.length,\n      config: {\n        drive_folder_id: config.drive_folder_id,\n        profile_username: config.profile_username,\n        platforms_raw: config.platforms_raw,\n        timezone: config.timezone,\n        start_date: config.start_date,\n        cadence: config.cadence,\n        publish_hour: config.publish_hour,\n        sheet_id: config.sheet_id\n      },\n      schedule: {\n        date: scheduleDateStr,\n        datetime: scheduleDateTime\n      }\n    }\n  });\n}\n\nreturn enrichedItems;"}, "id": "030f8651-615d-4292-a2d8-5097842c4847", "name": "Build Schedule Calendar", "type": "n8n-nodes-base.code", "position": [1184, 544], "typeVersion": 2}, {"parameters": {"options": {}}, "id": "81f5d473-e690-4574-83b6-9bacd17429f0", "name": "Process Each Video", "type": "n8n-nodes-base.splitInBatches", "position": [1424, 544], "typeVersion": 3}, {"parameters": {"operation": "download", "fileId": {"__rl": true, "mode": "id", "value": "={{ $json.id }}"}, "options": {}}, "id": "a38e1cbf-0baa-4141-b526-c29930602739", "name": "Download from Drive", "type": "n8n-nodes-base.googleDrive", "position": [1664, 528], "typeVersion": 3}, {"parameters": {"resource": "video", "operation": "analyze", "modelId": {"__rl": true, "mode": "list", "value": "models/gemini-2.5-flash", "cachedResultName": "models/gemini-2.5-flash"}, "text": "=Analyze the attached video and provide:\n\n1) DETAILED DESCRIPTION: A thorough, faithful narrative of what is seen and heard.\n2) FULL TRANSCRIPTION of the audio.\n3) KEYWORDS: 10-15 SEO-relevant keywords.\n4) KEY MOMENTS with approximate timestamps.\n5) CONTENT TYPE (tutorial, review, vlog, entertainment, educational, etc.).\n6) TONE (serious, funny, professional, casual, etc.).\n7) DETECTED PRIMARY LANGUAGE of the spoken content.\n\nImportant output rule:\nStart your answer with a single line exactly like:\nDetected language: <English|Spanish|Other>\n\nThen write the rest of the analysis in English.\nThis analysis will be used to generate social titles and descriptions in the same detected language.", "inputType": "binary", "options": {}}, "id": "3421ea97-cb06-4e03-a9ac-9b06f6513ab8", "name": "AI Video Analysis", "type": "@n8n/n8n-nodes-langchain.googleGemini", "position": [1904, 528], "typeVersion": 1}, {"parameters": {"promptType": "define", "text": "=[VIDEO ANALYSIS]\n{{ $json.content.parts[0].text }}\n\n[FILE INFO]\nName: {{ $('Download from Drive').item.json.name }}\n\n[CAMPAIGN SETTINGS]\nPlatforms: {{ $json.config.platforms_raw }}\n\n[GOAL]\nGenerate platform-specific titles, descriptions and hashtags for the selected platforms.\n\nLanguage rule:\n- Use the SAME language as the video.\n- The analysis starts with \"Detected language:\". Follow it strictly.\n- If it says English, write everything in English.\n- If it says Spanish, write everything in Spanish (Spain).\n\nOutput rules:\n- Each platform must be UNIQUE (do not copy/paste across platforms).\n- Return ONLY valid JSON matching this exact structure:\n{\n  \"tiktok\": {\n    \"title\": \"Optimized TikTok title (max 150 chars, strong hook)\",\n    \"description\": \"Short, engaging TikTok description\",\n    \"hashtags\": \"#hashtag1 #hashtag2 ...\"\n  },\n  \"instagram\": {\n    \"title\": \"Optimized Instagram Reels caption\",\n    \"description\": \"Value-driven description with CTA\",\n    \"hashtags\": \"#hashtag1 #hashtag2 ...\"\n  },\n  \"youtube\": {\n    \"title\": \"SEO-first YouTube Shorts title\",\n    \"description\": \"YouTube description with natural keywords and CTA\",\n    \"tags\": \"tag1, tag2, tag3\"\n  },\n  \"summary\": \"Very short internal summary\"\n}", "hasOutputParser": true, "options": {"systemMessage": "You are a social media content marketing expert specialized in TikTok, Instagram Reels and YouTube Shorts.\n\nYour goals:\n- Maximize CTR\n- Improve retention\n- Increase engagement\n- Improve organic reach\n- Boost SEO on YouTube\n\nPlatform guidelines:\n\nTikTok:\n- Short, punchy titles with an emotional hook\n- Use emojis sparingly if the language/style fits\n- 10-15 hashtags mixing trending + niche\n- Casual, native tone\n\nInstagram Reels:\n- Strong first line hook\n- Slightly longer caption with light storytelling\n- Clear CTA (save, share, comment)\n- 20-30 hashtags mixing large/medium/niche\n\nYouTube Shorts:\n- SEO-first title, main keyword near the start\n- Ideal 50-60 characters\n- Description with natural keywords and CTA\n- 10-15 tags comma-separated\n\nCritical rules:\n- Each platform content must be DIFFERENT\n- Do not invent facts not present in the video\n- Output ONLY valid JSON, no markdown\n- Use the language detected in the analysis line: \"Detected language:\""}}, "id": "31b7814f-c2f9-4427-91a9-f587d01b8940", "name": "Generate Social Copy", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2096, 528], "retryOnFail": true, "typeVersion": 3}, {"parameters": {"options": {}}, "id": "a759dc98-8795-4c28-a810-d3e5513d9545", "name": "Gemini Pro", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [2096, 752], "typeVersion": 1}, {"parameters": {"jsonSchemaExample": "{\n  \"tiktok\": {\n    \"title\": \"Optimized TikTok title (max 150 chars, strong hook)\",\n    \"description\": \"Short, engaging TikTok description\",\n    \"hashtags\": \"#hashtag1 #hashtag2 #hashtag3\"\n  },\n  \"instagram\": {\n    \"title\": \"Optimized Instagram Reels caption\",\n    \"description\": \"Value-driven description with CTA\",\n    \"hashtags\": \"#hashtag1 #hashtag2\"\n  },\n  \"youtube\": {\n    \"title\": \"SEO-first YouTube Shorts title\",\n    \"description\": \"YouTube description with natural keywords and CTA\",\n    \"tags\": \"tag1, tag2, tag3\"\n  },\n  \"summary\": \"Very short internal summary\"\n}", "autoFix": true}, "id": "d0ae1c56-6eaf-4744-ac4f-86b16575a3df", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [2240, 736], "typeVersion": 1.3}, {"parameters": {"jsCode": "const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const calendarInfo = $('Build Schedule Calendar').item?.json ?? {};\n  const downloadInfo = $('Download from Drive').item?.json ?? {};\n\n  const makeBaseRow = () => ({\n    \"Video ID\": calendarInfo?.id || downloadInfo?.id || 'unknown',\n    \"Video Name\": downloadInfo?.name || calendarInfo?.name || 'unknown',\n    \"Index\": String(calendarInfo?.video_index ?? ''),\n    \"Status\": 'draft',\n    \"Schedule Date\": calendarInfo?.schedule?.date || '',\n    \"Schedule DateTime\": calendarInfo?.schedule?.datetime || '',\n\n    \"TikTok Title\": '',\n    \"TikTok Description\": '',\n    \"TikTok Hashtags\": '',\n\n    \"Instagram Title\": '',\n    \"Instagram Description\": '',\n    \"Instagram Hashtags\": '',\n\n    \"YouTube Title\": '',\n    \"YouTube Description\": '',\n    \"YouTube Tags\": '',\n\n    \"Summary\": '',\n    \"Profile\": calendarInfo?.config?.profile_username || '',\n    \"Platforms\": calendarInfo?.config?.platforms_raw || '',\n    \"Created At\": new Date().toISOString()\n  });\n\n  try {\n    const rawOutput = item.json.output ?? item.json.text ?? item.json;\n\n    let content;\n    if (rawOutput && typeof rawOutput === 'object' && !Array.isArray(rawOutput)) {\n      content = rawOutput;\n    } else {\n      let cleanedOutput = String(rawOutput)\n        .replace(/```json\\n?/g, '')\n        .replace(/```\\n?/g, '')\n        .trim();\n\n      const firstBrace = cleanedOutput.indexOf('{');\n      const lastBrace = cleanedOutput.lastIndexOf('}');\n      if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {\n        cleanedOutput = cleanedOutput.slice(firstBrace, lastBrace + 1);\n      }\n\n      content = JSON.parse(cleanedOutput);\n    }\n\n    const row = makeBaseRow();\n\n    row[\"TikTok Title\"] = content.tiktok?.title || '';\n    row[\"TikTok Description\"] = content.tiktok?.description || '';\n    row[\"TikTok Hashtags\"] = content.tiktok?.hashtags || '';\n\n    row[\"Instagram Title\"] = content.instagram?.title || '';\n    row[\"Instagram Description\"] = content.instagram?.description || '';\n    row[\"Instagram Hashtags\"] = content.instagram?.hashtags || '';\n\n    row[\"YouTube Title\"] = content.youtube?.title || '';\n    row[\"YouTube Description\"] = content.youtube?.description || '';\n    row[\"YouTube Tags\"] = content.youtube?.tags || '';\n\n    row[\"Summary\"] = content.summary || '';\n\n    results.push({ json: row });\n  } catch (error) {\n    const row = makeBaseRow();\n    row[\"Status\"] = 'error';\n    row[\"Summary\"] = `PARSE_ERROR: ${error.message}`;\n    results.push({ json: row });\n  }\n}\n\nreturn results;"}, "id": "c6dac1ea-6c04-4458-88f3-0dd5c17af102", "name": "Format Content Data", "type": "n8n-nodes-base.code", "position": [2400, 528], "typeVersion": 2}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "mode": "id", "value": "={{ $('Campaign Settings').first().json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "name", "value": "VideosTable"}, "columns": {"value": {}, "schema": [{"id": "Video ID", "type": "string", "display": true, "required": false, "displayName": "Video ID", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Name", "type": "string", "display": true, "required": false, "displayName": "Video Name", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Index", "type": "string", "display": true, "required": false, "displayName": "Index", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule Date", "type": "string", "display": true, "required": false, "displayName": "Schedule Date", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule DateTime", "type": "string", "display": true, "required": false, "displayName": "Schedule DateTime", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Title", "type": "string", "display": true, "required": false, "displayName": "TikTok Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Description", "type": "string", "display": true, "required": false, "displayName": "TikTok Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Hashtags", "type": "string", "display": true, "required": false, "displayName": "TikTok Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Title", "type": "string", "display": true, "required": false, "displayName": "Instagram Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Description", "type": "string", "display": true, "required": false, "displayName": "Instagram Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Hashtags", "type": "string", "display": true, "required": false, "displayName": "Instagram Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Title", "type": "string", "display": true, "required": false, "displayName": "YouTube Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Description", "type": "string", "display": true, "required": false, "displayName": "YouTube Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Tags", "type": "string", "display": true, "required": false, "displayName": "YouTube Tags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Summary", "type": "string", "display": true, "required": false, "displayName": "Summary", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Profile", "type": "string", "display": true, "required": false, "displayName": "Profile", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Platforms", "type": "string", "display": true, "required": false, "displayName": "Platforms", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Created At", "type": "string", "display": true, "required": false, "displayName": "Created At", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "autoMapInputData", "matchingColumns": [], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {"cellFormat": "USER_ENTERED"}}, "id": "947ac55b-929a-4ae0-853d-3172ea9463e6", "name": "Save Draft to Sheet", "type": "n8n-nodes-base.googleSheets", "position": [2640, 528], "typeVersion": 4.7}, {"parameters": {"assignments": {"assignments": [{"id": "sheet_id_2", "name": "sheet_id", "type": "string", "value": "1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw"}, {"id": "drive_id_2", "name": "drive_folder_id", "type": "string", "value": "1LB5YDDVnt0vLeC9qN1jc0UgLjMsnCRYn"}, {"id": "profile_2", "name": "profile_username", "type": "string", "value": "automated-tests"}]}, "options": {}}, "id": "2b06b906-7dc6-4a0d-8dc2-2f43be827841", "name": "Publisher Config", "type": "n8n-nodes-base.set", "position": [464, 1200], "typeVersion": 3.4}, {"parameters": {"documentId": {"__rl": true, "mode": "id", "value": "={{ $json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "name", "value": "VideosTable"}, "options": {}}, "id": "e7bd1629-8612-42fc-954b-d5bf73fa0236", "name": "Load Content Queue", "type": "n8n-nodes-base.googleSheets", "position": [704, 1200], "typeVersion": 4.7}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "status-approved", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.Status }}", "rightValue": "approved"}]}, "options": {}}, "id": "1c646599-376e-487a-a16f-a585960ef3e4", "name": "Only Approved", "type": "n8n-nodes-base.filter", "position": [944, 1200], "typeVersion": 2.2}, {"parameters": {"options": {}}, "id": "1a515324-2bb0-4b1c-8ac1-756b6513dd14", "name": "Process Queue", "type": "n8n-nodes-base.splitInBatches", "position": [1184, 1200], "typeVersion": 3}, {"parameters": {"operation": "download", "fileId": {"__rl": true, "mode": "id", "value": "={{ $json['Video ID'] }}"}, "options": {}}, "id": "d3edefd0-be69-4a3e-9e27-caf1182c5219", "name": "Get Video File", "type": "n8n-nodes-base.googleDrive", "position": [1424, 1200], "typeVersion": 3}, {"parameters": {"jsCode": "const item = $input.first();\nconst sheetData = item.json;\nconst config = $('Publisher Config').first().json;\n\nconst platforms = (sheetData.Platforms || 'tiktok,instagram,youtube').toLowerCase();\n\nreturn {\n  json: {\n    video_id: sheetData['Video ID'],\n    video_name: sheetData['Video Name'],\n    row_index: sheetData.row_number,\n\n    has_tiktok: platforms.includes('tiktok'),\n    has_instagram: platforms.includes('instagram'),\n    has_youtube: platforms.includes('youtube'),\n\n    tiktok_content: [sheetData['TikTok Title'], sheetData['TikTok Description'], sheetData['TikTok Hashtags']].filter(Boolean).join('\\n\\n'),\n    instagram_content: [sheetData['Instagram Title'], sheetData['Instagram Description'], sheetData['Instagram Hashtags']].filter(Boolean).join('\\n\\n'),\n\n    youtube_title: sheetData['YouTube Title'] || '',\n    youtube_description: sheetData['YouTube Description'] || '',\n\n    schedule_datetime: sheetData['Schedule DateTime'] || '',\n\n    profile_username: sheetData.Profile || config.profile_username,\n    sheet_id: config.sheet_id\n  },\n  binary: item.binary\n};"}, "id": "1426596c-4a72-471a-aaf2-e8d785547c9f", "name": "Build Upload Payload", "type": "n8n-nodes-base.code", "position": [1664, 1200], "typeVersion": 2}, {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "tiktok-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_tiktok }}"}]}, "options": {}}, "id": "5b6f5d94-237e-464a-85e2-7b1b81f56ae7", "name": "TikTok Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1040], "typeVersion": 2.2}, {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "ig-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_instagram }}"}]}, "options": {}}, "id": "54034429-1f5f-4cd8-a97a-cf5d63077c6b", "name": "Instagram Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1200], "typeVersion": 2.2}, {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "yt-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_youtube }}"}]}, "options": {}}, "id": "2f460513-7788-48c7-8382-2043e68c9647", "name": "YouTube Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1360], "typeVersion": 2.2}, {"parameters": {"user": "automated-tests", "title": "={{ $json.tiktok_content }}", "video": "data", "platform": ["tiktok"], "operation": "uploadVideo", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "="}, "id": "10bf3045-8623-456c-a609-d4b490840c1a", "name": "Schedule TikTok", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1024], "typeVersion": 1, "credentials": {}}, {"parameters": {"user": "automated-tests", "title": "={{ $json.instagram_content }}", "video": "data", "platform": ["instagram"], "operation": "uploadVideo", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "=", "instagramMediaType": "REELS"}, "id": "ef7eda8b-7abd-4684-adb8-525a7cc50a41", "name": "Schedule Instagram", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1184], "typeVersion": 1, "credentials": {}}, {"parameters": {"user": "automated-tests", "title": "={{ $json.youtube_title }}", "video": "data", "platform": ["youtube"], "operation": "uploadVideo", "youtubeTitle": "={{ $json.youtube_title }}", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "="}, "id": "5e384334-2f45-44f2-a26c-aa760db1cbfc", "name": "Schedule YouTube", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1344], "typeVersion": 1, "credentials": {}}, {"parameters": {"operation": "update", "documentId": {"__rl": true, "mode": "id", "value": "={{ $('Publisher Config').item.json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "list", "value": 1275860196, "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw/edit#gid=1275860196", "cachedResultName": "VideosTable"}, "columns": {"value": {"Status": "scheduled", "Video ID": "={{ $('Get Video File').item.json[\"Video ID\"] }}"}, "schema": [{"id": "Video ID", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Video ID", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Name", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Video Name", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Index", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Index", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule Date", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Schedule Date", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule DateTime", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Schedule DateTime", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Hashtags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Hashtags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Tags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Tags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Summary", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Summary", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Profile", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Profile", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Platforms", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Platforms", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Created At", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Created At", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "row_number", "type": "number", "display": true, "removed": true, "readOnly": true, "required": false, "displayName": "row_number", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": ["Video ID"], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "4f7fcc4f-43db-425d-a687-ae9d0cc4780a", "name": "Mark as Scheduled", "type": "n8n-nodes-base.googleSheets", "position": [2480, 1184], "typeVersion": 4.7}, {"parameters": {"rule": {"interval": [{"field": "minutes", "minutesInterval": 15}]}}, "id": "97de94e6-4347-40ab-96af-53b84479544d", "name": "15 mins check", "type": "n8n-nodes-base.scheduleTrigger", "position": [208, 1200], "typeVersion": 1.2}, {"parameters": {"content": "## Upload to social networks\n\nIs configured Tiktok Instagram and Youtube, but you can add all : TikTok, Instagram, LinkedIn, YouTube, Facebook, X, Threads, Pinterest, Reddit, Bluesky", "height": 628, "width": 460}, "id": "f4a882fa-92bb-48aa-bd7d-75b9aa9cb08f", "name": "FETCH NOTE1", "type": "n8n-nodes-base.stickyNote", "position": [1824, 896], "typeVersion": 1}, {"parameters": {"content": "## Flow 1: Save Schedule\n\nFormats the AI output plus schedule info and appends a new row in VideosTable with Status=approved. Change Status to scheduled when you want Flow 2 to publish it.", "height": 628, "width": 420}, "id": "01908fca-ce61-412c-bae8-88a4e90f468a", "name": "SAVE NOTE1", "type": "n8n-nodes-base.stickyNote", "position": [2304, 896], "typeVersion": 1}], "pinData": {"Start Campaign": [{"json": {"Cadence": "1_daily", "Timezone": "Europe/Madrid", "formMode": "test", "Platforms": "TikTok, Instagram, YouTube", "submittedAt": "2025-12-08T23:21:42.951+01:00", "Publish Hour (HH:MM)": "19:00", "Google Drive Folder ID": "1LB5YDDVnt0vLeC9qN1jc0UgLjMsnCRYn", "Start Date (YYYY-MM-DD)": "2025-12-09", "Google Sheet ID (for tracking)": "1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw", "Profile Username (Upload-Post)": "test"}}]}, "connections": {"Gemini Pro": {"ai_languageModel": [[{"node": "Generate Social Copy", "type": "ai_languageModel", "index": 0}, {"node": "Structured Output Parser", "type": "ai_languageModel", "index": 0}]]}, "15 mins check": {"main": [[{"node": "Publisher Config", "type": "main", "index": 0}]]}, "Only Approved": {"main": [[{"node": "Process Queue", "type": "main", "index": 0}]]}, "Process Queue": {"main": [[], [{"node": "Get Video File", "type": "main", "index": 0}]]}, "Get Video File": {"main": [[{"node": "Build Upload Payload", "type": "main", "index": 0}]]}, "Start Campaign": {"main": [[{"node": "Campaign Settings", "type": "main", "index": 0}]]}, "Schedule TikTok": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}, "TikTok Enabled?": {"main": [[{"node": "Schedule TikTok", "type": "main", "index": 0}]]}, "Publisher Config": {"main": [[{"node": "Load Content Queue", "type": "main", "index": 0}]]}, "Schedule YouTube": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}, "Video Files Only": {"main": [[{"node": "Build Schedule Calendar", "type": "main", "index": 0}]]}, "YouTube Enabled?": {"main": [[{"node": "Schedule YouTube", "type": "main", "index": 0}]]}, "AI Video Analysis": {"main": [[{"node": "Generate Social Copy", "type": "main", "index": 0}]]}, "Campaign Settings": {"main": [[{"node": "Fetch Videos from Drive", "type": "main", "index": 0}]]}, "Mark as Scheduled": {"main": [[{"node": "Process Queue", "type": "main", "index": 0}]]}, "Instagram Enabled?": {"main": [[{"node": "Schedule Instagram", "type": "main", "index": 0}]]}, "Load Content Queue": {"main": [[{"node": "Only Approved", "type": "main", "index": 0}]]}, "Process Each Video": {"main": [[], [{"node": "Download from Drive", "type": "main", "index": 0}]]}, "Schedule Instagram": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}, "Download from Drive": {"main": [[{"node": "AI Video Analysis", "type": "main", "index": 0}]]}, "Format Content Data": {"main": [[{"node": "Save Draft to Sheet", "type": "main", "index": 0}]]}, "Save Draft to Sheet": {"main": [[{"node": "Process Each Video", "type": "main", "index": 0}]]}, "Build Upload Payload": {"main": [[{"node": "TikTok Enabled?", "type": "main", "index": 0}, {"node": "Instagram Enabled?", "type": "main", "index": 0}, {"node": "YouTube Enabled?", "type": "main", "index": 0}]]}, "Generate Social Copy": {"main": [[{"node": "Format Content Data", "type": "main", "index": 0}]]}, "Build Schedule Calendar": {"main": [[{"node": "Process Each Video", "type": "main", "index": 0}]]}, "Fetch Videos from Drive": {"main": [[{"node": "Video Files Only", "type": "main", "index": 0}]]}, "Structured Output Parser": {"ai_outputParser": [[{"node": "Generate Social Copy", "type": "ai_outputParser", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "00665782-1d5f-48ed-a230-d2dc789f42ce", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "aEkP9LlF439cyIav", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"My workflow 2"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 1, $$"19427280-0db3-45e8-8aef-edc7fa5c7013"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"PUBLISHER NOTE"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Flow 2: Approval & auto-publish\n\nEvery 15 minutes the workflow reads VideosTable, filters Status=approved, downloads the file and schedules it to the enabled platforms via Upload-Post. After a successful schedule, it updates the row to Status=scheduled.", "height": 180, "width": 468}, "id": "19427280-0db3-45e8-8aef-edc7fa5c7013", "name": "PUBLISHER NOTE", "type": "n8n-nodes-base.stickyNote", "position": [80, 960], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 2, $$"66518d7d-fa59-4b52-a3fb-d65ddbb9c0ac"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"SAVE NOTE"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Flow 1: Save drafts\n\nFormats the AI output plus schedule info and appends a new row in VideosTable with Status=draft. Change Status to approved when you want Flow 2 to publish it.", "height": 580, "width": 420}, "id": "66518d7d-fa59-4b52-a3fb-d65ddbb9c0ac", "name": "SAVE NOTE", "type": "n8n-nodes-base.stickyNote", "position": [2576, 304], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 3, $$"c01b9298-7407-407f-8998-2ad77bfc900b"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"AI NOTE"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Flow 1: AI analysis & copy\n\nEach video is downloaded, analyzed with Gemini Flash, then Gemini Pro generates unique TikTok/Instagram/YouTube titles, descriptions and hashtags. The parser enforces valid JSON before saving.", "height": 584, "width": 712}, "id": "c01b9298-7407-407f-8998-2ad77bfc900b", "name": "AI NOTE", "type": "n8n-nodes-base.stickyNote", "position": [1840, 304], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 4, $$"2a4b1fdb-27ee-49db-86fa-43150833e642"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"FETCH NOTE"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Flow 1: Campaign intake & Drive fetch\n\nThe form collects campaign inputs. Google Drive lists files in the folder, then the filter keeps only video files before building the posting calendar.", "height": 516, "width": 460}, "id": "2a4b1fdb-27ee-49db-86fa-43150833e642", "name": "FETCH NOTE", "type": "n8n-nodes-base.stickyNote", "position": [640, 368], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 5, $$"768f5e17-5bb2-442f-b090-bd961de46b72"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"WORKFLOW INFO"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## How it works\nThis template has two flows. Flow 1 starts with a Form, reads all videos from a Google Drive folder, filters to keep video files, and builds a posting calendar using the start date, cadence and publish hour. Each file is downloaded, analyzed with Gemini, and used to generate platform-specific titles, descriptions and hashtags for TikTok, Instagram Reels and YouTube Shorts. The workflow then formats the results and appends them to a Google Sheet as drafts.\n\n## Setup steps\n1) Prepare a Google Drive folder with your videos.\n2) Copy this template sheet in your drive: https://docs.google.com/spreadsheets/d/1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw/edit?usp=sharing\n3) Connect Google Drive, Google Sheets and Google Gemini credentials.\n4) Run the Form and provide the Drive Folder ID, Upload-Post profile username, platforms, timezone, start date, cadence, publish hour, and Sheet ID.\n5) Activate the workflow. Set any draft row Status to approved; Flow 2 checks every 15 minutes, schedules it via Upload-Post, and updates the row to scheduled.", "height": 456, "width": 560, "color": 4}, "id": "768f5e17-5bb2-442f-b090-bd961de46b72", "name": "WORKFLOW INFO", "type": "n8n-nodes-base.stickyNote", "position": [0, 0], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 6, $$"c2514ef0-db49-46b5-99f5-b02e438a00a3"$$::jsonb::text, $$"n8n-nodes-base.formTrigger"$$::jsonb::text, $$"Start Campaign"$$::jsonb::text, $${"n8n_node": {"parameters": {"formTitle": "Social Video Autopilot", "formDescription": "Batch process and schedule your videos across TikTok, Instagram & YouTube with AI-powered optimization", "formFields": {"values": [{"fieldLabel": "Google Drive Folder ID", "placeholder": "1jojIQ8TUjC_O-HfuhcjZfJSGSOl-h0Om", "requiredField": true}, {"fieldLabel": "Profile Username (Upload-Post)", "placeholder": "mi_perfil_whitelabel", "requiredField": true}, {"fieldLabel": "Platforms", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "TikTok, Instagram, YouTube"}, {"option": "TikTok, Instagram"}, {"option": "TikTok, YouTube"}, {"option": "Instagram, YouTube"}, {"option": "TikTok"}, {"option": "Instagram"}, {"option": "YouTube"}]}, "requiredField": true}, {"fieldLabel": "Start Date (YYYY-MM-DD)", "placeholder": "2025-12-09", "requiredField": true}, {"fieldLabel": "Cadence", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "1_daily"}, {"option": "5_per_week"}, {"option": "3_per_week"}]}, "requiredField": true}, {"fieldLabel": "Publish Hour (HH:MM)", "placeholder": "09:00", "requiredField": true}, {"fieldLabel": "Google Sheet ID (for tracking)", "placeholder": "1lg_YOUR_AWS_SECRET_KEY_HERE", "requiredField": true}]}, "options": {}}, "id": "c2514ef0-db49-46b5-99f5-b02e438a00a3", "name": "Start Campaign", "type": "n8n-nodes-base.formTrigger", "position": [272, 544], "webhookId": "8ab742a3-8535-4f48-83b2-568a4848a68c", "typeVersion": 2.2}, "connections": {"main": [[{"node": "Campaign Settings", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 7, $$"a759dc98-8795-4c28-a810-d3e5513d9545"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatGoogleGemini"$$::jsonb::text, $$"Gemini Pro"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "a759dc98-8795-4c28-a810-d3e5513d9545", "name": "Gemini Pro", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [2096, 752], "typeVersion": 1}, "connections": {"ai_languageModel": [[{"node": "Generate Social Copy", "type": "ai_languageModel", "index": 0}, {"node": "Structured Output Parser", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 8, $$"97de94e6-4347-40ab-96af-53b84479544d"$$::jsonb::text, $$"n8n-nodes-base.scheduleTrigger"$$::jsonb::text, $$"15 mins check"$$::jsonb::text, $${"n8n_node": {"parameters": {"rule": {"interval": [{"field": "minutes", "minutesInterval": 15}]}}, "id": "97de94e6-4347-40ab-96af-53b84479544d", "name": "15 mins check", "type": "n8n-nodes-base.scheduleTrigger", "position": [208, 1200], "typeVersion": 1.2}, "connections": {"main": [[{"node": "Publisher Config", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 9, $$"f4a882fa-92bb-48aa-bd7d-75b9aa9cb08f"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"FETCH NOTE1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Upload to social networks\n\nIs configured Tiktok Instagram and Youtube, but you can add all : TikTok, Instagram, LinkedIn, YouTube, Facebook, X, Threads, Pinterest, Reddit, Bluesky", "height": 628, "width": 460}, "id": "f4a882fa-92bb-48aa-bd7d-75b9aa9cb08f", "name": "FETCH NOTE1", "type": "n8n-nodes-base.stickyNote", "position": [1824, 896], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 10, $$"01908fca-ce61-412c-bae8-88a4e90f468a"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"SAVE NOTE1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Flow 1: Save Schedule\n\nFormats the AI output plus schedule info and appends a new row in VideosTable with Status=approved. Change Status to scheduled when you want Flow 2 to publish it.", "height": 628, "width": 420}, "id": "01908fca-ce61-412c-bae8-88a4e90f468a", "name": "SAVE NOTE1", "type": "n8n-nodes-base.stickyNote", "position": [2304, 896], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 11, $$"f8358fc8-6a71-4599-9ad1-3eccad1c4682"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Campaign Settings"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "drive_folder_id", "name": "drive_folder_id", "type": "string", "value": "={{ $json['Google Drive Folder ID'] }}"}, {"id": "profile_username", "name": "profile_username", "type": "string", "value": "={{ $json['Profile Username (Upload-Post)'] }}"}, {"id": "platforms_raw", "name": "platforms_raw", "type": "string", "value": "={{ $json['Platforms'] }}"}, {"id": "timezone", "name": "timezone", "type": "string", "value": "={{ $json['Timezone'] }}"}, {"id": "start_date", "name": "start_date", "type": "string", "value": "={{ $json['Start Date (YYYY-MM-DD)'] }}"}, {"id": "cadence", "name": "cadence", "type": "string", "value": "={{ $json['Cadence'] }}"}, {"id": "publish_hour", "name": "publish_hour", "type": "string", "value": "={{ $json['Publish Hour (HH:MM)'] }}"}, {"id": "sheet_id", "name": "sheet_id", "type": "string", "value": "={{ $json['Google Sheet ID (for tracking)'] }}"}]}, "options": {}}, "id": "f8358fc8-6a71-4599-9ad1-3eccad1c4682", "name": "Campaign Settings", "type": "n8n-nodes-base.set", "position": [432, 544], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Fetch Videos from Drive", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 12, $$"d0ae1c56-6eaf-4744-ac4f-86b16575a3df"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structured Output Parser"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsonSchemaExample": "{\n  \"tiktok\": {\n    \"title\": \"Optimized TikTok title (max 150 chars, strong hook)\",\n    \"description\": \"Short, engaging TikTok description\",\n    \"hashtags\": \"#hashtag1 #hashtag2 #hashtag3\"\n  },\n  \"instagram\": {\n    \"title\": \"Optimized Instagram Reels caption\",\n    \"description\": \"Value-driven description with CTA\",\n    \"hashtags\": \"#hashtag1 #hashtag2\"\n  },\n  \"youtube\": {\n    \"title\": \"SEO-first YouTube Shorts title\",\n    \"description\": \"YouTube description with natural keywords and CTA\",\n    \"tags\": \"tag1, tag2, tag3\"\n  },\n  \"summary\": \"Very short internal summary\"\n}", "autoFix": true}, "id": "d0ae1c56-6eaf-4744-ac4f-86b16575a3df", "name": "Structured Output Parser", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [2240, 736], "typeVersion": 1.3}, "connections": {"ai_outputParser": [[{"node": "Generate Social Copy", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 13, $$"2b06b906-7dc6-4a0d-8dc2-2f43be827841"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Publisher Config"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "sheet_id_2", "name": "sheet_id", "type": "string", "value": "1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw"}, {"id": "drive_id_2", "name": "drive_folder_id", "type": "string", "value": "1LB5YDDVnt0vLeC9qN1jc0UgLjMsnCRYn"}, {"id": "profile_2", "name": "profile_username", "type": "string", "value": "automated-tests"}]}, "options": {}}, "id": "2b06b906-7dc6-4a0d-8dc2-2f43be827841", "name": "Publisher Config", "type": "n8n-nodes-base.set", "position": [464, 1200], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Load Content Queue", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 14, $$"a8db17f7-8041-4c64-a2be-29648de09866"$$::jsonb::text, $$"n8n-nodes-base.googleDrive"$$::jsonb::text, $$"Fetch Videos from Drive"$$::jsonb::text, $${"n8n_node": {"parameters": {"resource": "fileFolder", "searchMethod": "query", "queryString": "='{{ $json.drive_folder_id }}' in parents and trashed = false", "returnAll": true, "filter": {}, "options": {}}, "id": "a8db17f7-8041-4c64-a2be-29648de09866", "name": "Fetch Videos from Drive", "type": "n8n-nodes-base.googleDrive", "position": [704, 544], "typeVersion": 3}, "connections": {"main": [[{"node": "Video Files Only", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 15, $$"e7bd1629-8612-42fc-954b-d5bf73fa0236"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Load Content Queue"$$::jsonb::text, $${"n8n_node": {"parameters": {"documentId": {"__rl": true, "mode": "id", "value": "={{ $json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "name", "value": "VideosTable"}, "options": {}}, "id": "e7bd1629-8612-42fc-954b-d5bf73fa0236", "name": "Load Content Queue", "type": "n8n-nodes-base.googleSheets", "position": [704, 1200], "typeVersion": 4.7}, "connections": {"main": [[{"node": "Only Approved", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 16, $$"5615edc4-ec87-4c3f-94c5-ad2f457b64d8"$$::jsonb::text, $$"n8n-nodes-base.filter"$$::jsonb::text, $$"Video Files Only"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "or", "conditions": [{"id": "video-mp4", "operator": {"type": "string", "operation": "contains"}, "leftValue": "={{ $json.name }}", "rightValue": ".mp4"}]}, "options": {}}, "id": "5615edc4-ec87-4c3f-94c5-ad2f457b64d8", "name": "Video Files Only", "type": "n8n-nodes-base.filter", "position": [944, 544], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Build Schedule Calendar", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 17, $$"1c646599-376e-487a-a16f-a585960ef3e4"$$::jsonb::text, $$"n8n-nodes-base.filter"$$::jsonb::text, $$"Only Approved"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "status-approved", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.Status }}", "rightValue": "approved"}]}, "options": {}}, "id": "1c646599-376e-487a-a16f-a585960ef3e4", "name": "Only Approved", "type": "n8n-nodes-base.filter", "position": [944, 1200], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Process Queue", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 18, $$"030f8651-615d-4292-a2d8-5097842c4847"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Build Schedule Calendar"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Get configuration from Campaign Settings node\nconst config = $('Campaign Settings').first().json;\n\nconst items = $input.all();\nconst enrichedItems = [];\n\nconst startDate = new Date(config.start_date);\nlet cadenceDays = [];\n\nswitch(config.cadence) {\n  case '1_daily':\n    for(let i = 0; i < items.length; i++) cadenceDays.push(i);\n    break;\n  case '5_per_week':\n    let dayCounter5 = 0;\n    let weekDay5 = startDate.getDay();\n    for(let i = 0; i < items.length; i++) {\n      while(weekDay5 === 0 || weekDay5 === 6) {\n        dayCounter5++;\n        weekDay5 = (startDate.getDay() + dayCounter5) % 7;\n      }\n      cadenceDays.push(dayCounter5);\n      dayCounter5++;\n      weekDay5 = (startDate.getDay() + dayCounter5) % 7;\n    }\n    break;\n  case '3_per_week':\n    let dayCounter3 = 0;\n    for(let i = 0; i < items.length; i++) {\n      while(![1, 3, 5].includes((startDate.getDay() + dayCounter3) % 7)) dayCounter3++;\n      cadenceDays.push(dayCounter3);\n      dayCounter3++;\n    }\n    break;\n}\n\nfor (let i = 0; i < items.length; i++) {\n  const item = items[i];\n  const scheduleDaysOffset = cadenceDays[i] ?? i;\n\n  const scheduleDate = new Date(startDate);\n  scheduleDate.setDate(scheduleDate.getDate() + scheduleDaysOffset);\n  const scheduleDateStr = scheduleDate.toISOString().split('T')[0];\n  const scheduleDateTime = `${scheduleDateStr}T${config.publish_hour}:00`;\n\n  enrichedItems.push({\n    json: {\n      ...item.json,\n      video_index: i + 1,\n      total_videos: items.length,\n      config: {\n        drive_folder_id: config.drive_folder_id,\n        profile_username: config.profile_username,\n        platforms_raw: config.platforms_raw,\n        timezone: config.timezone,\n        start_date: config.start_date,\n        cadence: config.cadence,\n        publish_hour: config.publish_hour,\n        sheet_id: config.sheet_id\n      },\n      schedule: {\n        date: scheduleDateStr,\n        datetime: scheduleDateTime\n      }\n    }\n  });\n}\n\nreturn enrichedItems;"}, "id": "030f8651-615d-4292-a2d8-5097842c4847", "name": "Build Schedule Calendar", "type": "n8n-nodes-base.code", "position": [1184, 544], "typeVersion": 2}, "connections": {"main": [[{"node": "Process Each Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 19, $$"81f5d473-e690-4574-83b6-9bacd17429f0"$$::jsonb::text, $$"n8n-nodes-base.splitInBatches"$$::jsonb::text, $$"Process Each Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "81f5d473-e690-4574-83b6-9bacd17429f0", "name": "Process Each Video", "type": "n8n-nodes-base.splitInBatches", "position": [1424, 544], "typeVersion": 3}, "connections": {"main": [[], [{"node": "Download from Drive", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 20, $$"a38e1cbf-0baa-4141-b526-c29930602739"$$::jsonb::text, $$"n8n-nodes-base.googleDrive"$$::jsonb::text, $$"Download from Drive"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "download", "fileId": {"__rl": true, "mode": "id", "value": "={{ $json.id }}"}, "options": {}}, "id": "a38e1cbf-0baa-4141-b526-c29930602739", "name": "Download from Drive", "type": "n8n-nodes-base.googleDrive", "position": [1664, 528], "typeVersion": 3}, "connections": {"main": [[{"node": "AI Video Analysis", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 21, $$"3421ea97-cb06-4e03-a9ac-9b06f6513ab8"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.googleGemini"$$::jsonb::text, $$"AI Video Analysis"$$::jsonb::text, $${"n8n_node": {"parameters": {"resource": "video", "operation": "analyze", "modelId": {"__rl": true, "mode": "list", "value": "models/gemini-2.5-flash", "cachedResultName": "models/gemini-2.5-flash"}, "text": "=Analyze the attached video and provide:\n\n1) DETAILED DESCRIPTION: A thorough, faithful narrative of what is seen and heard.\n2) FULL TRANSCRIPTION of the audio.\n3) KEYWORDS: 10-15 SEO-relevant keywords.\n4) KEY MOMENTS with approximate timestamps.\n5) CONTENT TYPE (tutorial, review, vlog, entertainment, educational, etc.).\n6) TONE (serious, funny, professional, casual, etc.).\n7) DETECTED PRIMARY LANGUAGE of the spoken content.\n\nImportant output rule:\nStart your answer with a single line exactly like:\nDetected language: <English|Spanish|Other>\n\nThen write the rest of the analysis in English.\nThis analysis will be used to generate social titles and descriptions in the same detected language.", "inputType": "binary", "options": {}}, "id": "3421ea97-cb06-4e03-a9ac-9b06f6513ab8", "name": "AI Video Analysis", "type": "@n8n/n8n-nodes-langchain.googleGemini", "position": [1904, 528], "typeVersion": 1}, "connections": {"main": [[{"node": "Generate Social Copy", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 22, $$"31b7814f-c2f9-4427-91a9-f587d01b8940"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Generate Social Copy"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=[VIDEO ANALYSIS]\n{{ $json.content.parts[0].text }}\n\n[FILE INFO]\nName: {{ $('Download from Drive').item.json.name }}\n\n[CAMPAIGN SETTINGS]\nPlatforms: {{ $json.config.platforms_raw }}\n\n[GOAL]\nGenerate platform-specific titles, descriptions and hashtags for the selected platforms.\n\nLanguage rule:\n- Use the SAME language as the video.\n- The analysis starts with \"Detected language:\". Follow it strictly.\n- If it says English, write everything in English.\n- If it says Spanish, write everything in Spanish (Spain).\n\nOutput rules:\n- Each platform must be UNIQUE (do not copy/paste across platforms).\n- Return ONLY valid JSON matching this exact structure:\n{\n  \"tiktok\": {\n    \"title\": \"Optimized TikTok title (max 150 chars, strong hook)\",\n    \"description\": \"Short, engaging TikTok description\",\n    \"hashtags\": \"#hashtag1 #hashtag2 ...\"\n  },\n  \"instagram\": {\n    \"title\": \"Optimized Instagram Reels caption\",\n    \"description\": \"Value-driven description with CTA\",\n    \"hashtags\": \"#hashtag1 #hashtag2 ...\"\n  },\n  \"youtube\": {\n    \"title\": \"SEO-first YouTube Shorts title\",\n    \"description\": \"YouTube description with natural keywords and CTA\",\n    \"tags\": \"tag1, tag2, tag3\"\n  },\n  \"summary\": \"Very short internal summary\"\n}", "hasOutputParser": true, "options": {"systemMessage": "You are a social media content marketing expert specialized in TikTok, Instagram Reels and YouTube Shorts.\n\nYour goals:\n- Maximize CTR\n- Improve retention\n- Increase engagement\n- Improve organic reach\n- Boost SEO on YouTube\n\nPlatform guidelines:\n\nTikTok:\n- Short, punchy titles with an emotional hook\n- Use emojis sparingly if the language/style fits\n- 10-15 hashtags mixing trending + niche\n- Casual, native tone\n\nInstagram Reels:\n- Strong first line hook\n- Slightly longer caption with light storytelling\n- Clear CTA (save, share, comment)\n- 20-30 hashtags mixing large/medium/niche\n\nYouTube Shorts:\n- SEO-first title, main keyword near the start\n- Ideal 50-60 characters\n- Description with natural keywords and CTA\n- 10-15 tags comma-separated\n\nCritical rules:\n- Each platform content must be DIFFERENT\n- Do not invent facts not present in the video\n- Output ONLY valid JSON, no markdown\n- Use the language detected in the analysis line: \"Detected language:\""}}, "id": "31b7814f-c2f9-4427-91a9-f587d01b8940", "name": "Generate Social Copy", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2096, 528], "retryOnFail": true, "typeVersion": 3}, "connections": {"main": [[{"node": "Format Content Data", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 23, $$"c6dac1ea-6c04-4458-88f3-0dd5c17af102"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Format Content Data"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const calendarInfo = $('Build Schedule Calendar').item?.json ?? {};\n  const downloadInfo = $('Download from Drive').item?.json ?? {};\n\n  const makeBaseRow = () => ({\n    \"Video ID\": calendarInfo?.id || downloadInfo?.id || 'unknown',\n    \"Video Name\": downloadInfo?.name || calendarInfo?.name || 'unknown',\n    \"Index\": String(calendarInfo?.video_index ?? ''),\n    \"Status\": 'draft',\n    \"Schedule Date\": calendarInfo?.schedule?.date || '',\n    \"Schedule DateTime\": calendarInfo?.schedule?.datetime || '',\n\n    \"TikTok Title\": '',\n    \"TikTok Description\": '',\n    \"TikTok Hashtags\": '',\n\n    \"Instagram Title\": '',\n    \"Instagram Description\": '',\n    \"Instagram Hashtags\": '',\n\n    \"YouTube Title\": '',\n    \"YouTube Description\": '',\n    \"YouTube Tags\": '',\n\n    \"Summary\": '',\n    \"Profile\": calendarInfo?.config?.profile_username || '',\n    \"Platforms\": calendarInfo?.config?.platforms_raw || '',\n    \"Created At\": new Date().toISOString()\n  });\n\n  try {\n    const rawOutput = item.json.output ?? item.json.text ?? item.json;\n\n    let content;\n    if (rawOutput && typeof rawOutput === 'object' && !Array.isArray(rawOutput)) {\n      content = rawOutput;\n    } else {\n      let cleanedOutput = String(rawOutput)\n        .replace(/```json\\n?/g, '')\n        .replace(/```\\n?/g, '')\n        .trim();\n\n      const firstBrace = cleanedOutput.indexOf('{');\n      const lastBrace = cleanedOutput.lastIndexOf('}');\n      if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {\n        cleanedOutput = cleanedOutput.slice(firstBrace, lastBrace + 1);\n      }\n\n      content = JSON.parse(cleanedOutput);\n    }\n\n    const row = makeBaseRow();\n\n    row[\"TikTok Title\"] = content.tiktok?.title || '';\n    row[\"TikTok Description\"] = content.tiktok?.description || '';\n    row[\"TikTok Hashtags\"] = content.tiktok?.hashtags || '';\n\n    row[\"Instagram Title\"] = content.instagram?.title || '';\n    row[\"Instagram Description\"] = content.instagram?.description || '';\n    row[\"Instagram Hashtags\"] = content.instagram?.hashtags || '';\n\n    row[\"YouTube Title\"] = content.youtube?.title || '';\n    row[\"YouTube Description\"] = content.youtube?.description || '';\n    row[\"YouTube Tags\"] = content.youtube?.tags || '';\n\n    row[\"Summary\"] = content.summary || '';\n\n    results.push({ json: row });\n  } catch (error) {\n    const row = makeBaseRow();\n    row[\"Status\"] = 'error';\n    row[\"Summary\"] = `PARSE_ERROR: ${error.message}`;\n    results.push({ json: row });\n  }\n}\n\nreturn results;"}, "id": "c6dac1ea-6c04-4458-88f3-0dd5c17af102", "name": "Format Content Data", "type": "n8n-nodes-base.code", "position": [2400, 528], "typeVersion": 2}, "connections": {"main": [[{"node": "Save Draft to Sheet", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 24, $$"947ac55b-929a-4ae0-853d-3172ea9463e6"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Save Draft to Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "mode": "id", "value": "={{ $('Campaign Settings').first().json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "name", "value": "VideosTable"}, "columns": {"value": {}, "schema": [{"id": "Video ID", "type": "string", "display": true, "required": false, "displayName": "Video ID", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Name", "type": "string", "display": true, "required": false, "displayName": "Video Name", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Index", "type": "string", "display": true, "required": false, "displayName": "Index", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule Date", "type": "string", "display": true, "required": false, "displayName": "Schedule Date", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule DateTime", "type": "string", "display": true, "required": false, "displayName": "Schedule DateTime", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Title", "type": "string", "display": true, "required": false, "displayName": "TikTok Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Description", "type": "string", "display": true, "required": false, "displayName": "TikTok Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Hashtags", "type": "string", "display": true, "required": false, "displayName": "TikTok Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Title", "type": "string", "display": true, "required": false, "displayName": "Instagram Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Description", "type": "string", "display": true, "required": false, "displayName": "Instagram Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Hashtags", "type": "string", "display": true, "required": false, "displayName": "Instagram Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Title", "type": "string", "display": true, "required": false, "displayName": "YouTube Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Description", "type": "string", "display": true, "required": false, "displayName": "YouTube Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Tags", "type": "string", "display": true, "required": false, "displayName": "YouTube Tags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Summary", "type": "string", "display": true, "required": false, "displayName": "Summary", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Profile", "type": "string", "display": true, "required": false, "displayName": "Profile", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Platforms", "type": "string", "display": true, "required": false, "displayName": "Platforms", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Created At", "type": "string", "display": true, "required": false, "displayName": "Created At", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "autoMapInputData", "matchingColumns": [], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {"cellFormat": "USER_ENTERED"}}, "id": "947ac55b-929a-4ae0-853d-3172ea9463e6", "name": "Save Draft to Sheet", "type": "n8n-nodes-base.googleSheets", "position": [2640, 528], "typeVersion": 4.7}, "connections": {"main": [[{"node": "Process Each Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 25, $$"1a515324-2bb0-4b1c-8ac1-756b6513dd14"$$::jsonb::text, $$"n8n-nodes-base.splitInBatches"$$::jsonb::text, $$"Process Queue"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "1a515324-2bb0-4b1c-8ac1-756b6513dd14", "name": "Process Queue", "type": "n8n-nodes-base.splitInBatches", "position": [1184, 1200], "typeVersion": 3}, "connections": {"main": [[], [{"node": "Get Video File", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 26, $$"d3edefd0-be69-4a3e-9e27-caf1182c5219"$$::jsonb::text, $$"n8n-nodes-base.googleDrive"$$::jsonb::text, $$"Get Video File"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "download", "fileId": {"__rl": true, "mode": "id", "value": "={{ $json['Video ID'] }}"}, "options": {}}, "id": "d3edefd0-be69-4a3e-9e27-caf1182c5219", "name": "Get Video File", "type": "n8n-nodes-base.googleDrive", "position": [1424, 1200], "typeVersion": 3}, "connections": {"main": [[{"node": "Build Upload Payload", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 27, $$"1426596c-4a72-471a-aaf2-e8d785547c9f"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Build Upload Payload"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "const item = $input.first();\nconst sheetData = item.json;\nconst config = $('Publisher Config').first().json;\n\nconst platforms = (sheetData.Platforms || 'tiktok,instagram,youtube').toLowerCase();\n\nreturn {\n  json: {\n    video_id: sheetData['Video ID'],\n    video_name: sheetData['Video Name'],\n    row_index: sheetData.row_number,\n\n    has_tiktok: platforms.includes('tiktok'),\n    has_instagram: platforms.includes('instagram'),\n    has_youtube: platforms.includes('youtube'),\n\n    tiktok_content: [sheetData['TikTok Title'], sheetData['TikTok Description'], sheetData['TikTok Hashtags']].filter(Boolean).join('\\n\\n'),\n    instagram_content: [sheetData['Instagram Title'], sheetData['Instagram Description'], sheetData['Instagram Hashtags']].filter(Boolean).join('\\n\\n'),\n\n    youtube_title: sheetData['YouTube Title'] || '',\n    youtube_description: sheetData['YouTube Description'] || '',\n\n    schedule_datetime: sheetData['Schedule DateTime'] || '',\n\n    profile_username: sheetData.Profile || config.profile_username,\n    sheet_id: config.sheet_id\n  },\n  binary: item.binary\n};"}, "id": "1426596c-4a72-471a-aaf2-e8d785547c9f", "name": "Build Upload Payload", "type": "n8n-nodes-base.code", "position": [1664, 1200], "typeVersion": 2}, "connections": {"main": [[{"node": "TikTok Enabled?", "type": "main", "index": 0}, {"node": "Instagram Enabled?", "type": "main", "index": 0}, {"node": "YouTube Enabled?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 28, $$"5b6f5d94-237e-464a-85e2-7b1b81f56ae7"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"TikTok Enabled?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "tiktok-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_tiktok }}"}]}, "options": {}}, "id": "5b6f5d94-237e-464a-85e2-7b1b81f56ae7", "name": "TikTok Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1040], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Schedule TikTok", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 29, $$"54034429-1f5f-4cd8-a97a-cf5d63077c6b"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Instagram Enabled?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "ig-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_instagram }}"}]}, "options": {}}, "id": "54034429-1f5f-4cd8-a97a-cf5d63077c6b", "name": "Instagram Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1200], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Schedule Instagram", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 30, $$"2f460513-7788-48c7-8382-2043e68c9647"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"YouTube Enabled?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "yt-check", "operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.has_youtube }}"}]}, "options": {}}, "id": "2f460513-7788-48c7-8382-2043e68c9647", "name": "YouTube Enabled?", "type": "n8n-nodes-base.if", "position": [1904, 1360], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Schedule YouTube", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 31, $$"10bf3045-8623-456c-a609-d4b490840c1a"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Schedule TikTok"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "automated-tests", "title": "={{ $json.tiktok_content }}", "video": "data", "platform": ["tiktok"], "operation": "uploadVideo", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "="}, "id": "10bf3045-8623-456c-a609-d4b490840c1a", "name": "Schedule TikTok", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1024], "typeVersion": 1, "credentials": {}}, "connections": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 32, $$"ef7eda8b-7abd-4684-adb8-525a7cc50a41"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Schedule Instagram"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "automated-tests", "title": "={{ $json.instagram_content }}", "video": "data", "platform": ["instagram"], "operation": "uploadVideo", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "=", "instagramMediaType": "REELS"}, "id": "ef7eda8b-7abd-4684-adb8-525a7cc50a41", "name": "Schedule Instagram", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1184], "typeVersion": 1, "credentials": {}}, "connections": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 33, $$"5e384334-2f45-44f2-a26c-aa760db1cbfc"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Schedule YouTube"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "automated-tests", "title": "={{ $json.youtube_title }}", "video": "data", "platform": ["youtube"], "operation": "uploadVideo", "youtubeTitle": "={{ $json.youtube_title }}", "scheduledDate": "={{ $json.schedule_datetime }}", "waitForCompletion": "="}, "id": "5e384334-2f45-44f2-a26c-aa760db1cbfc", "name": "Schedule YouTube", "type": "n8n-nodes-upload-post.uploadPost", "position": [2144, 1344], "typeVersion": 1, "credentials": {}}, "connections": {"main": [[{"node": "Mark as Scheduled", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_Auto-Publish_Videos_to_Social_Networks_with_AI_Copy_and_Client_Approval"$$::jsonb::text, 34, $$"4f7fcc4f-43db-425d-a687-ae9d0cc4780a"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Mark as Scheduled"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "update", "documentId": {"__rl": true, "mode": "id", "value": "={{ $('Publisher Config').item.json.sheet_id }}"}, "sheetName": {"__rl": true, "mode": "list", "value": 1275860196, "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cegJHxj7Kx4Tg8gMr3uixpzToNc62VEvuuz37iFvnRw/edit#gid=1275860196", "cachedResultName": "VideosTable"}, "columns": {"value": {"Status": "scheduled", "Video ID": "={{ $('Get Video File').item.json[\"Video ID\"] }}"}, "schema": [{"id": "Video ID", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Video ID", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Name", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Video Name", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Index", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Index", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule Date", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Schedule Date", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Schedule DateTime", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Schedule DateTime", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "TikTok Hashtags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "TikTok Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Instagram Hashtags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Instagram Hashtags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Title", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Description", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Description", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "YouTube Tags", "type": "string", "display": true, "removed": true, "required": false, "displayName": "YouTube Tags", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Summary", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Summary", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Profile", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Profile", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Platforms", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Platforms", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Created At", "type": "string", "display": true, "removed": true, "required": false, "displayName": "Created At", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "row_number", "type": "number", "display": true, "removed": true, "readOnly": true, "required": false, "displayName": "row_number", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": ["Video ID"], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "4f7fcc4f-43db-425d-a687-ae9d0cc4780a", "name": "Mark as Scheduled", "type": "n8n-nodes-base.googleSheets", "position": [2480, 1184], "typeVersion": 4.7}, "connections": {"main": [[{"node": "Process Queue", "type": "main", "index": 0}]]}}$$::jsonb);

-- N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"My workflow 3"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Bulk auto-publish videos to social networks with AI copy and client approval.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "NelydervoUwikCcL", "name": "My workflow 3", "active": false}, "sourcePath": "workflows/n8n/social_media/Bulk auto-publish videos to social networks with AI copy and client approval.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "My workflow 3", "nodes": [{"parameters": {"assignments": {"assignments": [{"id": "97b7d7fa-1c7e-480c-8a01-52f63cab87bb", "name": "Title", "type": "string", "value": "={{ $('Google Sheets').item.json.Title }}"}, {"id": "72e6c291-ddc2-46f1-960a-ac2036c80105", "name": "Copy", "type": "string", "value": "={{ $('Google Sheets').item.json.Copy }}"}, {"id": "f50748ec-1027-458d-b263-1b9c132bd5d2", "name": "Status", "type": "string", "value": "={{ $('Google Sheets').item.json.Status }}"}, {"id": "e1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6", "name": "video_url", "type": "string", "value": "={{ $('Google Sheets').item.json[\"Video Link\"] }}"}, {"id": "f1g2h3i4-j5k6-l7m8-n9o0-p1q2r3s4t5u6", "name": "is_drive_file", "type": "boolean", "value": true}, {"id": "row-number-drive", "name": "row_number", "type": "number", "value": "={{ $('Google Sheets').item.json.row_number }}"}]}, "options": {}}, "id": "64ad92f3-9d1e-4c65-b59a-9ce4475c9b59", "name": "Format Drive Content", "type": "n8n-nodes-base.set", "position": [1120, 720], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "9eeb5af9-55a3-47ab-ab27-a87bbd91755c", "name": "facebook id (Page Id)", "type": "string", "value": ""}, {"id": "7e3308c5-bf44-4b1e-8d63-8efaccd4f763", "name": "board id (Pinterest)", "type": "string", "value": ""}]}, "includeOtherFields": true, "options": {}}, "id": "63d4607c-61d9-481a-b129-8b0504a127f7", "name": "Social Media Account IDs", "type": "n8n-nodes-base.set", "position": [1312, 720], "typeVersion": 3.4}, {"parameters": {"operation": "update", "documentId": {"__rl": true, "mode": "id", "value": "1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit#gid=0", "cachedResultName": "Video"}, "columns": {"value": {"Status": "Posteado", "row_number": "={{ $('Google Sheets').item.json.row_number }}"}, "schema": [{"id": "Title", "type": "string", "display": true, "required": false, "displayName": "Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Copy", "type": "string", "display": true, "required": false, "displayName": "Copy", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Link", "type": "string", "display": true, "required": false, "displayName": "Video Link", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Plataforma", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Plataforma", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Fecha.Hora", "type": "string", "display": true, "required": false, "displayName": "Fecha.Hora", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Día", "type": "string", "display": true, "required": false, "displayName": "Día", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "row_number", "type": "number", "display": true, "removed": false, "readOnly": true, "required": false, "displayName": "row_number", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": ["row_number"], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "c25e3536-b09e-4bde-854d-a9bb57972093", "name": "Google Sheets1", "type": "n8n-nodes-base.googleSheets", "position": [1808, 768], "typeVersion": 4.6}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "or", "conditions": [{"id": "057ea0fb-bba4-4394-bcda-c66fe860467b", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json['Readable time'] }}", "rightValue": "={{ $('Google Sheets').item.json[\"Fecha.Hora\"] }}"}]}, "options": {}}, "id": "a46ce20c-1a9b-4e4e-b560-61c18024918f", "name": "If", "type": "n8n-nodes-base.if", "position": [880, 736], "typeVersion": 2.2}, {"parameters": {"jsCode": "// Obtener la fecha del Schedule Trigger\nconst triggerData = $('Schedule Trigger').first().json;\nconst originalDate = new Date(triggerData.scheduled || triggerData.timestamp || new Date());\n\n// Convertir a zona horaria de Santiago de Chile\nconst santiagoDate = new Date(originalDate.toLocaleString(\"en-US\", {timeZone: \"America/Santiago\"}));\n\n// Arrays para traducir al español\nconst meses = [\n  'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',\n  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'\n];\n\nconst diasSemana = [\n  'Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'\n];\n\n// Extraer componentes de la fecha\nconst dia = santiagoDate.getDate();\nconst mes = meses[santiagoDate.getMonth()];\nlet horas = santiagoDate.getHours();\nconst ampm = horas >= 12 ? 'pm' : 'am';\n\n// Convertir a formato de 12 horas\nhoras = horas % 12;\nhoras = horas ? horas : 12; // la hora '0' debe ser '12'\n\nconst diaSemana = diasSemana[santiagoDate.getDay()];\n\n// Crear el formato deseado: \"22 de Junio a las 9 am\"\nconst readableTime = `${dia} de ${mes} a las ${horas} ${ampm}`;\n\nreturn [{\n  json: {\n    \"Readable time\": readableTime,\n    \"Day of week\": diaSemana\n  }\n}];"}, "id": "d39b8143-5fd1-43f0-be79-b7ef6edd897d", "name": "Code", "type": "n8n-nodes-base.code", "position": [624, 784], "typeVersion": 2}, {"parameters": {"rule": {"interval": [{"triggerAtHour": 9}, {"triggerAtHour": 21}]}}, "id": "2c389cf4-340a-4be8-996e-60070c8a1313", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [64, 704], "typeVersion": 1.2}, {"parameters": {"documentId": {"__rl": true, "mode": "id", "value": "1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit#gid=0", "cachedResultName": "Video"}, "filtersUI": {"values": [{"lookupColumn": "Status", "lookupValue": "Listo para postear "}]}, "options": {"returnFirstMatch": true}}, "id": "b2657ca6-a139-41ae-a1bb-df29a440e788", "name": "Google Sheets", "type": "n8n-nodes-base.googleSheets", "position": [368, 768], "typeVersion": 4.6}, {"parameters": {"chatId": "Your Chat Id ", "text": "=**📹 Resultados de publicación:**\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[0].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[0].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[0].success }}\n\n---\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[1].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[1].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[1].success }}\n\n---\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[2].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[2].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[2].success }}", "additionalFields": {"appendAttribution": false}}, "id": "b7fad4f5-df4e-42d9-af67-f04edaaf7a3c", "name": "Send a text message", "type": "n8n-nodes-base.telegram", "position": [2160, 736], "webhookId": "6a86891a-9444-45ed-9ff4-b20d3fc71f58", "typeVersion": 1.2}, {"parameters": {"user": "JoseAI", "title": "={{ $('Social Media Account IDs').item.json.Title }}\n\n{{ $('Social Media Account IDs').item.json.Copy }}", "video": "={{ $('Social Media Account IDs').item.json.video_url }}", "platform": ["instagram", "linkedin", "tiktok"], "operation": "uploadVideo"}, "id": "d316f8c0-da6a-4950-a767-dd42f60af6d9", "name": "Upload a video", "type": "n8n-nodes-upload-post.uploadPost", "position": [1520, 720], "typeVersion": 1, "credentials": {}}, {"parameters": {"content": "## ⏰ Automatic Trigger\n\n**Runs twice daily:**\n- 9:00 AM\n- 9:00 PM\n\nTimezone: America/Santiago (Chile)\n\nYou can modify these times or add more trigger hours in the Schedule Trigger configuration.", "height": 416, "width": 280}, "id": "910b32d8-cba5-4e47-a93c-3a6405e1c720", "name": "Sticky Note 1", "type": "n8n-nodes-base.stickyNote", "position": [16, 416], "typeVersion": 1}, {"parameters": {"content": "## 📊 Fetch Scheduled Posts\n\n**Reads Google Sheets** to find posts ready to publish.\n\n**Filter criteria:**\n- Status = \"Listo para postear\"\n- Returns only the first match\n\n**Required columns:**\n- Title, Copy, Video Link\n- Status, Fecha.Hora\n- row_number (for tracking)", "height": 544, "width": 220}, "id": "74f61584-e9f3-42e3-a105-ea21fbdd09b4", "name": "Sticky Note 2", "type": "n8n-nodes-base.stickyNote", "position": [304, 384], "typeVersion": 1}, {"parameters": {"content": "## 🕐 Time Formatter\n\n**Converts trigger timestamp** to Spanish readable format.\n\n**Output example:**\n\"16 de Octubre a las 9 am\"\n\n**Includes:**\n- Day of week (Spanish)\n- Month name (Spanish)\n- 12-hour format with AM/PM\n- You can change the code with Claude to english and that is it.\n\nThis format must match exactly with the \"Fecha.Hora\" column in Google Sheets.", "height": 672, "width": 236}, "id": "1a33514c-02b8-4359-aac1-94a9f3f6ef00", "name": "Sticky Note 3", "type": "n8n-nodes-base.stickyNote", "position": [560, 304], "typeVersion": 1}, {"parameters": {"content": "## ✅ Time Validation\n\n**Checks if it's time to post** by comparing:\n\n- Current formatted time (from Code node)\n- Scheduled time in Google Sheets\n\n**If match:**\n✅ Continues to posting workflow\n\n**If no match:**\n❌ Workflow stops here\n\nThis prevents posting at wrong times.", "height": 624, "width": 188}, "id": "90bb01f5-e10a-4bbc-a8de-4d78555a97a5", "name": "Sticky Note 4", "type": "n8n-nodes-base.stickyNote", "position": [832, 240], "typeVersion": 1}, {"parameters": {"content": "## 📝 Data Preparation\n\n**Extracts and organizes** post data:\n\n- Title (post title)\n- Copy (caption/description)\n- Status (current status)\n- video_url (Google Drive link)\n- is_drive_file (set to true)\n- row_number (for tracking)\n\nCleans and formats data for upload API.", "height": 624, "width": 204}, "id": "5b09d158-06f2-41c3-b7e7-0c22b1034f20", "name": "Sticky Note 5", "type": "n8n-nodes-base.stickyNote", "position": [1056, 256], "typeVersion": 1}, {"parameters": {"content": "## 🆔 Account Configuration\n\n**Prepares social media account identifiers.**\n\nYou can specify different account IDs for each platform:\n- Facebook ID\n- Pinterest Board ID\n- etc.", "height": 464, "width": 188}, "id": "b7a23f9f-754d-4b50-bec6-9efc980a5911", "name": "Sticky Note 6", "type": "n8n-nodes-base.stickyNote", "position": [1264, 432], "typeVersion": 1}, {"parameters": {"content": "## 🎬 Multi-Platform Upload\n\n**Posts video simultaneously** to:\n- Instagram\n- LinkedIn\n- TikTok\n\n(You can add more Platforms)\n\n**Uses UploadPost API**\n\n**Content includes:**\n- Title + Copy as caption\n- Video from Google Drive URL\n\n**Credentials required:**\nUploadPost API account with connected social media profiles.", "height": 608, "width": 252}, "id": "3f1959d8-0fa2-4471-bb6c-05e9743b915e", "name": "Sticky Note 7", "type": "n8n-nodes-base.stickyNote", "position": [1472, 272], "typeVersion": 1}, {"parameters": {"content": "## 📊 Update Sheet Status\n\n**Marks post as published** in Google Sheets.\n\n**Changes:**\n- Status: \"Listo para postear\" → \"Posteado\"\n\n**Prevents:**\n- Duplicate posts\n- Re-processing same content\n\n**Matches by:** row_number column to ensure accurate update.", "height": 560, "width": 300}, "id": "c3b5bf60-c186-450b-ab87-36d5fdabb98d", "name": "Sticky Note 8", "type": "n8n-nodes-base.stickyNote", "position": [1744, 368], "typeVersion": 1}, {"parameters": {"content": "## 📱 Telegram Notification\n\n**Sends detailed success report** with:\n\n**For each platform:**\n- Platform name\n- Post URL (clickable link)\n- Success status\n\n**Includes results for:**\n- Instagram\n- LinkedIn\n- TikTok\n\nYou'll receive this message immediately after posting completes.", "height": 624, "width": 300}, "id": "5ffd9e1c-5d7d-46f9-82b6-302e47e39fa1", "name": "Sticky Note 9", "type": "n8n-nodes-base.stickyNote", "position": [2064, 288], "typeVersion": 1}, {"parameters": {"content": "# Automated Social Media Video Posting\n\n## 🎯 Complete workflow for scheduling and posting videos to Instagram, LinkedIn, and TikTok\n\n### Key Features:\n✅ Automated scheduling (twice daily)\n✅ Multi-platform posting\n✅ Status tracking in Google Sheets\n✅ Telegram notifications\n✅ Duplicate prevention", "height": 1248, "width": 2432, "color": 3}, "id": "b6c15ed8-fbcb-4d25-bd49-f000212157c2", "name": "Sticky Note Main", "type": "n8n-nodes-base.stickyNote", "position": [0, 0], "typeVersion": 1}, {"parameters": {"content": "## Google Sheets \n\nhttps://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit?usp=sharing", "height": 192}, "id": "b499f534-d2b2-4628-bcad-31ab833dce82", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [2064, 1024], "typeVersion": 1}], "pinData": {}, "connections": {"If": {"main": [[{"node": "Format Drive Content", "type": "main", "index": 0}]]}, "Code": {"main": [[{"node": "If", "type": "main", "index": 0}]]}, "Google Sheets": {"main": [[{"node": "Code", "type": "main", "index": 0}]]}, "Google Sheets1": {"main": [[{"node": "Send a text message", "type": "main", "index": 0}]]}, "Upload a video": {"main": [[{"node": "Google Sheets1", "type": "main", "index": 0}]]}, "Schedule Trigger": {"main": [[{"node": "Google Sheets", "type": "main", "index": 0}]]}, "Format Drive Content": {"main": [[{"node": "Social Media Account IDs", "type": "main", "index": 0}]]}, "Social Media Account IDs": {"main": [[{"node": "Upload a video", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "0b3e0310-2cdc-45dc-ab8c-62605d2f5b05", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "NelydervoUwikCcL", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"My workflow 3"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 1, $$"2c389cf4-340a-4be8-996e-60070c8a1313"$$::jsonb::text, $$"n8n-nodes-base.scheduleTrigger"$$::jsonb::text, $$"Schedule Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"rule": {"interval": [{"triggerAtHour": 9}, {"triggerAtHour": 21}]}}, "id": "2c389cf4-340a-4be8-996e-60070c8a1313", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [64, 704], "typeVersion": 1.2}, "connections": {"main": [[{"node": "Google Sheets", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 2, $$"910b32d8-cba5-4e47-a93c-3a6405e1c720"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## ⏰ Automatic Trigger\n\n**Runs twice daily:**\n- 9:00 AM\n- 9:00 PM\n\nTimezone: America/Santiago (Chile)\n\nYou can modify these times or add more trigger hours in the Schedule Trigger configuration.", "height": 416, "width": 280}, "id": "910b32d8-cba5-4e47-a93c-3a6405e1c720", "name": "Sticky Note 1", "type": "n8n-nodes-base.stickyNote", "position": [16, 416], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 3, $$"74f61584-e9f3-42e3-a105-ea21fbdd09b4"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 2"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 📊 Fetch Scheduled Posts\n\n**Reads Google Sheets** to find posts ready to publish.\n\n**Filter criteria:**\n- Status = \"Listo para postear\"\n- Returns only the first match\n\n**Required columns:**\n- Title, Copy, Video Link\n- Status, Fecha.Hora\n- row_number (for tracking)", "height": 544, "width": 220}, "id": "74f61584-e9f3-42e3-a105-ea21fbdd09b4", "name": "Sticky Note 2", "type": "n8n-nodes-base.stickyNote", "position": [304, 384], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 4, $$"1a33514c-02b8-4359-aac1-94a9f3f6ef00"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 3"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 🕐 Time Formatter\n\n**Converts trigger timestamp** to Spanish readable format.\n\n**Output example:**\n\"16 de Octubre a las 9 am\"\n\n**Includes:**\n- Day of week (Spanish)\n- Month name (Spanish)\n- 12-hour format with AM/PM\n- You can change the code with Claude to english and that is it.\n\nThis format must match exactly with the \"Fecha.Hora\" column in Google Sheets.", "height": 672, "width": 236}, "id": "1a33514c-02b8-4359-aac1-94a9f3f6ef00", "name": "Sticky Note 3", "type": "n8n-nodes-base.stickyNote", "position": [560, 304], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 5, $$"90bb01f5-e10a-4bbc-a8de-4d78555a97a5"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 4"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## ✅ Time Validation\n\n**Checks if it's time to post** by comparing:\n\n- Current formatted time (from Code node)\n- Scheduled time in Google Sheets\n\n**If match:**\n✅ Continues to posting workflow\n\n**If no match:**\n❌ Workflow stops here\n\nThis prevents posting at wrong times.", "height": 624, "width": 188}, "id": "90bb01f5-e10a-4bbc-a8de-4d78555a97a5", "name": "Sticky Note 4", "type": "n8n-nodes-base.stickyNote", "position": [832, 240], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 6, $$"5b09d158-06f2-41c3-b7e7-0c22b1034f20"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 5"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 📝 Data Preparation\n\n**Extracts and organizes** post data:\n\n- Title (post title)\n- Copy (caption/description)\n- Status (current status)\n- video_url (Google Drive link)\n- is_drive_file (set to true)\n- row_number (for tracking)\n\nCleans and formats data for upload API.", "height": 624, "width": 204}, "id": "5b09d158-06f2-41c3-b7e7-0c22b1034f20", "name": "Sticky Note 5", "type": "n8n-nodes-base.stickyNote", "position": [1056, 256], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 7, $$"b7a23f9f-754d-4b50-bec6-9efc980a5911"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 6"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 🆔 Account Configuration\n\n**Prepares social media account identifiers.**\n\nYou can specify different account IDs for each platform:\n- Facebook ID\n- Pinterest Board ID\n- etc.", "height": 464, "width": 188}, "id": "b7a23f9f-754d-4b50-bec6-9efc980a5911", "name": "Sticky Note 6", "type": "n8n-nodes-base.stickyNote", "position": [1264, 432], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 8, $$"3f1959d8-0fa2-4471-bb6c-05e9743b915e"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 7"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 🎬 Multi-Platform Upload\n\n**Posts video simultaneously** to:\n- Instagram\n- LinkedIn\n- TikTok\n\n(You can add more Platforms)\n\n**Uses UploadPost API**\n\n**Content includes:**\n- Title + Copy as caption\n- Video from Google Drive URL\n\n**Credentials required:**\nUploadPost API account with connected social media profiles.", "height": 608, "width": 252}, "id": "3f1959d8-0fa2-4471-bb6c-05e9743b915e", "name": "Sticky Note 7", "type": "n8n-nodes-base.stickyNote", "position": [1472, 272], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 9, $$"c3b5bf60-c186-450b-ab87-36d5fdabb98d"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 8"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 📊 Update Sheet Status\n\n**Marks post as published** in Google Sheets.\n\n**Changes:**\n- Status: \"Listo para postear\" → \"Posteado\"\n\n**Prevents:**\n- Duplicate posts\n- Re-processing same content\n\n**Matches by:** row_number column to ensure accurate update.", "height": 560, "width": 300}, "id": "c3b5bf60-c186-450b-ab87-36d5fdabb98d", "name": "Sticky Note 8", "type": "n8n-nodes-base.stickyNote", "position": [1744, 368], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 10, $$"5ffd9e1c-5d7d-46f9-82b6-302e47e39fa1"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note 9"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## 📱 Telegram Notification\n\n**Sends detailed success report** with:\n\n**For each platform:**\n- Platform name\n- Post URL (clickable link)\n- Success status\n\n**Includes results for:**\n- Instagram\n- LinkedIn\n- TikTok\n\nYou'll receive this message immediately after posting completes.", "height": 624, "width": 300}, "id": "5ffd9e1c-5d7d-46f9-82b6-302e47e39fa1", "name": "Sticky Note 9", "type": "n8n-nodes-base.stickyNote", "position": [2064, 288], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 11, $$"b6c15ed8-fbcb-4d25-bd49-f000212157c2"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note Main"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Automated Social Media Video Posting\n\n## 🎯 Complete workflow for scheduling and posting videos to Instagram, LinkedIn, and TikTok\n\n### Key Features:\n✅ Automated scheduling (twice daily)\n✅ Multi-platform posting\n✅ Status tracking in Google Sheets\n✅ Telegram notifications\n✅ Duplicate prevention", "height": 1248, "width": 2432, "color": 3}, "id": "b6c15ed8-fbcb-4d25-bd49-f000212157c2", "name": "Sticky Note Main", "type": "n8n-nodes-base.stickyNote", "position": [0, 0], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 12, $$"b499f534-d2b2-4628-bcad-31ab833dce82"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Google Sheets \n\nhttps://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit?usp=sharing", "height": 192}, "id": "b499f534-d2b2-4628-bcad-31ab833dce82", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [2064, 1024], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 13, $$"b2657ca6-a139-41ae-a1bb-df29a440e788"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Google Sheets"$$::jsonb::text, $${"n8n_node": {"parameters": {"documentId": {"__rl": true, "mode": "id", "value": "1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit#gid=0", "cachedResultName": "Video"}, "filtersUI": {"values": [{"lookupColumn": "Status", "lookupValue": "Listo para postear "}]}, "options": {"returnFirstMatch": true}}, "id": "b2657ca6-a139-41ae-a1bb-df29a440e788", "name": "Google Sheets", "type": "n8n-nodes-base.googleSheets", "position": [368, 768], "typeVersion": 4.6}, "connections": {"main": [[{"node": "Code", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 14, $$"d39b8143-5fd1-43f0-be79-b7ef6edd897d"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Code"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Obtener la fecha del Schedule Trigger\nconst triggerData = $('Schedule Trigger').first().json;\nconst originalDate = new Date(triggerData.scheduled || triggerData.timestamp || new Date());\n\n// Convertir a zona horaria de Santiago de Chile\nconst santiagoDate = new Date(originalDate.toLocaleString(\"en-US\", {timeZone: \"America/Santiago\"}));\n\n// Arrays para traducir al español\nconst meses = [\n  'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',\n  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'\n];\n\nconst diasSemana = [\n  'Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'\n];\n\n// Extraer componentes de la fecha\nconst dia = santiagoDate.getDate();\nconst mes = meses[santiagoDate.getMonth()];\nlet horas = santiagoDate.getHours();\nconst ampm = horas >= 12 ? 'pm' : 'am';\n\n// Convertir a formato de 12 horas\nhoras = horas % 12;\nhoras = horas ? horas : 12; // la hora '0' debe ser '12'\n\nconst diaSemana = diasSemana[santiagoDate.getDay()];\n\n// Crear el formato deseado: \"22 de Junio a las 9 am\"\nconst readableTime = `${dia} de ${mes} a las ${horas} ${ampm}`;\n\nreturn [{\n  json: {\n    \"Readable time\": readableTime,\n    \"Day of week\": diaSemana\n  }\n}];"}, "id": "d39b8143-5fd1-43f0-be79-b7ef6edd897d", "name": "Code", "type": "n8n-nodes-base.code", "position": [624, 784], "typeVersion": 2}, "connections": {"main": [[{"node": "If", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 15, $$"a46ce20c-1a9b-4e4e-b560-61c18024918f"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"If"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "or", "conditions": [{"id": "057ea0fb-bba4-4394-bcda-c66fe860467b", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json['Readable time'] }}", "rightValue": "={{ $('Google Sheets').item.json[\"Fecha.Hora\"] }}"}]}, "options": {}}, "id": "a46ce20c-1a9b-4e4e-b560-61c18024918f", "name": "If", "type": "n8n-nodes-base.if", "position": [880, 736], "typeVersion": 2.2}, "connections": {"main": [[{"node": "Format Drive Content", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 16, $$"64ad92f3-9d1e-4c65-b59a-9ce4475c9b59"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Format Drive Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "97b7d7fa-1c7e-480c-8a01-52f63cab87bb", "name": "Title", "type": "string", "value": "={{ $('Google Sheets').item.json.Title }}"}, {"id": "72e6c291-ddc2-46f1-960a-ac2036c80105", "name": "Copy", "type": "string", "value": "={{ $('Google Sheets').item.json.Copy }}"}, {"id": "f50748ec-1027-458d-b263-1b9c132bd5d2", "name": "Status", "type": "string", "value": "={{ $('Google Sheets').item.json.Status }}"}, {"id": "e1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6", "name": "video_url", "type": "string", "value": "={{ $('Google Sheets').item.json[\"Video Link\"] }}"}, {"id": "f1g2h3i4-j5k6-l7m8-n9o0-p1q2r3s4t5u6", "name": "is_drive_file", "type": "boolean", "value": true}, {"id": "row-number-drive", "name": "row_number", "type": "number", "value": "={{ $('Google Sheets').item.json.row_number }}"}]}, "options": {}}, "id": "64ad92f3-9d1e-4c65-b59a-9ce4475c9b59", "name": "Format Drive Content", "type": "n8n-nodes-base.set", "position": [1120, 720], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Social Media Account IDs", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 17, $$"63d4607c-61d9-481a-b129-8b0504a127f7"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Social Media Account IDs"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "9eeb5af9-55a3-47ab-ab27-a87bbd91755c", "name": "facebook id (Page Id)", "type": "string", "value": ""}, {"id": "7e3308c5-bf44-4b1e-8d63-8efaccd4f763", "name": "board id (Pinterest)", "type": "string", "value": ""}]}, "includeOtherFields": true, "options": {}}, "id": "63d4607c-61d9-481a-b129-8b0504a127f7", "name": "Social Media Account IDs", "type": "n8n-nodes-base.set", "position": [1312, 720], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Upload a video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 18, $$"d316f8c0-da6a-4950-a767-dd42f60af6d9"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Upload a video"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "JoseAI", "title": "={{ $('Social Media Account IDs').item.json.Title }}\n\n{{ $('Social Media Account IDs').item.json.Copy }}", "video": "={{ $('Social Media Account IDs').item.json.video_url }}", "platform": ["instagram", "linkedin", "tiktok"], "operation": "uploadVideo"}, "id": "d316f8c0-da6a-4950-a767-dd42f60af6d9", "name": "Upload a video", "type": "n8n-nodes-upload-post.uploadPost", "position": [1520, 720], "typeVersion": 1, "credentials": {}}, "connections": {"main": [[{"node": "Google Sheets1", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 19, $$"c25e3536-b09e-4bde-854d-a9bb57972093"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Google Sheets1"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "update", "documentId": {"__rl": true, "mode": "id", "value": "1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s"}, "sheetName": {"__rl": true, "mode": "list", "value": "gid=0", "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ZKbnD7GM6eAHKzyDY98cvz9jMUib1HLU7d9gohYkR3s/edit#gid=0", "cachedResultName": "Video"}, "columns": {"value": {"Status": "Posteado", "row_number": "={{ $('Google Sheets').item.json.row_number }}"}, "schema": [{"id": "Title", "type": "string", "display": true, "required": false, "displayName": "Title", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Copy", "type": "string", "display": true, "required": false, "displayName": "Copy", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Video Link", "type": "string", "display": true, "required": false, "displayName": "Video Link", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Plataforma", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Plataforma", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Status", "type": "string", "display": true, "removed": false, "required": false, "displayName": "Status", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Fecha.Hora", "type": "string", "display": true, "required": false, "displayName": "Fecha.Hora", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "Día", "type": "string", "display": true, "required": false, "displayName": "Día", "defaultMatch": false, "canBeUsedToMatch": true}, {"id": "row_number", "type": "number", "display": true, "removed": false, "readOnly": true, "required": false, "displayName": "row_number", "defaultMatch": false, "canBeUsedToMatch": true}], "mappingMode": "defineBelow", "matchingColumns": ["row_number"], "attemptToConvertTypes": false, "convertFieldsToString": false}, "options": {}}, "id": "c25e3536-b09e-4bde-854d-a9bb57972093", "name": "Google Sheets1", "type": "n8n-nodes-base.googleSheets", "position": [1808, 768], "typeVersion": 4.6}, "connections": {"main": [[{"node": "Send a text message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Bulk_auto-publish_videos_to_social_networks_with_AI_copy_and_client_approval"$$::jsonb::text, 20, $$"b7fad4f5-df4e-42d9-af67-f04edaaf7a3c"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send a text message"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "Your Chat Id ", "text": "=**📹 Resultados de publicación:**\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[0].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[0].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[0].success }}\n\n---\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[1].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[1].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[1].success }}\n\n---\n\n🎯 **Plataforma:** {{ $('Upload a video').item.json.results[2].platform }}\n🔗 **URL:** {{ $('Upload a video').item.json.results[2].post_url }}\n✅ **Éxito:** {{ $('Upload a video').item.json.results[2].success }}", "additionalFields": {"appendAttribution": false}}, "id": "b7fad4f5-df4e-42d9-af67-f04edaaf7a3c", "name": "Send a text message", "type": "n8n-nodes-base.telegram", "position": [2160, 736], "webhookId": "6a86891a-9444-45ed-9ff4-b20d3fc71f58", "typeVersion": 1.2}, "connections": {}}$$::jsonb);

-- N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_ (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Publish image & video to multiple social media (X, Instagram, Facebook and more)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Publish image & video to multiple social media (X, Instagram, Facebook and more).json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "1eFDn6VxdQVB24q9", "name": "Publish image & video to multiple social media (X, Instagram, Facebook and more)", "active": false}, "sourcePath": "workflows/n8n/social_media/Publish image & video to multiple social media (X, Instagram, Facebook and more).json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Publish image & video to multiple social media (X, Instagram, Facebook and more)", "nodes": [{"parameters": {"formTitle": "Post Publisher", "formFields": {"values": [{"fieldLabel": "Platform", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "instagram"}, {"option": "linkedin"}, {"option": "facebook"}, {"option": "x"}, {"option": "tiktok"}, {"option": "threads"}]}, "requiredField": true}, {"fieldLabel": "Account", "placeholder": "User Profile name set on Upload-post.com", "requiredField": true}, {"fieldLabel": "Caption", "fieldType": "textarea", "requiredField": true}, {"fieldLabel": "Upload", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg,.mp4", "requiredField": true}, {"fieldLabel": "Facebook Id", "placeholder": "Facebook page Id (eg. +1234567890)"}]}, "options": {}}, "id": "f5050652-6170-41c6-b3c3-0f6616c9d575", "name": "On form submission", "type": "n8n-nodes-base.formTrigger", "position": [400, 1600], "webhookId": "bb578d47-feaa-4973-96df-659089838de5", "typeVersion": 2.2}, {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload_photos", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.Caption }}"}, {"name": "user", "value": "={{ $json.Account }}"}, {"name": "platform[]", "value": "={{ $json.Platform }}"}, {"parameterType": "formBinaryData", "name": "photos[]", "inputDataFieldName": "=Upload"}, {"name": "facebook_id", "value": "={{ $('On form submission').item.json['Facebook Id'] }}"}]}, "options": {}}, "id": "e9d8b8c9-3e40-420d-98c3-82c92f1c53c7", "name": "Post photo", "type": "n8n-nodes-base.httpRequest", "position": [992, 1312], "typeVersion": 4.2}, {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.Caption }}"}, {"name": "user", "value": "={{ $json.Account }}"}, {"name": "platform[]", "value": "={{ $json.Platform }}"}, {"parameterType": "formBinaryData", "name": "video", "inputDataFieldName": "=Upload"}]}, "options": {}}, "id": "04103be2-a1d8-4b00-942b-44e13dffa666", "name": "Post video", "type": "n8n-nodes-base.httpRequest", "position": [992, 1760], "typeVersion": 4.2}, {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "e7803375-20b0-4e12-80a4-b102ba48b6ba", "name": "KO Video", "type": "n8n-nodes-base.form", "position": [1648, 1872], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "91f2b501-4021-4ecc-9cc3-4e804d020135", "name": "OK Video", "type": "n8n-nodes-base.form", "position": [1648, 1664], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "b3eead97-f995-42dc-b937-6d05f284f601", "name": "KO Photo", "type": "n8n-nodes-base.form", "position": [1648, 1408], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "8ead4dfa-cb9e-4ab4-b52c-7a681876269f", "name": "OK Photo", "type": "n8n-nodes-base.form", "position": [1648, 1200], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}\n", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "a5fba676-4e7b-42e2-af36-e9d63458870b", "name": "Success Photo?", "type": "n8n-nodes-base.if", "position": [1408, 1312], "typeVersion": 2.2}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}\n", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "310853de-ab7e-481e-8efa-5a681f08032b", "name": "Success Video?", "type": "n8n-nodes-base.if", "position": [1440, 1760], "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "551c5179-055a-415e-bf17-61f2a5dd2769", "name": "=result", "type": "string", "value": "={{ $json.results[$('Video or Photo?').item.json.Platform].success.toBoolean() }}"}]}, "options": {}}, "id": "81ec87fc-9298-4cd6-8a46-45ee6cb050b3", "name": "Result Photo", "type": "n8n-nodes-base.set", "position": [1216, 1312], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "551c5179-055a-415e-bf17-61f2a5dd2769", "name": "=result", "type": "string", "value": "={{ $json.results[$('Video or Photo?').item.json.Platform].success.toBoolean() }}"}]}, "options": {}}, "id": "936ac765-0e7c-411d-b70d-bdfbe8e180a6", "name": "Result Video", "type": "n8n-nodes-base.set", "position": [1216, 1760], "typeVersion": 3.4}, {"parameters": {"rules": {"values": [{"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "879af56a-8979-4d9d-9acd-6009d821f6a7", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.Upload.mimetype }}", "rightValue": "image/jpeg"}]}, "renameOutput": true, "outputKey": "Image"}, {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "d7ee147d-d775-4b81-b043-0873c535b400", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $json.Upload.mimetype }}", "rightValue": "video/mp4"}]}, "renameOutput": true, "outputKey": "Video"}]}, "options": {}}, "id": "3a3d66ae-7ecd-43aa-a905-10afdab753b3", "name": "Video or Photo?", "type": "n8n-nodes-base.switch", "position": [656, 1600], "typeVersion": 3.2}, {"parameters": {"content": "## SETTINGS\n\n- Find your API key in your [Upload-Post Manage Api Keys](https://www.upload-post.com/?linkId=lp_144414&sourceId=n3witalia&tenantId=upload-post-app) 10 FREE uploads per month\n- Set the the \"Auth Header\":\n-- Name: Authorization\n-- Value: Apikey YOUR_API_KEY_HERE\n- Create profiles to manage your social media accounts. The \"Profile\" you choose will be used in the field \"Account\" on form submission (eg. test1 or test2).  \n\n![image](https://i.postimg.cc/N0BHdcQ4/uploadpost.png)\n\nApr-2025: YouTube integration is currently being verified by Google, and may not work as expected.\n", "height": 680, "width": 1380}, "id": "76d1cc06-8bb5-43cd-8dcc-2da1656b0335", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [368, 464], "typeVersion": 1}, {"parameters": {"content": "## Upload video and photo on TikTok, X, Facebook, Youtube, Instagram, Threads and Linkedin\n\nSimplify your social media workflow with our powerful platform designed for content creators and marketers.\n\nUpload your video once and let Upload-Post distribute it across all your connected social media accounts effortlessly.", "height": 180, "width": 1380, "color": 3}, "id": "e9b40e23-cde9-459d-b490-8adda6b9253f", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}], "pinData": {}, "connections": {"Post photo": {"main": [[{"node": "Result Photo", "type": "main", "index": 0}]]}, "Post video": {"main": [[{"node": "Result Video", "type": "main", "index": 0}]]}, "Result Photo": {"main": [[{"node": "Success Photo?", "type": "main", "index": 0}]]}, "Result Video": {"main": [[{"node": "Success Video?", "type": "main", "index": 0}]]}, "Success Photo?": {"main": [[{"node": "OK Photo", "type": "main", "index": 0}], [{"node": "KO Photo", "type": "main", "index": 0}]]}, "Success Video?": {"main": [[{"node": "OK Video", "type": "main", "index": 0}], [{"node": "KO Video", "type": "main", "index": 0}]]}, "Video or Photo?": {"main": [[{"node": "Post photo", "type": "main", "index": 0}], [{"node": "Post video", "type": "main", "index": 0}]]}, "On form submission": {"main": [[{"node": "Video or Photo?", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate"}, "versionId": "", "meta": {"templateId": "3669", "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "1eFDn6VxdQVB24q9", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Publish image & video to multiple social media (X, Instagram, Facebook and more)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 1, $$"f5050652-6170-41c6-b3c3-0f6616c9d575"$$::jsonb::text, $$"n8n-nodes-base.formTrigger"$$::jsonb::text, $$"On form submission"$$::jsonb::text, $${"n8n_node": {"parameters": {"formTitle": "Post Publisher", "formFields": {"values": [{"fieldLabel": "Platform", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "instagram"}, {"option": "linkedin"}, {"option": "facebook"}, {"option": "x"}, {"option": "tiktok"}, {"option": "threads"}]}, "requiredField": true}, {"fieldLabel": "Account", "placeholder": "User Profile name set on Upload-post.com", "requiredField": true}, {"fieldLabel": "Caption", "fieldType": "textarea", "requiredField": true}, {"fieldLabel": "Upload", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg,.mp4", "requiredField": true}, {"fieldLabel": "Facebook Id", "placeholder": "Facebook page Id (eg. +1234567890)"}]}, "options": {}}, "id": "f5050652-6170-41c6-b3c3-0f6616c9d575", "name": "On form submission", "type": "n8n-nodes-base.formTrigger", "position": [400, 1600], "webhookId": "bb578d47-feaa-4973-96df-659089838de5", "typeVersion": 2.2}, "connections": {"main": [[{"node": "Video or Photo?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 2, $$"76d1cc06-8bb5-43cd-8dcc-2da1656b0335"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## SETTINGS\n\n- Find your API key in your [Upload-Post Manage Api Keys](https://www.upload-post.com/?linkId=lp_144414&sourceId=n3witalia&tenantId=upload-post-app) 10 FREE uploads per month\n- Set the the \"Auth Header\":\n-- Name: Authorization\n-- Value: Apikey YOUR_API_KEY_HERE\n- Create profiles to manage your social media accounts. The \"Profile\" you choose will be used in the field \"Account\" on form submission (eg. test1 or test2).  \n\n![image](https://i.postimg.cc/N0BHdcQ4/uploadpost.png)\n\nApr-2025: YouTube integration is currently being verified by Google, and may not work as expected.\n", "height": 680, "width": 1380}, "id": "76d1cc06-8bb5-43cd-8dcc-2da1656b0335", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [368, 464], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 3, $$"e9b40e23-cde9-459d-b490-8adda6b9253f"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Upload video and photo on TikTok, X, Facebook, Youtube, Instagram, Threads and Linkedin\n\nSimplify your social media workflow with our powerful platform designed for content creators and marketers.\n\nUpload your video once and let Upload-Post distribute it across all your connected social media accounts effortlessly.", "height": 180, "width": 1380, "color": 3}, "id": "e9b40e23-cde9-459d-b490-8adda6b9253f", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 4, $$"3a3d66ae-7ecd-43aa-a905-10afdab753b3"$$::jsonb::text, $$"n8n-nodes-base.switch"$$::jsonb::text, $$"Video or Photo?"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"values": [{"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "879af56a-8979-4d9d-9acd-6009d821f6a7", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.Upload.mimetype }}", "rightValue": "image/jpeg"}]}, "renameOutput": true, "outputKey": "Image"}, {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "d7ee147d-d775-4b81-b043-0873c535b400", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $json.Upload.mimetype }}", "rightValue": "video/mp4"}]}, "renameOutput": true, "outputKey": "Video"}]}, "options": {}}, "id": "3a3d66ae-7ecd-43aa-a905-10afdab753b3", "name": "Video or Photo?", "type": "n8n-nodes-base.switch", "position": [656, 1600], "typeVersion": 3.2}, "connections": {"main": [[{"node": "Post photo", "type": "main", "index": 0}], [{"node": "Post video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 5, $$"e9d8b8c9-3e40-420d-98c3-82c92f1c53c7"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Post photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload_photos", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.Caption }}"}, {"name": "user", "value": "={{ $json.Account }}"}, {"name": "platform[]", "value": "={{ $json.Platform }}"}, {"parameterType": "formBinaryData", "name": "photos[]", "inputDataFieldName": "=Upload"}, {"name": "facebook_id", "value": "={{ $('On form submission').item.json['Facebook Id'] }}"}]}, "options": {}}, "id": "e9d8b8c9-3e40-420d-98c3-82c92f1c53c7", "name": "Post photo", "type": "n8n-nodes-base.httpRequest", "position": [992, 1312], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Result Photo", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 6, $$"04103be2-a1d8-4b00-942b-44e13dffa666"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Post video"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.Caption }}"}, {"name": "user", "value": "={{ $json.Account }}"}, {"name": "platform[]", "value": "={{ $json.Platform }}"}, {"parameterType": "formBinaryData", "name": "video", "inputDataFieldName": "=Upload"}]}, "options": {}}, "id": "04103be2-a1d8-4b00-942b-44e13dffa666", "name": "Post video", "type": "n8n-nodes-base.httpRequest", "position": [992, 1760], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Result Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 7, $$"81ec87fc-9298-4cd6-8a46-45ee6cb050b3"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Result Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "551c5179-055a-415e-bf17-61f2a5dd2769", "name": "=result", "type": "string", "value": "={{ $json.results[$('Video or Photo?').item.json.Platform].success.toBoolean() }}"}]}, "options": {}}, "id": "81ec87fc-9298-4cd6-8a46-45ee6cb050b3", "name": "Result Photo", "type": "n8n-nodes-base.set", "position": [1216, 1312], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Success Photo?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 8, $$"936ac765-0e7c-411d-b70d-bdfbe8e180a6"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Result Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "551c5179-055a-415e-bf17-61f2a5dd2769", "name": "=result", "type": "string", "value": "={{ $json.results[$('Video or Photo?').item.json.Platform].success.toBoolean() }}"}]}, "options": {}}, "id": "936ac765-0e7c-411d-b70d-bdfbe8e180a6", "name": "Result Video", "type": "n8n-nodes-base.set", "position": [1216, 1760], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Success Video?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 9, $$"a5fba676-4e7b-42e2-af36-e9d63458870b"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Success Photo?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}\n", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "a5fba676-4e7b-42e2-af36-e9d63458870b", "name": "Success Photo?", "type": "n8n-nodes-base.if", "position": [1408, 1312], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OK Photo", "type": "main", "index": 0}], [{"node": "KO Photo", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 10, $$"310853de-ab7e-481e-8efa-5a681f08032b"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Success Video?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}\n", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "310853de-ab7e-481e-8efa-5a681f08032b", "name": "Success Video?", "type": "n8n-nodes-base.if", "position": [1440, 1760], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OK Video", "type": "main", "index": 0}], [{"node": "KO Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 11, $$"b3eead97-f995-42dc-b937-6d05f284f601"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"KO Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "b3eead97-f995-42dc-b937-6d05f284f601", "name": "KO Photo", "type": "n8n-nodes-base.form", "position": [1648, 1408], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 12, $$"8ead4dfa-cb9e-4ab4-b52c-7a681876269f"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"OK Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "8ead4dfa-cb9e-4ab4-b52c-7a681876269f", "name": "OK Photo", "type": "n8n-nodes-base.form", "position": [1648, 1200], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 13, $$"e7803375-20b0-4e12-80a4-b102ba48b6ba"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"KO Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "e7803375-20b0-4e12-80a4-b102ba48b6ba", "name": "KO Video", "type": "n8n-nodes-base.form", "position": [1648, 1872], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Publish_image___video_to_multiple_social_media__X__Instagram__Facebook_and_more_"$$::jsonb::text, 14, $$"91f2b501-4021-4ecc-9cc3-4e804d020135"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"OK Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "91f2b501-4021-4ecc-9cc3-4e804d020135", "name": "OK Video", "type": "n8n-nodes-base.form", "position": [1648, 1664], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);

-- N8N-social_media_Tumblr (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Tumblr"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Tumblr.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "ci7yHjBNEHvHYeah", "name": "Tumblr", "active": false}, "sourcePath": "workflows/n8n/social_media/Tumblr.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Tumblr", "nodes": [{"parameters": {"httpMethod": "POST", "path": "282b6873-5dfc-4c25-ac2f-8417af7a2198", "options": {}}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, {"parameters": {"jsCode": "// Normalize payload coming from webhook.\n// n8n Webhook node often provides the incoming JSON under $json.body.\n\nconst input = ($json && typeof $json === 'object' && $json.body && typeof $json.body === 'object')\n  ? $json.body\n  : $json;\n\nreturn [\n  {\n    title: input?.title ?? \"Atlas UX Update\",\n    body: input?.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input?.tags) ? input.tags : [],\n    state: input?.state ?? \"draft\",\n  },\n];\n"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, {"parameters": {"method": "POST", "url": "https://api.tumblr.com/v2/blog/atlasux.tumblr.com/post", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "sendBody": true, "contentType": "form-urlencoded", "bodyParametersUi": {"parameter": [{"name": "type", "value": "text"}, {"name": "state", "value": "={{$json.state}}"}, {"name": "title", "value": "={{$json.title}}"}, {"name": "body", "value": "={{$json.body}}"}, {"name": "tags", "value": "={{$json.tags.join(\",\")}}"}]}, "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}, {"parameters": {"responseBody": "={{ { ok: true, tumblr: $json } }}", "options": {"responseHeaders": {"entries": [{"name": "Content-Type", "value": "application/json"}]}}}, "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [760, 0], "id": "respond-to-webhook-1", "name": "Respond to Webhook"}], "pinData": {}, "connections": {"Webhook": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}, "Code in JavaScript": {"main": [[{"node": "HTTP Request", "type": "main", "index": 0}]]}, "HTTP Request": {"main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "3620b6d1-aa89-4291-97d6-2d8ecd6c97d0", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "ci7yHjBNEHvHYeah", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Tumblr"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Tumblr"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, 1, $$"3bf2f934-a6db-4229-8a59-2b828d054303"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "282b6873-5dfc-4c25-ac2f-8417af7a2198", "options": {}}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, "connections": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, 2, $$"11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Code in JavaScript"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Normalize payload coming from webhook.\n// n8n Webhook node often provides the incoming JSON under $json.body.\n\nconst input = ($json && typeof $json === 'object' && $json.body && typeof $json.body === 'object')\n  ? $json.body\n  : $json;\n\nreturn [\n  {\n    title: input?.title ?? \"Atlas UX Update\",\n    body: input?.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input?.tags) ? input.tags : [],\n    state: input?.state ?? \"draft\",\n  },\n];\n"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, "connections": {"main": [[{"node": "HTTP Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, 3, $$"b7f98655-e0aa-409a-bb95-82396c9ff8c8"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"HTTP Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.tumblr.com/v2/blog/atlasux.tumblr.com/post", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "sendBody": true, "contentType": "form-urlencoded", "bodyParametersUi": {"parameter": [{"name": "type", "value": "text"}, {"name": "state", "value": "={{$json.state}}"}, {"name": "title", "value": "={{$json.title}}"}, {"name": "body", "value": "={{$json.body}}"}, {"name": "tags", "value": "={{$json.tags.join(\",\")}}"}]}, "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}, "connections": {"main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr"$$::jsonb::text, 4, $$"respond-to-webhook-1"$$::jsonb::text, $$"n8n-nodes-base.respondToWebhook"$$::jsonb::text, $$"Respond to Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"responseBody": "={{ { ok: true, tumblr: $json } }}", "options": {"responseHeaders": {"entries": [{"name": "Content-Type", "value": "application/json"}]}}}, "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [760, 0], "id": "respond-to-webhook-1", "name": "Respond to Webhook"}, "connections": {}}$$::jsonb);

-- N8N-social_media_Tumblr_original (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Tumblr"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Tumblr_original.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "ci7yHjBNEHvHYeah", "name": "Tumblr", "active": false}, "sourcePath": "workflows/n8n/social_media/Tumblr_original.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Tumblr", "nodes": [{"parameters": {"httpMethod": "POST", "path": "282b6873-5dfc-4c25-ac2f-8417af7a2198", "options": {}}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, {"parameters": {"keys": {"key": [{"currentKey": "title", "newKey": "body"}, {"newKey": "tags"}, {"currentKey": "state"}]}, "additionalOptions": {}}, "type": "n8n-nodes-base.renameKeys", "typeVersion": 1, "position": [208, 0], "id": "f4cd16b7-19a1-4ba7-82a7-c0f6135c32bc", "name": "Rename Keys"}, {"parameters": {"jsCode": "// Normalize payload coming from webhook\n\nconst input = $json;\n\nreturn [\n  {\n    title: input.title ?? \"Atlas UX Update\",\n    body: input.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input.tags) ? input.tags : [],\n    state: input.state ?? \"draft\",\n  },\n];"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, {"parameters": {"url": "https://api.tumblr.com/v2/user/info", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}], "pinData": {}, "connections": {"Webhook": {"main": [[{"node": "Rename Keys", "type": "main", "index": 0}]]}, "Rename Keys": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "3620b6d1-aa89-4291-97d6-2d8ecd6c97d0", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "ci7yHjBNEHvHYeah", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Tumblr"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Tumblr_original"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, 1, $$"3bf2f934-a6db-4229-8a59-2b828d054303"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "282b6873-5dfc-4c25-ac2f-8417af7a2198", "options": {}}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, "connections": {"main": [[{"node": "Rename Keys", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, 2, $$"b7f98655-e0aa-409a-bb95-82396c9ff8c8"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"HTTP Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "https://api.tumblr.com/v2/user/info", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, 3, $$"f4cd16b7-19a1-4ba7-82a7-c0f6135c32bc"$$::jsonb::text, $$"n8n-nodes-base.renameKeys"$$::jsonb::text, $$"Rename Keys"$$::jsonb::text, $${"n8n_node": {"parameters": {"keys": {"key": [{"currentKey": "title", "newKey": "body"}, {"newKey": "tags"}, {"currentKey": "state"}]}, "additionalOptions": {}}, "type": "n8n-nodes-base.renameKeys", "typeVersion": 1, "position": [208, 0], "id": "f4cd16b7-19a1-4ba7-82a7-c0f6135c32bc", "name": "Rename Keys"}, "connections": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Tumblr_original"$$::jsonb::text, 4, $$"11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Code in JavaScript"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Normalize payload coming from webhook\n\nconst input = $json;\n\nreturn [\n  {\n    title: input.title ?? \"Atlas UX Update\",\n    body: input.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input.tags) ? input.tags : [],\n    state: input.state ?? \"draft\",\n  },\n];"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, "connections": {}}$$::jsonb);

-- N8N-social_media_Universal_Social_Media_Content_Generator_with_AI (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Universal Social Media Content Generator with AI"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/Universal Social Media Content Generator with AI.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "xXmgJcpgqzlL4pgZ", "name": "Universal Social Media Content Generator with AI", "active": false}, "sourcePath": "workflows/n8n/social_media/Universal Social Media Content Generator with AI.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Universal Social Media Content Generator with AI", "nodes": [{"parameters": {"rule": {"interval": [{"daysInterval": 5, "triggerAtHour": 9}]}}, "id": "0396a23e-34a0-43cd-93d6-2b4be88134d7", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [-128, -160], "description": "This node triggers your content generation workflow on a schedule. Default is every 5 days at 9 AM, but you can adjust this to daily, weekly, or any custom schedule that fits your content strategy. The workflow will start automatically at the specified time.", "typeVersion": 1.2}, {"parameters": {"jsCode": "// This node creates a human-readable timestamp for the current schedule run\n// It helps track when each content generation session was initiated\n\nconst today = new Date();\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nconst scheduleName = `${days[today.getDay()]} ${today.getHours()}:00`;\n\nreturn [{\n  json: {\n    scheduleName: scheduleName,\n    timestamp: new Date().toISOString(),\n    workflowId: $workflow.id\n  }\n}];"}, "id": "c416b6af-afc5-4da3-b384-7900c5e2de3e", "name": "Create Schedule Timestamp", "type": "n8n-nodes-base.code", "position": [96, -160], "description": "Creates a human-readable timestamp and schedule name for tracking purposes. This helps you identify which schedule triggered the content generation, especially useful if you have multiple schedules running.", "typeVersion": 2}, {"parameters": {"chatId": "{{ $credentials.telegramChatId }}", "text": "🚀 **Content Generation Time!**\n\nIt's time for your {{ $json.scheduleName }} content creation session.\n\nPlease reply with:\n- Your topic or theme\n- Type 'single' for one post or 'thread' for multiple connected posts\n\nExample responses:\n- 'sustainable living tips - single'\n- 'how to start a podcast - thread'\n- 'morning motivation - single'", "additionalFields": {}}, "id": "e737a41f-5649-4470-aa2c-a7b06dc80893", "name": "Request Content Topic via Telegram", "type": "n8n-nodes-base.telegram", "position": [320, -160], "webhookId": "3c293ac0-62b9-4fe3-b9f8-e3ce7b26e906", "description": "Sends a message to your Telegram chat asking for the content topic and format. The message will appear in the Telegram chat/channel you've configured in the credentials. Make sure to set up your Telegram bot and add the chat ID in the credentials.", "typeVersion": 1.2}, {"parameters": {"updates": ["message"], "additionalFields": {}}, "id": "a0da42e4-e3f4-4e93-ac53-ae1ba141707a", "name": "Wait for User Topic Reply", "type": "n8n-nodes-base.telegramTrigger", "position": [320, 288], "webhookId": "telegram-topic-reply-webhook", "description": "This webhook listens for your reply in Telegram. When you send a message in response to the topic request, this node captures it and passes it to the next step. Make sure the webhook is properly configured in your Telegram bot settings.", "typeVersion": 1.1}, {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "486d068f-b5cb-4af4-aee8-beb09dd02802", "operator": {"type": "any", "operation": "exists"}, "leftValue": "={{ $json.message.reply_to_message }}"}, {"id": "9b8ba1b0-008e-4749-b808-9b9cfd8480ae", "operator": {"type": "string", "operation": "isNotEmpty"}, "leftValue": "={{ $json.message.text }}"}]}, "options": {}}, "id": "fba10582-9d08-4629-adca-701b79d92e4a", "name": "Validate Reply Format", "type": "n8n-nodes-base.if", "position": [224, 608], "description": "Checks if the Telegram message is a valid reply to the bot's request. It ensures the message is not empty and is actually a reply to the bot's prompt. This prevents the workflow from processing random messages in the chat.", "typeVersion": 2}, {"parameters": {"jsCode": "// This node parses the user input and validates the format\n// Expected format: 'topic - format' where format is 'single' or 'thread'\n// If no format is specified, it defaults to 'auto'\n\ntry {\n  const userInput = $json.message.text;\n  let topic, formatType;\n  \n  if (userInput.includes(' - ')) {\n    const parts = userInput.split(' - ');\n    topic = parts[0].trim();\n    formatType = parts[1].trim().toLowerCase();\n  } else {\n    // If no format specified, default to auto\n    topic = userInput.trim();\n    formatType = \"auto\";\n  }\n  \n  // Validate format type\n  const validFormats = ['single', 'thread', 'auto'];\n  if (!validFormats.includes(formatType)) {\n    throw new Error(`Invalid format type: ${formatType}. Use 'single', 'thread', or 'auto'`);\n  }\n  \n  // Validate topic length\n  if (topic.length < 3) {\n    throw new Error('Topic too short. Please provide a more detailed topic.');\n  }\n  \n  return [{\n    json: {\n      topic: topic,\n      format_type: formatType,\n      chat_id: $json.message.chat.id,\n      username: $json.message.from.username,\n      original_message: userInput,\n      validation_status: 'passed'\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      error: error.message,\n      validation_status: 'failed',\n      chat_id: $json.message.chat.id\n    }\n  }];\n}"}, "id": "17f3684a-2f19-4604-b4d5-35753a0b072e", "name": "Parse User Input", "type": "n8n-nodes-base.code", "position": [464, 624], "description": "Extracts the topic and format from the user's message. Supports three formats: 'single' (one post), 'thread' (multiple connected posts), or 'auto' (let AI decide). The topic must be at least 3 characters long. If format is not specified, defaults to 'auto'.", "typeVersion": 2}, {"parameters": {"conditions": {"options": {}, "combinator": "and", "conditions": [{"operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.validation_status }}", "rightValue": "passed"}]}, "options": {}}, "id": "4c438f0c-82a0-414a-9429-5fe5d4a5e1bb", "name": "Input Validation Check", "type": "n8n-nodes-base.if", "position": [640, 624], "description": "Routes the workflow based on validation results. If the input passes validation, it proceeds to content generation. If validation fails, it sends an error message back to the user with instructions on the correct format.", "typeVersion": 2}, {"parameters": {"chatId": "={{ $json.chat_id }}", "text": "❌ **Input Error**\n\n{{ $json.error }}\n\nPlease try again with the correct format:\n'your topic - single' or 'your topic - thread'\n\nExamples:\n- 'productivity tips - single'\n- 'beginner's guide to investing - thread'\n- 'motivational quote' (defaults to auto)", "additionalFields": {}}, "id": "5d7d3668-aa21-4017-b523-bd2040d2c626", "name": "Send Input Error Message", "type": "n8n-nodes-base.telegram", "position": [880, 928], "webhookId": "32b0496e-9b72-4806-a961-9a1a9a61670e", "description": "Sends an error message to the user if their input format is incorrect. Provides clear examples of the expected format to help users correct their input.", "typeVersion": 1.2}, {"parameters": {"promptType": "define", "text": "=Create social media content about: {{ $json.topic }}\nFormat type: {{ $json.format_type }}", "hasOutputParser": true, "options": {"systemMessage": "=You are a professional social media content creator. Your task is to generate engaging, high-quality content for Twitter/X and LinkedIn.\n\nCONTENT REQUIREMENTS:\n\nCHARACTER COUNT:\n- EVERY tweet/post MUST be between 240-265 characters\n- Count characters before finalizing\n- Rewrite if outside this range\n\nFORMAT GUIDELINES:\n- For 'single': Create one standalone post\n- For 'thread': Create 3-6 connected posts that tell a complete story\n- For 'auto': Decide based on topic complexity (simple topics = single, complex = thread)\n\nWRITING STYLE:\n- Clear, conversational tone\n- Use simple language\n- Include 1-2 relevant hashtags\n- Be engaging and value-driven\n- Professional but approachable\n- NO numbered lists in the beginning of posts (avoid \"1/\", \"2/\" etc.)\n\nCONTENT STRUCTURE:\n- Hook: Start with an attention-grabbing statement\n- Value: Provide useful information or insights\n- Call-to-action: Encourage engagement (questions, thoughts, actions)\n\nADAPT TO TOPIC:\n- Business topics: Professional, data-driven\n- Creative topics: Inspiring, imaginative\n- Educational topics: Clear, structured\n- Personal topics: Authentic, relatable\n- Technical topics: Simple explanations, practical examples\n\nREMEMBER:\n- Quality over quantity\n- Each post should provide value\n- Maintain consistency in tone throughout threads\n- Use line breaks for readability\n- End threads with a summary or key takeaway"}}, "id": "5f3a2261-899f-4179-93b3-e8165702f1e8", "name": "AI Content Generator", "type": "@n8n/n8n-nodes-langchain.agent", "maxTries": 3, "position": [880, 240], "description": "The AI agent that generates your social media content. It uses the topic and format you provided to create posts optimized for engagement. The system prompt ensures consistent quality and character count. Configure retry attempts (default: 3) for reliability.", "retryOnFail": true, "typeVersion": 1.7}, {"parameters": {"schemaType": "manual", "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"event_name\": {\n      \"type\": \"string\",\n      \"description\": \"Name or title for this content batch\"\n    },\n    \"event_description\": {\n      \"type\": \"string\",\n      \"description\": \"Brief description of the content theme\"\n    },\n    \"content_type\": {\n      \"type\": \"string\",\n      \"description\": \"Either 'single' or 'thread'\"\n    },\n    \"platform_posts\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"Twitter\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"thread\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                  \"tweet_number\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Order number in thread\"\n                  },\n                  \"post\": {\n                    \"type\": \"string\",\n                    \"description\": \"The actual tweet content\"\n                  },\n                  \"character_count\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Character count for validation\"\n                  }\n                }\n              }\n            },\n            \"single_post\": {\n              \"type\": \"string\",\n              \"description\": \"Content for single post format\"\n            },\n            \"hashtags\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n              },\n              \"description\": \"List of hashtags used\"\n            },\n            \"thread_length\": {\n              \"type\": \"integer\",\n              \"description\": \"Number of posts in thread\"\n            }\n          }\n        }\n      }\n    },\n    \"additional_notes\": {\n      \"type\": \"string\",\n      \"description\": \"Any additional context or notes\"\n    }\n  }\n}"}, "id": "ede96682-b35d-42de-ba6e-9ea1cf462eb9", "name": "Structure AI Output", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1072, 464], "description": "Defines the expected JSON structure for the AI's output. This ensures the AI returns content in a consistent format that can be processed by subsequent nodes. The schema includes fields for both single posts and threads.", "typeVersion": 1.2}, {"parameters": {"jsCode": "// This node validates the AI-generated content to ensure quality standards\n// It checks character counts, structure, and content formatting\n\ntry {\n  const aiOutput = $json.output || $json;\n  \n  // Validate AI output structure\n  if (!aiOutput.platform_posts?.Twitter) {\n    throw new Error('Invalid AI output: Missing Twitter platform data');\n  }\n  \n  const twitterData = aiOutput.platform_posts.Twitter;\n  let tweets = [];\n  let contentType = 'unknown';\n  \n  // Handle thread content\n  if (twitterData.thread && Array.isArray(twitterData.thread)) {\n    tweets = twitterData.thread;\n    contentType = 'thread';\n    console.log('Processing thread with ' + tweets.length + ' tweets');\n  }\n  // Handle single tweet content\n  else if (twitterData.single_post) {\n    tweets = [{\n      tweet_number: 1,\n      post: twitterData.single_post,\n      character_count: twitterData.single_post.length\n    }];\n    contentType = 'single';\n    console.log('Processing single tweet');\n  } else {\n    throw new Error('No valid tweet content found in AI output');\n  }\n  \n  // Validate each tweet\n  const validatedTweets = [];\n  const warnings = [];\n  let criticalErrors = 0;\n  \n  tweets.forEach((tweet, index) => {\n    const tweetNumber = index + 1;\n    const content = tweet.post || '';\n    const charCount = content.length;\n    let tweetHasIssues = false;\n    \n    // Character count validation\n    if (charCount < 240 || charCount > 265) {\n      warnings.push('Tweet ' + tweetNumber + ': ' + charCount + ' characters (recommended 240-265)');\n      // Only count as critical error if severely outside range\n      if (charCount < 216 || charCount > 291) {\n        criticalErrors++;\n        tweetHasIssues = true;\n      }\n    }\n    \n    // Check for numbered format at start (e.g., \"1/\", \"2/\")\n    if (/^\\d+[\\.\\/]/.test(content.trim())) {\n      warnings.push('Tweet ' + tweetNumber + ': Starts with numbering (not recommended)');\n    }\n    \n    validatedTweets.push({\n      ...tweet,\n      tweet_number: tweetNumber,\n      character_count: charCount,\n      has_issues: tweetHasIssues,\n      validation_passed: !tweetHasIssues\n    });\n    \n    console.log('Tweet ' + tweetNumber + ': ' + charCount + ' chars - \"' + content.substring(0, 50) + '...\"');\n  });\n  \n  // Calculate error percentage\n  const errorPercentage = (criticalErrors / tweets.length) * 100;\n  const shouldPass = errorPercentage <= 30; // Pass if 30% or fewer critical errors\n  \n  console.log('Validation summary: ' + criticalErrors + '/' + tweets.length + ' critical errors (' + errorPercentage.toFixed(1) + '%)');\n  console.log('Warnings: ' + warnings.length + ' total warnings');\n  \n  // Only fail if critical errors exceed 30%\n  if (!shouldPass) {\n    throw new Error('Critical validation failed: ' + errorPercentage.toFixed(1) + '% error rate exceeds 30% threshold');\n  }\n  \n  return [{\n    json: {\n      ...aiOutput,\n      content_type: contentType,\n      tweet_count: validatedTweets.length,\n      tweets_array: validatedTweets,\n      validation_summary: {\n        critical_errors: criticalErrors,\n        error_percentage: Math.round(errorPercentage * 10) / 10,\n        warnings: warnings.length,\n        passed_threshold: shouldPass,\n        warning_details: warnings\n      },\n      validation_status: 'passed',\n      processed_at: new Date().toISOString()\n    }\n  }];\n  \n} catch (error) {\n  console.error('Content validation error:', error.message);\n  return [{\n    json: {\n      error: error.message,\n      validation_status: 'failed',\n      processed_at: new Date().toISOString()\n    }\n  }];\n}"}, "id": "6cb9d845-d7b1-4923-ae08-2c0a894a16ed", "name": "Validate Generated Content", "type": "n8n-nodes-base.code", "position": [1184, 240], "description": "Performs quality checks on AI-generated content: character count validation (240-265 chars), format checking, and structure validation. Allows up to 30% error rate for flexibility. Logs detailed validation results for debugging.", "typeVersion": 2}, {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "96348250-726c-457a-8958-955c37e8d52f", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.validation_status }}", "rightValue": "passed"}]}, "options": {}}, "id": "cec0cd49-fdfd-47b7-8c18-9ff4f16a4dd0", "name": "Content Quality Gate", "type": "n8n-nodes-base.if", "position": [1376, 240], "description": "Final quality check before sending content for approval. Routes to preview creation if validation passed, or to error handling if content doesn't meet quality standards.", "typeVersion": 2}, {"parameters": {"chatId": "{{ $node['Parse User Input'].json.chat_id }}", "text": "❌ **Content Generation Failed**\n\n{{ $json.error }}\n\nThe AI couldn't generate content that meets quality requirements. This usually happens with very complex or unclear topics.\n\nTips:\n- Try simplifying your topic\n- Be more specific about what you want\n- Try a different format (single vs thread)\n\nPlease try again with a different topic or approach.", "additionalFields": {}}, "id": "48ab9d31-efb9-4c41-8b4d-06e91c0b0177", "name": "Send Generation Error", "type": "n8n-nodes-base.telegram", "position": [1584, 480], "webhookId": "4004b700-3e42-4abd-a1db-d43979a62ffa", "description": "Notifies the user if content generation fails. Provides helpful tips on how to improve their topic or format choice for better results.", "typeVersion": 1.2}, {"parameters": {"jsCode": "// Create a formatted preview of the generated content for user approval\nconst tweets = $json.tweets_array;\nconst contentType = $json.content_type;\n\nlet previewText = `📝 **Generated ${contentType.toUpperCase()} Content**\\n\\n`;\npreviewText += `**Topic:** ${$node['Parse User Input'].json.topic}\\n`;\npreviewText += `**Format:** ${contentType}\\n`;\npreviewText += `**Post Count:** ${tweets.length}\\n\\n`;\n\n// Add each tweet to the preview\ntweets.forEach((tweet, index) => {\n  const tweetNum = index + 1;\n  previewText += `**Post ${tweetNum}** (${tweet.character_count} chars):\\n`;\n  previewText += `${tweet.post}\\n\\n`;\n});\n\npreviewText += `---\\n**Ready to post?**\\nClick ✅ to approve or ❌ to cancel`;\n\nreturn [{\n  json: {\n    ...($json),\n    preview_text: previewText\n  }\n}];"}, "id": "b9f51388-1b9f-4328-a79c-0e4bab8cd8df", "name": "Format Content Preview", "type": "n8n-nodes-base.code", "position": [1600, 288], "description": "Creates a readable preview of all generated content for user review. Shows the topic, format, character count for each post, and the full content. This allows users to review before posting.", "typeVersion": 2}, {"parameters": {"operation": "sendAndWait", "chatId": "{{ $node['Parse User Input'].json.chat_id }}", "message": "={{ $json.preview_text }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"appendAttribution": false}}, "id": "b69796bb-d4df-4b06-8722-0837499a97d9", "name": "Send Preview & Await Approval", "type": "n8n-nodes-base.telegram", "position": [1856, 432], "webhookId": "78b25471-88dc-40d2-9d17-c4ba616a359b", "description": "Sends the content preview to Telegram and waits for user approval. Users can click ✅ to approve and post the content, or ❌ to cancel. The workflow pauses here until a response is received.", "typeVersion": 1.2}, {"parameters": {"conditions": {"options": {}, "combinator": "and", "conditions": [{"operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.data.approved }}", "rightValue": true}]}, "options": {}}, "id": "3a9cfcae-f65d-4303-b300-d028e0a13da0", "name": "Check User Approval", "type": "n8n-nodes-base.if", "position": [2080, 432], "description": "Routes the workflow based on user's approval decision. If approved (✅), proceeds to post the content. If rejected (❌), sends a cancellation message.", "typeVersion": 2}, {"parameters": {"chatId": "={{ $node['Parse User Input'].json.chat_id }}", "text": "❌ **Content Cancelled**\n\nThe content has been cancelled as requested.\n\nYou can start over by sending a new topic anytime.", "additionalFields": {}}, "id": "479e2ab9-5ca9-468b-ad40-5ecd12e37591", "name": "Send Cancellation Notice", "type": "n8n-nodes-base.telegram", "position": [2320, 544], "webhookId": "3065fcb6-a88b-4903-bbc2-de83237e3294", "description": "Confirms to the user that their content has been cancelled and won't be posted. Encourages them to try again with a new topic.", "typeVersion": 1.2}, {"parameters": {"fieldToSplitOut": "tweets_array", "options": {}}, "id": "5216c8e4-0365-402e-89e9-64c245c41140", "name": "Split Posts for Publishing", "type": "n8n-nodes-base.splitOut", "position": [2304, 304], "description": "Separates the array of posts into individual items for sequential posting. This is essential for threads, as each post needs to be published separately and linked together.", "typeVersion": 1}, {"parameters": {"query": "={{ $fromAI('Query', '', 'string') }}", "options": {}}, "id": "79f2610f-f0ed-4c05-9f03-7180b98f70bf", "name": "Web Research Tool (Optional)", "type": "@tavily/n8n-nodes-tavily.tavilyTool", "position": [960, 448], "description": "Optional research tool that the AI can use to gather current information about the topic. Useful for trending topics, news, or fact-checking. Requires Tavily API credentials.", "typeVersion": 1}, {"parameters": {"model": "openai/gpt-4o", "options": {}}, "id": "493898fa-c9b5-4c2a-bd7e-7328112265a9", "name": "AI Language Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter", "position": [832, 432], "description": "The AI model used for content generation. Default is GPT-4 via OpenRouter. You can change this to other models like Claude, Gemini, or any model supported by OpenRouter. Model choice affects content quality and style.", "typeVersion": 1}, {"parameters": {"content": "# Universal Social Media Content Generator\n\n## Overview\nThis workflow automates social media content creation using AI. It generates high-quality posts for Twitter/X and LinkedIn based on any topic you provide.\n\n## Features\n- **Scheduled or Manual Triggers**: Run automatically on schedule or start manually\n- **AI-Powered Generation**: Uses advanced language models to create engaging content\n- **Quality Validation**: Ensures posts meet character limits and quality standards\n- **Approval Workflow**: Review content before posting\n- **Multi-Platform Support**: Posts to both Twitter/X and LinkedIn\n- **Thread Support**: Create single posts or connected threads\n\n## Setup Requirements\n1. **Telegram Bot**: For receiving topics and approvals\n   - Create a bot via @BotFather\n   - Get your chat ID\n   - Add credentials to n8n\n\n2. **OpenRouter API**: For AI content generation\n   - Sign up at openrouter.ai\n   - Add API key to credentials\n\n3. **Upload Post API**: For publishing to social platforms\n   - Configure your social media accounts\n   - Add credentials to n8n\n\n4. **Tavily API (Optional)**: For web research\n   - Only needed if you want AI to research topics\n   - Sign up at tavily.com\n\n## Usage\n1. Workflow triggers on schedule or manually\n2. You receive a Telegram message asking for topic\n3. Reply with format: \"your topic - single\" or \"your topic - thread\"\n4. AI generates content (240-265 chars per post)\n5. Review the preview in Telegram\n6. Approve (✅) or Cancel (❌)\n7. Content posts to your configured platforms\n\n## Customization\n- **Topics**: Works with any topic or niche\n- **Tone**: Adjust the AI system prompt for your brand voice\n- **Schedule**: Change trigger frequency as needed\n- **Platforms**: Modify which platforms to post to\n- **Validation**: Adjust character limits or quality thresholds\n\n## Tips\n- Be specific with topics for better results\n- Use 'thread' format for complex topics\n- Review and edit the AI system prompt for your needs\n- Test with different AI models for varied styles", "height": 800, "width": 400, "color": 4}, "id": "67b9fbe1-f93e-4e86-a0ec-78af75f58fad", "name": "Workflow Documentation", "type": "n8n-nodes-base.stickyNote", "position": [-848, 688], "description": "Complete documentation for setting up and using this workflow. Read this first to understand all features and requirements.", "typeVersion": 1}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "5c062e42-c654-43ce-9fbc-5aad98e332ee", "name": "Merge Approval Data", "type": "n8n-nodes-base.merge", "position": [1856, 224], "description": "Combines the content data with the approval response to pass all necessary information to the next steps.", "typeVersion": 3.2}, {"parameters": {"chatId": "{{ $node['Parse User Input'].json.chat_id }}", "text": "✅ **Content Published Successfully!**\n\nLinkedIn: {{ $json.results.linkedin.success ? 'Posted' : 'Failed' }}\nTwitter/X: {{ $json.results.x.success ? 'Posted' : 'Failed' }}\n\nYour content is now live on the selected platforms. Check your accounts to see the posts and monitor engagement.", "additionalFields": {"appendAttribution": false}}, "id": "a2a06038-0b12-4669-9c93-490123392534", "name": "Send Success Notification", "type": "n8n-nodes-base.telegram", "position": [2640, 592], "webhookId": "49374cd3-483f-4934-ab49-a33e2750beed", "description": "Sends a final confirmation message showing which platforms successfully received the content. Helps you track posting status and troubleshoot any platform-specific issues.", "typeVersion": 1.2}, {"parameters": {"user": "{{ $credentials.username }}", "title": "={{ $json.post }}", "platform": ["x", "linkedin"], "operation": "uploadText", "xReplySettings": "everyone"}, "id": "6b833896-38ce-4e2c-982b-56ed994902a5", "name": "Publish to Social Platforms", "type": "n8n-nodes-upload-post.uploadPost", "position": [2672, 304], "description": "Posts the content to Twitter/X and LinkedIn. Configure which platforms to use in the parameters. For threads, posts are published sequentially with proper reply chains on Twitter/X.", "typeVersion": 1}], "pinData": {}, "connections": {"Parse User Input": {"main": [[{"node": "Input Validation Check", "type": "main", "index": 0}]]}, "Schedule Trigger": {"main": [[{"node": "Create Schedule Timestamp", "type": "main", "index": 0}]]}, "AI Language Model": {"ai_languageModel": [[{"node": "AI Content Generator", "type": "ai_languageModel", "index": 0}]]}, "Check User Approval": {"main": [[{"node": "Split Posts for Publishing", "type": "main", "index": 0}], [{"node": "Send Cancellation Notice", "type": "main", "index": 0}]]}, "Merge Approval Data": {"main": [[{"node": "Check User Approval", "type": "main", "index": 0}]]}, "Structure AI Output": {"ai_outputParser": [[{"node": "AI Content Generator", "type": "ai_outputParser", "index": 0}]]}, "AI Content Generator": {"main": [[{"node": "Validate Generated Content", "type": "main", "index": 0}]]}, "Content Quality Gate": {"main": [[{"node": "Format Content Preview", "type": "main", "index": 0}], [{"node": "Send Generation Error", "type": "main", "index": 0}]]}, "Validate Reply Format": {"main": [[], [{"node": "Parse User Input", "type": "main", "index": 0}]]}, "Format Content Preview": {"main": [[{"node": "Send Preview & Await Approval", "type": "main", "index": 0}, {"node": "Merge Approval Data", "type": "main", "index": 0}]]}, "Input Validation Check": {"main": [[{"node": "AI Content Generator", "type": "main", "index": 0}], [{"node": "Send Input Error Message", "type": "main", "index": 0}]]}, "Create Schedule Timestamp": {"main": [[{"node": "Request Content Topic via Telegram", "type": "main", "index": 0}]]}, "Wait for User Topic Reply": {"main": [[{"node": "Validate Reply Format", "type": "main", "index": 0}]]}, "Split Posts for Publishing": {"main": [[{"node": "Publish to Social Platforms", "type": "main", "index": 0}]]}, "Validate Generated Content": {"main": [[{"node": "Content Quality Gate", "type": "main", "index": 0}]]}, "Publish to Social Platforms": {"main": [[{"node": "Send Success Notification", "type": "main", "index": 0}]]}, "Web Research Tool (Optional)": {"ai_tool": [[{"node": "AI Content Generator", "type": "ai_tool", "index": 0}]]}, "Send Preview & Await Approval": {"main": [[{"node": "Merge Approval Data", "type": "main", "index": 1}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "69650787-fbff-48c4-8556-e920a7912a7e", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "xXmgJcpgqzlL4pgZ", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Universal Social Media Content Generator with AI"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 1, $$"a0da42e4-e3f4-4e93-ac53-ae1ba141707a"$$::jsonb::text, $$"n8n-nodes-base.telegramTrigger"$$::jsonb::text, $$"Wait for User Topic Reply"$$::jsonb::text, $${"n8n_node": {"parameters": {"updates": ["message"], "additionalFields": {}}, "id": "a0da42e4-e3f4-4e93-ac53-ae1ba141707a", "name": "Wait for User Topic Reply", "type": "n8n-nodes-base.telegramTrigger", "position": [320, 288], "webhookId": "telegram-topic-reply-webhook", "description": "This webhook listens for your reply in Telegram. When you send a message in response to the topic request, this node captures it and passes it to the next step. Make sure the webhook is properly configured in your Telegram bot settings.", "typeVersion": 1.1}, "connections": {"main": [[{"node": "Validate Reply Format", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 2, $$"0396a23e-34a0-43cd-93d6-2b4be88134d7"$$::jsonb::text, $$"n8n-nodes-base.scheduleTrigger"$$::jsonb::text, $$"Schedule Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"rule": {"interval": [{"daysInterval": 5, "triggerAtHour": 9}]}}, "id": "0396a23e-34a0-43cd-93d6-2b4be88134d7", "name": "Schedule Trigger", "type": "n8n-nodes-base.scheduleTrigger", "position": [-128, -160], "description": "This node triggers your content generation workflow on a schedule. Default is every 5 days at 9 AM, but you can adjust this to daily, weekly, or any custom schedule that fits your content strategy. The workflow will start automatically at the specified time.", "typeVersion": 1.2}, "connections": {"main": [[{"node": "Create Schedule Timestamp", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 3, $$"ede96682-b35d-42de-ba6e-9ea1cf462eb9"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Structure AI Output"$$::jsonb::text, $${"n8n_node": {"parameters": {"schemaType": "manual", "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"event_name\": {\n      \"type\": \"string\",\n      \"description\": \"Name or title for this content batch\"\n    },\n    \"event_description\": {\n      \"type\": \"string\",\n      \"description\": \"Brief description of the content theme\"\n    },\n    \"content_type\": {\n      \"type\": \"string\",\n      \"description\": \"Either 'single' or 'thread'\"\n    },\n    \"platform_posts\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"Twitter\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"thread\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                  \"tweet_number\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Order number in thread\"\n                  },\n                  \"post\": {\n                    \"type\": \"string\",\n                    \"description\": \"The actual tweet content\"\n                  },\n                  \"character_count\": {\n                    \"type\": \"integer\",\n                    \"description\": \"Character count for validation\"\n                  }\n                }\n              }\n            },\n            \"single_post\": {\n              \"type\": \"string\",\n              \"description\": \"Content for single post format\"\n            },\n            \"hashtags\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"type\": \"string\"\n              },\n              \"description\": \"List of hashtags used\"\n            },\n            \"thread_length\": {\n              \"type\": \"integer\",\n              \"description\": \"Number of posts in thread\"\n            }\n          }\n        }\n      }\n    },\n    \"additional_notes\": {\n      \"type\": \"string\",\n      \"description\": \"Any additional context or notes\"\n    }\n  }\n}"}, "id": "ede96682-b35d-42de-ba6e-9ea1cf462eb9", "name": "Structure AI Output", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1072, 464], "description": "Defines the expected JSON structure for the AI's output. This ensures the AI returns content in a consistent format that can be processed by subsequent nodes. The schema includes fields for both single posts and threads.", "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "AI Content Generator", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 4, $$"79f2610f-f0ed-4c05-9f03-7180b98f70bf"$$::jsonb::text, $$"@tavily/n8n-nodes-tavily.tavilyTool"$$::jsonb::text, $$"Web Research Tool (Optional)"$$::jsonb::text, $${"n8n_node": {"parameters": {"query": "={{ $fromAI('Query', '', 'string') }}", "options": {}}, "id": "79f2610f-f0ed-4c05-9f03-7180b98f70bf", "name": "Web Research Tool (Optional)", "type": "@tavily/n8n-nodes-tavily.tavilyTool", "position": [960, 448], "description": "Optional research tool that the AI can use to gather current information about the topic. Useful for trending topics, news, or fact-checking. Requires Tavily API credentials.", "typeVersion": 1}, "connections": {"ai_tool": [[{"node": "AI Content Generator", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 5, $$"493898fa-c9b5-4c2a-bd7e-7328112265a9"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenRouter"$$::jsonb::text, $$"AI Language Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "openai/gpt-4o", "options": {}}, "id": "493898fa-c9b5-4c2a-bd7e-7328112265a9", "name": "AI Language Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter", "position": [832, 432], "description": "The AI model used for content generation. Default is GPT-4 via OpenRouter. You can change this to other models like Claude, Gemini, or any model supported by OpenRouter. Model choice affects content quality and style.", "typeVersion": 1}, "connections": {"ai_languageModel": [[{"node": "AI Content Generator", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 6, $$"67b9fbe1-f93e-4e86-a0ec-78af75f58fad"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Workflow Documentation"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Universal Social Media Content Generator\n\n## Overview\nThis workflow automates social media content creation using AI. It generates high-quality posts for Twitter/X and LinkedIn based on any topic you provide.\n\n## Features\n- **Scheduled or Manual Triggers**: Run automatically on schedule or start manually\n- **AI-Powered Generation**: Uses advanced language models to create engaging content\n- **Quality Validation**: Ensures posts meet character limits and quality standards\n- **Approval Workflow**: Review content before posting\n- **Multi-Platform Support**: Posts to both Twitter/X and LinkedIn\n- **Thread Support**: Create single posts or connected threads\n\n## Setup Requirements\n1. **Telegram Bot**: For receiving topics and approvals\n   - Create a bot via @BotFather\n   - Get your chat ID\n   - Add credentials to n8n\n\n2. **OpenRouter API**: For AI content generation\n   - Sign up at openrouter.ai\n   - Add API key to credentials\n\n3. **Upload Post API**: For publishing to social platforms\n   - Configure your social media accounts\n   - Add credentials to n8n\n\n4. **Tavily API (Optional)**: For web research\n   - Only needed if you want AI to research topics\n   - Sign up at tavily.com\n\n## Usage\n1. Workflow triggers on schedule or manually\n2. You receive a Telegram message asking for topic\n3. Reply with format: \"your topic - single\" or \"your topic - thread\"\n4. AI generates content (240-265 chars per post)\n5. Review the preview in Telegram\n6. Approve (✅) or Cancel (❌)\n7. Content posts to your configured platforms\n\n## Customization\n- **Topics**: Works with any topic or niche\n- **Tone**: Adjust the AI system prompt for your brand voice\n- **Schedule**: Change trigger frequency as needed\n- **Platforms**: Modify which platforms to post to\n- **Validation**: Adjust character limits or quality thresholds\n\n## Tips\n- Be specific with topics for better results\n- Use 'thread' format for complex topics\n- Review and edit the AI system prompt for your needs\n- Test with different AI models for varied styles", "height": 800, "width": 400, "color": 4}, "id": "67b9fbe1-f93e-4e86-a0ec-78af75f58fad", "name": "Workflow Documentation", "type": "n8n-nodes-base.stickyNote", "position": [-848, 688], "description": "Complete documentation for setting up and using this workflow. Read this first to understand all features and requirements.", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 7, $$"fba10582-9d08-4629-adca-701b79d92e4a"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Validate Reply Format"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "486d068f-b5cb-4af4-aee8-beb09dd02802", "operator": {"type": "any", "operation": "exists"}, "leftValue": "={{ $json.message.reply_to_message }}"}, {"id": "9b8ba1b0-008e-4749-b808-9b9cfd8480ae", "operator": {"type": "string", "operation": "isNotEmpty"}, "leftValue": "={{ $json.message.text }}"}]}, "options": {}}, "id": "fba10582-9d08-4629-adca-701b79d92e4a", "name": "Validate Reply Format", "type": "n8n-nodes-base.if", "position": [224, 608], "description": "Checks if the Telegram message is a valid reply to the bot's request. It ensures the message is not empty and is actually a reply to the bot's prompt. This prevents the workflow from processing random messages in the chat.", "typeVersion": 2}, "connections": {"main": [[], [{"node": "Parse User Input", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 8, $$"c416b6af-afc5-4da3-b384-7900c5e2de3e"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Create Schedule Timestamp"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// This node creates a human-readable timestamp for the current schedule run\n// It helps track when each content generation session was initiated\n\nconst today = new Date();\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nconst scheduleName = `${days[today.getDay()]} ${today.getHours()}:00`;\n\nreturn [{\n  json: {\n    scheduleName: scheduleName,\n    timestamp: new Date().toISOString(),\n    workflowId: $workflow.id\n  }\n}];"}, "id": "c416b6af-afc5-4da3-b384-7900c5e2de3e", "name": "Create Schedule Timestamp", "type": "n8n-nodes-base.code", "position": [96, -160], "description": "Creates a human-readable timestamp and schedule name for tracking purposes. This helps you identify which schedule triggered the content generation, especially useful if you have multiple schedules running.", "typeVersion": 2}, "connections": {"main": [[{"node": "Request Content Topic via Telegram", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 9, $$"17f3684a-2f19-4604-b4d5-35753a0b072e"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Parse User Input"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// This node parses the user input and validates the format\n// Expected format: 'topic - format' where format is 'single' or 'thread'\n// If no format is specified, it defaults to 'auto'\n\ntry {\n  const userInput = $json.message.text;\n  let topic, formatType;\n  \n  if (userInput.includes(' - ')) {\n    const parts = userInput.split(' - ');\n    topic = parts[0].trim();\n    formatType = parts[1].trim().toLowerCase();\n  } else {\n    // If no format specified, default to auto\n    topic = userInput.trim();\n    formatType = \"auto\";\n  }\n  \n  // Validate format type\n  const validFormats = ['single', 'thread', 'auto'];\n  if (!validFormats.includes(formatType)) {\n    throw new Error(`Invalid format type: ${formatType}. Use 'single', 'thread', or 'auto'`);\n  }\n  \n  // Validate topic length\n  if (topic.length < 3) {\n    throw new Error('Topic too short. Please provide a more detailed topic.');\n  }\n  \n  return [{\n    json: {\n      topic: topic,\n      format_type: formatType,\n      chat_id: $json.message.chat.id,\n      username: $json.message.from.username,\n      original_message: userInput,\n      validation_status: 'passed'\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      error: error.message,\n      validation_status: 'failed',\n      chat_id: $json.message.chat.id\n    }\n  }];\n}"}, "id": "17f3684a-2f19-4604-b4d5-35753a0b072e", "name": "Parse User Input", "type": "n8n-nodes-base.code", "position": [464, 624], "description": "Extracts the topic and format from the user's message. Supports three formats: 'single' (one post), 'thread' (multiple connected posts), or 'auto' (let AI decide). The topic must be at least 3 characters long. If format is not specified, defaults to 'auto'.", "typeVersion": 2}, "connections": {"main": [[{"node": "Input Validation Check", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 10, $$"e737a41f-5649-4470-aa2c-a7b06dc80893"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Request Content Topic via Telegram"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "{{ $credentials.telegramChatId }}", "text": "🚀 **Content Generation Time!**\n\nIt's time for your {{ $json.scheduleName }} content creation session.\n\nPlease reply with:\n- Your topic or theme\n- Type 'single' for one post or 'thread' for multiple connected posts\n\nExample responses:\n- 'sustainable living tips - single'\n- 'how to start a podcast - thread'\n- 'morning motivation - single'", "additionalFields": {}}, "id": "e737a41f-5649-4470-aa2c-a7b06dc80893", "name": "Request Content Topic via Telegram", "type": "n8n-nodes-base.telegram", "position": [320, -160], "webhookId": "3c293ac0-62b9-4fe3-b9f8-e3ce7b26e906", "description": "Sends a message to your Telegram chat asking for the content topic and format. The message will appear in the Telegram chat/channel you've configured in the credentials. Make sure to set up your Telegram bot and add the chat ID in the credentials.", "typeVersion": 1.2}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 11, $$"4c438f0c-82a0-414a-9429-5fe5d4a5e1bb"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Input Validation Check"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {}, "combinator": "and", "conditions": [{"operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.validation_status }}", "rightValue": "passed"}]}, "options": {}}, "id": "4c438f0c-82a0-414a-9429-5fe5d4a5e1bb", "name": "Input Validation Check", "type": "n8n-nodes-base.if", "position": [640, 624], "description": "Routes the workflow based on validation results. If the input passes validation, it proceeds to content generation. If validation fails, it sends an error message back to the user with instructions on the correct format.", "typeVersion": 2}, "connections": {"main": [[{"node": "AI Content Generator", "type": "main", "index": 0}], [{"node": "Send Input Error Message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 12, $$"5f3a2261-899f-4179-93b3-e8165702f1e8"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"AI Content Generator"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=Create social media content about: {{ $json.topic }}\nFormat type: {{ $json.format_type }}", "hasOutputParser": true, "options": {"systemMessage": "=You are a professional social media content creator. Your task is to generate engaging, high-quality content for Twitter/X and LinkedIn.\n\nCONTENT REQUIREMENTS:\n\nCHARACTER COUNT:\n- EVERY tweet/post MUST be between 240-265 characters\n- Count characters before finalizing\n- Rewrite if outside this range\n\nFORMAT GUIDELINES:\n- For 'single': Create one standalone post\n- For 'thread': Create 3-6 connected posts that tell a complete story\n- For 'auto': Decide based on topic complexity (simple topics = single, complex = thread)\n\nWRITING STYLE:\n- Clear, conversational tone\n- Use simple language\n- Include 1-2 relevant hashtags\n- Be engaging and value-driven\n- Professional but approachable\n- NO numbered lists in the beginning of posts (avoid \"1/\", \"2/\" etc.)\n\nCONTENT STRUCTURE:\n- Hook: Start with an attention-grabbing statement\n- Value: Provide useful information or insights\n- Call-to-action: Encourage engagement (questions, thoughts, actions)\n\nADAPT TO TOPIC:\n- Business topics: Professional, data-driven\n- Creative topics: Inspiring, imaginative\n- Educational topics: Clear, structured\n- Personal topics: Authentic, relatable\n- Technical topics: Simple explanations, practical examples\n\nREMEMBER:\n- Quality over quantity\n- Each post should provide value\n- Maintain consistency in tone throughout threads\n- Use line breaks for readability\n- End threads with a summary or key takeaway"}}, "id": "5f3a2261-899f-4179-93b3-e8165702f1e8", "name": "AI Content Generator", "type": "@n8n/n8n-nodes-langchain.agent", "maxTries": 3, "position": [880, 240], "description": "The AI agent that generates your social media content. It uses the topic and format you provided to create posts optimized for engagement. The system prompt ensures consistent quality and character count. Configure retry attempts (default: 3) for reliability.", "retryOnFail": true, "typeVersion": 1.7}, "connections": {"main": [[{"node": "Validate Generated Content", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 13, $$"5d7d3668-aa21-4017-b523-bd2040d2c626"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send Input Error Message"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "={{ $json.chat_id }}", "text": "❌ **Input Error**\n\n{{ $json.error }}\n\nPlease try again with the correct format:\n'your topic - single' or 'your topic - thread'\n\nExamples:\n- 'productivity tips - single'\n- 'beginner's guide to investing - thread'\n- 'motivational quote' (defaults to auto)", "additionalFields": {}}, "id": "5d7d3668-aa21-4017-b523-bd2040d2c626", "name": "Send Input Error Message", "type": "n8n-nodes-base.telegram", "position": [880, 928], "webhookId": "32b0496e-9b72-4806-a961-9a1a9a61670e", "description": "Sends an error message to the user if their input format is incorrect. Provides clear examples of the expected format to help users correct their input.", "typeVersion": 1.2}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 14, $$"6cb9d845-d7b1-4923-ae08-2c0a894a16ed"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Validate Generated Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// This node validates the AI-generated content to ensure quality standards\n// It checks character counts, structure, and content formatting\n\ntry {\n  const aiOutput = $json.output || $json;\n  \n  // Validate AI output structure\n  if (!aiOutput.platform_posts?.Twitter) {\n    throw new Error('Invalid AI output: Missing Twitter platform data');\n  }\n  \n  const twitterData = aiOutput.platform_posts.Twitter;\n  let tweets = [];\n  let contentType = 'unknown';\n  \n  // Handle thread content\n  if (twitterData.thread && Array.isArray(twitterData.thread)) {\n    tweets = twitterData.thread;\n    contentType = 'thread';\n    console.log('Processing thread with ' + tweets.length + ' tweets');\n  }\n  // Handle single tweet content\n  else if (twitterData.single_post) {\n    tweets = [{\n      tweet_number: 1,\n      post: twitterData.single_post,\n      character_count: twitterData.single_post.length\n    }];\n    contentType = 'single';\n    console.log('Processing single tweet');\n  } else {\n    throw new Error('No valid tweet content found in AI output');\n  }\n  \n  // Validate each tweet\n  const validatedTweets = [];\n  const warnings = [];\n  let criticalErrors = 0;\n  \n  tweets.forEach((tweet, index) => {\n    const tweetNumber = index + 1;\n    const content = tweet.post || '';\n    const charCount = content.length;\n    let tweetHasIssues = false;\n    \n    // Character count validation\n    if (charCount < 240 || charCount > 265) {\n      warnings.push('Tweet ' + tweetNumber + ': ' + charCount + ' characters (recommended 240-265)');\n      // Only count as critical error if severely outside range\n      if (charCount < 216 || charCount > 291) {\n        criticalErrors++;\n        tweetHasIssues = true;\n      }\n    }\n    \n    // Check for numbered format at start (e.g., \"1/\", \"2/\")\n    if (/^\\d+[\\.\\/]/.test(content.trim())) {\n      warnings.push('Tweet ' + tweetNumber + ': Starts with numbering (not recommended)');\n    }\n    \n    validatedTweets.push({\n      ...tweet,\n      tweet_number: tweetNumber,\n      character_count: charCount,\n      has_issues: tweetHasIssues,\n      validation_passed: !tweetHasIssues\n    });\n    \n    console.log('Tweet ' + tweetNumber + ': ' + charCount + ' chars - \"' + content.substring(0, 50) + '...\"');\n  });\n  \n  // Calculate error percentage\n  const errorPercentage = (criticalErrors / tweets.length) * 100;\n  const shouldPass = errorPercentage <= 30; // Pass if 30% or fewer critical errors\n  \n  console.log('Validation summary: ' + criticalErrors + '/' + tweets.length + ' critical errors (' + errorPercentage.toFixed(1) + '%)');\n  console.log('Warnings: ' + warnings.length + ' total warnings');\n  \n  // Only fail if critical errors exceed 30%\n  if (!shouldPass) {\n    throw new Error('Critical validation failed: ' + errorPercentage.toFixed(1) + '% error rate exceeds 30% threshold');\n  }\n  \n  return [{\n    json: {\n      ...aiOutput,\n      content_type: contentType,\n      tweet_count: validatedTweets.length,\n      tweets_array: validatedTweets,\n      validation_summary: {\n        critical_errors: criticalErrors,\n        error_percentage: Math.round(errorPercentage * 10) / 10,\n        warnings: warnings.length,\n        passed_threshold: shouldPass,\n        warning_details: warnings\n      },\n      validation_status: 'passed',\n      processed_at: new Date().toISOString()\n    }\n  }];\n  \n} catch (error) {\n  console.error('Content validation error:', error.message);\n  return [{\n    json: {\n      error: error.message,\n      validation_status: 'failed',\n      processed_at: new Date().toISOString()\n    }\n  }];\n}"}, "id": "6cb9d845-d7b1-4923-ae08-2c0a894a16ed", "name": "Validate Generated Content", "type": "n8n-nodes-base.code", "position": [1184, 240], "description": "Performs quality checks on AI-generated content: character count validation (240-265 chars), format checking, and structure validation. Allows up to 30% error rate for flexibility. Logs detailed validation results for debugging.", "typeVersion": 2}, "connections": {"main": [[{"node": "Content Quality Gate", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 15, $$"cec0cd49-fdfd-47b7-8c18-9ff4f16a4dd0"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Content Quality Gate"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 1, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "96348250-726c-457a-8958-955c37e8d52f", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.validation_status }}", "rightValue": "passed"}]}, "options": {}}, "id": "cec0cd49-fdfd-47b7-8c18-9ff4f16a4dd0", "name": "Content Quality Gate", "type": "n8n-nodes-base.if", "position": [1376, 240], "description": "Final quality check before sending content for approval. Routes to preview creation if validation passed, or to error handling if content doesn't meet quality standards.", "typeVersion": 2}, "connections": {"main": [[{"node": "Format Content Preview", "type": "main", "index": 0}], [{"node": "Send Generation Error", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 16, $$"b9f51388-1b9f-4328-a79c-0e4bab8cd8df"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Format Content Preview"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Create a formatted preview of the generated content for user approval\nconst tweets = $json.tweets_array;\nconst contentType = $json.content_type;\n\nlet previewText = `📝 **Generated ${contentType.toUpperCase()} Content**\\n\\n`;\npreviewText += `**Topic:** ${$node['Parse User Input'].json.topic}\\n`;\npreviewText += `**Format:** ${contentType}\\n`;\npreviewText += `**Post Count:** ${tweets.length}\\n\\n`;\n\n// Add each tweet to the preview\ntweets.forEach((tweet, index) => {\n  const tweetNum = index + 1;\n  previewText += `**Post ${tweetNum}** (${tweet.character_count} chars):\\n`;\n  previewText += `${tweet.post}\\n\\n`;\n});\n\npreviewText += `---\\n**Ready to post?**\\nClick ✅ to approve or ❌ to cancel`;\n\nreturn [{\n  json: {\n    ...($json),\n    preview_text: previewText\n  }\n}];"}, "id": "b9f51388-1b9f-4328-a79c-0e4bab8cd8df", "name": "Format Content Preview", "type": "n8n-nodes-base.code", "position": [1600, 288], "description": "Creates a readable preview of all generated content for user review. Shows the topic, format, character count for each post, and the full content. This allows users to review before posting.", "typeVersion": 2}, "connections": {"main": [[{"node": "Send Preview & Await Approval", "type": "main", "index": 0}, {"node": "Merge Approval Data", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 17, $$"48ab9d31-efb9-4c41-8b4d-06e91c0b0177"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send Generation Error"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "{{ $node['Parse User Input'].json.chat_id }}", "text": "❌ **Content Generation Failed**\n\n{{ $json.error }}\n\nThe AI couldn't generate content that meets quality requirements. This usually happens with very complex or unclear topics.\n\nTips:\n- Try simplifying your topic\n- Be more specific about what you want\n- Try a different format (single vs thread)\n\nPlease try again with a different topic or approach.", "additionalFields": {}}, "id": "48ab9d31-efb9-4c41-8b4d-06e91c0b0177", "name": "Send Generation Error", "type": "n8n-nodes-base.telegram", "position": [1584, 480], "webhookId": "4004b700-3e42-4abd-a1db-d43979a62ffa", "description": "Notifies the user if content generation fails. Provides helpful tips on how to improve their topic or format choice for better results.", "typeVersion": 1.2}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 18, $$"b69796bb-d4df-4b06-8722-0837499a97d9"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send Preview & Await Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "sendAndWait", "chatId": "{{ $node['Parse User Input'].json.chat_id }}", "message": "={{ $json.preview_text }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"appendAttribution": false}}, "id": "b69796bb-d4df-4b06-8722-0837499a97d9", "name": "Send Preview & Await Approval", "type": "n8n-nodes-base.telegram", "position": [1856, 432], "webhookId": "78b25471-88dc-40d2-9d17-c4ba616a359b", "description": "Sends the content preview to Telegram and waits for user approval. Users can click ✅ to approve and post the content, or ❌ to cancel. The workflow pauses here until a response is received.", "typeVersion": 1.2}, "connections": {"main": [[{"node": "Merge Approval Data", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 19, $$"5c062e42-c654-43ce-9fbc-5aad98e332ee"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge Approval Data"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "5c062e42-c654-43ce-9fbc-5aad98e332ee", "name": "Merge Approval Data", "type": "n8n-nodes-base.merge", "position": [1856, 224], "description": "Combines the content data with the approval response to pass all necessary information to the next steps.", "typeVersion": 3.2}, "connections": {"main": [[{"node": "Check User Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 20, $$"3a9cfcae-f65d-4303-b300-d028e0a13da0"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Check User Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {}, "combinator": "and", "conditions": [{"operator": {"type": "boolean", "operation": "true"}, "leftValue": "={{ $json.data.approved }}", "rightValue": true}]}, "options": {}}, "id": "3a9cfcae-f65d-4303-b300-d028e0a13da0", "name": "Check User Approval", "type": "n8n-nodes-base.if", "position": [2080, 432], "description": "Routes the workflow based on user's approval decision. If approved (✅), proceeds to post the content. If rejected (❌), sends a cancellation message.", "typeVersion": 2}, "connections": {"main": [[{"node": "Split Posts for Publishing", "type": "main", "index": 0}], [{"node": "Send Cancellation Notice", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 21, $$"479e2ab9-5ca9-468b-ad40-5ecd12e37591"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send Cancellation Notice"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "={{ $node['Parse User Input'].json.chat_id }}", "text": "❌ **Content Cancelled**\n\nThe content has been cancelled as requested.\n\nYou can start over by sending a new topic anytime.", "additionalFields": {}}, "id": "479e2ab9-5ca9-468b-ad40-5ecd12e37591", "name": "Send Cancellation Notice", "type": "n8n-nodes-base.telegram", "position": [2320, 544], "webhookId": "3065fcb6-a88b-4903-bbc2-de83237e3294", "description": "Confirms to the user that their content has been cancelled and won't be posted. Encourages them to try again with a new topic.", "typeVersion": 1.2}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 22, $$"5216c8e4-0365-402e-89e9-64c245c41140"$$::jsonb::text, $$"n8n-nodes-base.splitOut"$$::jsonb::text, $$"Split Posts for Publishing"$$::jsonb::text, $${"n8n_node": {"parameters": {"fieldToSplitOut": "tweets_array", "options": {}}, "id": "5216c8e4-0365-402e-89e9-64c245c41140", "name": "Split Posts for Publishing", "type": "n8n-nodes-base.splitOut", "position": [2304, 304], "description": "Separates the array of posts into individual items for sequential posting. This is essential for threads, as each post needs to be published separately and linked together.", "typeVersion": 1}, "connections": {"main": [[{"node": "Publish to Social Platforms", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 23, $$"6b833896-38ce-4e2c-982b-56ed994902a5"$$::jsonb::text, $$"n8n-nodes-upload-post.uploadPost"$$::jsonb::text, $$"Publish to Social Platforms"$$::jsonb::text, $${"n8n_node": {"parameters": {"user": "{{ $credentials.username }}", "title": "={{ $json.post }}", "platform": ["x", "linkedin"], "operation": "uploadText", "xReplySettings": "everyone"}, "id": "6b833896-38ce-4e2c-982b-56ed994902a5", "name": "Publish to Social Platforms", "type": "n8n-nodes-upload-post.uploadPost", "position": [2672, 304], "description": "Posts the content to Twitter/X and LinkedIn. Configure which platforms to use in the parameters. For threads, posts are published sequentially with proper reply chains on Twitter/X.", "typeVersion": 1}, "connections": {"main": [[{"node": "Send Success Notification", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_Universal_Social_Media_Content_Generator_with_AI"$$::jsonb::text, 24, $$"a2a06038-0b12-4669-9c93-490123392534"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Send Success Notification"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "{{ $node['Parse User Input'].json.chat_id }}", "text": "✅ **Content Published Successfully!**\n\nLinkedIn: {{ $json.results.linkedin.success ? 'Posted' : 'Failed' }}\nTwitter/X: {{ $json.results.x.success ? 'Posted' : 'Failed' }}\n\nYour content is now live on the selected platforms. Check your accounts to see the posts and monitor engagement.", "additionalFields": {"appendAttribution": false}}, "id": "a2a06038-0b12-4669-9c93-490123392534", "name": "Send Success Notification", "type": "n8n-nodes-base.telegram", "position": [2640, 592], "webhookId": "49374cd3-483f-4934-ab49-a33e2750beed", "description": "Sends a final confirmation message showing which platforms successfully received the content. Helps you track posting status and troubleshoot any platform-specific issues.", "typeVersion": 1.2}, "connections": {}}$$::jsonb);

-- N8N-social_media_auto_blogpost_linkedin_twitter (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Auto-post Blogs to LinkedIn and Twitter"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/auto_blogpost_linkedin_twitter.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Auto-post Blogs to LinkedIn and Twitter", "active": null}, "sourcePath": "workflows/n8n/social_media/auto_blogpost_linkedin_twitter.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Auto-post Blogs to LinkedIn and Twitter", "nodes": [{"parameters": {"content": "Placeholder for Auto-post Blogs to LinkedIn and Twitter", "height": 530, "width": 1100, "color": 5}, "id": "f6b52b5b-3751-4c22-a6c1-3e5936fb322a", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "auto-post-blogs-to-linkedin-and-twitter"}, "id": "f5a15148-9af1-409b-a4ef-ad2b0e2e2f06", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "121f362d-ae3a-45c8-894d-12e606dab808", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "6a35e11a-dd03-4d95-bcc3-f4f8c85088d5", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"mode": "insert", "options": {}, "indexName": "auto-post_blogs_to_linkedin_and_twitter"}, "id": "401ef38d-6acd-41cd-8ce5-3a50b8545789", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"indexName": "auto-post_blogs_to_linkedin_and_twitter"}, "id": "04497ee3-b9d0-4296-8d11-c26ea24c5a19", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "cd76d86e-4c30-43bb-a0e2-baaf728f7871", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "9f39a9d1-b9d1-42d9-b199-8256c98ba424", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "8262b5be-0943-4a57-81d3-438502e72dca", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, {"parameters": {"promptType": "define", "text": "Handle data", "options": {"systemMessage": "You are an assistant for Auto-post Blogs to LinkedIn and Twitter"}}, "id": "ef4551cd-6b4e-41ae-8688-f3119f289c8f", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Auto-post Blogs to LinkedIn and Twitter"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": "Status", "schema": []}}, "id": "4ab2b12c-2228-4309-b688-e64bd895ffce", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "Auto-post Blogs to LinkedIn and Twitter error: {$json.error.message}"}, "id": "915205bd-7106-4a5d-9962-82a3d5292349", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}, "Supabase Insert": {"ai_document": [[]]}, "Supabase Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Auto-post Blogs to LinkedIn and Twitter"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 1, $$"f5a15148-9af1-409b-a4ef-ad2b0e2e2f06"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "auto-post-blogs-to-linkedin-and-twitter"}, "id": "f5a15148-9af1-409b-a4ef-ad2b0e2e2f06", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 2, $$"f6b52b5b-3751-4c22-a6c1-3e5936fb322a"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Placeholder for Auto-post Blogs to LinkedIn and Twitter", "height": 530, "width": 1100, "color": 5}, "id": "f6b52b5b-3751-4c22-a6c1-3e5936fb322a", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 3, $$"8262b5be-0943-4a57-81d3-438502e72dca"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatAnthropic"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "8262b5be-0943-4a57-81d3-438502e72dca", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic", "typeVersion": 1, "position": [450, -340], "credentials": {"anthropicApi": {"id": "ANTHROPIC_API", "name": "Anthropic"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 4, $$"121f362d-ae3a-45c8-894d-12e606dab808"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "121f362d-ae3a-45c8-894d-12e606dab808", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Supabase Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 5, $$"9f39a9d1-b9d1-42d9-b199-8256c98ba424"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "9f39a9d1-b9d1-42d9-b199-8256c98ba424", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 6, $$"6a35e11a-dd03-4d95-bcc3-f4f8c85088d5"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsOpenAi"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "text-embedding-3-small", "options": {}}, "id": "6a35e11a-dd03-4d95-bcc3-f4f8c85088d5", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi", "typeVersion": 1, "position": [70, 0], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_embedding": [[{"node": "Supabase Insert", "type": "ai_embedding", "index": 0}, {"node": "Supabase Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 7, $$"401ef38d-6acd-41cd-8ce5-3a50b8545789"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "indexName": "auto-post_blogs_to_linkedin_and_twitter"}, "id": "401ef38d-6acd-41cd-8ce5-3a50b8545789", "name": "Supabase Insert", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, 0], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 8, $$"04497ee3-b9d0-4296-8d11-c26ea24c5a19"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStoreSupabase"$$::jsonb::text, $$"Supabase Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"indexName": "auto-post_blogs_to_linkedin_and_twitter"}, "id": "04497ee3-b9d0-4296-8d11-c26ea24c5a19", "name": "Supabase Query", "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase", "typeVersion": 1, "position": [270, -180], "credentials": {"supabaseApi": {"id": "SUPABASE_API", "name": "Supabase account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 9, $$"cd76d86e-4c30-43bb-a0e2-baaf728f7871"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Supabase", "description": "Vector context"}, "id": "cd76d86e-4c30-43bb-a0e2-baaf728f7871", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 10, $$"ef4551cd-6b4e-41ae-8688-f3119f289c8f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Handle data", "options": {"systemMessage": "You are an assistant for Auto-post Blogs to LinkedIn and Twitter"}}, "id": "ef4551cd-6b4e-41ae-8688-f3119f289c8f", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 11, $$"4ab2b12c-2228-4309-b688-e64bd895ffce"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Auto-post Blogs to LinkedIn and Twitter"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": "Status", "schema": []}}, "id": "4ab2b12c-2228-4309-b688-e64bd895ffce", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_blogpost_linkedin_twitter"$$::jsonb::text, 12, $$"915205bd-7106-4a5d-9962-82a3d5292349"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "Auto-post Blogs to LinkedIn and Twitter error: {$json.error.message}"}, "id": "915205bd-7106-4a5d-9962-82a3d5292349", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-social_media_auto_dm_twitter_new_follower (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Auto-DM New Twitter Followers"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/auto_dm_twitter_new_follower.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Auto-DM New Twitter Followers", "active": null}, "sourcePath": "workflows/n8n/social_media/auto_dm_twitter_new_follower.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Auto-DM New Twitter Followers", "nodes": [{"parameters": {"content": "Placeholder for Auto-DM New Twitter Followers", "height": 530, "width": 1100, "color": 5}, "id": "6c8445ba-33d0-4091-bc77-9206a3e8b3be", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, {"parameters": {"httpMethod": "POST", "path": "auto-dm-new-twitter-followers"}, "id": "f3af4318-25fb-48b3-afcd-b6626ffa4fc3", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "5d8f131d-4f2e-4689-941a-71971000788e", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, {"parameters": {"model": "embed-english-v3.0", "options": {}}, "id": "c16f0e7d-d77e-4bf0-a9b8-aff545ebac3e", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [70, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "auto-dm_new_twitter_followers", "mode": "list", "cachedResultName": "auto-dm_new_twitter_followers"}}, "id": "66aa91bd-6e08-4905-92b6-ab70a0a0fb57", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"pineconeIndex": {"__rl": true, "value": "auto-dm_new_twitter_followers", "mode": "list", "cachedResultName": "auto-dm_new_twitter_followers"}}, "id": "9e705430-71d8-4f8c-badf-693b26ca753a", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "ca01a22f-5dd8-403c-95ea-f56ba2d0e096", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, {"parameters": {}, "id": "bab9ab82-93b6-47dd-b15f-8a84bcb46950", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, {"parameters": {"options": {}}, "id": "752644de-7653-4ebb-afe7-9f0afb6d092b", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, {"parameters": {"promptType": "define", "text": "Handle data", "options": {"systemMessage": "You are an assistant for Auto-DM New Twitter Followers"}}, "id": "b22befc8-d57c-4fb2-a104-4fd9e9fbf878", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Auto-DM New Twitter Followers"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": "Status", "schema": []}}, "id": "5d5d5e45-7359-4cf9-a630-6592d59cda74", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, {"parameters": {"channel": "#alerts", "text": "Auto-DM New Twitter Followers error: {$json.error.message}"}, "id": "b9362533-2cf6-4f58-980f-829f3483092c", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}], "connections": {"Webhook Trigger": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}, "Text Splitter": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}, "Embeddings": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}, "Pinecone Insert": {"ai_document": [[]]}, "Pinecone Query": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}, "Vector Tool": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}, "Window Memory": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}, "Chat Model": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}, "RAG Agent": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}, "settings": {"executionOrder": "v1"}, "triggerCount": 1}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Auto-DM New Twitter Followers"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 1, $$"f3af4318-25fb-48b3-afcd-b6626ffa4fc3"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook Trigger"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "auto-dm-new-twitter-followers"}, "id": "f3af4318-25fb-48b3-afcd-b6626ffa4fc3", "name": "Webhook Trigger", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [-300, 0]}, "connections": {"main": [[{"node": "Text Splitter", "type": "main", "index": 0}, {"node": "Window Memory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 2, $$"6c8445ba-33d0-4091-bc77-9206a3e8b3be"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "Placeholder for Auto-DM New Twitter Followers", "height": 530, "width": 1100, "color": 5}, "id": "6c8445ba-33d0-4091-bc77-9206a3e8b3be", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "typeVersion": 1, "position": [-480, -240]}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 3, $$"752644de-7653-4ebb-afe7-9f0afb6d092b"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"Chat Model"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "752644de-7653-4ebb-afe7-9f0afb6d092b", "name": "Chat Model", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "typeVersion": 1, "position": [450, -340], "credentials": {"openAiApi": {"id": "OPENAI_API", "name": "OpenAI"}}}, "connections": {"ai_languageModel": [[{"node": "RAG Agent", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 4, $$"5d8f131d-4f2e-4689-941a-71971000788e"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter"$$::jsonb::text, $$"Text Splitter"$$::jsonb::text, $${"n8n_node": {"parameters": {"chunkSize": 400, "chunkOverlap": 40}, "id": "5d8f131d-4f2e-4689-941a-71971000788e", "name": "Text Splitter", "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter", "typeVersion": 1, "position": [-130, 0]}, "connections": {"main": [[{"node": "Embeddings", "type": "main", "index": 0}]], "ai_textSplitter": [[{"node": "Pinecone Insert", "type": "ai_textSplitter", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 5, $$"bab9ab82-93b6-47dd-b15f-8a84bcb46950"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.memoryBufferWindow"$$::jsonb::text, $$"Window Memory"$$::jsonb::text, $${"n8n_node": {"parameters": {}, "id": "bab9ab82-93b6-47dd-b15f-8a84bcb46950", "name": "Window Memory", "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow", "typeVersion": 1.3, "position": [450, -40]}, "connections": {"ai_memory": [[{"node": "RAG Agent", "type": "ai_memory", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 6, $$"c16f0e7d-d77e-4bf0-a9b8-aff545ebac3e"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.embeddingsCohere"$$::jsonb::text, $$"Embeddings"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": "embed-english-v3.0", "options": {}}, "id": "c16f0e7d-d77e-4bf0-a9b8-aff545ebac3e", "name": "Embeddings", "type": "@n8n/n8n-nodes-langchain.embeddingsCohere", "typeVersion": 1, "position": [70, 0], "credentials": {"cohereApi": {"id": "COHERE_API", "name": "Cohere"}}}, "connections": {"ai_embedding": [[{"node": "Pinecone Insert", "type": "ai_embedding", "index": 0}, {"node": "Pinecone Query", "type": "ai_embedding", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 7, $$"66aa91bd-6e08-4905-92b6-ab70a0a0fb57"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Insert"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "insert", "options": {}, "pineconeIndex": {"__rl": true, "value": "auto-dm_new_twitter_followers", "mode": "list", "cachedResultName": "auto-dm_new_twitter_followers"}}, "id": "66aa91bd-6e08-4905-92b6-ab70a0a0fb57", "name": "Pinecone Insert", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, 0], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_document": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 8, $$"9e705430-71d8-4f8c-badf-693b26ca753a"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.vectorStorePinecone"$$::jsonb::text, $$"Pinecone Query"$$::jsonb::text, $${"n8n_node": {"parameters": {"pineconeIndex": {"__rl": true, "value": "auto-dm_new_twitter_followers", "mode": "list", "cachedResultName": "auto-dm_new_twitter_followers"}}, "id": "9e705430-71d8-4f8c-badf-693b26ca753a", "name": "Pinecone Query", "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone", "typeVersion": 1, "position": [270, -180], "credentials": {"pineconeApi": {"id": "PINECONE_API", "name": "Pinecone account"}}}, "connections": {"ai_vectorStore": [[{"node": "Vector Tool", "type": "ai_vectorStore", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 9, $$"ca01a22f-5dd8-403c-95ea-f56ba2d0e096"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolVectorStore"$$::jsonb::text, $$"Vector Tool"$$::jsonb::text, $${"n8n_node": {"parameters": {"name": "Pinecone", "description": "Vector context"}, "id": "ca01a22f-5dd8-403c-95ea-f56ba2d0e096", "name": "Vector Tool", "type": "@n8n/n8n-nodes-langchain.toolVectorStore", "typeVersion": 1, "position": [450, -180]}, "connections": {"ai_tool": [[{"node": "RAG Agent", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 10, $$"b22befc8-d57c-4fb2-a104-4fd9e9fbf878"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"RAG Agent"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "Handle data", "options": {"systemMessage": "You are an assistant for Auto-DM New Twitter Followers"}}, "id": "b22befc8-d57c-4fb2-a104-4fd9e9fbf878", "name": "RAG Agent", "type": "@n8n/n8n-nodes-langchain.agent", "typeVersion": 1, "position": [720, -40]}, "connections": {"main": [[{"node": "Append Sheet", "type": "main", "index": 0}]], "onError": [[{"node": "Slack Alert", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 11, $$"5d5d5e45-7359-4cf9-a630-6592d59cda74"$$::jsonb::text, $$"n8n-nodes-base.googleSheets"$$::jsonb::text, $$"Append Sheet"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "append", "documentId": {"__rl": true, "value": "SHEET_ID", "mode": "list", "cachedResultName": "Auto-DM New Twitter Followers"}, "sheetName": {"__rl": true, "value": "Log", "mode": "list", "cachedResultName": "Log"}, "columns": {"mappingMode": "defineBelow", "value": "Status", "schema": []}}, "id": "5d5d5e45-7359-4cf9-a630-6592d59cda74", "name": "Append Sheet", "type": "n8n-nodes-base.googleSheets", "typeVersion": 4, "position": [930, -40], "credentials": {"googleSheetsOAuth2Api": {"id": "SHEETS_API", "name": "Google Sheets account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_auto_dm_twitter_new_follower"$$::jsonb::text, 12, $$"b9362533-2cf6-4f58-980f-829f3483092c"$$::jsonb::text, $$"n8n-nodes-base.slack"$$::jsonb::text, $$"Slack Alert"$$::jsonb::text, $${"n8n_node": {"parameters": {"channel": "#alerts", "text": "Auto-DM New Twitter Followers error: {$json.error.message}"}, "id": "b9362533-2cf6-4f58-980f-829f3483092c", "name": "Slack Alert", "type": "n8n-nodes-base.slack", "typeVersion": 1, "position": [930, 120], "credentials": {"slackApi": {"id": "SLACK_API", "name": "Slack"}}}, "connections": {}}$$::jsonb);

-- N8N-social_media_multipass (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Publish image & video to multiple social media (X, Instagram, Facebook and more)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/multipass.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "1eFDn6VxdQVB24q9", "name": "Publish image & video to multiple social media (X, Instagram, Facebook and more)", "active": false}, "sourcePath": "workflows/n8n/social_media/multipass.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Publish image & video to multiple social media (X, Instagram, Facebook and more)", "nodes": [{"parameters": {"formTitle": "Post Publisher", "formFields": {"values": [{"fieldLabel": "Platform", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "instagram"}, {"option": "linkedin"}, {"option": "facebook"}, {"option": "x"}, {"option": "tiktok"}, {"option": "threads"}]}, "requiredField": true}, {"fieldLabel": "Account", "placeholder": "User Profile name set on Upload-post.com", "requiredField": true}, {"fieldLabel": "Caption", "fieldType": "textarea", "requiredField": true}, {"fieldLabel": "Upload", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg,.mp4", "requiredField": true}, {"fieldLabel": "Facebook Id", "placeholder": "Facebook page Id (eg. +1234567890)"}]}, "options": {}}, "id": "f5050652-6170-41c6-b3c3-0f6616c9d575", "name": "On form submission", "type": "n8n-nodes-base.formTrigger", "position": [400, 1600], "webhookId": "bb578d47-feaa-4973-96df-659089838de5", "typeVersion": 2.2}, {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload_photos", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.caption }}"}, {"name": "user", "value": "={{ $json.account }}"}, {"name": "platform[]", "value": "={{ $json.platforms }}"}, {"parameterType": "formBinaryData", "name": "photos[]", "inputDataFieldName": "=Upload"}, {"name": "facebook_id", "value": "={{ $json.facebook_id }}"}]}, "options": {}}, "id": "e9d8b8c9-3e40-420d-98c3-82c92f1c53c7", "name": "Post photo", "type": "n8n-nodes-base.httpRequest", "position": [1040, 1312], "typeVersion": 4.2}, {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.caption }}"}, {"name": "user", "value": "={{ $json.account }}"}, {"name": "platform[]", "value": "={{ $json.platforms }}"}, {"parameterType": "formBinaryData", "name": "video", "inputDataFieldName": "=Upload"}]}, "options": {}}, "id": "04103be2-a1d8-4b00-942b-44e13dffa666", "name": "Post video", "type": "n8n-nodes-base.httpRequest", "position": [1040, 1760], "typeVersion": 4.2}, {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "e7803375-20b0-4e12-80a4-b102ba48b6ba", "name": "KO Video", "type": "n8n-nodes-base.form", "position": [1648, 1872], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "91f2b501-4021-4ecc-9cc3-4e804d020135", "name": "OK Video", "type": "n8n-nodes-base.form", "position": [1648, 1664], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "b3eead97-f995-42dc-b937-6d05f284f601", "name": "KO Photo", "type": "n8n-nodes-base.form", "position": [1648, 1408], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "8ead4dfa-cb9e-4ab4-b52c-7a681876269f", "name": "OK Photo", "type": "n8n-nodes-base.form", "position": [1648, 1200], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "a5fba676-4e7b-42e2-af36-e9d63458870b", "name": "Success Photo?", "type": "n8n-nodes-base.if", "position": [1408, 1312], "typeVersion": 2.2}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "310853de-ab7e-481e-8efa-5a681f08032b", "name": "Success Video?", "type": "n8n-nodes-base.if", "position": [1440, 1760], "typeVersion": 2.2}, {"parameters": {"functionCode": "// Compute overall success across all selected platforms\nconst resp = items[0].json;\nconst platforms = (items[0].json.platforms || items[0].json.platform || []);\nconst pList = Array.isArray(platforms) ? platforms : [platforms];\n\n// upload-post responses usually have resp.results[platform].success\nlet ok = true;\nfor (const p of pList) {\n  const success = resp?.results?.[p]?.success;\n  if (success === false || success === 'false') ok = false;\n  // if undefined, treat as failure (safer)\n  if (typeof success === 'undefined') ok = false;\n}\n\nreturn [{\n  json: {\n    ...resp,\n    result: ok ? 'true' : 'false'\n  }\n}];"}, "id": "81ec87fc-9298-4cd6-8a46-45ee6cb050b3", "name": "Result Photo", "type": "n8n-nodes-base.function", "position": [1216, 1312], "typeVersion": 2}, {"parameters": {"functionCode": "// Compute overall success across all selected platforms\nconst resp = items[0].json;\nconst platforms = (items[0].json.platforms || items[0].json.platform || []);\nconst pList = Array.isArray(platforms) ? platforms : [platforms];\n\n// upload-post responses usually have resp.results[platform].success\nlet ok = true;\nfor (const p of pList) {\n  const success = resp?.results?.[p]?.success;\n  if (success === false || success === 'false') ok = false;\n  // if undefined, treat as failure (safer)\n  if (typeof success === 'undefined') ok = false;\n}\n\nreturn [{\n  json: {\n    ...resp,\n    result: ok ? 'true' : 'false'\n  }\n}];"}, "id": "936ac765-0e7c-411d-b70d-bdfbe8e180a6", "name": "Result Video", "type": "n8n-nodes-base.function", "position": [1216, 1760], "typeVersion": 2}, {"parameters": {"rules": {"values": [{"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "879af56a-8979-4d9d-9acd-6009d821f6a7", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.media_kind }}", "rightValue": "image"}]}, "renameOutput": true, "outputKey": "Image"}, {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "d7ee147d-d775-4b81-b043-0873c535b400", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $json.media_kind }}", "rightValue": "video"}]}, "renameOutput": true, "outputKey": "Video"}]}, "options": {}}, "id": "3a3d66ae-7ecd-43aa-a905-10afdab753b3", "name": "Video or Photo?", "type": "n8n-nodes-base.switch", "position": [720, 1600], "typeVersion": 3.2}, {"parameters": {"content": "## SETTINGS\n\n- Find your API key in your [Upload-Post Manage Api Keys](https://www.upload-post.com/?linkId=lp_144414&sourceId=n3witalia&tenantId=upload-post-app) 10 FREE uploads per month\n- Set the the \"Auth Header\":\n-- Name: Authorization\n-- Value: Apikey YOUR_API_KEY_HERE\n- Create profiles to manage your social media accounts. The \"Profile\" you choose will be used in the field \"Account\" on form submission (eg. test1 or test2).  \n\n![image](https://i.postimg.cc/N0BHdcQ4/uploadpost.png)\n\nApr-2025: YouTube integration is currently being verified by Google, and may not work as expected.\n", "height": 680, "width": 1380}, "id": "76d1cc06-8bb5-43cd-8dcc-2da1656b0335", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [368, 464], "typeVersion": 1}, {"parameters": {"content": "## Upload video and photo on TikTok, X, Facebook, Youtube, Instagram, Threads and Linkedin\n\nSimplify your social media workflow with our powerful platform designed for content creators and marketers.\n\nUpload your video once and let Upload-Post distribute it across all your connected social media accounts effortlessly.", "height": 180, "width": 1380, "color": 3}, "id": "e9b40e23-cde9-459d-b490-8adda6b9253f", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, {"parameters": {"functionCode": "// Normalize form inputs for multi-platform posting\nconst form = items[0].json;\n\n// Platform can be a single value or comma-separated list (e.g. \"instagram, x, facebook\")\nconst rawPlatform = (form.Platform ?? '').toString();\nconst platforms = rawPlatform\n  .split(',')\n  .map(s => s.trim().toLowerCase())\n  .filter(Boolean);\n\n// Basic required fields\nconst caption = form.Caption ?? '';\nconst account = form.Account ?? '';\nconst facebookId = form['Facebook Id'] ?? form.facebook_id ?? '';\n\n// Detect media kind from uploaded file mimetype\nconst upload = form.Upload;\nconst mimetype = upload?.mimetype ?? '';\nlet media_kind = '';\nif (mimetype.startsWith('image/')) media_kind = 'image';\nelse if (mimetype.startsWith('video/')) media_kind = 'video';\n\n// Return normalized payload\nreturn [{\n  json: {\n    caption,\n    account,\n    platforms,      // array\n    media_kind,     // 'image' | 'video'\n    facebook_id: facebookId,\n    Upload: upload  // keep binary reference\n  }\n}];"}, "id": "fca03b05-cf12-46d1-9bd0-92dc1b1aadc7", "name": "Normalize Inputs", "type": "n8n-nodes-base.function", "position": [520, 1600], "typeVersion": 2}], "pinData": {}, "connections": {"Post photo": {"main": [[{"node": "Result Photo", "type": "main", "index": 0}]]}, "Post video": {"main": [[{"node": "Result Video", "type": "main", "index": 0}]]}, "Result Photo": {"main": [[{"node": "Success Photo?", "type": "main", "index": 0}]]}, "Result Video": {"main": [[{"node": "Success Video?", "type": "main", "index": 0}]]}, "Success Photo?": {"main": [[{"node": "OK Photo", "type": "main", "index": 0}], [{"node": "KO Photo", "type": "main", "index": 0}]]}, "Success Video?": {"main": [[{"node": "OK Video", "type": "main", "index": 0}], [{"node": "KO Video", "type": "main", "index": 0}]]}, "Video or Photo?": {"main": [[{"node": "Post photo", "type": "main", "index": 0}], [{"node": "Post video", "type": "main", "index": 0}]]}, "On form submission": {"main": [[{"node": "Normalize Inputs", "type": "main", "index": 0}]]}, "Normalize Inputs": {"main": [[{"node": "Video or Photo?", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate"}, "versionId": "", "meta": {"templateId": "3669", "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "1eFDn6VxdQVB24q9", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Publish image & video to multiple social media (X, Instagram, Facebook and more)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_multipass"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 1, $$"f5050652-6170-41c6-b3c3-0f6616c9d575"$$::jsonb::text, $$"n8n-nodes-base.formTrigger"$$::jsonb::text, $$"On form submission"$$::jsonb::text, $${"n8n_node": {"parameters": {"formTitle": "Post Publisher", "formFields": {"values": [{"fieldLabel": "Platform", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "instagram"}, {"option": "linkedin"}, {"option": "facebook"}, {"option": "x"}, {"option": "tiktok"}, {"option": "threads"}]}, "requiredField": true}, {"fieldLabel": "Account", "placeholder": "User Profile name set on Upload-post.com", "requiredField": true}, {"fieldLabel": "Caption", "fieldType": "textarea", "requiredField": true}, {"fieldLabel": "Upload", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg,.mp4", "requiredField": true}, {"fieldLabel": "Facebook Id", "placeholder": "Facebook page Id (eg. +1234567890)"}]}, "options": {}}, "id": "f5050652-6170-41c6-b3c3-0f6616c9d575", "name": "On form submission", "type": "n8n-nodes-base.formTrigger", "position": [400, 1600], "webhookId": "bb578d47-feaa-4973-96df-659089838de5", "typeVersion": 2.2}, "connections": {"main": [[{"node": "Normalize Inputs", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 2, $$"76d1cc06-8bb5-43cd-8dcc-2da1656b0335"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## SETTINGS\n\n- Find your API key in your [Upload-Post Manage Api Keys](https://www.upload-post.com/?linkId=lp_144414&sourceId=n3witalia&tenantId=upload-post-app) 10 FREE uploads per month\n- Set the the \"Auth Header\":\n-- Name: Authorization\n-- Value: Apikey YOUR_API_KEY_HERE\n- Create profiles to manage your social media accounts. The \"Profile\" you choose will be used in the field \"Account\" on form submission (eg. test1 or test2).  \n\n![image](https://i.postimg.cc/N0BHdcQ4/uploadpost.png)\n\nApr-2025: YouTube integration is currently being verified by Google, and may not work as expected.\n", "height": 680, "width": 1380}, "id": "76d1cc06-8bb5-43cd-8dcc-2da1656b0335", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [368, 464], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 3, $$"e9b40e23-cde9-459d-b490-8adda6b9253f"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Upload video and photo on TikTok, X, Facebook, Youtube, Instagram, Threads and Linkedin\n\nSimplify your social media workflow with our powerful platform designed for content creators and marketers.\n\nUpload your video once and let Upload-Post distribute it across all your connected social media accounts effortlessly.", "height": 180, "width": 1380, "color": 3}, "id": "e9b40e23-cde9-459d-b490-8adda6b9253f", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 4, $$"fca03b05-cf12-46d1-9bd0-92dc1b1aadc7"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Normalize Inputs"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Normalize form inputs for multi-platform posting\nconst form = items[0].json;\n\n// Platform can be a single value or comma-separated list (e.g. \"instagram, x, facebook\")\nconst rawPlatform = (form.Platform ?? '').toString();\nconst platforms = rawPlatform\n  .split(',')\n  .map(s => s.trim().toLowerCase())\n  .filter(Boolean);\n\n// Basic required fields\nconst caption = form.Caption ?? '';\nconst account = form.Account ?? '';\nconst facebookId = form['Facebook Id'] ?? form.facebook_id ?? '';\n\n// Detect media kind from uploaded file mimetype\nconst upload = form.Upload;\nconst mimetype = upload?.mimetype ?? '';\nlet media_kind = '';\nif (mimetype.startsWith('image/')) media_kind = 'image';\nelse if (mimetype.startsWith('video/')) media_kind = 'video';\n\n// Return normalized payload\nreturn [{\n  json: {\n    caption,\n    account,\n    platforms,      // array\n    media_kind,     // 'image' | 'video'\n    facebook_id: facebookId,\n    Upload: upload  // keep binary reference\n  }\n}];"}, "id": "fca03b05-cf12-46d1-9bd0-92dc1b1aadc7", "name": "Normalize Inputs", "type": "n8n-nodes-base.function", "position": [520, 1600], "typeVersion": 2}, "connections": {"main": [[{"node": "Video or Photo?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 5, $$"3a3d66ae-7ecd-43aa-a905-10afdab753b3"$$::jsonb::text, $$"n8n-nodes-base.switch"$$::jsonb::text, $$"Video or Photo?"$$::jsonb::text, $${"n8n_node": {"parameters": {"rules": {"values": [{"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "879af56a-8979-4d9d-9acd-6009d821f6a7", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.media_kind }}", "rightValue": "image"}]}, "renameOutput": true, "outputKey": "Image"}, {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "d7ee147d-d775-4b81-b043-0873c535b400", "operator": {"name": "filter.operator.equals", "type": "string", "operation": "equals"}, "leftValue": "={{ $json.media_kind }}", "rightValue": "video"}]}, "renameOutput": true, "outputKey": "Video"}]}, "options": {}}, "id": "3a3d66ae-7ecd-43aa-a905-10afdab753b3", "name": "Video or Photo?", "type": "n8n-nodes-base.switch", "position": [720, 1600], "typeVersion": 3.2}, "connections": {"main": [[{"node": "Post photo", "type": "main", "index": 0}], [{"node": "Post video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 6, $$"e9d8b8c9-3e40-420d-98c3-82c92f1c53c7"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Post photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload_photos", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.caption }}"}, {"name": "user", "value": "={{ $json.account }}"}, {"name": "platform[]", "value": "={{ $json.platforms }}"}, {"parameterType": "formBinaryData", "name": "photos[]", "inputDataFieldName": "=Upload"}, {"name": "facebook_id", "value": "={{ $json.facebook_id }}"}]}, "options": {}}, "id": "e9d8b8c9-3e40-420d-98c3-82c92f1c53c7", "name": "Post photo", "type": "n8n-nodes-base.httpRequest", "position": [1040, 1312], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Result Photo", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 7, $$"04103be2-a1d8-4b00-942b-44e13dffa666"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Post video"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.upload-post.com/api/upload", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"name": "title", "value": "={{ $json.caption }}"}, {"name": "user", "value": "={{ $json.account }}"}, {"name": "platform[]", "value": "={{ $json.platforms }}"}, {"parameterType": "formBinaryData", "name": "video", "inputDataFieldName": "=Upload"}]}, "options": {}}, "id": "04103be2-a1d8-4b00-942b-44e13dffa666", "name": "Post video", "type": "n8n-nodes-base.httpRequest", "position": [1040, 1760], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Result Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 8, $$"81ec87fc-9298-4cd6-8a46-45ee6cb050b3"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Result Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Compute overall success across all selected platforms\nconst resp = items[0].json;\nconst platforms = (items[0].json.platforms || items[0].json.platform || []);\nconst pList = Array.isArray(platforms) ? platforms : [platforms];\n\n// upload-post responses usually have resp.results[platform].success\nlet ok = true;\nfor (const p of pList) {\n  const success = resp?.results?.[p]?.success;\n  if (success === false || success === 'false') ok = false;\n  // if undefined, treat as failure (safer)\n  if (typeof success === 'undefined') ok = false;\n}\n\nreturn [{\n  json: {\n    ...resp,\n    result: ok ? 'true' : 'false'\n  }\n}];"}, "id": "81ec87fc-9298-4cd6-8a46-45ee6cb050b3", "name": "Result Photo", "type": "n8n-nodes-base.function", "position": [1216, 1312], "typeVersion": 2}, "connections": {"main": [[{"node": "Success Photo?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 9, $$"936ac765-0e7c-411d-b70d-bdfbe8e180a6"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Result Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "// Compute overall success across all selected platforms\nconst resp = items[0].json;\nconst platforms = (items[0].json.platforms || items[0].json.platform || []);\nconst pList = Array.isArray(platforms) ? platforms : [platforms];\n\n// upload-post responses usually have resp.results[platform].success\nlet ok = true;\nfor (const p of pList) {\n  const success = resp?.results?.[p]?.success;\n  if (success === false || success === 'false') ok = false;\n  // if undefined, treat as failure (safer)\n  if (typeof success === 'undefined') ok = false;\n}\n\nreturn [{\n  json: {\n    ...resp,\n    result: ok ? 'true' : 'false'\n  }\n}];"}, "id": "936ac765-0e7c-411d-b70d-bdfbe8e180a6", "name": "Result Video", "type": "n8n-nodes-base.function", "position": [1216, 1760], "typeVersion": 2}, "connections": {"main": [[{"node": "Success Video?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 10, $$"a5fba676-4e7b-42e2-af36-e9d63458870b"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Success Photo?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "a5fba676-4e7b-42e2-af36-e9d63458870b", "name": "Success Photo?", "type": "n8n-nodes-base.if", "position": [1408, 1312], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OK Photo", "type": "main", "index": 0}], [{"node": "KO Photo", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 11, $$"310853de-ab7e-481e-8efa-5a681f08032b"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Success Video?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "loose"}, "combinator": "and", "conditions": [{"id": "47eee8ce-0237-48f2-b67f-04021d3acda2", "operator": {"type": "string", "operation": "equals"}, "leftValue": "={{ $json.result }}", "rightValue": "true"}]}, "looseTypeValidation": true, "options": {}}, "id": "310853de-ab7e-481e-8efa-5a681f08032b", "name": "Success Video?", "type": "n8n-nodes-base.if", "position": [1440, 1760], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OK Video", "type": "main", "index": 0}], [{"node": "KO Video", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 12, $$"b3eead97-f995-42dc-b937-6d05f284f601"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"KO Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "b3eead97-f995-42dc-b937-6d05f284f601", "name": "KO Photo", "type": "n8n-nodes-base.form", "position": [1648, 1408], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 13, $$"8ead4dfa-cb9e-4ab4-b52c-7a681876269f"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"OK Photo"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "8ead4dfa-cb9e-4ab4-b52c-7a681876269f", "name": "OK Photo", "type": "n8n-nodes-base.form", "position": [1648, 1200], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 14, $$"e7803375-20b0-4e12-80a4-b102ba48b6ba"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"KO Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Oops", "completionMessage": "There was an error", "options": {}}, "id": "e7803375-20b0-4e12-80a4-b102ba48b6ba", "name": "KO Video", "type": "n8n-nodes-base.form", "position": [1648, 1872], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_multipass"$$::jsonb::text, 15, $$"91f2b501-4021-4ecc-9cc3-4e804d020135"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"OK Video"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "completion", "completionTitle": "=Congratulations!", "completionMessage": "Your post has been published correctly", "options": {}}, "id": "91f2b501-4021-4ecc-9cc3-4e804d020135", "name": "OK Video", "type": "n8n-nodes-base.form", "position": [1648, 1664], "webhookId": "d03e4286-f252-4a35-a65e-ea8ac96222e4", "typeVersion": 1}, "connections": {}}$$::jsonb);

-- N8N-social_media_pinterest (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Pinterest Publish - Webhook → Pinterest API (template)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/pinterest.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": null, "name": "Pinterest Publish - Webhook → Pinterest API (template)", "active": false}, "sourcePath": "workflows/n8n/social_media/pinterest.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Pinterest Publish - Webhook → Pinterest API (template)", "nodes": [{"parameters": {"httpMethod": "POST", "path": "pinterest-publish", "responseMode": "lastNode", "options": {}}, "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 300]}, {"parameters": {"values": {"string": [{"name": "title", "value": "={{$json[\"title\"] || $json[\"pin_title\"]}}"}, {"name": "description", "value": "={{$json[\"description\"] || $json[\"pin_description\"]}}"}, {"name": "link", "value": "={{$json[\"link\"] || $json[\"destination_url\"] || $json[\"url\"]}}"}, {"name": "image_url", "value": "={{$json[\"image_url\"] || $json[\"image\"] || $json[\"media_url\"]}}"}, {"name": "alt_text", "value": "={{$json[\"alt_text\"] || $json[\"title\"] || $json[\"description\"]}}"}, {"name": "board_id", "value": "={{$json[\"board_id\"] || \"<YOUR_BOARD_ID_HERE>\"}}"}, {"name": "access_token", "value": "={{$json[\"access_token\"] || \"<OPTIONAL_PLACEHOLDER_ACCESS_TOKEN>\"}}"}, {"name": "utm_campaign", "value": "={{$json[\"utm_campaign\"] || \"{{campaign}}\"}}"}]}, "options": {}}, "name": "Prepare Pin Data", "type": "n8n-nodes-base.set", "typeVersion": 1, "position": [500, 300]}, {"parameters": {"functionCode": "const item = items[0].json;\n\n// Guards (Atlas-grade): fail fast if required inputs are missing\nif (!item.access_token) {\n  throw new Error('Missing Pinterest access_token');\n}\nif (!item.board_id) {\n  throw new Error('Missing Pinterest board_id');\n}\nif (!item.image_url) {\n  throw new Error('Missing image_url for Pinterest pin');\n}\n\n// Build canonical link with UTM if utm_campaign provided\nlet link = item.link || '';\nif (item.utm_campaign && link) {\n  const u = new URL(link);\n  const params = u.searchParams;\n  if (!params.has('utm_source')) params.set('utm_source', 'pinterest');\n  if (!params.has('utm_medium')) params.set('utm_medium', 'organic');\n  params.set('utm_campaign', item.utm_campaign);\n  u.search = params.toString();\n  link = u.toString();\n}\n\nconst body = {\n  board_id: item.board_id,\n  title: item.title || '',\n  description: item.description || '',\n  alt_text: item.alt_text || (item.title || item.description || ''),\n  link: link || item.link || '',\n  media_source: {\n    source_type: 'image_url',\n    url: item.image_url\n  }\n};\n\n// Minimal audit payload you can store/log downstream\nconst audit = {\n  platform: 'pinterest',\n  action: 'pin_create',\n  board_id: body.board_id,\n  title: body.title,\n  link: body.link,\n  media_source_type: body.media_source?.source_type,\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: { body, access_token: item.access_token, audit, original: item } }];\n"}, "name": "Build Request Body", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [750, 300]}, {"parameters": {"requestMethod": "POST", "url": "=https://api.pinterest.com/v5/pins", "responseFormat": "json", "jsonParameters": true, "options": {}, "bodyParametersJson": "={{ $json[\"body\"] }}", "headerParameters": [{"name": "Authorization", "value": "={{ `Bearer ${$json[\"access_token\"]}` }}"}, {"name": "Content-Type", "value": "application/json"}]}, "name": "Create Pin (Pinterest API)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [1000, 300]}, {"parameters": {"values": {"string": [{"name": "status", "value": "={{$json[\"statusCode\"] || ''}}"}, {"name": "api_response", "value": "={{ JSON.stringify($json[\"body\"] || $json) }}"}]}, "options": {}}, "name": "Format Response", "type": "n8n-nodes-base.set", "typeVersion": 1, "position": [1250, 300]}], "connections": {"Webhook": {"main": [[{"node": "Prepare Pin Data", "type": "main", "index": 0}]]}, "Prepare Pin Data": {"main": [[{"node": "Build Request Body", "type": "main", "index": 0}]]}, "Build Request Body": {"main": [[{"node": "Create Pin (Pinterest API)", "type": "main", "index": 0}]]}, "Create Pin (Pinterest API)": {"main": [[{"node": "Format Response", "type": "main", "index": 0}]]}}, "active": false, "settings": {}, "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Pinterest Publish - Webhook → Pinterest API (template)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_pinterest"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, 1, $$"Webhook"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "pinterest-publish", "responseMode": "lastNode", "options": {}}, "name": "Webhook", "type": "n8n-nodes-base.webhook", "typeVersion": 1, "position": [250, 300]}, "connections": {"main": [[{"node": "Prepare Pin Data", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, 2, $$"Prepare Pin Data"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Prepare Pin Data"$$::jsonb::text, $${"n8n_node": {"parameters": {"values": {"string": [{"name": "title", "value": "={{$json[\"title\"] || $json[\"pin_title\"]}}"}, {"name": "description", "value": "={{$json[\"description\"] || $json[\"pin_description\"]}}"}, {"name": "link", "value": "={{$json[\"link\"] || $json[\"destination_url\"] || $json[\"url\"]}}"}, {"name": "image_url", "value": "={{$json[\"image_url\"] || $json[\"image\"] || $json[\"media_url\"]}}"}, {"name": "alt_text", "value": "={{$json[\"alt_text\"] || $json[\"title\"] || $json[\"description\"]}}"}, {"name": "board_id", "value": "={{$json[\"board_id\"] || \"<YOUR_BOARD_ID_HERE>\"}}"}, {"name": "access_token", "value": "={{$json[\"access_token\"] || \"<OPTIONAL_PLACEHOLDER_ACCESS_TOKEN>\"}}"}, {"name": "utm_campaign", "value": "={{$json[\"utm_campaign\"] || \"{{campaign}}\"}}"}]}, "options": {}}, "name": "Prepare Pin Data", "type": "n8n-nodes-base.set", "typeVersion": 1, "position": [500, 300]}, "connections": {"main": [[{"node": "Build Request Body", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, 3, $$"Build Request Body"$$::jsonb::text, $$"n8n-nodes-base.function"$$::jsonb::text, $$"Build Request Body"$$::jsonb::text, $${"n8n_node": {"parameters": {"functionCode": "const item = items[0].json;\n\n// Guards (Atlas-grade): fail fast if required inputs are missing\nif (!item.access_token) {\n  throw new Error('Missing Pinterest access_token');\n}\nif (!item.board_id) {\n  throw new Error('Missing Pinterest board_id');\n}\nif (!item.image_url) {\n  throw new Error('Missing image_url for Pinterest pin');\n}\n\n// Build canonical link with UTM if utm_campaign provided\nlet link = item.link || '';\nif (item.utm_campaign && link) {\n  const u = new URL(link);\n  const params = u.searchParams;\n  if (!params.has('utm_source')) params.set('utm_source', 'pinterest');\n  if (!params.has('utm_medium')) params.set('utm_medium', 'organic');\n  params.set('utm_campaign', item.utm_campaign);\n  u.search = params.toString();\n  link = u.toString();\n}\n\nconst body = {\n  board_id: item.board_id,\n  title: item.title || '',\n  description: item.description || '',\n  alt_text: item.alt_text || (item.title || item.description || ''),\n  link: link || item.link || '',\n  media_source: {\n    source_type: 'image_url',\n    url: item.image_url\n  }\n};\n\n// Minimal audit payload you can store/log downstream\nconst audit = {\n  platform: 'pinterest',\n  action: 'pin_create',\n  board_id: body.board_id,\n  title: body.title,\n  link: body.link,\n  media_source_type: body.media_source?.source_type,\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: { body, access_token: item.access_token, audit, original: item } }];\n"}, "name": "Build Request Body", "type": "n8n-nodes-base.function", "typeVersion": 1, "position": [750, 300]}, "connections": {"main": [[{"node": "Create Pin (Pinterest API)", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, 4, $$"Create Pin (Pinterest API)"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Create Pin (Pinterest API)"$$::jsonb::text, $${"n8n_node": {"parameters": {"requestMethod": "POST", "url": "=https://api.pinterest.com/v5/pins", "responseFormat": "json", "jsonParameters": true, "options": {}, "bodyParametersJson": "={{ $json[\"body\"] }}", "headerParameters": [{"name": "Authorization", "value": "={{ `Bearer ${$json[\"access_token\"]}` }}"}, {"name": "Content-Type", "value": "application/json"}]}, "name": "Create Pin (Pinterest API)", "type": "n8n-nodes-base.httpRequest", "typeVersion": 1, "position": [1000, 300]}, "connections": {"main": [[{"node": "Format Response", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_pinterest"$$::jsonb::text, 5, $$"Format Response"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Format Response"$$::jsonb::text, $${"n8n_node": {"parameters": {"values": {"string": [{"name": "status", "value": "={{$json[\"statusCode\"] || ''}}"}, {"name": "api_response", "value": "={{ JSON.stringify($json[\"body\"] || $json) }}"}]}, "options": {}}, "name": "Format Response", "type": "n8n-nodes-base.set", "typeVersion": 1, "position": [1250, 300]}, "connections": {}}$$::jsonb);

-- N8N-social_media_tumblr_publish (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"Tumblr Publish (Atlas)"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/tumblr_publish.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "ci7yHjBNEHvHYeah", "name": "Tumblr Publish (Atlas)", "active": false}, "sourcePath": "workflows/n8n/social_media/tumblr_publish.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "Tumblr Publish (Atlas)", "nodes": [{"parameters": {"httpMethod": "POST", "path": "atlas-tumblr-publish", "options": {}, "responseMode": "responseNode"}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, {"parameters": {"jsCode": "// Normalize payload coming from webhook.\n// n8n Webhook node often provides the incoming JSON under $json.body.\n\nconst input = ($json && typeof $json === 'object' && $json.body && typeof $json.body === 'object')\n  ? $json.body\n  : $json;\n\nreturn [\n  {\n    title: input?.title ?? \"Atlas UX Update\",\n    body: input?.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input?.tags) ? input.tags : [],\n    state: input?.state ?? \"draft\",\n  },\n];\n"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, {"parameters": {"method": "POST", "url": "https://api.tumblr.com/v2/blog/atlasux.tumblr.com/post", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "sendBody": true, "contentType": "form-urlencoded", "bodyParametersUi": {"parameter": [{"name": "type", "value": "text"}, {"name": "state", "value": "={{$json.state}}"}, {"name": "title", "value": "={{$json.title}}"}, {"name": "body", "value": "={{$json.body}}"}, {"name": "tags", "value": "={{$json.tags.join(\",\")}}"}]}, "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}, {"parameters": {"responseBody": "={{ { ok: true, tumblr: $json } }}", "options": {"responseHeaders": {"entries": [{"name": "Content-Type", "value": "application/json"}]}}}, "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [760, 0], "id": "respond-to-webhook-1", "name": "Respond to Webhook"}], "pinData": {}, "connections": {"Webhook": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}, "Code in JavaScript": {"main": [[{"node": "HTTP Request", "type": "main", "index": 0}]]}, "HTTP Request": {"main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "3620b6d1-aa89-4291-97d6-2d8ecd6c97d0", "meta": {"instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "ci7yHjBNEHvHYeah", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"Tumblr Publish (Atlas)"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media_tumblr_publish"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, 1, $$"3bf2f934-a6db-4229-8a59-2b828d054303"$$::jsonb::text, $$"n8n-nodes-base.webhook"$$::jsonb::text, $$"Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpMethod": "POST", "path": "atlas-tumblr-publish", "options": {}, "responseMode": "responseNode"}, "type": "n8n-nodes-base.webhook", "typeVersion": 2.1, "position": [0, 0], "id": "3bf2f934-a6db-4229-8a59-2b828d054303", "name": "Webhook", "webhookId": "282b6873-5dfc-4c25-ac2f-8417af7a2198"}, "connections": {"main": [[{"node": "Code in JavaScript", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, 2, $$"11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Code in JavaScript"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "// Normalize payload coming from webhook.\n// n8n Webhook node often provides the incoming JSON under $json.body.\n\nconst input = ($json && typeof $json === 'object' && $json.body && typeof $json.body === 'object')\n  ? $json.body\n  : $json;\n\nreturn [\n  {\n    title: input?.title ?? \"Atlas UX Update\",\n    body: input?.body ?? \"<p>Test post from Atlas UX</p>\",\n    tags: Array.isArray(input?.tags) ? input.tags : [],\n    state: input?.state ?? \"draft\",\n  },\n];\n"}, "type": "n8n-nodes-base.code", "typeVersion": 2, "position": [416, 0], "id": "11a2ebf4-0cf9-4c16-bf3d-ab2c94d4a043", "name": "Code in JavaScript"}, "connections": {"main": [[{"node": "HTTP Request", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, 3, $$"b7f98655-e0aa-409a-bb95-82396c9ff8c8"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"HTTP Request"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.tumblr.com/v2/blog/atlasux.tumblr.com/post", "authentication": "genericCredentialType", "genericAuthType": "oAuth1Api", "sendBody": true, "contentType": "form-urlencoded", "bodyParametersUi": {"parameter": [{"name": "type", "value": "text"}, {"name": "state", "value": "={{$json.state}}"}, {"name": "title", "value": "={{$json.title}}"}, {"name": "body", "value": "={{$json.body}}"}, {"name": "tags", "value": "={{$json.tags.join(\",\")}}"}]}, "options": {}}, "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.4, "position": [576, 0], "id": "b7f98655-e0aa-409a-bb95-82396c9ff8c8", "name": "HTTP Request", "credentials": {"oAuth1Api": {"id": "JJKt2UavIG3yoGS9", "name": "Tumblr"}}}, "connections": {"main": [[{"node": "Respond to Webhook", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media_tumblr_publish"$$::jsonb::text, 4, $$"respond-to-webhook-1"$$::jsonb::text, $$"n8n-nodes-base.respondToWebhook"$$::jsonb::text, $$"Respond to Webhook"$$::jsonb::text, $${"n8n_node": {"parameters": {"responseBody": "={{ { ok: true, tumblr: $json } }}", "options": {"responseHeaders": {"entries": [{"name": "Content-Type", "value": "application/json"}]}}}, "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [760, 0], "id": "respond-to-webhook-1", "name": "Respond to Webhook"}, "connections": {}}$$::jsonb);

-- N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI (n8n)
INSERT INTO workflows (workflow_key, agent_key, name, version, status, trigger, policy, outputs, metadata)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $$"✨🤖Automate Multi-Platform Social Media Content Creation with AI"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"ready"$$::jsonb::text, $${"type": "n8n_template", "sourcePath": "workflows/n8n/social_media/✨🤖Automate Multi-Platform Social Media Content Creation with AI.json"}$$::jsonb, $${}$$::jsonb, $${}$$::jsonb, $${"source": "n8n", "n8n": {"id": "N3hPT9EXmBKinPPk", "name": "✨🤖Automate Multi-Platform Social Media Content Creation with AI", "active": false}, "sourcePath": "workflows/n8n/social_media/✨🤖Automate Multi-Platform Social Media Content Creation with AI.json"}$$::jsonb)
ON CONFLICT (workflow_key) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  name=EXCLUDED.name,
  version=EXCLUDED.version,
  status=EXCLUDED.status,
  trigger=EXCLUDED.trigger,
  policy=EXCLUDED.policy,
  outputs=EXCLUDED.outputs,
  metadata=EXCLUDED.metadata,
  updated_at=now();
INSERT INTO atlas_workflows (workflow_id, agent_key, workflow_doc, status, version, name, trigger_type)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, $$"atlas"$$::jsonb::text, $${"name": "✨🤖Automate Multi-Platform Social Media Content Creation with AI", "nodes": [{"parameters": {"content": "# 🧑‍🦱 User Input for Social Media Posts \n💡 Unpin default data to get started", "height": 360, "width": 360, "color": 4}, "id": "1e77584f-76b4-420b-b6b0-99132d6c0151", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [432, 400], "typeVersion": 1}, {"parameters": {"content": "# 🛠️ Social Media Content Factory\n- LinkedIn\n- Instagram\n- Facebook\n- X\n- TikTok\n- Threads\n- YouTube Shorts\n", "height": 600, "width": 640, "color": 6}, "id": "dc92fcf1-3618-4188-a30f-6c2205cc3266", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [832, 368], "typeVersion": 1}, {"parameters": {"content": "# 👍 Approve Content Before Proceeding", "height": 360, "width": 400, "color": 4}, "id": "02429ea7-be59-49e3-9d85-c1678ee64abd", "name": "Sticky Note2", "type": "n8n-nodes-base.stickyNote", "position": [2576, 608], "typeVersion": 1}, {"parameters": {"content": "# ✉️ Prepare & Format Approval Email", "height": 560, "width": 500, "color": 5}, "id": "fa38e25c-89e9-4d9b-be78-03aeb6965e30", "name": "Sticky Note5", "type": "n8n-nodes-base.stickyNote", "position": [2032, 400], "typeVersion": 1}, {"parameters": {"schemaType": "manual", "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"name\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"description\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"platform_posts\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"LinkedIn\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"image_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Instagram\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"caption\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"emojis\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Facebook\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"X-Twitter\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                        \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"character_limit\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n                \"TikTok\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                \t\t\"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"caption\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"Threads\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                       \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n                \t\t\"text_post\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"YouTube_Shorts\": {\n                  \t\"type\": \"object\",\n                  \t\"properties\": {\n                  \t\t\"video_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                  \t\t\"title\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                          \"description\": {\n                              \"type\": \"string\"\n                          },\n                          \"hashtags\": {\n                              \"type\": \"array\",\n                              \"items\": {\n                                  \"type\": \"string\"\n                              }\n                          },\n                          \"call_to_action\": {\n                              \"type\": \"string\"\n                          }\n                      }\n                  }\n\t\t\t}\n\t\t},\n\t\t\"additional_notes\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t}\n}\n"}, "id": "9b6e2038-9f65-4e0f-b13d-6c09e8224ed6", "name": "Social Media Content", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 768], "typeVersion": 1.2}, {"parameters": {"modelName": "models/gemini-2.0-flash-exp", "options": {"temperature": 0.4}}, "id": "a1211873-05ca-48c7-aa93-57d80b37174b", "name": "Google Gemini LLM", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [1056, 768], "typeVersion": 1, "credentials": {"googlePalmApi": {"id": "56jfoyxum81iEXj1", "name": "Google Gemini(PaLM) Api account"}}, "disabled": true}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "14327277-1e66-401d-9c74-8fdb6d76445f", "name": "gpt-4o-mini", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2096, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "9a49454b-f518-4388-82a7-2529addae3e5", "name": "gpt-4o", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2240, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}, "disabled": true}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "56eb9c72-87fc-42b2-b576-be68b3a8c7d2", "name": "gpt-4o LLM", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [912, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"url": "=https://image.pollinations.ai/prompt/{{$('Social Media Content Factory').item.json.output.description.replaceAll(' ','-').replaceAll(',','').replaceAll('.','') }}", "options": {}}, "id": "bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a", "name": "pollinations.ai", "type": "n8n-nodes-base.httpRequest", "position": [1712, 2080], "typeVersion": 4.2, "disabled": true}, {"parameters": {"content": "## Create Post Image\nhttps://pollinations.ai/\nhttps://image.pollinations.ai/prompt/[your image description]\n\n(alternative)", "height": 340, "width": 300}, "id": "5a950645-8e74-4be8-bad2-73d9f827a6b8", "name": "Sticky Note6", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1920], "typeVersion": 1}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "7b5b53eb-85c6-4a90-b209-7bd8d638f237", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [1440, 1328], "typeVersion": 3}, {"parameters": {"method": "POST", "url": "https://api.imgbb.com/1/upload", "sendQuery": true, "queryParameters": {"parameters": [{"name": "expiration", "value": "0"}, {"name": "key", "value": "={{ $env.IMGBB_API_KEY}} "}]}, "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"parameterType": "formBinaryData", "name": "image", "inputDataFieldName": "data"}]}, "options": {"redirect": {"redirect": {}}}}, "id": "daa6773e-0e15-4994-bcee-b3d996655855", "name": "Save Image to imgbb.com3", "type": "n8n-nodes-base.httpRequest", "position": [1088, 1168], "typeVersion": 4.2}, {"parameters": {"method": "POST", "url": "https://graph.facebook.com/v20.0/[your-unique-id]/media", "authentication": "predefinedCredentialType", "nodeCredentialType": "facebookGraphApi", "sendQuery": true, "queryParameters": {"parameters": [{"name": "image_url", "value": "={{ $json.data.medium.url }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}, "options": {}}, "id": "af06853c-258e-4dfb-a579-3168c8de96bd", "name": "Instagram Image", "type": "n8n-nodes-base.httpRequest", "position": [2432, 1248], "typeVersion": 4.2, "onError": "continueRegularOutput"}, {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "media_publish", "options": {"queryParameters": {"parameter": [{"name": "creation_id", "value": "={{ $json.id }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}}}, "id": "6ee72138-a8ec-4fbd-8f14-fd6e881edfd1", "name": "Instragram Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1472], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, {"parameters": {"text": "={{ $('Social Media Content Factory').item.json.output.platform_posts['X-Twitter'].post }}", "additionalFields": {}}, "id": "9e168865-1eae-4e53-99c9-91b041426ecb", "name": "X Post", "type": "n8n-nodes-base.twitter", "position": [2432, 1680], "typeVersion": 2, "alwaysOutputData": true, "credentials": {"twitterOAuth2Api": {"id": "K5y9gmrpUFKI0JmT", "name": "X account"}}, "onError": "continueRegularOutput"}, {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "photos", "sendBinaryData": true, "binaryPropertyName": "data", "options": {"queryParameters": {"parameter": [{"name": "message", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.post }}\n\n{{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}\n"}, {"name": "link", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}"}]}}}, "id": "4ee55c94-7251-445e-8ce7-15eee7165010", "name": "Facebook Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1904], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, {"parameters": {"postAs": "organization", "organization": "12345678", "text": "={{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}", "shareMediaCategory": "IMAGE", "binaryPropertyName": "=data", "additionalFields": {}}, "id": "3a015f3f-a162-411a-85e8-e1f042d9c653", "name": "LinkedIn Post", "type": "n8n-nodes-base.linkedIn", "position": [2432, 2080], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"linkedInOAuth2Api": {"id": "j4U4N6AqTwJMtEjS", "name": "LinkedIn account"}}, "onError": "continueRegularOutput"}, {"parameters": {"resource": "image", "prompt": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}", "options": {}}, "id": "8ab03d75-b4c5-4271-8fa9-830f449a3a3c", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [768, 1280], "typeVersion": 1.8, "alwaysOutputData": true, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "d1ac29b1-128d-4615-b828-89f1f64d1b15", "name": "Merge1", "type": "n8n-nodes-base.merge", "position": [2176, 1248], "typeVersion": 3}, {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "71eebce8-027a-4b12-b07e-692121de9a68", "name": "Merge2", "type": "n8n-nodes-base.merge", "position": [2176, 1984], "typeVersion": 3}, {"parameters": {"aggregate": "aggregateAllItemData", "options": {}}, "id": "140cff41-a619-4111-8dc9-3ec8fc45e061", "name": "Aggregate", "type": "n8n-nodes-base.aggregate", "position": [496, 1824], "typeVersion": 1}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "3e96bfac-dad5-4b75-b51b-50329892ee70", "name": "gpt-4o-mini1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 1840], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "4d73d59f-bb8c-481b-877a-bf4dc64f3277", "name": "gpt-4o-mini2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 2128], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥{{ $('Social Media Content Factory').item.json.output.name }} - {{ $('Social Media Content Factory').item.json.output.description }}", "message": "={{ $json.output }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "aaef70d7-6029-4fae-afc1-72a6a0019b03", "name": "Gmail User for Approval", "type": "n8n-nodes-base.gmail", "position": [2736, 768], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, {"parameters": {"content": "## Publish to Social Media", "height": 1100, "width": 300, "color": 6}, "id": "44e3bada-7665-4268-bb79-12ffb377552e", "name": "Sticky Note3", "type": "n8n-nodes-base.stickyNote", "position": [2336, 1168], "typeVersion": 1}, {"parameters": {"content": "## Format Results", "height": 880, "width": 300, "color": 5}, "id": "75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9", "name": "Sticky Note4", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1392], "typeVersion": 1}, {"parameters": {"content": "# Step 4️⃣: Send Final Results of Social Media Factory", "height": 760, "width": 1020, "color": 7}, "id": "ff5d050a-111c-4467-bc61-e51444943cb5", "name": "Sticky Note7", "type": "n8n-nodes-base.stickyNote", "position": [368, 1552], "typeVersion": 1}, {"parameters": {"content": "## Create Post Image", "height": 260, "width": 260, "color": 3}, "id": "26a684cc-72d9-40c8-bd30-1d074d914328", "name": "Sticky Note8", "type": "n8n-nodes-base.stickyNote", "position": [688, 1200], "typeVersion": 1}, {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥 New LinkedIn Post", "message": "=<html>\n<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n\n    <h2 style=\"font-size:20px; color:#333; margin:0 0 15px 0;\">LinkedIn</h2>\n      \n    <!-- LinkedIn Card -->\n    <div style=\"background: #ffffff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n\n      <!-- Card Header Image -->\n      <div style=\"height: 200px; overflow: hidden; border-radius: 8px 8px 0 0;\">\n        <img src=\"{{ $json.data.medium.url }}\" alt=\"Featured Image\" style=\"width: 100%; height: 100%; object-fit: cover;\">\n      </div>\n\n      <!-- Card Content -->\n      <div style=\"padding: 25px;\">\n\n        <p style=\"font-size:16px; color:#555; line-height: 1.6; margin-bottom: 15px;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n        </p>\n        \n        <div style=\"margin: 15px 0;\">\n          <span style=\"display: inline-block; background: #f0f0f0; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size:12px; color:#333;\">\n            {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n          </span>\n        </div>\n\n        <p style=\"font-size:14px; color:#1a0dab; font-weight: 600; margin:15px 0 0 0;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "930e76ac-6e9c-4a3f-9229-28ba18de25a3", "name": "Approve Final Post Content", "type": "n8n-nodes-base.gmail", "position": [1712, 1680], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}, "disabled": true}, {"parameters": {"content": "## Final Approval before Publishing to Social Feeds\n(optional)", "height": 340, "width": 300}, "id": "051b7ff6-febb-4aba-9790-bc977c11e645", "name": "Sticky Note9", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1552], "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "efe337a1-63e0-4513-873d-421bf41e4868", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "b42df164-47ae-4e08-9099-d0958dd41c8f", "name": "Is Approved?", "type": "n8n-nodes-base.if", "position": [1888, 1328], "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Instagram Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "e3193aef-d115-4c3b-87b2-b8ebd5bb0c05", "name": "Instagram Result", "type": "n8n-nodes-base.set", "position": [2768, 1472], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "X Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "6f8b248f-5c79-412c-81ef-3c52bef7f257", "name": "X Result", "type": "n8n-nodes-base.set", "position": [2768, 1680], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Facebook Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "4c1ee118-aba1-4632-bd48-27cef9d5e272", "name": "Facebook Result", "type": "n8n-nodes-base.set", "position": [2768, 1904], "typeVersion": 3.4}, {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "LinkedIn Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "490223f9-9b6a-4617-8829-c8e4b130feb7", "name": "LinkedIn Result", "type": "n8n-nodes-base.set", "position": [2768, 2080], "typeVersion": 3.4}, {"parameters": {"formTitle": "workflows.diy", "formDescription": "=Welcome to the workflows.diy AI-Powered Assistant!\n\nThis tool is designed to streamline and enhance your social media content creation process.\n\nSimply provide key inputs like a topic or title and an optional image, and our intelligent agent will generate engaging, platform-specific post descriptions tailored to your audience. \n\nWhether you're a marketer, business owner, or influencer, this assistant saves you time while delivering professional-quality content optimized for maximum impact.\n\n", "formFields": {"values": [{"fieldLabel": "Topic", "placeholder": "Provide a concise and clear title or main topic for your post (e.g., \"New Product Launch,\" \"Exciting Company Update\"). This helps the AI accurately capture the focus of your content.", "requiredField": true}, {"fieldLabel": "Keywords or Hashtags (optional)", "placeholder": "Include any specific keywords or hashtags you'd like the AI to incorporate into the post. This ensures the content aligns with your branding and campaign objectives.", "requiredField": "={{ false }}"}, {"fieldLabel": "Link (optional)", "placeholder": "=Provide the URL of any product, service, form, support page, or other resource. This link will be included in the generated post to direct your audience to the relevant content.\n"}]}, "responseMode": "lastNode", "options": {"buttonLabel": "Automatically Generate Social Media Content"}}, "id": "9732c12e-903e-49ac-8d29-ffc4d78c7ff8", "name": "Submit Social Post Details", "type": "n8n-nodes-base.formTrigger", "position": [560, 560], "webhookId": "3e762442-715e-47e1-a65e-ae92085857ae", "typeVersion": 2.2}, {"parameters": {"content": "# Step 1️⃣: Create Social Media Written Content\nNote:  \nYou could use the output of step 1 to create your written content and manually post if required.  \nYou so not have to implement step 2.", "height": 760, "width": 2640, "color": 7}, "id": "899f658f-4faa-4ba7-ae02-cc8fb1d22c71", "name": "Sticky Note10", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, {"parameters": {"content": "# Step 2️⃣: Create Image or Upload Image for Social Post", "height": 460, "width": 1020, "color": 7}, "id": "a8075b2a-4cd0-4b0c-9b19-8bd58de449c0", "name": "Sticky Note11", "type": "n8n-nodes-base.stickyNote", "position": [368, 1040], "typeVersion": 1}, {"parameters": {"content": "# Step 3️⃣: Publish Final Social Media Posts", "height": 1260, "width": 1680, "color": 7}, "id": "1da28ef3-9061-4e83-84e0-3502d254d63a", "name": "Sticky Note12", "type": "n8n-nodes-base.stickyNote", "position": [1568, 1040], "typeVersion": 1}, {"parameters": {"numberInputs": 4}, "id": "1955b762-b9c4-4704-955b-093686e827bd", "name": "Merge Results", "type": "n8n-nodes-base.merge", "position": [3072, 2080], "typeVersion": 3, "alwaysOutputData": true, "onError": "continueRegularOutput"}, {"parameters": {"promptType": "define", "text": "=You are a **content creation AI** for workflows.diy, a leading creator of **n8n workflow automation solutions and AI Agentic workflows**.\n\nYour goal is to craft **engaging, platform-specific content** for LinkedIn, Instagram, Facebook, Twitter (X), TikTok, Threads, and YouTube Shorts. Each post must align with the platform’s audience preferences, tone, and style while reflecting workflows.diy's expertise. The content should provide **value-driven insights**, tutorials, reviews, and discussions that resonate with tech professionals, automation enthusiasts, businesses, and n8n users.\n\n### Key Objectives:\n1. **Platform Optimization**: Tailor content format, tone, and hashtags to suit each platform’s algorithm and audience engagement patterns.\n2. **SEO & Hashtags**: Use a mix of general automation hashtags and trending platform-specific hashtags to maximize reach.\n3. **Engagement Focus**: Create content that sparks interaction through tutorials, comparisons, reviews, or thought-provoking discussions.\n4. **Consistency**: Maintain a professional yet approachable tone across all platforms while adapting to audience needs.\n5. **Data-Driven Strategy**: Analyze trends and performance data to refine content strategy and hashtag usage.\n\n### General Hashtags:\n#workflowsdiy #n8n #automation #AIWorkflows #WorkflowAutomation #TechSolutions\n\n---\n\n### Platform-Specific Guidelines:\n\n#### 1. LinkedIn\n   - **Style**: Professional and insightful.\n   - **Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n   - **Content Length**: 3-4 sentences; concise but detailed.\n   - **Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n   - **Call to Action (CTA)**: Encourage comments or visits to workflows.diy’s website for more insights.\n\n#### 2. Instagram\n   - **Style**: Visual storytelling with creative captions.\n   - **Tone**: Inspirational and engaging; use emojis for relatability.\n   - **Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n   - **Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n   - **CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n   - **Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://workflows.diy.\"\n   - **Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n\n#### 3. Facebook\n   - **Style**: Friendly and community-focused.\n   - **Tone**: Relatable; highlight user success stories or company achievements in automation.\n   - **Content Length**: 2-3 sentences; conversational yet professional.\n   - **Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n   - **CTA**: Encourage likes, shares, comments (e.g., “What’s your favorite automation tip?”).\n\n#### 4. Twitter (X)\n   - **Style**: Concise and impactful.\n   - **Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n   - **Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n   - **CTA**: Drive quick engagement through retweets or replies (e.g., “What’s your go-to n8n workflow?”).\n\n#### 5. TikTok\n   - **Style**: Short-form video content with trending audio or effects.\n   - **Tone**: Fun yet informative; focus on quick workflow demos or automation tips.\n   - **Content Length**: 15-60 seconds with captions summarizing the key message.\n   - **Hashtags**: Use trending tech-related hashtags relevant to TikTok’s audience (e.g., #n8nTips).\n   - **CTA**: Encourage viewers to follow workflows.diy for more automation hacks.\n\n#### 6. Threads\n   - **Style**: Conversational and community-driven posts.\n   - **Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n   - **Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n   - **Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n\n#### 7. YouTube Shorts\n   - **Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n   - **Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n   - Content Length:\n     - Tutorials/Reviews (long-form): 5-10 minutes\n     - Shorts/Highlights (short-form): Under 1 minute\n   - CTA:** Encourage subscriptions**, likes, comments (e.g., “Subscribe for more workflow tips!”).\n\n---\n\n### Content Creation Workflow:\nFor every post:\n1. Use the following input fields:\n    - Topic/About the Post: {{ $json.Topic }}\n    - Keywords/Focus Areas: {{ $json.formMode }}\n    - Link (optional): {{ $json['Link (optional)'] }}\n2. Adapt the tone/style based on the platform guidelines above.\n\nEnsure every post reflects workflows.diy's mission of delivering high-quality automation insights while maximizing engagement across platforms.\n\nFollow the provided JSON schema for your reponse.\n", "hasOutputParser": true, "options": {"systemMessage": "=Use the provided tools to research the topic based on latest information.  Todays date is {{ $now }}"}}, "id": "6dc47749-eb49-4351-89aa-50f2b6c035bb", "name": "Social Media Content Factory", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1040, 560], "retryOnFail": true, "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Generate clean, modern HTML email content from the provided JSON data with these requirements:\n- Use table-based layout with inline CSS for email compatibility\n- Create card sections for each platform containing:\n  • Title header (20px) \n  • Post content (16px) \n  • Video/image suggestions (italic 14px)\n  • Hashtag list (inline-block with # prefix)\n  • Emoji preservation where present\n  • Call-to-action (bold 14px)\n- Structure using:\n  • 600px max-width container\n  • 20px padding between cards\n  • Left-aligned text hierarchy\n  • Arial/sans-serif font stack\n  • Email-safe colors (#333 text, #555 secondary)\n- Include all platform-specific elements:\n  ▶ Video/image suggestions in italic\n  ▶ Hashtags as linked search terms\n  ▶ Emojis in original positions\n  ▶ Character limits for Twitter\n  ▶ Platform-specific CTAs\n  ▶ Visual quality reminders\n- Format hashtags as:\n  <span style=\"display: inline-block; background: #f0f0f0; padding: 2px 6px; margin: 2px; border-radius: 4px;\">#tag</span>\n\nInput data: {{ $json.output.toJsonString() }}\n\nRemove ALL code blocks and comments. Output ONLY the raw HTML with:\n- Platform cards in JSON order\n- All data elements represented\n- Mobile-responsive tables\n- W3C-valid markup\n\n## Example HTML:\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#fbfcfe;border:1px solid #dbdfe7;border-radius:8px\">\n\t\t<tbody><tr>\n\t\t\t<td align=\"center\" style=\"padding:24px 0\">\n\t\t\t\t<table width=\"448\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:100%;max-width:448px;background-color:#ffffff;border:1px solid #dbdfe7;border-radius:8px;padding:24px\">\n\t\t\t\t\t<tbody><tr>\n\t\t\t\t\t\t<td style=\"text-align:center;padding-top:8px;font-family:Arial,sans-serif;font-size:14px;color:#7e8186\">\n\t\t\t\t\t\t\t<p style=\"white-space:pre-line\"></p><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;font-family:Arial,sans-serif;color:#333\"><tbody><tr><td style=\"padding:20px\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">LinkedIn</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Discover why n8n stands out as the premier workflow automation tool. Its flexibility and open-source nature empower businesses to create custom solutions that drive efficiency and innovation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Video/Image suggestion pending</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Innovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>DigitalTransformation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit workflows.diy to explore how n8n can transform your business processes!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Instagram</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Eye-catching infographic comparing n8n to other automation tools, highlighting its unique features.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The ultimate workflow automation tool! <img data-emoji=\"💡\" class=\"an1\" alt=\"💡\" aria-label=\"💡\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a1/32.png\" loading=\"lazy\"> Unlock limitless possibilities with its open-source platform. Boost your productivity and streamline your processes. <img data-emoji=\"💤\" class=\"an1\" alt=\"💤\" aria-label=\"💤\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a4/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AutomationLife</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#TechInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#WorkflowTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Programming</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Engineering</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit our website: <a href=\"https://n8n.io/\" target=\"_blank\" data-saferedirecturl=\"https://www.google.com/url?q=https://n8n.io/&amp;source=gmail&amp;ust=1741030878129000&amp;usg=AOvVaw1Nr6ek3eGwe94zlbPaJrzT\">https://n8n.io/</a> #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Facebook</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">See why businesses are choosing n8n for their workflow automation needs. From its user-friendly interface to its powerful customization options, n8n is revolutionizing how companies approach automation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">A visually appealing graphic showcasing n8n's key features and benefits.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#SmallBusinessAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Entrepreneurship</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">What's your favorite automation tip? Share in the comments!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Twitter</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The best #WorkflowAutomation tool! Open-source, customizable, and powerful. Transform your business processes today!</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowTrends</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AutomationTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#NoCodeSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">TikTok</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Quick demo showcasing how n8n simplifies complex workflows with its intuitive interface.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: Your go-to for effortless workflow automation! <img data-emoji=\"✨\" class=\"an1\" alt=\"✨\" aria-label=\"✨\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/2728/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8nTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Follow workflows.diy for more automation hacks!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Threads</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n is transforming the automation landscape. Its open-source nature and extensive integrations make it a top choice for businesses of all sizes. What are your thoughts on the future of workflow automation?</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Share your insights below!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">YouTube Shorts</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Short tutorial demonstrating how to build a simple automation workflow in n8n.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Learn why n8n is the top choice for workflow automation. Its open-source platform and powerful features make it a game-changer for businesses.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowautomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#nocode</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Subscribe for more workflow tips!</td></tr></tbody></table></td></tr></tbody></table><p></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n</table>\n", "options": {}}, "id": "88c548bf-40e5-4b89-aef0-9233c3f5bc9c", "name": "Prepare Content Review Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2176, 560], "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a modern single line HTML table showing platform statuses. For each entry:\n\n-Extract platform name from the JSON key\n-Identify status (Success/Error) based on statusCode or error presence\n-Capture error message if present\n-Format as responsive HTML table with professional styling\n-Ensure email client compatibility with inline CSS\n-Include error handling for invalid JSON formats\n-Remove all line breaks and \\n from response.\n-Avoid any preamble or further explanation and remove all ``` and ```html from response.\n\n## Implementation Example:\nThis solution uses the parsed results from your workflow to generate:\n<table style=\"border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; margin: 20px 0; background-color: #f9f9f9; border: 1px solid #ddd;\">\n    <thead>\n        <tr style=\"background-color: #007bff; color: #fff;\">\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Platform</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Status</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Details</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Instagram</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">X (Twitter)</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Facebook</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">LinkedIn</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n    </tbody>\n</table>\n\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n", "options": {}}, "id": "3b074887-262f-47ab-b69c-c51b3a513993", "name": "Prepare Results Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1680], "typeVersion": 1.7}, {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a brief summary of the results.\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n\n## Example Response:\nThe social media post results indicate multiple errors when attempting to access or post content on various platforms. \n\n1. Instagram: The response shows a 400 status code with an error message indicating that the specific post request is unsupported due to missing permissions or an invalid object ID. \n\n2. X Post: Success\n\n3. Facebook: Success \n\n4. LinkedIn: Also returned an 'Unable to sign without access token' error. \n\nOverall, access token issues and unsupported requests are frequent problems across these social media platforms.\n", "options": {}}, "id": "abb3994f-bf23-43f8-9c46-28795cfd2017", "name": "Prepare Results Message", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1968], "typeVersion": 1.7}, {"parameters": {"formFields": {"values": [{"fieldLabel": "Upload Image (optional)", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg, .png, .jpeg"}, {"fieldLabel": "Generate Custom Image using AI Image Generator", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "Yes"}, {"option": "No"}]}, "requiredField": true}]}, "options": {"formTitle": "Generate Post Image", "buttonLabel": "Submit"}}, "id": "b4a4838a-83b0-4f28-a9f3-dea915228325", "name": "Image Choice", "type": "n8n-nodes-base.form", "position": [112, 1184], "webhookId": "0dc811ef-b2e0-4213-a0c9-e9b5fb9fcbf1", "typeVersion": 1, "disabled": true}, {"parameters": {"sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "🔥RESULTS🔥 Social Media Factory", "message": "={{ $json.output }}", "options": {"appendAttribution": false}}, "id": "1cf97c10-e60f-4584-b069-3d4506868d8e", "name": "Gmail Results", "type": "n8n-nodes-base.gmail", "position": [1088, 1680], "webhookId": "0a81b95a-cd82-465d-8450-cf38518a4cbb", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, {"parameters": {"chatId": "={{ $env.TELEGRAM_CHAT_ID }}", "text": "={{ $json.output }}", "additionalFields": {"appendAttribution": false}}, "id": "c845ae46-9d37-472b-ae0f-49fc6940e685", "name": "Telegram Results", "type": "n8n-nodes-base.telegram", "position": [1088, 1968], "webhookId": "bb40ede7-03cf-493d-b051-196b96725925", "typeVersion": 1.2, "credentials": {"telegramApi": {"id": "0JxGbAnpImpz1Tne", "name": "Telegram account"}}}, {"parameters": {"content": "", "height": 620, "width": 940, "color": 4}, "id": "a33f9431-bede-4f66-ae0d-1e686a3092b7", "name": "Sticky Note13", "type": "n8n-nodes-base.stickyNote", "position": [416, 1648], "typeVersion": 1}, {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "e32d270f-f258-4522-94e1-2cb7ee4e8d2a", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "643b94c6-4535-4876-9660-d82ff69cbcf6", "name": "Is Content Approved?", "type": "n8n-nodes-base.if", "position": [496, 1280], "typeVersion": 2.2}, {"parameters": {"assignments": {"assignments": [{"id": "f150aa79-2d20-4869-b60a-350d49a215a5", "name": "data", "type": "object", "value": "={\n  \"approved\": true\n}"}]}, "options": {}}, "id": "fb7108e2-21cf-4df4-ab20-fe75b15b0a24", "name": "Set Default True 2", "type": "n8n-nodes-base.set", "position": [1712, 1328], "typeVersion": 3.4}, {"parameters": {"content": "## Alternative User Uploaded Image\n(optional)", "height": 580, "width": 300}, "id": "66364a53-c2fc-43fd-be92-683b373652df", "name": "Sticky Note14", "type": "n8n-nodes-base.stickyNote", "position": [32, 1040], "typeVersion": 1}, {"parameters": {"content": "## Implement Additional Approval Here\n(optional)", "height": 340, "width": 460}, "id": "d0025029-1f6f-4b27-8495-00966f1dae12", "name": "Sticky Note15", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1168], "typeVersion": 1}, {"parameters": {"options": {}}, "id": "0a10bca0-c3a8-496b-a22e-120928ad7736", "name": "SerpAPI", "type": "@n8n/n8n-nodes-langchain.toolSerpApi", "position": [1200, 768], "typeVersion": 1, "credentials": {"serpApi": {"id": "R2xhbE9t2j13givq", "name": "SerpAPI account"}}}, {"parameters": {"content": "### 💡Notes\n\nAdjust the Social Media Content Factory prompts to suit your personal or business requirements.\n\nUpdate Credentials for:\n- OpenAI API Key\nhttps://auth.openai.com/log-in\n\n- Google Studio API\nhttps://aistudio.google.com/app/apikey\n\n- SERP API Key\nhttps://serpapi.com/\n\n- Gmail OAuth\nhttps://docs.n8n.io/integrations/builtin/credentials/google/\n\n- Telegram Bot (Optional)\nhttps://docs.n8n.io/integrations/builtin/credentials/telegram/\n\n- imgbb\nhttps://imgbb.com/", "height": 500, "width": 480}, "id": "fa765062-22ef-4f26-9f02-099235edc771", "name": "Sticky Note16", "type": "n8n-nodes-base.stickyNote", "position": [1520, 400], "typeVersion": 1}, {"parameters": {"content": "💡Notes\n\nUpdate all Social Media Platform Credentials as required.\n\nAdjust parameters and content for each platform to suit your needs.", "height": 180, "width": 300}, "id": "5ffc2b16-61af-4395-a57b-20d1cd125488", "name": "Sticky Note17", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1168], "typeVersion": 1}, {"parameters": {"jsCode": "$input.first().binary.data = $input.first().binary.Upload_Image__optional_\ndelete $input.first().binary.Upload_Image__optional_\nreturn $input.first()"}, "id": "b21f527c-5674-49d0-a114-866d669e7ad6", "name": "Rename Binary File", "type": "n8n-nodes-base.code", "position": [112, 1424], "typeVersion": 2, "alwaysOutputData": true}], "pinData": {}, "connections": {"Merge": {"main": [[{"node": "Set Default True 2", "type": "main", "index": 0}]]}, "Merge1": {"main": [[{"node": "Instagram Image", "type": "main", "index": 0}]]}, "Merge2": {"main": [[{"node": "Facebook Post", "type": "main", "index": 0}, {"node": "LinkedIn Post", "type": "main", "index": 0}]]}, "OpenAI": {"main": [[{"node": "Save Image to imgbb.com3", "type": "main", "index": 0}, {"node": "Merge", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 1}]]}, "X Post": {"main": [[{"node": "X Result", "type": "main", "index": 0}], []]}, "SerpAPI": {"ai_tool": [[{"node": "Social Media Content Factory", "type": "ai_tool", "index": 0}]]}, "X Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 1}]]}, "Aggregate": {"main": [[{"node": "Prepare Results Email", "type": "main", "index": 0}, {"node": "Prepare Results Message", "type": "main", "index": 0}]]}, "gpt-4o LLM": {"ai_languageModel": [[{"node": "Social Media Content Factory", "type": "ai_languageModel", "index": 0}]]}, "gpt-4o-mini": {"ai_languageModel": [[{"node": "Prepare Content Review Email", "type": "ai_languageModel", "index": 0}]]}, "Image Choice": {"main": [[{"node": "Rename Binary File", "type": "main", "index": 0}]]}, "Is Approved?": {"main": [[{"node": "X Post", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 0}], []]}, "gpt-4o-mini1": {"ai_languageModel": [[{"node": "Prepare Results Email", "type": "ai_languageModel", "index": 0}]]}, "gpt-4o-mini2": {"ai_languageModel": [[{"node": "Prepare Results Message", "type": "ai_languageModel", "index": 0}]]}, "Facebook Post": {"main": [[{"node": "Facebook Result", "type": "main", "index": 0}], []]}, "LinkedIn Post": {"main": [[{"node": "LinkedIn Result", "type": "main", "index": 0}], []]}, "Merge Results": {"main": [[{"node": "Aggregate", "type": "main", "index": 0}]]}, "Facebook Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 2}]]}, "Instagram Image": {"main": [[{"node": "Instragram Post", "type": "main", "index": 0}]]}, "Instragram Post": {"main": [[{"node": "Instagram Result", "type": "main", "index": 0}], []]}, "LinkedIn Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 3}]]}, "pollinations.ai": {"main": [[]]}, "Instagram Result": {"main": [[{"node": "Merge Results", "type": "main", "index": 0}]]}, "Google Gemini LLM": {"ai_languageModel": [[]]}, "Set Default True 2": {"main": [[{"node": "Is Approved?", "type": "main", "index": 0}]]}, "Is Content Approved?": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}]]}, "Social Media Content": {"ai_outputParser": [[{"node": "Social Media Content Factory", "type": "ai_outputParser", "index": 0}]]}, "Prepare Results Email": {"main": [[{"node": "Gmail Results", "type": "main", "index": 0}]]}, "Gmail User for Approval": {"main": [[{"node": "Is Content Approved?", "type": "main", "index": 0}]]}, "Prepare Results Message": {"main": [[{"node": "Telegram Results", "type": "main", "index": 0}]]}, "Save Image to imgbb.com3": {"main": [[{"node": "Merge", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 0}]]}, "Approve Final Post Content": {"main": [[]]}, "Submit Social Post Details": {"main": [[{"node": "Social Media Content Factory", "type": "main", "index": 0}]]}, "Prepare Content Review Email": {"main": [[{"node": "Gmail User for Approval", "type": "main", "index": 0}]]}, "Social Media Content Factory": {"main": [[{"node": "Prepare Content Review Email", "type": "main", "index": 0}]]}}, "active": false, "settings": {"executionOrder": "v1", "binaryMode": "separate", "availableInMCP": false}, "versionId": "8338e381-d3c4-4caa-8aa1-76cc5c163946", "meta": {"templateId": "3066", "templateCredsSetupCompleted": true, "instanceId": "0ab6c930d4b3510bd213503110294aa13c64c39cd77abd213e349cc60c946f9d"}, "id": "N3hPT9EXmBKinPPk", "tags": []}$$::jsonb, $$"ready"$$::jsonb::text, $$"1.0.0"$$::jsonb::text, $$"✨🤖Automate Multi-Platform Social Media Content Creation with AI"$$::jsonb::text, 'n8n_template')
ON CONFLICT (workflow_id) DO UPDATE SET
  agent_key=EXCLUDED.agent_key,
  workflow_doc=EXCLUDED.workflow_doc,
  status=EXCLUDED.status,
  version=EXCLUDED.version,
  name=EXCLUDED.name,
  trigger_type=EXCLUDED.trigger_type,
  updated_at=now();
DELETE FROM workflow_steps WHERE workflow_key=$$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text;
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 1, $$"1e77584f-76b4-420b-b6b0-99132d6c0151"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 🧑‍🦱 User Input for Social Media Posts \n💡 Unpin default data to get started", "height": 360, "width": 360, "color": 4}, "id": "1e77584f-76b4-420b-b6b0-99132d6c0151", "name": "Sticky Note", "type": "n8n-nodes-base.stickyNote", "position": [432, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 2, $$"dc92fcf1-3618-4188-a30f-6c2205cc3266"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note1"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 🛠️ Social Media Content Factory\n- LinkedIn\n- Instagram\n- Facebook\n- X\n- TikTok\n- Threads\n- YouTube Shorts\n", "height": 600, "width": 640, "color": 6}, "id": "dc92fcf1-3618-4188-a30f-6c2205cc3266", "name": "Sticky Note1", "type": "n8n-nodes-base.stickyNote", "position": [832, 368], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 3, $$"02429ea7-be59-49e3-9d85-c1678ee64abd"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note2"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# 👍 Approve Content Before Proceeding", "height": 360, "width": 400, "color": 4}, "id": "02429ea7-be59-49e3-9d85-c1678ee64abd", "name": "Sticky Note2", "type": "n8n-nodes-base.stickyNote", "position": [2576, 608], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 4, $$"fa38e25c-89e9-4d9b-be78-03aeb6965e30"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note5"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# ✉️ Prepare & Format Approval Email", "height": 560, "width": 500, "color": 5}, "id": "fa38e25c-89e9-4d9b-be78-03aeb6965e30", "name": "Sticky Note5", "type": "n8n-nodes-base.stickyNote", "position": [2032, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 5, $$"9b6e2038-9f65-4e0f-b13d-6c09e8224ed6"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.outputParserStructured"$$::jsonb::text, $$"Social Media Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"schemaType": "manual", "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"name\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"description\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"platform_posts\": {\n\t\t\t\"type\": \"object\",\n\t\t\t\"properties\": {\n\t\t\t\t\"LinkedIn\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"image_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Instagram\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"caption\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"emojis\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"Facebook\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"call_to_action\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"X-Twitter\": {\n\t\t\t\t\t\"type\": \"object\",\n\t\t\t\t\t\"properties\": {\n                        \"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                        \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"post\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"hashtags\": {\n\t\t\t\t\t\t\t\"type\": \"array\",\n\t\t\t\t\t\t\t\"items\": {\n\t\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"character_limit\": {\n\t\t\t\t\t\t\t\"type\": \"integer\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n                \"TikTok\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                \t\t\"video_suggestion\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"caption\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"Threads\": {\n                \t\"type\": \"object\",\n                \t\"properties\": {\n                       \"image_suggestion\": {\n\t\t\t\t\t\t\t\"type\": \"string\"\n\t\t\t\t\t\t},\n                \t\t\"text_post\": {\n                \t\t\t\"type\": \"string\"\n                \t\t},\n                \t\t\"hashtags\": {\n                \t\t\t\"type\": \"array\",\n                \t\t\t\"items\": {\n                \t\t\t\t\"type\": \"string\"\n                \t\t\t}\n                \t\t},\n                \t\t\"call_to_action\": {\n                \t\t\t\"type\": \"string\"\n                \t\t}\n                \t}\n                },\n                \"YouTube_Shorts\": {\n                  \t\"type\": \"object\",\n                  \t\"properties\": {\n                  \t\t\"video_suggestion\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                  \t\t\"title\": {\n                  \t\t\t\"type\": \"string\"\n                  \t\t},\n                          \"description\": {\n                              \"type\": \"string\"\n                          },\n                          \"hashtags\": {\n                              \"type\": \"array\",\n                              \"items\": {\n                                  \"type\": \"string\"\n                              }\n                          },\n                          \"call_to_action\": {\n                              \"type\": \"string\"\n                          }\n                      }\n                  }\n\t\t\t}\n\t\t},\n\t\t\"additional_notes\": {\n\t\t\t\"type\": \"string\"\n\t\t}\n\t}\n}\n"}, "id": "9b6e2038-9f65-4e0f-b13d-6c09e8224ed6", "name": "Social Media Content", "type": "@n8n/n8n-nodes-langchain.outputParserStructured", "position": [1296, 768], "typeVersion": 1.2}, "connections": {"ai_outputParser": [[{"node": "Social Media Content Factory", "type": "ai_outputParser", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 6, $$"a1211873-05ca-48c7-aa93-57d80b37174b"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatGoogleGemini"$$::jsonb::text, $$"Google Gemini LLM"$$::jsonb::text, $${"n8n_node": {"parameters": {"modelName": "models/gemini-2.0-flash-exp", "options": {"temperature": 0.4}}, "id": "a1211873-05ca-48c7-aa93-57d80b37174b", "name": "Google Gemini LLM", "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini", "position": [1056, 768], "typeVersion": 1, "credentials": {"googlePalmApi": {"id": "56jfoyxum81iEXj1", "name": "Google Gemini(PaLM) Api account"}}, "disabled": true}, "connections": {"ai_languageModel": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 7, $$"14327277-1e66-401d-9c74-8fdb6d76445f"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "14327277-1e66-401d-9c74-8fdb6d76445f", "name": "gpt-4o-mini", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2096, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Content Review Email", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 8, $$"9a49454b-f518-4388-82a7-2529addae3e5"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "9a49454b-f518-4388-82a7-2529addae3e5", "name": "gpt-4o", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [2240, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}, "disabled": true}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 9, $$"56eb9c72-87fc-42b2-b576-be68b3a8c7d2"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o LLM"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o", "cachedResultName": "gpt-4o"}, "options": {"responseFormat": "text"}}, "id": "56eb9c72-87fc-42b2-b576-be68b3a8c7d2", "name": "gpt-4o LLM", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [912, 768], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Social Media Content Factory", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 10, $$"bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"pollinations.ai"$$::jsonb::text, $${"n8n_node": {"parameters": {"url": "=https://image.pollinations.ai/prompt/{{$('Social Media Content Factory').item.json.output.description.replaceAll(' ','-').replaceAll(',','').replaceAll('.','') }}", "options": {}}, "id": "bf4e6d41-b2be-44fc-8fc7-6dc6bc4ee69a", "name": "pollinations.ai", "type": "n8n-nodes-base.httpRequest", "position": [1712, 2080], "typeVersion": 4.2, "disabled": true}, "connections": {"main": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 11, $$"5a950645-8e74-4be8-bad2-73d9f827a6b8"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note6"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Create Post Image\nhttps://pollinations.ai/\nhttps://image.pollinations.ai/prompt/[your image description]\n\n(alternative)", "height": 340, "width": 300}, "id": "5a950645-8e74-4be8-bad2-73d9f827a6b8", "name": "Sticky Note6", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1920], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 12, $$"3e96bfac-dad5-4b75-b51b-50329892ee70"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini1"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "3e96bfac-dad5-4b75-b51b-50329892ee70", "name": "gpt-4o-mini1", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 1840], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Results Email", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 13, $$"4d73d59f-bb8c-481b-877a-bf4dc64f3277"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.lmChatOpenAi"$$::jsonb::text, $$"gpt-4o-mini2"$$::jsonb::text, $${"n8n_node": {"parameters": {"model": {"__rl": true, "mode": "list", "value": "gpt-4o-mini", "cachedResultName": "gpt-4o-mini"}, "options": {"responseFormat": "text"}}, "id": "4d73d59f-bb8c-481b-877a-bf4dc64f3277", "name": "gpt-4o-mini2", "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi", "position": [720, 2128], "typeVersion": 1.2, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"ai_languageModel": [[{"node": "Prepare Results Message", "type": "ai_languageModel", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 14, $$"44e3bada-7665-4268-bb79-12ffb377552e"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note3"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Publish to Social Media", "height": 1100, "width": 300, "color": 6}, "id": "44e3bada-7665-4268-bb79-12ffb377552e", "name": "Sticky Note3", "type": "n8n-nodes-base.stickyNote", "position": [2336, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 15, $$"75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note4"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Format Results", "height": 880, "width": 300, "color": 5}, "id": "75bfc1f4-0afa-4d8d-b5cc-83e29b6570f9", "name": "Sticky Note4", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1392], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 16, $$"ff5d050a-111c-4467-bc61-e51444943cb5"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note7"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 4️⃣: Send Final Results of Social Media Factory", "height": 760, "width": 1020, "color": 7}, "id": "ff5d050a-111c-4467-bc61-e51444943cb5", "name": "Sticky Note7", "type": "n8n-nodes-base.stickyNote", "position": [368, 1552], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 17, $$"26a684cc-72d9-40c8-bd30-1d074d914328"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note8"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Create Post Image", "height": 260, "width": 260, "color": 3}, "id": "26a684cc-72d9-40c8-bd30-1d074d914328", "name": "Sticky Note8", "type": "n8n-nodes-base.stickyNote", "position": [688, 1200], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 18, $$"930e76ac-6e9c-4a3f-9229-28ba18de25a3"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Approve Final Post Content"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥 New LinkedIn Post", "message": "=<html>\n<body style=\"margin:0; padding:0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <div style=\"max-width: 600px; margin: 0 auto; padding: 20px;\">\n\n    <h2 style=\"font-size:20px; color:#333; margin:0 0 15px 0;\">LinkedIn</h2>\n      \n    <!-- LinkedIn Card -->\n    <div style=\"background: #ffffff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n\n      <!-- Card Header Image -->\n      <div style=\"height: 200px; overflow: hidden; border-radius: 8px 8px 0 0;\">\n        <img src=\"{{ $json.data.medium.url }}\" alt=\"Featured Image\" style=\"width: 100%; height: 100%; object-fit: cover;\">\n      </div>\n\n      <!-- Card Content -->\n      <div style=\"padding: 25px;\">\n\n        <p style=\"font-size:16px; color:#555; line-height: 1.6; margin-bottom: 15px;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n        </p>\n        \n        <div style=\"margin: 15px 0;\">\n          <span style=\"display: inline-block; background: #f0f0f0; padding: 4px 8px; margin: 2px; border-radius: 4px; font-size:12px; color:#333;\">\n            {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n          </span>\n        </div>\n\n        <p style=\"font-size:14px; color:#1a0dab; font-weight: 600; margin:15px 0 0 0;\">\n          {{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n        </p>\n      </div>\n    </div>\n  </div>\n</body>\n</html>\n", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "930e76ac-6e9c-4a3f-9229-28ba18de25a3", "name": "Approve Final Post Content", "type": "n8n-nodes-base.gmail", "position": [1712, 1680], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}, "disabled": true}, "connections": {"main": [[]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 19, $$"051b7ff6-febb-4aba-9790-bc977c11e645"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note9"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Final Approval before Publishing to Social Feeds\n(optional)", "height": 340, "width": 300}, "id": "051b7ff6-febb-4aba-9790-bc977c11e645", "name": "Sticky Note9", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1552], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 20, $$"9732c12e-903e-49ac-8d29-ffc4d78c7ff8"$$::jsonb::text, $$"n8n-nodes-base.formTrigger"$$::jsonb::text, $$"Submit Social Post Details"$$::jsonb::text, $${"n8n_node": {"parameters": {"formTitle": "workflows.diy", "formDescription": "=Welcome to the workflows.diy AI-Powered Assistant!\n\nThis tool is designed to streamline and enhance your social media content creation process.\n\nSimply provide key inputs like a topic or title and an optional image, and our intelligent agent will generate engaging, platform-specific post descriptions tailored to your audience. \n\nWhether you're a marketer, business owner, or influencer, this assistant saves you time while delivering professional-quality content optimized for maximum impact.\n\n", "formFields": {"values": [{"fieldLabel": "Topic", "placeholder": "Provide a concise and clear title or main topic for your post (e.g., \"New Product Launch,\" \"Exciting Company Update\"). This helps the AI accurately capture the focus of your content.", "requiredField": true}, {"fieldLabel": "Keywords or Hashtags (optional)", "placeholder": "Include any specific keywords or hashtags you'd like the AI to incorporate into the post. This ensures the content aligns with your branding and campaign objectives.", "requiredField": "={{ false }}"}, {"fieldLabel": "Link (optional)", "placeholder": "=Provide the URL of any product, service, form, support page, or other resource. This link will be included in the generated post to direct your audience to the relevant content.\n"}]}, "responseMode": "lastNode", "options": {"buttonLabel": "Automatically Generate Social Media Content"}}, "id": "9732c12e-903e-49ac-8d29-ffc4d78c7ff8", "name": "Submit Social Post Details", "type": "n8n-nodes-base.formTrigger", "position": [560, 560], "webhookId": "3e762442-715e-47e1-a65e-ae92085857ae", "typeVersion": 2.2}, "connections": {"main": [[{"node": "Social Media Content Factory", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 21, $$"899f658f-4faa-4ba7-ae02-cc8fb1d22c71"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note10"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 1️⃣: Create Social Media Written Content\nNote:  \nYou could use the output of step 1 to create your written content and manually post if required.  \nYou so not have to implement step 2.", "height": 760, "width": 2640, "color": 7}, "id": "899f658f-4faa-4ba7-ae02-cc8fb1d22c71", "name": "Sticky Note10", "type": "n8n-nodes-base.stickyNote", "position": [368, 240], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 22, $$"a8075b2a-4cd0-4b0c-9b19-8bd58de449c0"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note11"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 2️⃣: Create Image or Upload Image for Social Post", "height": 460, "width": 1020, "color": 7}, "id": "a8075b2a-4cd0-4b0c-9b19-8bd58de449c0", "name": "Sticky Note11", "type": "n8n-nodes-base.stickyNote", "position": [368, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 23, $$"1da28ef3-9061-4e83-84e0-3502d254d63a"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note12"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "# Step 3️⃣: Publish Final Social Media Posts", "height": 1260, "width": 1680, "color": 7}, "id": "1da28ef3-9061-4e83-84e0-3502d254d63a", "name": "Sticky Note12", "type": "n8n-nodes-base.stickyNote", "position": [1568, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 24, $$"b4a4838a-83b0-4f28-a9f3-dea915228325"$$::jsonb::text, $$"n8n-nodes-base.form"$$::jsonb::text, $$"Image Choice"$$::jsonb::text, $${"n8n_node": {"parameters": {"formFields": {"values": [{"fieldLabel": "Upload Image (optional)", "fieldType": "file", "multipleFiles": false, "acceptFileTypes": ".jpg, .png, .jpeg"}, {"fieldLabel": "Generate Custom Image using AI Image Generator", "fieldType": "dropdown", "fieldOptions": {"values": [{"option": "Yes"}, {"option": "No"}]}, "requiredField": true}]}, "options": {"formTitle": "Generate Post Image", "buttonLabel": "Submit"}}, "id": "b4a4838a-83b0-4f28-a9f3-dea915228325", "name": "Image Choice", "type": "n8n-nodes-base.form", "position": [112, 1184], "webhookId": "0dc811ef-b2e0-4213-a0c9-e9b5fb9fcbf1", "typeVersion": 1, "disabled": true}, "connections": {"main": [[{"node": "Rename Binary File", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 25, $$"a33f9431-bede-4f66-ae0d-1e686a3092b7"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note13"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "", "height": 620, "width": 940, "color": 4}, "id": "a33f9431-bede-4f66-ae0d-1e686a3092b7", "name": "Sticky Note13", "type": "n8n-nodes-base.stickyNote", "position": [416, 1648], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 26, $$"66364a53-c2fc-43fd-be92-683b373652df"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note14"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Alternative User Uploaded Image\n(optional)", "height": 580, "width": 300}, "id": "66364a53-c2fc-43fd-be92-683b373652df", "name": "Sticky Note14", "type": "n8n-nodes-base.stickyNote", "position": [32, 1040], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 27, $$"d0025029-1f6f-4b27-8495-00966f1dae12"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note15"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "## Implement Additional Approval Here\n(optional)", "height": 340, "width": 460}, "id": "d0025029-1f6f-4b27-8495-00966f1dae12", "name": "Sticky Note15", "type": "n8n-nodes-base.stickyNote", "position": [1616, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 28, $$"0a10bca0-c3a8-496b-a22e-120928ad7736"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.toolSerpApi"$$::jsonb::text, $$"SerpAPI"$$::jsonb::text, $${"n8n_node": {"parameters": {"options": {}}, "id": "0a10bca0-c3a8-496b-a22e-120928ad7736", "name": "SerpAPI", "type": "@n8n/n8n-nodes-langchain.toolSerpApi", "position": [1200, 768], "typeVersion": 1, "credentials": {"serpApi": {"id": "R2xhbE9t2j13givq", "name": "SerpAPI account"}}}, "connections": {"ai_tool": [[{"node": "Social Media Content Factory", "type": "ai_tool", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 29, $$"fa765062-22ef-4f26-9f02-099235edc771"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note16"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "### 💡Notes\n\nAdjust the Social Media Content Factory prompts to suit your personal or business requirements.\n\nUpdate Credentials for:\n- OpenAI API Key\nhttps://auth.openai.com/log-in\n\n- Google Studio API\nhttps://aistudio.google.com/app/apikey\n\n- SERP API Key\nhttps://serpapi.com/\n\n- Gmail OAuth\nhttps://docs.n8n.io/integrations/builtin/credentials/google/\n\n- Telegram Bot (Optional)\nhttps://docs.n8n.io/integrations/builtin/credentials/telegram/\n\n- imgbb\nhttps://imgbb.com/", "height": 500, "width": 480}, "id": "fa765062-22ef-4f26-9f02-099235edc771", "name": "Sticky Note16", "type": "n8n-nodes-base.stickyNote", "position": [1520, 400], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 30, $$"5ffc2b16-61af-4395-a57b-20d1cd125488"$$::jsonb::text, $$"n8n-nodes-base.stickyNote"$$::jsonb::text, $$"Sticky Note17"$$::jsonb::text, $${"n8n_node": {"parameters": {"content": "💡Notes\n\nUpdate all Social Media Platform Credentials as required.\n\nAdjust parameters and content for each platform to suit your needs.", "height": 180, "width": 300}, "id": "5ffc2b16-61af-4395-a57b-20d1cd125488", "name": "Sticky Note17", "type": "n8n-nodes-base.stickyNote", "position": [2672, 1168], "typeVersion": 1}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 31, $$"b21f527c-5674-49d0-a114-866d669e7ad6"$$::jsonb::text, $$"n8n-nodes-base.code"$$::jsonb::text, $$"Rename Binary File"$$::jsonb::text, $${"n8n_node": {"parameters": {"jsCode": "$input.first().binary.data = $input.first().binary.Upload_Image__optional_\ndelete $input.first().binary.Upload_Image__optional_\nreturn $input.first()"}, "id": "b21f527c-5674-49d0-a114-866d669e7ad6", "name": "Rename Binary File", "type": "n8n-nodes-base.code", "position": [112, 1424], "typeVersion": 2, "alwaysOutputData": true}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 32, $$"6dc47749-eb49-4351-89aa-50f2b6c035bb"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Social Media Content Factory"$$::jsonb::text, $${"n8n_node": {"parameters": {"promptType": "define", "text": "=You are a **content creation AI** for workflows.diy, a leading creator of **n8n workflow automation solutions and AI Agentic workflows**.\n\nYour goal is to craft **engaging, platform-specific content** for LinkedIn, Instagram, Facebook, Twitter (X), TikTok, Threads, and YouTube Shorts. Each post must align with the platform’s audience preferences, tone, and style while reflecting workflows.diy's expertise. The content should provide **value-driven insights**, tutorials, reviews, and discussions that resonate with tech professionals, automation enthusiasts, businesses, and n8n users.\n\n### Key Objectives:\n1. **Platform Optimization**: Tailor content format, tone, and hashtags to suit each platform’s algorithm and audience engagement patterns.\n2. **SEO & Hashtags**: Use a mix of general automation hashtags and trending platform-specific hashtags to maximize reach.\n3. **Engagement Focus**: Create content that sparks interaction through tutorials, comparisons, reviews, or thought-provoking discussions.\n4. **Consistency**: Maintain a professional yet approachable tone across all platforms while adapting to audience needs.\n5. **Data-Driven Strategy**: Analyze trends and performance data to refine content strategy and hashtag usage.\n\n### General Hashtags:\n#workflowsdiy #n8n #automation #AIWorkflows #WorkflowAutomation #TechSolutions\n\n---\n\n### Platform-Specific Guidelines:\n\n#### 1. LinkedIn\n   - **Style**: Professional and insightful.\n   - **Tone**: Business-oriented; focus on automation use cases, industry insights, and community impact.\n   - **Content Length**: 3-4 sentences; concise but detailed.\n   - **Hashtags**: #Innovation #Automation #WorkflowSolutions #DigitalTransformation #Leadership\n   - **Call to Action (CTA)**: Encourage comments or visits to workflows.diy’s website for more insights.\n\n#### 2. Instagram\n   - **Style**: Visual storytelling with creative captions.\n   - **Tone**: Inspirational and engaging; use emojis for relatability.\n   - **Content Length**: 2-3 sentences paired with eye-catching visuals (e.g., infographics or workflow demos).\n   - **Visuals**: Showcase milestones (e.g., new workflow launches), tutorials, or product highlights.\n   - **CTA**: Use phrases like \"Swipe to learn more,\" \"Tag your team,\" or \"Check out the link below!\"\n   - **Link Placement**: Add the provided link before hashtags; if no link is provided, use \"Visit our website: https://workflows.diy.\"\n   - **Hashtags**: #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering\n\n#### 3. Facebook\n   - **Style**: Friendly and community-focused.\n   - **Tone**: Relatable; highlight user success stories or company achievements in automation.\n   - **Content Length**: 2-3 sentences; conversational yet professional.\n   - **Hashtags**: #SmallBusinessAutomation #Entrepreneurship #Leadership #WorkflowInnovation\n   - **CTA**: Encourage likes, shares, comments (e.g., “What’s your favorite automation tip?”).\n\n#### 4. Twitter (X)\n   - **Style**: Concise and impactful.\n   - **Tone**: Crisp and engaging; spark curiosity in 150 characters or less.\n   - **Hashtags**: #WorkflowTrends #AIWorkflows #AutomationTips #NoCodeSolutions\n   - **CTA**: Drive quick engagement through retweets or replies (e.g., “What’s your go-to n8n workflow?”).\n\n#### 5. TikTok\n   - **Style**: Short-form video content with trending audio or effects.\n   - **Tone**: Fun yet informative; focus on quick workflow demos or automation tips.\n   - **Content Length**: 15-60 seconds with captions summarizing the key message.\n   - **Hashtags**: Use trending tech-related hashtags relevant to TikTok’s audience (e.g., #n8nTips).\n   - **CTA**: Encourage viewers to follow workflows.diy for more automation hacks.\n\n#### 6. Threads\n   - **Style**: Conversational and community-driven posts.\n   - **Tone**: Casual yet informative; encourage discussions around automation trends or innovations.\n   - **Content Length**: 1-2 short paragraphs with a question or thought-provoking statement at the end.\n   - **Hashtags**: Similar to Instagram but tailored for trending Threads topics related to automation.\n\n#### 7. YouTube Shorts\n   - **Style**: Short-form video content showcasing quick workflow tutorials or use cases.\n   - **Tone**: Authoritative yet approachable; establish workflows.diy as a leader in n8n automation solutions.\n   - Content Length:\n     - Tutorials/Reviews (long-form): 5-10 minutes\n     - Shorts/Highlights (short-form): Under 1 minute\n   - CTA:** Encourage subscriptions**, likes, comments (e.g., “Subscribe for more workflow tips!”).\n\n---\n\n### Content Creation Workflow:\nFor every post:\n1. Use the following input fields:\n    - Topic/About the Post: {{ $json.Topic }}\n    - Keywords/Focus Areas: {{ $json.formMode }}\n    - Link (optional): {{ $json['Link (optional)'] }}\n2. Adapt the tone/style based on the platform guidelines above.\n\nEnsure every post reflects workflows.diy's mission of delivering high-quality automation insights while maximizing engagement across platforms.\n\nFollow the provided JSON schema for your reponse.\n", "hasOutputParser": true, "options": {"systemMessage": "=Use the provided tools to research the topic based on latest information.  Todays date is {{ $now }}"}}, "id": "6dc47749-eb49-4351-89aa-50f2b6c035bb", "name": "Social Media Content Factory", "type": "@n8n/n8n-nodes-langchain.agent", "position": [1040, 560], "retryOnFail": true, "typeVersion": 1.7}, "connections": {"main": [[{"node": "Prepare Content Review Email", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 33, $$"88c548bf-40e5-4b89-aef0-9233c3f5bc9c"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Content Review Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Generate clean, modern HTML email content from the provided JSON data with these requirements:\n- Use table-based layout with inline CSS for email compatibility\n- Create card sections for each platform containing:\n  • Title header (20px) \n  • Post content (16px) \n  • Video/image suggestions (italic 14px)\n  • Hashtag list (inline-block with # prefix)\n  • Emoji preservation where present\n  • Call-to-action (bold 14px)\n- Structure using:\n  • 600px max-width container\n  • 20px padding between cards\n  • Left-aligned text hierarchy\n  • Arial/sans-serif font stack\n  • Email-safe colors (#333 text, #555 secondary)\n- Include all platform-specific elements:\n  ▶ Video/image suggestions in italic\n  ▶ Hashtags as linked search terms\n  ▶ Emojis in original positions\n  ▶ Character limits for Twitter\n  ▶ Platform-specific CTAs\n  ▶ Visual quality reminders\n- Format hashtags as:\n  <span style=\"display: inline-block; background: #f0f0f0; padding: 2px 6px; margin: 2px; border-radius: 4px;\">#tag</span>\n\nInput data: {{ $json.output.toJsonString() }}\n\nRemove ALL code blocks and comments. Output ONLY the raw HTML with:\n- Platform cards in JSON order\n- All data elements represented\n- Mobile-responsive tables\n- W3C-valid markup\n\n## Example HTML:\n<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#fbfcfe;border:1px solid #dbdfe7;border-radius:8px\">\n\t\t<tbody><tr>\n\t\t\t<td align=\"center\" style=\"padding:24px 0\">\n\t\t\t\t<table width=\"448\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:100%;max-width:448px;background-color:#ffffff;border:1px solid #dbdfe7;border-radius:8px;padding:24px\">\n\t\t\t\t\t<tbody><tr>\n\t\t\t\t\t\t<td style=\"text-align:center;padding-top:8px;font-family:Arial,sans-serif;font-size:14px;color:#7e8186\">\n\t\t\t\t\t\t\t<p style=\"white-space:pre-line\"></p><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;font-family:Arial,sans-serif;color:#333\"><tbody><tr><td style=\"padding:20px\"><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">LinkedIn</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Discover why n8n stands out as the premier workflow automation tool. Its flexibility and open-source nature empower businesses to create custom solutions that drive efficiency and innovation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Video/Image suggestion pending</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Innovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>DigitalTransformation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit workflows.diy to explore how n8n can transform your business processes!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Instagram</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Eye-catching infographic comparing n8n to other automation tools, highlighting its unique features.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The ultimate workflow automation tool! <img data-emoji=\"💡\" class=\"an1\" alt=\"💡\" aria-label=\"💡\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a1/32.png\" loading=\"lazy\"> Unlock limitless possibilities with its open-source platform. Boost your productivity and streamline your processes. <img data-emoji=\"💤\" class=\"an1\" alt=\"💤\" aria-label=\"💤\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/1f4a4/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AutomationLife</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#TechInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#WorkflowTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Programming</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Engineering</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Visit our website: <a href=\"https://n8n.io/\" target=\"_blank\" data-saferedirecturl=\"https://www.google.com/url?q=https://n8n.io/&amp;source=gmail&amp;ust=1741030878129000&amp;usg=AOvVaw1Nr6ek3eGwe94zlbPaJrzT\">https://n8n.io/</a> #AutomationLife #TechInnovation #WorkflowTips #Programming #Engineering</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Facebook</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">See why businesses are choosing n8n for their workflow automation needs. From its user-friendly interface to its powerful customization options, n8n is revolutionizing how companies approach automation.</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">A visually appealing graphic showcasing n8n's key features and benefits.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#SmallBusinessAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>Entrepreneurship</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#Leadership</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowInnovation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">What's your favorite automation tip? Share in the comments!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Twitter</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: The best #WorkflowAutomation tool! Open-source, customizable, and powerful. Transform your business processes today!</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowTrends</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AutomationTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#NoCodeSolutions</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">TikTok</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Quick demo showcasing how n8n simplifies complex workflows with its intuitive interface.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n: Your go-to for effortless workflow automation! <img data-emoji=\"✨\" class=\"an1\" alt=\"✨\" aria-label=\"✨\" draggable=\"false\" src=\"https://fonts.gstatic.com/s/e/notoemoji/16.0/2728/32.png\" loading=\"lazy\"></td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8nTips</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\"><wbr>#TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Follow workflows.diy for more automation hacks!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">Threads</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">n8n is transforming the automation landscape. Its open-source nature and extensive integrations make it a top choice for businesses of all sizes. What are your thoughts on the future of workflow automation?</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>WorkflowAutomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Share your insights below!</td></tr></tbody></table><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f9f9f9;margin-bottom:20px;padding:20px;border-radius:8px\"><tbody><tr><td style=\"font-size:20px;font-weight:bold;padding-bottom:10px\">YouTube Shorts</td></tr><tr><td style=\"font-size:14px;font-style:italic;padding-bottom:10px\">Short tutorial demonstrating how to build a simple automation workflow in n8n.</td></tr><tr><td style=\"font-size:16px;padding-bottom:10px\">Learn why n8n is the top choice for workflow automation. Its open-source platform and powerful features make it a game-changer for businesses.</td></tr><tr><td style=\"padding-bottom:10px\"><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#n8n</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#automation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowautomation</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#nocode</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>workflowsdiy</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#AIWorkflows</span><span style=\"display:inline-block;background:#f0f0f0;padding:2px 6px;margin:2px;border-radius:4px\">#<wbr>TechSolutions</span></td></tr><tr><td style=\"font-size:14px;font-weight:bold\">Subscribe for more workflow tips!</td></tr></tbody></table></td></tr></tbody></table><p></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n</table>\n", "options": {}}, "id": "88c548bf-40e5-4b89-aef0-9233c3f5bc9c", "name": "Prepare Content Review Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [2176, 560], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Gmail User for Approval", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 34, $$"aaef70d7-6029-4fae-afc1-72a6a0019b03"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Gmail User for Approval"$$::jsonb::text, $${"n8n_node": {"parameters": {"operation": "sendAndWait", "sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "=🔥FOR APPROVAL🔥{{ $('Social Media Content Factory').item.json.output.name }} - {{ $('Social Media Content Factory').item.json.output.description }}", "message": "={{ $json.output }}", "approvalOptions": {"values": {"approvalType": "double"}}, "options": {"limitWaitTime": {"values": {"resumeAmount": 45, "resumeUnit": "minutes"}}}}, "id": "aaef70d7-6029-4fae-afc1-72a6a0019b03", "name": "Gmail User for Approval", "type": "n8n-nodes-base.gmail", "position": [2736, 768], "webhookId": "c46cf421-ddb6-45a8-b83b-80b381666f0e", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, "connections": {"main": [[{"node": "Is Content Approved?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 35, $$"643b94c6-4535-4876-9660-d82ff69cbcf6"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Is Content Approved?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "e32d270f-f258-4522-94e1-2cb7ee4e8d2a", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "643b94c6-4535-4876-9660-d82ff69cbcf6", "name": "Is Content Approved?", "type": "n8n-nodes-base.if", "position": [496, 1280], "typeVersion": 2.2}, "connections": {"main": [[{"node": "OpenAI", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 36, $$"8ab03d75-b4c5-4271-8fa9-830f449a3a3c"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.openAi"$$::jsonb::text, $$"OpenAI"$$::jsonb::text, $${"n8n_node": {"parameters": {"resource": "image", "prompt": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}", "options": {}}, "id": "8ab03d75-b4c5-4271-8fa9-830f449a3a3c", "name": "OpenAI", "type": "@n8n/n8n-nodes-langchain.openAi", "position": [768, 1280], "typeVersion": 1.8, "alwaysOutputData": true, "credentials": {"openAiApi": {"id": "Q0qfR5CcE2DiTcZK", "name": "OpenAi account 3"}}}, "connections": {"main": [[{"node": "Save Image to imgbb.com3", "type": "main", "index": 0}, {"node": "Merge", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 37, $$"daa6773e-0e15-4994-bcee-b3d996655855"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Save Image to imgbb.com3"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://api.imgbb.com/1/upload", "sendQuery": true, "queryParameters": {"parameters": [{"name": "expiration", "value": "0"}, {"name": "key", "value": "={{ $env.IMGBB_API_KEY}} "}]}, "sendBody": true, "contentType": "multipart-form-data", "bodyParameters": {"parameters": [{"parameterType": "formBinaryData", "name": "image", "inputDataFieldName": "data"}]}, "options": {"redirect": {"redirect": {}}}}, "id": "daa6773e-0e15-4994-bcee-b3d996655855", "name": "Save Image to imgbb.com3", "type": "n8n-nodes-base.httpRequest", "position": [1088, 1168], "typeVersion": 4.2}, "connections": {"main": [[{"node": "Merge", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 38, $$"7b5b53eb-85c6-4a90-b209-7bd8d638f237"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "7b5b53eb-85c6-4a90-b209-7bd8d638f237", "name": "Merge", "type": "n8n-nodes-base.merge", "position": [1440, 1328], "typeVersion": 3}, "connections": {"main": [[{"node": "Set Default True 2", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 39, $$"fb7108e2-21cf-4df4-ab20-fe75b15b0a24"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Set Default True 2"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "f150aa79-2d20-4869-b60a-350d49a215a5", "name": "data", "type": "object", "value": "={\n  \"approved\": true\n}"}]}, "options": {}}, "id": "fb7108e2-21cf-4df4-ab20-fe75b15b0a24", "name": "Set Default True 2", "type": "n8n-nodes-base.set", "position": [1712, 1328], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Is Approved?", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 40, $$"b42df164-47ae-4e08-9099-d0958dd41c8f"$$::jsonb::text, $$"n8n-nodes-base.if"$$::jsonb::text, $$"Is Approved?"$$::jsonb::text, $${"n8n_node": {"parameters": {"conditions": {"options": {"version": 2, "leftValue": "", "caseSensitive": true, "typeValidation": "strict"}, "combinator": "and", "conditions": [{"id": "efe337a1-63e0-4513-873d-421bf41e4868", "operator": {"type": "boolean", "operation": "true", "singleValue": true}, "leftValue": "={{ $json.data.approved }}", "rightValue": ""}]}, "options": {}}, "id": "b42df164-47ae-4e08-9099-d0958dd41c8f", "name": "Is Approved?", "type": "n8n-nodes-base.if", "position": [1888, 1328], "typeVersion": 2.2}, "connections": {"main": [[{"node": "X Post", "type": "main", "index": 0}, {"node": "Merge1", "type": "main", "index": 1}, {"node": "Merge2", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 41, $$"d1ac29b1-128d-4615-b828-89f1f64d1b15"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge1"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {}}, "id": "d1ac29b1-128d-4615-b828-89f1f64d1b15", "name": "Merge1", "type": "n8n-nodes-base.merge", "position": [2176, 1248], "typeVersion": 3}, "connections": {"main": [[{"node": "Instagram Image", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 42, $$"71eebce8-027a-4b12-b07e-692121de9a68"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge2"$$::jsonb::text, $${"n8n_node": {"parameters": {"mode": "combine", "combineBy": "combineByPosition", "options": {"includeUnpaired": true}}, "id": "71eebce8-027a-4b12-b07e-692121de9a68", "name": "Merge2", "type": "n8n-nodes-base.merge", "position": [2176, 1984], "typeVersion": 3}, "connections": {"main": [[{"node": "Facebook Post", "type": "main", "index": 0}, {"node": "LinkedIn Post", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 43, $$"9e168865-1eae-4e53-99c9-91b041426ecb"$$::jsonb::text, $$"n8n-nodes-base.twitter"$$::jsonb::text, $$"X Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"text": "={{ $('Social Media Content Factory').item.json.output.platform_posts['X-Twitter'].post }}", "additionalFields": {}}, "id": "9e168865-1eae-4e53-99c9-91b041426ecb", "name": "X Post", "type": "n8n-nodes-base.twitter", "position": [2432, 1680], "typeVersion": 2, "alwaysOutputData": true, "credentials": {"twitterOAuth2Api": {"id": "K5y9gmrpUFKI0JmT", "name": "X account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "X Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 44, $$"af06853c-258e-4dfb-a579-3168c8de96bd"$$::jsonb::text, $$"n8n-nodes-base.httpRequest"$$::jsonb::text, $$"Instagram Image"$$::jsonb::text, $${"n8n_node": {"parameters": {"method": "POST", "url": "https://graph.facebook.com/v20.0/[your-unique-id]/media", "authentication": "predefinedCredentialType", "nodeCredentialType": "facebookGraphApi", "sendQuery": true, "queryParameters": {"parameters": [{"name": "image_url", "value": "={{ $json.data.medium.url }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}, "options": {}}, "id": "af06853c-258e-4dfb-a579-3168c8de96bd", "name": "Instagram Image", "type": "n8n-nodes-base.httpRequest", "position": [2432, 1248], "typeVersion": 4.2, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Instragram Post", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 45, $$"4ee55c94-7251-445e-8ce7-15eee7165010"$$::jsonb::text, $$"n8n-nodes-base.facebookGraphApi"$$::jsonb::text, $$"Facebook Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "photos", "sendBinaryData": true, "binaryPropertyName": "data", "options": {"queryParameters": {"parameter": [{"name": "message", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.post }}\n\n{{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}\n"}, {"name": "link", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Facebook.call_to_action }}"}]}}}, "id": "4ee55c94-7251-445e-8ce7-15eee7165010", "name": "Facebook Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1904], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Facebook Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 46, $$"3a015f3f-a162-411a-85e8-e1f042d9c653"$$::jsonb::text, $$"n8n-nodes-base.linkedIn"$$::jsonb::text, $$"LinkedIn Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"postAs": "organization", "organization": "12345678", "text": "={{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.post }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.hashtags }}\n{{ $('Social Media Content Factory').item.json.output.platform_posts.LinkedIn.call_to_action }}", "shareMediaCategory": "IMAGE", "binaryPropertyName": "=data", "additionalFields": {}}, "id": "3a015f3f-a162-411a-85e8-e1f042d9c653", "name": "LinkedIn Post", "type": "n8n-nodes-base.linkedIn", "position": [2432, 2080], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"linkedInOAuth2Api": {"id": "j4U4N6AqTwJMtEjS", "name": "LinkedIn account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "LinkedIn Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 47, $$"6f8b248f-5c79-412c-81ef-3c52bef7f257"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"X Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "X Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "6f8b248f-5c79-412c-81ef-3c52bef7f257", "name": "X Result", "type": "n8n-nodes-base.set", "position": [2768, 1680], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 1}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 48, $$"6ee72138-a8ec-4fbd-8f14-fd6e881edfd1"$$::jsonb::text, $$"n8n-nodes-base.facebookGraphApi"$$::jsonb::text, $$"Instragram Post"$$::jsonb::text, $${"n8n_node": {"parameters": {"httpRequestMethod": "POST", "graphApiVersion": "v20.0", "node": "[your-unique-id]", "edge": "media_publish", "options": {"queryParameters": {"parameter": [{"name": "creation_id", "value": "={{ $json.id }}"}, {"name": "caption", "value": "={{ $('Social Media Content Factory').item.json.output.platform_posts.Instagram.caption }}"}]}}}, "id": "6ee72138-a8ec-4fbd-8f14-fd6e881edfd1", "name": "Instragram Post", "type": "n8n-nodes-base.facebookGraphApi", "position": [2432, 1472], "typeVersion": 1, "alwaysOutputData": true, "credentials": {"facebookGraphApi": {"id": "igQ4SpjrZDjiyZnK", "name": "Facebook Graph account"}}, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Instagram Result", "type": "main", "index": 0}], []]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 49, $$"4c1ee118-aba1-4632-bd48-27cef9d5e272"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Facebook Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Facebook Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "4c1ee118-aba1-4632-bd48-27cef9d5e272", "name": "Facebook Result", "type": "n8n-nodes-base.set", "position": [2768, 1904], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 2}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 50, $$"490223f9-9b6a-4617-8829-c8e4b130feb7"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"LinkedIn Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "LinkedIn Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "490223f9-9b6a-4617-8829-c8e4b130feb7", "name": "LinkedIn Result", "type": "n8n-nodes-base.set", "position": [2768, 2080], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 3}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 51, $$"e3193aef-d115-4c3b-87b2-b8ebd5bb0c05"$$::jsonb::text, $$"n8n-nodes-base.set"$$::jsonb::text, $$"Instagram Result"$$::jsonb::text, $${"n8n_node": {"parameters": {"assignments": {"assignments": [{"id": "5c6edc76-1e3b-45b0-8baa-33a14c678150", "name": "Instagram Post Result", "type": "string", "value": "={{ $json }}"}]}, "options": {}}, "id": "e3193aef-d115-4c3b-87b2-b8ebd5bb0c05", "name": "Instagram Result", "type": "n8n-nodes-base.set", "position": [2768, 1472], "typeVersion": 3.4}, "connections": {"main": [[{"node": "Merge Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 52, $$"1955b762-b9c4-4704-955b-093686e827bd"$$::jsonb::text, $$"n8n-nodes-base.merge"$$::jsonb::text, $$"Merge Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"numberInputs": 4}, "id": "1955b762-b9c4-4704-955b-093686e827bd", "name": "Merge Results", "type": "n8n-nodes-base.merge", "position": [3072, 2080], "typeVersion": 3, "alwaysOutputData": true, "onError": "continueRegularOutput"}, "connections": {"main": [[{"node": "Aggregate", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 53, $$"140cff41-a619-4111-8dc9-3ec8fc45e061"$$::jsonb::text, $$"n8n-nodes-base.aggregate"$$::jsonb::text, $$"Aggregate"$$::jsonb::text, $${"n8n_node": {"parameters": {"aggregate": "aggregateAllItemData", "options": {}}, "id": "140cff41-a619-4111-8dc9-3ec8fc45e061", "name": "Aggregate", "type": "n8n-nodes-base.aggregate", "position": [496, 1824], "typeVersion": 1}, "connections": {"main": [[{"node": "Prepare Results Email", "type": "main", "index": 0}, {"node": "Prepare Results Message", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 54, $$"3b074887-262f-47ab-b69c-c51b3a513993"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Results Email"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a modern single line HTML table showing platform statuses. For each entry:\n\n-Extract platform name from the JSON key\n-Identify status (Success/Error) based on statusCode or error presence\n-Capture error message if present\n-Format as responsive HTML table with professional styling\n-Ensure email client compatibility with inline CSS\n-Include error handling for invalid JSON formats\n-Remove all line breaks and \\n from response.\n-Avoid any preamble or further explanation and remove all ``` and ```html from response.\n\n## Implementation Example:\nThis solution uses the parsed results from your workflow to generate:\n<table style=\"border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; margin: 20px 0; background-color: #f9f9f9; border: 1px solid #ddd;\">\n    <thead>\n        <tr style=\"background-color: #007bff; color: #fff;\">\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Platform</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Status</th>\n            <th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Details</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Instagram</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">X (Twitter)</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n        <tr style=\"background-color: #ffffff;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Facebook</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unsupported post request. Object with ID '[your-unique-id]' does not exist, cannot be loaded due to missing permissions.</td>\n        </tr>\n        <tr style=\"background-color: #f8f9fa;\">\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">LinkedIn</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px; color: #dc3545;\">✗ Error</td>\n            <td style=\"border: 1px solid #ddd; padding: 12px;\">Unable to sign without access token</td>\n        </tr>\n    </tbody>\n</table>\n\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n", "options": {}}, "id": "3b074887-262f-47ab-b69c-c51b3a513993", "name": "Prepare Results Email", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1680], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Gmail Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 55, $$"abb3994f-bf23-43f8-9c46-28795cfd2017"$$::jsonb::text, $$"@n8n/n8n-nodes-langchain.agent"$$::jsonb::text, $$"Prepare Results Message"$$::jsonb::text, $${"n8n_node": {"parameters": {"agent": "conversationalAgent", "promptType": "define", "text": "=Parse the social media post results and generate a brief summary of the results.\n\nThis is the social media post results: \n{{ $json.data.toJsonString() }}\n\n## Example Response:\nThe social media post results indicate multiple errors when attempting to access or post content on various platforms. \n\n1. Instagram: The response shows a 400 status code with an error message indicating that the specific post request is unsupported due to missing permissions or an invalid object ID. \n\n2. X Post: Success\n\n3. Facebook: Success \n\n4. LinkedIn: Also returned an 'Unable to sign without access token' error. \n\nOverall, access token issues and unsupported requests are frequent problems across these social media platforms.\n", "options": {}}, "id": "abb3994f-bf23-43f8-9c46-28795cfd2017", "name": "Prepare Results Message", "type": "@n8n/n8n-nodes-langchain.agent", "position": [736, 1968], "typeVersion": 1.7}, "connections": {"main": [[{"node": "Telegram Results", "type": "main", "index": 0}]]}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 56, $$"1cf97c10-e60f-4584-b069-3d4506868d8e"$$::jsonb::text, $$"n8n-nodes-base.gmail"$$::jsonb::text, $$"Gmail Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"sendTo": "={{ $env.EMAIL_ADDRESS_JOE }} ", "subject": "🔥RESULTS🔥 Social Media Factory", "message": "={{ $json.output }}", "options": {"appendAttribution": false}}, "id": "1cf97c10-e60f-4584-b069-3d4506868d8e", "name": "Gmail Results", "type": "n8n-nodes-base.gmail", "position": [1088, 1680], "webhookId": "0a81b95a-cd82-465d-8450-cf38518a4cbb", "typeVersion": 2.1, "credentials": {"gmailOAuth2": {"id": "6s1rUEEqTAQJ9ZUu", "name": "Gmail account"}}}, "connections": {}}$$::jsonb);
INSERT INTO workflow_steps (workflow_key, step_order, step_id, step_type, description, config)
VALUES ($$"N8N-social_media__Automate_Multi-Platform_Social_Media_Content_Creation_with_AI"$$::jsonb::text, 57, $$"c845ae46-9d37-472b-ae0f-49fc6940e685"$$::jsonb::text, $$"n8n-nodes-base.telegram"$$::jsonb::text, $$"Telegram Results"$$::jsonb::text, $${"n8n_node": {"parameters": {"chatId": "={{ $env.TELEGRAM_CHAT_ID }}", "text": "={{ $json.output }}", "additionalFields": {"appendAttribution": false}}, "id": "c845ae46-9d37-472b-ae0f-49fc6940e685", "name": "Telegram Results", "type": "n8n-nodes-base.telegram", "position": [1088, 1968], "webhookId": "bb40ede7-03cf-493d-b051-196b96725925", "typeVersion": 1.2, "credentials": {"telegramApi": {"id": "0JxGbAnpImpz1Tne", "name": "Telegram account"}}}, "connections": {}}$$::jsonb);
